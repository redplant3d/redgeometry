var Qn="{",Nn="}";function ut(a,...t){let e={value:0},n="",i=0,s=!1,r=!1;for(let o=0;o<a.length;o++){let c=a[o];if(c===Qn)if(!r)n+=a.substring(i,o),i=o+1,r=!0;else if(a[o-1]===Qn)r=!1;else{s=!0;break}else if(c===Nn)if(r){let u=a.substring(i,o);n+=mi(t,e,u),i=o+1,r=!1}else if(a[o+1]===Nn)n+=a.substring(i,o),i=o+1,o=i;else{s=!0;break}}if(s||r)throw new Error("Invalid format string");return n+=a.substring(i),n}function mi(a,t,e){let n=Number.parseInt(e);return(Number.isNaN(n)||n<0)&&(n=t.value,t.value+=1),String(a[n])}var re=class{errorFn;infoFn;warnFn;constructor(t){this.errorFn=t.errorFn,this.infoFn=t.infoFn,this.warnFn=t.warnFn}static getStackTrace(t){let e=t.stack;if(e!==void 0){let n=e.indexOf(`
`);return e.substring(n)}else return}assert(t,e,...n){if(!t){let i=ut(e,...n);this.errorFn(i)}}assertDebug(t,e,...n){}assertFn(t,e,...n){if(!t()){let i=ut(e,...n);this.errorFn(i)}}assertFnDebug(t,e,...n){}error(t,...e){let n=ut(t,...e);this.errorFn(n)}errorDebug(t,...e){}info(t,...e){let n=ut(t,...e);this.infoFn(n)}infoDebug(t,...e){}warn(t,...e){let n=ut(t,...e);this.warnFn(n)}warnDebug(t,...e){}};var v=new re({errorFn:console.error,warnFn:console.warn,infoFn:console.info});function Yn(a,t,...e){if(!a){let n=ut(t??"Assertion failed",...e);throw new Error(n)}}function T(a,t,...e){}function F(a){let t=ut("Object with value '{}' must not exist",a);throw new Error(t)}function wn(a,...t){let e=ut(a,...t);throw new Error(e)}var oe=class{callbackContext;constructor(t,e,n){this.callbackContext={provider:t,target:e,callback:n,requestHandle:0}}startAnimation(){let t=this.callbackContext;if(t.requestHandle!==0)return;let e=n=>{t.callback(n,t.target),t.requestHandle=t.provider.requestAnimationFrame(e)};t.requestHandle=t.provider.requestAnimationFrame(e)}stepAnimation(){let t=this.callbackContext;if(t.requestHandle!==0)return;let e=n=>{t.callback(n,t.target),t.requestHandle=0};t.requestHandle=t.provider.requestAnimationFrame(e)}stopAnimation(){let t=this.callbackContext;t.provider.cancelAnimationFrame(t.requestHandle),t.requestHandle=0}};function Xn(a,t,e){let n=Math.min(a,t),i=Math.max(a,t);return nt(n,i,e)}function Un(a,t,e){let n=Math.min(a,t),i=Math.max(a,t);n=Math.ceil(n),i=Math.floor(i);let s=nt(n,i,e);return Math.ceil(s)}function L(a,t,e){return a<=t?t:a>=e?e:a}function nt(a,t,e){return a+e*(t-a)}function Vt(a,t){return Math.round(t*a)/t}var C=class a{static ONE=new a(1,1);static UNIT_X=new a(1,0);static UNIT_Y=new a(0,1);static ZERO=new a(0,0);x;y;constructor(t,e){this.x=t,this.y=e}static fromArray(t,e=0){return new a(t[e],t[e+1])}static fromObject(t){return new a(t.x,t.y)}static fromXYW(t,e,n){return new a(t/n,e/n)}static isBetweenCcw(t,e,n){return e.cross(n)>0?e.cross(t)>0&&n.cross(t)<0:e.cross(t)>0||n.cross(t)<0}add(t){return new a(this.x+t.x,this.y+t.y)}addMul(t,e){let n=this.x+e*t.x,i=this.y+e*t.y;return new a(n,i)}addPt(t){return new b(t.x+this.x,t.y+this.y)}angle(){return Math.atan2(this.y,this.x)}clamp(t,e){let n=L(this.x,t.x,e.x),i=L(this.y,t.y,e.y);return new a(n,i)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y}cross(t){return this.x*t.y-this.y*t.x}div(t){return new a(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}eq(t){return this.x===t.x&&this.y===t.y}isZero(){return this.x===0&&this.y===0}len(){return Math.sqrt(this.lenSq())}lenSq(){return this.x*this.x+this.y*this.y}mul(t){return new a(t*this.x,t*this.y)}neg(){return new a(-this.x,-this.y)}normal(){return new a(this.y,-this.x)}sub(t){return new a(this.x-t.x,this.y-t.y)}toArray(){return[this.x,this.y]}toPoint(){return new b(this.x,this.y)}toString(){return`{x: ${this.x}, y: ${this.y}}`}unit(){return this.div(this.len())}unitOrZero(){let t=this.len();return t>0?this.div(t):a.ZERO}},pt=class a{static ONE=new a(1,1,1);static UNIT_X=new a(1,0,0);static UNIT_Y=new a(0,1,0);static UNIT_Z=new a(0,0,1);static ZERO=new a(0,0,0);x;y;z;constructor(t,e,n){this.x=t,this.y=e,this.z=n}static fromArray(t,e=0){return new a(t[e],t[e+1],t[e+2])}static fromObject(t){return new a(t.x,t.y,t.z)}static fromXY(t,e){return new a(t,e,1)}static fromXYW(t,e,n){return new a(n*t,n*e,n)}static fromXYZW(t,e,n,i){return new a(t/i,e/i,n/i)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}addMul(t,e){let n=this.x+e*t.x,i=this.y+e*t.y,s=this.z+e*t.z;return new a(n,i,s)}addPt(t){return new z(t.x+this.x,t.y+this.y,t.z+this.z)}clamp(t,e){let n=L(this.x,t.x,e.x),i=L(this.y,t.y,e.y),s=L(this.z,t.z,e.z);return new a(n,i,s)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z}cross(t){let e=this.y*t.z-this.z*t.y,n=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return new a(e,n,i)}div(t){return new a(this.x/t,this.y/t,this.z/t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}eq(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}len(){return Math.sqrt(this.lenSq())}lenSq(){return this.x*this.x+this.y*this.y+this.z*this.z}mul(t){return new a(t*this.x,t*this.y,t*this.z)}neg(){return new a(-this.x,-this.y,-this.z)}normalX(){return new a(0,this.z,-this.y)}normalY(){return new a(-this.z,0,this.x)}normalZ(){return new a(this.y,-this.x,0)}sub(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}toArray(){return[this.x,this.y,this.z]}toPoint(){return new z(this.x,this.y,this.z)}toString(){return`{x: ${this.x}, y: ${this.y}, z: ${this.z}}`}unit(){return this.div(this.len())}unitOrZero(){let t=this.len();return t>0?this.div(t):a.ZERO}};var b=class a{static ZERO=new a(0,0);x;y;constructor(t,e){this.x=t,this.y=e}static fromArray(t,e=0){return new a(t[e],t[e+1])}static fromObject(t){return new a(t.x,t.y)}static fromXYW(t,e,n){return new a(t/n,e/n)}static isPointInTriangle(t,e,n,i){let s=i.sub(t),r=e.sub(t),o=n.sub(t),c=s.cross(o),u=r.cross(s),l=r.cross(o);return l>0?c>0&&u>0&&c+u<l:c<0&&u<0&&c+u>l}static roundToPrecision(t,e){let n=Vt(t.x,e),i=Vt(t.y,e);return new a(n,i)}static signedArea(t,e,n){let i=e.sub(t),s=n.sub(t);return i.cross(s)}add(t){return new a(this.x+t.x,this.y+t.y)}addMul(t,e){let n=this.x+e*t.x,i=this.y+e*t.y;return new a(n,i)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y}eq(t){return this.x===t.x&&this.y===t.y}gt(t){return this.x===t.x?this.y>t.y:this.x>t.x}gte(t){return this.x===t.x?this.y>=t.y:this.x>t.x}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.x)}isZero(){return this.x===0&&this.y===0}lerp(t,e){let n=nt(this.x,t.x,e),i=nt(this.y,t.y,e);return new a(n,i)}lt(t){return this.x===t.x?this.y<t.y:this.x<t.x}lte(t){return this.x===t.x?this.y<=t.y:this.x<t.x}sub(t){return new C(this.x-t.x,this.y-t.y)}toArray(){return[this.x,this.y]}toString(){return`{x: ${this.x}, y: ${this.y}}`}toVector(){return new C(this.x,this.y)}},z=class a{static ZERO=new a(0,0,0);x;y;z;constructor(t,e,n){this.x=t,this.y=e,this.z=n}static fromArray(t,e=0){return new a(t[e],t[e+1],t[e+2])}static fromObject(t){return new a(t.x,t.y,t.z)}static fromXY(t,e){return new a(t,e,1)}static fromXYW(t,e,n){return new a(n*t,n*e,n)}static fromXYZW(t,e,n,i){return new a(t/i,e/i,n/i)}static max(t,e){return new a(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}static min(t,e){return new a(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static round(t){return new a(Math.round(t.x),Math.round(t.y),Math.round(t.z))}static roundToPrecision(t,e){let n=Vt(t.x,e),i=Vt(t.y,e),s=Vt(t.z,e);return new a(n,i,s)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}addMul(t,e){let n=this.x+e*t.x,i=this.y+e*t.y,s=this.z+e*t.z;return new a(n,i,s)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z}eq(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.x)&&Number.isFinite(this.y)}lerp(t,e){let n=nt(this.x,t.x,e),i=nt(this.y,t.y,e),s=nt(this.z,t.z,e);return new a(n,i,s)}sub(t){return new pt(this.x-t.x,this.y-t.y,this.z-t.z)}toArray(){return[this.x,this.y,this.z]}toString(){return`{x: ${this.x}, y: ${this.y}, z: ${this.z}}`}toVector(){return new pt(this.x,this.y,this.z)}};var lt=class a{a;b;constructor(t,e){this.a=t,this.b=e}static fromUnordered(t,e){return t<=e?new a(t,e):new a(e,t)}clamp(t,e){let n=Math.max(this.a,t),i=Math.min(this.b,e);return new a(n,i)}contains(t){return this.a<t&&this.b>t}diameter(){return this.b-this.a}encloseInterval(t){let e=Math.min(this.a,t.a),n=Math.max(this.b,t.b);return new a(e,n)}encloseValue(t){let e=Math.min(this.a,t),n=Math.max(this.b,t);return new a(e,n)}intersects(t){return this.a<t.b&&this.b>t.a}isDegenerate(){return this.a===this.b}isEmpty(){return this.a>this.b}mid(){return .5*(this.a+this.b)}widen(t){return new a(this.a-t,this.b+t)}withEnd(t){return new a(this.a,t)}withStart(t){return new a(t,this.b)}};function mt(a,t){return-t/a}function $(a,t,e){let n=t*t-a*e;if(n<0)return{type:0};{let i,s;return n=Math.sqrt(n),t>0?(n=-t-n,i=e/n,s=n/a):t<0?(n=-t+n,i=n/a,s=e/n):a*a>=e*e?(i=n/a,s=-n/a):(i=e/-n,s=e/n),{type:2,x1:i,x2:s}}}function ae(a,t,e,n){let i=a*e-t*t,s=a*n-t*e,r=t*n-e*e,o=4*i*r-s*s;if(o<0){let c;if(t*t*t*n>=a*e*e*e){let u=2*t*i-a*s,p=(u<0?-1:1)*Math.abs(a)*Math.sqrt(-o),h=p+u,d=Math.cbrt(.5*h),m=p===h?-d:-i/d;c=((i<=0?d+m:u/(d*d+m*m+i))-t)/a}else{let u=n*s-2*e*r,p=(u<0?-1:1)*Math.abs(n)*Math.sqrt(-o),h=p+u,d=Math.cbrt(.5*h),m=p===h?-d:-r/d,f=r<=0?d+m:u/(d*d+m*m+r);c=-n/(f+e)}return{type:1,x:c}}else{let c=Math.sqrt(o),u=2*t*i-a*s,l=n*s-2*e*r,p=Math.abs(Math.atan2(a*c,u)/3),h=Math.abs(Math.atan2(n*c,l)/3),d=2*Math.sqrt(-i),m=2*Math.sqrt(-r),f=Math.cos(p),y=Math.cos(h),x=d*f,M=m*y,k=-d*(.5*f+.8660254037844386*Math.sin(p)),B=-m*(.5*y+.8660254037844386*Math.sin(h)),I=x+k>2*t?x-t:k-t,X=a,Z=-n,g=M+B<2*e?M+e:B+e,Ut=X*g,Rt=-I*g-X*Z,Wt=I*Z,Zt=e*Rt-t*Wt,jt=e*Ut-t*Rt;return{type:3,x1:I/X,x2:Z/g,x3:Zt/jt}}}function ot(a,t,e){e>0&&e<1&&t.enclose(a.getValueAt(e))}function $t(a,t,e,n){if(e>0&&e<1){let i=a.getValueAt(e).sub(t).lenSq();i<n.distSq&&(n.param=e,n.distSq=i)}}function Wn(a,t,e){if(t<0||t>1)return 0;let n=nt(a.p0.x,a.p1.x,t),i=a.p0.y-a.p1.y;return pe(e,n,i)}function En(a,t,e){if(t<0||t>1)return 0;let n=a.p0.lerp(a.p1,t),i=a.p1.lerp(a.p2,t),s=nt(n.x,i.x,t),r=n.y-i.y;return pe(e,s,r)}function Kt(a,t,e){if(t<0||t>1)return 0;let n=a.p0.lerp(a.p1,t),i=a.p1.lerp(a.p2,t),s=a.p2.lerp(a.p3,t),r=n.lerp(i,t),o=i.lerp(s,t),c=nt(r.x,o.x,t),u=r.y-o.y;return pe(e,c,u)}function Sn(a,t,e){if(t<0||t>1)return 0;let[n,i,s]=a.getProjectivePoints(),r=n.lerp(i,t),o=i.lerp(s,t),c=r.lerp(o,t),u=c.x/c.z,l=c.y*(o.z-r.z)-c.z*(o.y-r.y);return pe(e,u,l)}function pe(a,t,e){return a<t||e===0?0:e<0?-1:1}function ce(a,t,e,n,i,s){let r=8881784197001252e-31;if(!i.intersects(t))return;let o=i.clamp(t.a,t.b);v.infoDebug("Intersection candidate: [{}, {}]",o.a,o.b),o.diameter()<r?(v.infoDebug("Intersection found at t = {} (Diam: {})",o.mid(),o.diameter()),s.push(a.getValueAt(o.mid()))):Tn(e,n,a,o,s)}function Tn(a,t,e,n,i){let s=e.splitBetween(n.a,n.b),r=.5*b.signedArea(s.p0,s.p2,s.p1),o=b.signedArea(s.p0,s.p2,a.p0),c=b.signedArea(s.p0,s.p2,a.p1),u=b.signedArea(s.p0,s.p2,a.p2),l=c-o,p=u-c,h=Math.min(0,r),d=Math.max(0,r),m=$(p-l,l,o-h),f=$(p-l,l,o-d);if(m.type===2&&f.type===2){let y=lt.fromUnordered(m.x1,f.x1),x=lt.fromUnordered(m.x2,f.x2);ce(a,t,e,n,y,i),ce(a,t,e,n,x,i)}else if(m.type===2){let y=lt.fromUnordered(m.x1,m.x2);ce(a,t,e,n,y,i)}else if(f.type===2){let y=lt.fromUnordered(f.x1,f.x2);ce(a,t,e,n,y,i)}}function Zn(a){let t=0,[e,n]=a.getDerivativeCoefficients();return t+=ue(.1739274225687269,.06943184420297371,e,n),t+=ue(.3260725774312731,.3300094782075719,e,n),t+=ue(.3260725774312731,.6699905217924281,e,n),t+=ue(.1739274225687269,.9305681557970263,e,n),t}function An(a,t){let e=a.p1.sub(a.p0).len(),n=a.p2.sub(a.p1).len(),i=$(n-e,e,-t);return i.type===2?i.x1:1}function ue(a,t,e,n){let i=e.mul(t).add(n);return a*i.len()}var R=class a{x0;x1;y0;y1;constructor(t,e,n,i){this.x0=t,this.y0=e,this.x1=n,this.y1=i}static createEmpty(){return new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}static fromPoints(t,e){let n=Math.min(t.x,e.x),i=Math.min(t.y,e.y),s=Math.max(t.x,e.x),r=Math.max(t.y,e.y);return new a(n,i,s,r)}static fromXYWH(t,e,n,i){let s=Math.min(t,t+n),r=Math.min(e,e+i),o=Math.max(t,t+n),c=Math.max(e,e+i);return new a(s,r,o,c)}contains(t){return this.x0<t.x&&this.y0<t.y&&this.x1>t.x&&this.y1>t.y}containsInclusive(t){return this.x0<=t.x&&this.y0<=t.y&&this.x1>=t.x&&this.y1>=t.y}dx(){return this.x1-this.x0}dy(){return this.y1-this.y0}enclose(t){this.x0=Math.min(this.x0,t.x),this.y0=Math.min(this.y0,t.y),this.x1=Math.max(this.x1,t.x),this.y1=Math.max(this.y1,t.y)}getCenter(){return new b(.5*(this.x0+this.x1),.5*(this.y0+this.y1))}intersects(t){return this.x0<t.x1&&this.x1>t.x0&&this.y0<t.y1&&this.y1>t.y0}intersectsInclusive(t){return this.x0<=t.x1&&this.x1>=t.x0&&this.y0<=t.y1&&this.y1>=t.y0}isEmpty(){return this.x0>this.x1||this.y0>this.y1}isPoint(){return this.x0===this.x1&&this.y0===this.y1}scale(t,e){let n=.5*(t-1)*this.dx(),i=.5*(e-1)*this.dy();return this.scaleAbsolute(n,i)}scaleAbsolute(t,e){return new a(this.x0-t,this.y0-e,this.x1+t,this.y1+e)}toString(){return`{x0: ${this.x0}, y0: ${this.y0}, x1: ${this.x1}, y1: ${this.y1}}`}union(t){this.x0=Math.min(this.x0,t.x0),this.y0=Math.min(this.y0,t.y0),this.x1=Math.max(this.x1,t.x1),this.y1=Math.max(this.y1,t.y1)}},le=class a{x0;x1;y0;y1;z0;z1;constructor(t,e,n,i,s,r){this.x0=t,this.y0=e,this.z0=n,this.x1=i,this.y1=s,this.z1=r}static createEmpty(){return new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}static fromPoints(t,e){let n=Math.min(t.x,e.x),i=Math.min(t.y,e.y),s=Math.min(t.z,e.z),r=Math.max(t.x,e.x),o=Math.max(t.y,e.y),c=Math.max(t.z,e.z);return new a(n,i,s,r,o,c)}contains(t){return this.x0<t.x&&this.y0<t.y&&this.z0<t.z&&this.x1>t.x&&this.y1>t.y&&this.z1>t.z}containsInclusive(t){return this.x0<=t.x&&this.y0<=t.y&&this.z0<=t.z&&this.x1>=t.x&&this.y1>=t.y&&this.z1>=t.z}dx(){return this.x1-this.x0}dy(){return this.y1-this.y0}dz(){return this.z1-this.z0}enclose(t){this.x0=Math.min(this.x0,t.x),this.y0=Math.min(this.y0,t.y),this.z0=Math.min(this.z0,t.z),this.x1=Math.max(this.x1,t.x),this.y1=Math.max(this.y1,t.y),this.z1=Math.max(this.z1,t.z)}getCenter(){return new z(.5*(this.x0+this.x1),.5*(this.y0+this.y1),.5*(this.z0+this.z1))}intersects(t){return this.x0<t.x1&&this.x1>t.x0&&this.y0<t.y1&&this.y1>t.y0&&this.z0<t.z1&&this.z1>t.z0}intersectsInclusive(t){return this.x0<=t.x1&&this.x1>=t.x0&&this.y0<=t.y1&&this.y1>=t.y0&&this.z0<=t.z1&&this.z1>=t.z0}isEmpty(){return this.x0>this.x1||this.y0>this.y1||this.z0>this.z1}isPoint(){return this.x0===this.x1&&this.y0===this.y1&&this.z0===this.z1}scale(t,e,n){let i=.5*(t-1)*this.dx(),s=.5*(e-1)*this.dy(),r=.5*(n-1)*this.dz();return this.scaleAbsolute(i,s,r)}scaleAbsolute(t,e,n){return new a(this.x0-t,this.y0-e,this.z0-n,this.x1+t,this.y1+e,this.z1+n)}toString(){return`{x0: ${this.x0}, y0: ${this.y0}, z0: ${this.z0}, x1: ${this.x1}, y1: ${this.y1}}, z1: ${this.z1}}`}union(t){this.x0=Math.min(this.x0,t.x0),this.y0=Math.min(this.y0,t.y0),this.z0=Math.min(this.z0,t.z0),this.x1=Math.max(this.x1,t.x1),this.y1=Math.max(this.y1,t.y1),this.z1=Math.max(this.z1,t.z1)}};var E=class a{p0;p1;constructor(t,e){this.p0=t,this.p1=e}static clip(t,...e){let n=t;for(let i of e){let[s]=a.getIntersectionParameter(n,i),r=b.signedArea(i.p0,i.p1,n.p0);if(s>0&&s<1){let o=n.getValueAt(s);r<=0?n=new a(o,n.p1):n=new a(n.p0,o)}else if(r<=0)return}if(!n.isPoint())return n}static fromArray(t,e=0){return new a(t[e],t[e+1])}static fromObject(t){return new a(t.p0,t.p1)}static fromXY(t,e,n,i){let s=new b(t,e),r=new b(n,i);return new a(s,r)}static getCircleIntersectionParameter(t,e,n){let i=t.p1.sub(t.p0),s=e.sub(t.p0),r=i.dot(i),o=i.dot(s.neg()),c=s.dot(s)-n*n,u=$(r,o,c);if(u.type===2){let l=u.x1,p=u.x2;return[l,p]}else return}static getClosestDistance(t,e){let[n,i]=a.getClosestParameter(t,e),s=t.getValueAt(n),r=e.getValueAt(i);return s.sub(r).len()}static getClosestParameter(t,e){let n=t.vector(),i=e.vector(),s=t.p0.sub(e.p0),r=n.dot(n),o=n.dot(i),c=i.dot(i),u=n.dot(s),l=i.dot(s),p=r*c-o*o,h,d;if(p>0){let m=o*l-c*u,f=r*l-o*u;m<=0?l<=0?(h=L(-u/r,0,1),d=0):l<c?(h=0,d=l/c):(h=L((o-u)/r,0,1),d=1):p<=m?o+l<=0?(h=L(-u/r,0,1),d=0):o+l<c?(h=1,d=(o+l)/c):(h=L((o-u)/r,0,1),d=1):f<=0?(h=L(-u/r,0,1),d=0):f<p?(h=m/p,d=f/p):(h=L((o-u)/r,0,1),d=1)}else l<=0?(h=L(-u/r,0,1),d=0):l<c?(h=0,d=l/c):(h=L((o-u)/r,0,1),d=1);return[h,d]}static getIntersection(t,e){let n=t.vector(),i=e.vector(),s=n.cross(i);if(s!==0){let r=e.p0.sub(t.p0),o=r.cross(i)/s,c=r.cross(n)/s;if(o>=0&&o<=1&&c>=0&&c<=1)return t.getValueAt(o)}}static getIntersectionParameter(t,e){let n,i=t.vector(),s=e.vector(),r=i.cross(s);if(r!==0){let o=e.p0.sub(t.p0),c=o.cross(s)/r,u=o.cross(i)/r;n=[c,u]}else n=[Number.NaN,Number.NaN];return n}static isAdjacent(t,e){return t.p0.eq(e.p0)||t.p0.eq(e.p1)||t.p1.eq(e.p0)||t.p1.eq(e.p1)}static isEqual(t,e){return t.p0.eq(e.p0)&&t.p1.eq(e.p1)}static isIntersection(t,e){let n=b.signedArea(t.p0,t.p1,e.p0),i=b.signedArea(t.p0,t.p1,e.p1),s=n*i;if(s>0)return!1;let r=b.signedArea(e.p0,e.p1,t.p0),o=b.signedArea(e.p0,e.p1,t.p1),c=r*o;return c>0?!1:s*c>0?!0:!!(n===0&&t.isPointInside(e.p0)||i===0&&t.isPointInside(e.p1)||r===0&&e.isPointInside(t.p0)||o===0&&e.isPointInside(t.p1))}static isOpposite(t,e){return t.p0.eq(e.p1)&&t.p1.eq(e.p0)}eq(t){return this.p0.eq(t.p0)&&this.p1.eq(t.p1)}getBounds(){return R.fromPoints(this.p0,this.p1)}getClosestPoint(t){let e=this.getParameterFromPoint(t);return e<=0?this.p0:e>=1?this.p1:this.getValueAt(e)}getClosestPointDistance(t){return this.getClosestPoint(t).sub(t).len()}getParameterFromPoint(t){let e=this.vector(),n=t.sub(this.p0);return e.dot(n)/e.lenSq()}getSignedDistanceFromPoint(t){let e=this.vector(),n=this.p0.sub(t);return e.cross(n)/e.len()}getValueAt(t){return this.p0.lerp(this.p1,t)}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()}isPoint(){return this.p0.eq(this.p1)}isPointInside(t){let e=this.getParameterFromPoint(t);return e>=0&&e<=1}normal(){let t=this.vector().normal();return new a(this.p0,this.p0.add(t))}reverse(){return new a(this.p1,this.p0)}toBezier(){return new S(this.p0,this.p1)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}translate(t){return new a(this.p0.add(t),this.p1.add(t))}vector(){return this.p1.sub(this.p0)}},J=class a{p0;p1;constructor(t,e){this.p0=t,this.p1=e}static fromArray(t,e=0){return new a(t[e],t[e+1])}static fromObject(t){return new a(t.p0,t.p1)}static fromXYZ(t,e,n,i,s,r){let o=new z(t,e,n),c=new z(i,s,r);return new a(o,c)}static isAdjacent(t,e){return t.p0.eq(e.p0)||t.p0.eq(e.p1)||t.p1.eq(e.p0)||t.p1.eq(e.p1)}static isEqual(t,e){return t.p0.eq(e.p0)&&t.p1.eq(e.p1)}static isOpposite(t,e){return t.p0.eq(e.p1)&&t.p1.eq(e.p0)}eq(t){return this.p0.eq(t.p0)&&this.p1.eq(t.p1)}getBounds(){return le.fromPoints(this.p0,this.p1)}getClosestPoint(t){let e=this.getParameterFromPoint(t);return e<=0?this.p0:e>=1?this.p1:this.getValueAt(e)}getClosestPointDistance(t){return this.getClosestPoint(t).sub(t).len()}getDistanceFromPoint(t){let e=this.vector(),n=this.p0.sub(t);return e.cross(n).len()/e.len()}getNormalAround(t){let e=this.vector().cross(t);return new a(this.p0,this.p0.add(e))}getParameterFromPoint(t){let e=this.vector(),n=t.sub(this.p0);return e.dot(n)/e.lenSq()}getProjectedEdge(t,e){let n=E.fromXY(this.p0.x,this.p0.y,this.p1.x,this.p1.y),i=n.getParameterFromPoint(t),s=n.getParameterFromPoint(e);return new a(this.getValueAt(i),this.getValueAt(s))}getValueAt(t){return this.p0.lerp(this.p1,t)}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()}reverse(){return new a(this.p1,this.p0)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}translate(t){return new a(this.p0.add(t),this.p1.add(t))}vector(){return this.p1.sub(this.p0)}};var S=class a{p0;p1;constructor(t,e){this.p0=t,this.p1=e}get pn(){return this.p1}get type(){return 0}static fromXY(t,e,n,i){let s=new b(t,e),r=new b(n,i);return new a(s,r)}static getIntersectionParameter(t,e){let n,i=t.p1.sub(t.p0),s=e.p1.sub(e.p0),r=e.p0.sub(t.p0),o=i.cross(s);if(o!==0){let c=r.cross(s)/o,u=r.cross(i)/o;n=[c,u]}else n=[Number.NaN,Number.NaN];return n}getBounds(){return R.fromPoints(this.p0,this.p1)}getControlBounds(){return R.fromPoints(this.p0,this.p1)}getDerivative(){return this.p1.sub(this.p0)}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector();return t.cross(e)/2}getTangentEnd(){return this.getDerivative()}getTangentStart(){return this.getDerivative()}getValueAt(t){return this.p0.lerp(this.p1,t)}getWindingAt(t){let e=this.p0.y-t.y,n=this.p1.y-this.p0.y,i=mt(n,e);return Wn(this,i,t.x)}getWindingFracAt(t,e){let n=this.getDerivative(),i=0;for(let s=0;s<1;s+=e){let r=this.getValueAt(s).sub(t);i+=r.cross(n)/r.dot(r)}return e*i}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()}isPoint(){return this.p0.eq(this.p1)}reverse(){return new a(this.p1,this.p0)}splitAfter(t){let e=this.p0.lerp(this.p1,t);return new a(e,this.p1)}splitAt(t){let e=this.p0.lerp(this.p1,t),n=new a(this.p0,e),i=new a(e,this.p1);return[n,i]}splitBefore(t){let e=this.p0.lerp(this.p1,t);return new a(this.p0,e)}splitBetween(t,e){let n=this.p0.lerp(this.p1,t),i=this.p0.lerp(this.p1,e);return new a(n,i)}toEdge(){return new E(this.p0,this.p1)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}},A=class a{p0;p1;p2;constructor(t,e,n){this.p0=t,this.p1=e,this.p2=n}get pn(){return this.p2}get type(){return 1}static fromXY(t,e,n,i,s,r){let o=new b(t,e),c=new b(n,i),u=new b(s,r);return new a(o,c,u)}getBounds(){let t=R.fromPoints(this.p0,this.p2),[e,n]=this.getDerivativeCoefficients(),i=mt(e.x,n.x),s=mt(e.y,n.y);return ot(this,t,i),ot(this,t,s),t}getClosestParameter(t){let e=this.p0.sub(t),n=this.p1.sub(this.p0),i=this.p2.sub(this.p1),s=n.dot(e),r=n.dot(n),o=i.dot(e),c=i.dot(n),l=2*(i.dot(i)-c-c+r),p=2*(c-r),h=2/3*(o+r+r-s),d=2*s,m=ae(l,p,h,d),f=this.p0.sub(t).lenSq(),y=this.p2.sub(t).lenSq(),x=f<y?{param:0,distSq:f}:{param:1,distSq:y};return m.type===3?($t(this,t,m.x1,x),$t(this,t,m.x2,x),$t(this,t,m.x3,x)):$t(this,t,m.x,x),x.param}getCoefficients(){let t=this.p1.sub(this.p0),n=this.p2.sub(this.p1).sub(t),i=t.add(t),s=this.p0;return[n,i,s]}getControlBounds(){let t=R.fromPoints(this.p0,this.p2);return t.enclose(this.p1),t}getCurvatureAt(t){let[e,n]=this.getDerivativeCoefficients(),i=e.mul(t).add(n),s=e,r=i.len();return i.cross(s)/(r*r*r)}getCurvatureMetric(){let[t,e]=this.getDerivativeCoefficients();return t.cross(e)}getDerivativeAt(t){let e=this.p0.lerp(this.p1,t);return this.p1.lerp(this.p2,t).sub(e).mul(2)}getDerivativeCoefficients(){let t=this.p1.sub(this.p0),n=this.p2.sub(this.p1).sub(t).mul(2),i=t.add(t);return[n,i]}getEvoluteAt(t){let[e,n,i]=this.getCoefficients(),s=e.mul(t).add(n).mul(t).addPt(i),r=e.mul(2*t).add(n),o=e.mul(2);return s.addMul(r.normal(),r.lenSq()/r.cross(o))}getOffsetCuspParameter(t){let[e,n]=this.getDerivativeCoefficients(),i=e.lenSq(),s=n.lenSq(),r=e.cross(n),o=e.dot(n),c=1/i,u=c*-o,l=0;if(r!==0){let p=Math.cbrt(t*t*r*r),h=Math.sqrt(o*o-i*(s-p));l=c*h}return[u,l]}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector(),n=this.p2.toVector(),i=2*t.cross(e),s=2*e.cross(n),r=t.cross(n);return(i+r+s)/6}getTangentEnd(){return this.p2.eq(this.p1)?this.p1.sub(this.p0):this.p2.sub(this.p1)}getTangentStart(){return this.p1.eq(this.p0)?this.p2.sub(this.p1):this.p1.sub(this.p0)}getValueAt(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t);return e.lerp(n,t)}getVertexParameter(){let[t,e]=this.getDerivativeCoefficients();return t.dot(e.neg())/t.lenSq()}getWindingAt(t){let e=this.p0.y-t.y,n=this.p1.y-this.p0.y,i=this.p2.y-this.p1.y,s=$(i-n,n,e),r=0;return s.type===2&&(r+=En(this,s.x1,t.x),r+=En(this,s.x2,t.x)),r}getWindingFracAt(t,e){let n=0;for(let i=0;i<1;i+=e){let s=this.getValueAt(i).sub(t),r=this.getDerivativeAt(i);n+=s.cross(r)/s.dot(s)}return e*n}intersectLine(t,e){let n=b.signedArea(t.p0,t.p1,this.p0),i=b.signedArea(t.p0,t.p1,this.p1),s=b.signedArea(t.p0,t.p1,this.p2),r=i-n,o=s-i,c=$(o-r,r,n);c.type===2&&(c.x1>=0&&c.x1<=1&&e.push(c.x1),c.x2>=0&&c.x2<=1&&e.push(c.x2))}intersectQuad(t,e){let n=new lt(0,1),i=new lt(0,1);Tn(this,n,t,i,e)}isCollinear(){return this.getCurvatureMetric()===0}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()&&this.p2.isFinite()}isPoint(){return this.p0.eq(this.p1)&&this.p1.eq(this.p2)}reverse(){return new a(this.p2,this.p1,this.p0)}splitAfter(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=e.lerp(n,t);return new a(i,n,this.p2)}splitAt(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=e.lerp(n,t),s=new a(this.p0,e,i),r=new a(i,n,this.p2);return[s,r]}splitBefore(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=e.lerp(n,t);return new a(this.p0,e,i)}splitBetween(t,e){let n=this.p0.lerp(this.p1,t),i=this.p0.lerp(this.p1,e),s=this.p1.lerp(this.p2,t),r=this.p1.lerp(this.p2,e),o=n.lerp(s,t),c=i.lerp(r,t),u=i.lerp(r,e);return new a(o,c,u)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}, p2: ${this.p2}}`}},U=class a{p0;p1;p2;p3;constructor(t,e,n,i){this.p0=t,this.p1=e,this.p2=n,this.p3=i}get pn(){return this.p3}get type(){return 2}static fromXY(t,e,n,i,s,r,o,c){let u=new b(t,e),l=new b(n,i),p=new b(s,r),h=new b(o,c);return new a(u,l,p,h)}getBounds(){let t=R.fromPoints(this.p0,this.p3),[e,n,i]=this.getDerivativeCoefficients(),s=$(e.x,.5*n.x,i.x),r=$(e.y,.5*n.y,i.y);return s.type===2&&(ot(this,t,s.x1),ot(this,t,s.x2)),r.type===2&&(ot(this,t,r.x1),ot(this,t,r.x2)),t}getCoefficients(){let t=this.p1.sub(this.p0),e=this.p2.sub(this.p1),i=this.p3.sub(this.p2).sub(e).sub(e).add(t),s=e.sub(t).mul(3),r=t.mul(3),o=this.p0;return[i,s,r,o]}getControlBounds(){let t=R.fromPoints(this.p0,this.p3);return t.enclose(this.p1),t.enclose(this.p2),t}getCurvatureAt(t){let[e,n,i]=this.getDerivativeCoefficients(),s=e.mul(t).add(n).mul(t).add(i),r=e.mul(2*t).add(n),o=s.len();return s.cross(r)/(o*o*o)}getCurvatureMetric(){let[t,e]=this.getDerivativeCoefficients();return t.cross(e)}getDerivativeAt(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=this.p2.lerp(this.p3,t),s=e.lerp(n,t);return n.lerp(i,t).sub(s).mul(3)}getDerivativeCoefficients(){let t=this.p1.sub(this.p0),e=this.p2.sub(this.p1),i=this.p3.sub(this.p2).sub(e).sub(e).add(t).mul(3),s=e.sub(t).mul(6),r=t.mul(3);return[i,s,r]}getEvoluteAt(t){let[e,n,i,s]=this.getCoefficients(),r=e.mul(t).add(n).mul(t).add(i).mul(t).addPt(s),o=e.mul(3*t).addMul(n,2).mul(t).add(i),c=e.mul(6*t).addMul(n,2);return r.addMul(o.normal(),o.lenSq()/o.cross(c))}getInflectionParameter(){let[t,e,n]=this.getDerivativeCoefficients(),i,s,r=e.cross(t);return r!==0?(i=t.cross(n)/r,s=i*i+e.cross(n)/r,s>0&&(s=Math.sqrt(s))):(i=-.5*n.cross(e)/n.cross(t),s=Number.NaN),[i,s]}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector(),n=this.p2.toVector(),i=this.p3.toVector(),s=6*t.cross(e),r=6*n.cross(i),o=3*t.cross(n),c=3*e.cross(n),u=3*e.cross(i),l=t.cross(i);return(s+o+l+c+u+r)/20}getTangentEnd(){return this.p3.eq(this.p2)?this.p2.eq(this.p1)?this.p1.sub(this.p0):this.p2.sub(this.p1):this.p3.sub(this.p2)}getTangentStart(){return this.p1.eq(this.p0)?this.p2.eq(this.p1)?this.p3.sub(this.p2):this.p2.sub(this.p1):this.p1.sub(this.p0)}getValueAt(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=this.p2.lerp(this.p3,t),s=e.lerp(n,t),r=n.lerp(i,t);return s.lerp(r,t)}getWindingAt(t){let e=this.p0.y-t.y,n=this.p1.y-this.p0.y,i=this.p2.y-this.p1.y,s=this.p3.y-this.p2.y,r=ae(s-i-i+n,i-n,n,e),o=0;return r.type===3?(o+=Kt(this,r.x1,t.x),o+=Kt(this,r.x2,t.x),o+=Kt(this,r.x3,t.x)):o+=Kt(this,r.x,t.x),o}getWindingFracAt(t,e){let n=0;for(let i=0;i<1;i+=e){let s=this.getValueAt(i).sub(t),r=this.getDerivativeAt(i);n+=s.cross(r)/s.dot(s)}return e*n}isCollinear(){return this.getCurvatureMetric()===0}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()&&this.p2.isFinite()&&this.p3.isFinite()}isPoint(){return this.p0.eq(this.p1)&&this.p1.eq(this.p2)&&this.p2.eq(this.p3)}reverse(){return new a(this.p3,this.p2,this.p1,this.p0)}splitAfter(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=this.p2.lerp(this.p3,t),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t);return new a(this.p0,e,s,o)}splitAt(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=this.p2.lerp(this.p3,t),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t),c=new a(this.p0,e,s,o),u=new a(o,r,i,this.p3);return[c,u]}splitBefore(t){let e=this.p0.lerp(this.p1,t),n=this.p1.lerp(this.p2,t),i=this.p2.lerp(this.p3,t),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t);return new a(o,r,i,this.p3)}splitBetween(t,e){let n=this.p0.lerp(this.p1,t),i=this.p0.lerp(this.p1,e),s=this.p1.lerp(this.p2,t),r=this.p1.lerp(this.p2,e),o=this.p2.lerp(this.p3,t),c=this.p2.lerp(this.p3,e);return n=n.lerp(s,t),s=s.lerp(o,t),c=r.lerp(c,e),r=i.lerp(r,e),n=n.lerp(s,t),i=n.lerp(s,e),o=r.lerp(c,t),c=r.lerp(c,e),new a(n,i,o,c)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}, p2: ${this.p2},p2: ${this.p3}}`}},Q=class a{p0;p1;p2;w;constructor(t,e,n,i){this.p0=t,this.p1=e,this.p2=n,this.w=i}get pn(){return this.p2}get type(){return 3}static fromCenterPoint(t,e,n,i){let r=t.lerp(n,.5).sub(i).len(),o=e.sub(i).len(),c=Math.sqrt(r/o);return new a(t,e,n,c)}static fromProjectivePoints(t,e,n){let i=b.fromXYW(t.x,t.y,t.z),s=b.fromXYW(e.x,e.y,e.z),r=b.fromXYW(n.x,n.y,n.z),o=a.getNormalizedWeight(t.z,e.z,n.z);return new a(i,s,r,o)}static fromXY(t,e,n,i,s,r,o){let c=new b(t,e),u=new b(n,i),l=new b(s,r);return new a(c,u,l,o)}static getNormalizedWeight(t,e,n){return e/Math.sqrt(t*n)}static getWeightFromVectors(t,e,n){let i=e.sub(t),s=n.sub(t);return i.dot(s)/Math.sqrt(i.lenSq()*s.lenSq())}getBounds(){let t=R.fromPoints(this.p0,this.p2),[e,n,i]=this.getDerivativeCoefficients(),s=$(e.x,.5*n.x,i.x),r=$(e.y,.5*n.y,i.y);return s.type===2&&(ot(this,t,s.x1),ot(this,t,s.x2)),r.type===2&&(ot(this,t,r.x1),ot(this,t,r.x2)),t}getControlBounds(){let t=R.fromPoints(this.p0,this.p2);return t.enclose(this.p1),t}getDerivativeAt(t){let[e,n,i]=this.getProjectivePoints(),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t),c=r.sub(s).mul(2),u=c.x*o.z-o.x*c.z,l=c.y*o.z-o.y*c.z,p=o.z*o.z;return C.fromXYW(u,l,p)}getDerivativeCoefficients(){let[t,e,n]=this.getProjectivePoints(),i=n.x*e.z-e.x*n.z,s=n.y*e.z-e.y*n.z,r=n.x*t.z-t.x*n.z,o=n.y*t.z-t.y*n.z,c=e.x*t.z-t.x*e.z,u=e.y*t.z-t.y*e.z,l=new z(2*i,2*s,n.z),p=new z(r,o,e.z),h=new z(2*c,2*u,t.z),d=l.sub(p),m=p.sub(h),f=d.sub(m),y=m.mul(2);return[f,y,h]}getProjectivePoints(){let t=z.fromXY(this.p0.x,this.p0.y),e=z.fromXYW(this.p1.x,this.p1.y,this.w),n=z.fromXY(this.p2.x,this.p2.y);return[t,e,n]}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector(),n=this.p2.toVector(),i=this.w,s=t.cross(e),r=t.cross(n),o=e.cross(n),c=2**-23;if(i<1-c){if(i<=-1+c)return r/2;{let u=1-i*i,l=(1-i)/(1+i),p=Math.sqrt(u),h=Math.sqrt(l),d=i*i*(s+o)-r,m=2*i*(s+o-r),f=2*p*u;return(m*Math.atan(h)-d*p)/f}}else if(i<=1+c){let u=(2*s+r+2*o)/6,l=2/15*(r-s-o)*(i-1);return u-l}else{let u=i*i-1,l=(i-1)/(i+1),p=Math.sqrt(u),h=Math.sqrt(l),d=i*i*(s+o)-r,m=2*i*(s+o-r),f=2*p*u;return(d*p-m*Math.atanh(h))/f}}getTangentEnd(){return this.p2.eq(this.p1)?this.p1.sub(this.p0):this.p2.sub(this.p1)}getTangentStart(){return this.p1.eq(this.p0)?this.p2.sub(this.p1):this.p1.sub(this.p0)}getValueAt(t){let[e,n,i]=this.getProjectivePoints(),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t);return b.fromXYW(o.x,o.y,o.z)}getWindingAt(t){let e=this.w*this.p1.y-this.w*t.y+t.y,n=this.p0.y-t.y,i=e-this.p0.y,s=this.p2.y-e,r=$(s-i,i,n),o=0;return r.type===2&&(o+=Sn(this,r.x1,t.x),o+=Sn(this,r.x2,t.x)),o}getWindingFracAt(t,e){let n=0;for(let i=0;i<1;i+=e){let s=this.getValueAt(i).sub(t),r=this.getDerivativeAt(i);n+=s.cross(r)/s.dot(s)}return e*n}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()&&this.p2.isFinite()&&Number.isFinite(this.w)}isPoint(){return this.p0.eq(this.p1)&&this.p1.eq(this.p2)}reverse(){return new a(this.p2,this.p1,this.p0,this.w)}splitAfter(t){let[e,n,i]=this.getProjectivePoints(),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t);return a.fromProjectivePoints(e,s,o)}splitAt(t){let[e,n,i]=this.getProjectivePoints(),s=e.lerp(n,t),r=n.lerp(i,t),o=s.lerp(r,t),c=a.fromProjectivePoints(e,s,o),u=a.fromProjectivePoints(o,r,i);return[c,u]}splitBefore(t){let[e,n,i]=this.getProjectivePoints(),s=n.lerp(i,t),o=e.lerp(n,t).lerp(s,t);return a.fromProjectivePoints(o,s,i)}splitBetween(t,e){let[n,i,s]=this.getProjectivePoints(),r=n.lerp(i,t),o=n.lerp(i,e),c=i.lerp(s,t),u=i.lerp(s,e),l=r.lerp(c,t),p=o.lerp(u,t),h=o.lerp(u,e);return a.fromProjectivePoints(l,p,h)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}, p2: ${this.p2}, w: ${this.w}}`}};var Lt=class{curr;last;wasLast;constructor(t,e){this.curr=t,this.last=e,this.wasLast=!1}[Symbol.iterator](){return this}next(){let t=this.wasLast,e=this.curr;return this.wasLast=this.last===e||t,this.curr=e.lnext,{done:t,value:e}}},he=class{curr;last;wasLast;constructor(t,e){this.curr=t,this.last=e,this.wasLast=!1}[Symbol.iterator](){return this}next(){let t=this.wasLast,e=this.curr;return this.wasLast=this.last===e||t,this.curr=e.onext,{done:t,value:e}}},de=class{cIdx;commands;p0;pIdx;points;ps;constructor(t,e){this.commands=t,this.points=e,this.cIdx=0,this.pIdx=0,this.ps=b.ZERO,this.p0=b.ZERO}[Symbol.iterator](){return this}next(){let t=this.commands,e=this.points;for(;this.cIdx<t.length;){let n=t[this.cIdx++];switch(n.type){case 0:{this.ps=e[this.pIdx++],this.p0=this.ps;break}case 1:{let i=new S(this.p0,e[this.pIdx++]);return this.p0=i.p1,{done:!1,value:i}}case 2:{let i=new A(this.p0,e[this.pIdx++],e[this.pIdx++]);return this.p0=i.p2,{done:!1,value:i}}case 3:{let i=new U(this.p0,e[this.pIdx++],e[this.pIdx++],e[this.pIdx++]);return this.p0=i.p3,{done:!1,value:i}}case 4:{let i=new Q(this.p0,e[this.pIdx++],e[this.pIdx++],n.w);return this.p0=i.p2,{done:!1,value:i}}case 5:{let i=new S(this.p0,this.ps);if(this.p0=i.p1,!i.isPoint())return{done:!1,value:i};break}default:F(n)}}return{done:!0,value:void 0}}},me=class{idx;points;constructor(t){this.points=t,this.idx=1}[Symbol.iterator](){return this}next(){let t=this.points,e=this.idx;if(e<t.length){let n=new E(t[e-1],t[e]);return this.idx+=1,{done:!1,value:n}}else if(e===t.length){let n=new E(t[e-1],t[0]);return this.idx+=1,{done:!1,value:n}}else return{done:!0,value:void 0}}};var Ht=class{currentIndex;currentLength;currentPhase;dashArray;isFirst;output;path;pathFirst;startAdvancedLength;startIndex;startPhase;constructor(){this.currentIndex=0,this.currentLength=0,this.currentPhase=!1,this.dashArray=[],this.isFirst=!0,this.output=new w,this.startAdvancedLength=0,this.startIndex=0,this.startPhase=!1;let t=new w;this.path=t,this.pathFirst=t}dashDegenerateQuad(t,e,n){let i=new A(t,e,e),s=new A(e,e,n);this.dashQuadraticSimple(i),this.dashQuadraticSimple(s)}dashFirst(t,e){this.currentPhase&&e.isZero()&&this.insertMove(t)}dashLinear(t){let e=this.getDashLength()-this.currentLength,n=Dt(t),i=t;for(;e<n;){let s=In(i,e),r=i.splitAfter(s);this.currentPhase?this.insertLinear(r.p0):this.insertMove(r.p0),this.advance(),e=this.getDashLength(),n=Dt(r),i=r}this.currentLength+=n,this.currentPhase&&this.insertLinear(i.p1)}dashQuadraticSimple(t){let e=this.getDashLength()-this.currentLength,n=qt(t),i=t;for(;e<n;){let s=On(i,e),[r,o]=i.splitAt(s);this.currentPhase?this.insertQuadratic(r.p1,r.p2):this.insertMove(r.p2),this.advance(),e=this.getDashLength(),n=qt(o),i=o}this.currentLength+=n,this.currentPhase&&this.insertQuadratic(i.p1,i.p2)}finalizeClosed(t){this.startPhase&&t.addPath(this.pathFirst,this.currentPhase),this.reset()}finalizeOpen(t){this.startPhase&&t.addPath(this.pathFirst,!1),this.reset()}initialize(t,e){this.dashArray=e.array;let[n,i,s]=Mn(e.array,e.offset);this.startAdvancedLength=n,this.startIndex=i,this.startPhase=s,this.output=t,this.reset()}advance(){let t=be(this.dashArray,this.currentIndex);this.currentLength=0,this.currentIndex=t,this.currentPhase=!this.currentPhase,this.isFirst&&(this.isFirst=!1,this.path=this.output)}getDashLength(){return this.dashArray[this.currentIndex]}insertLinear(t){this.path.lineTo(t)}insertMove(t){this.path.moveTo(t)}insertQuadratic(t,e){this.path.quadTo(t,e)}reset(){this.pathFirst.clear(),this.currentIndex=this.startIndex,this.currentLength=this.startAdvancedLength,this.startPhase?(this.path=this.pathFirst,this.currentPhase=!0,this.isFirst=!0):(this.path=this.output,this.currentPhase=!1,this.isFirst=!1)}};function be(a,t){return(t+1)%a.length}function Mn(a,t){let e=2*bi(a),n=t%e;n<0&&(n+=e);let i=0,s=!0;for(e=a[i];n>=e;)n-=e,i=be(a,i),s=!s,e=a[i];return e=n,[e,i,s]}function Dt(a){return a.p1.sub(a.p0).len()}function In(a,t){return t/Dt(a)}function qt(a){return Zn(a)}function On(a,t){let e=An(a,t);if(e>=1)return 1;let[n,i]=a.splitAt(e),s=t-qt(n),r=(1-e)*An(i,s);return e+r}function bi(a){let t=0;for(let e of a)t+=e;return t}function Qt(a,t){let e=a.p1.sub(a.p0),n=a.p2.sub(a.p1);return e.dot(n)>t*Math.sqrt(e.lenSq()*n.lenSq())}function bt(a,t){let[e,n]=a.getDerivativeCoefficients();return t*n.lenSq()/(Math.abs(e.cross(n))-t*e.dot(n))}function wt(a){let t=a.p1.sub(a.p0),e=a.p2.sub(a.p1);return a.p3.sub(a.p2).sub(e).sub(e).add(t).len()}function ht(a,t,e){let n=a.p1.sub(a.p0),i=a.p2.sub(a.p1),r=a.p3.sub(a.p2).sub(i).sub(i).add(n),o=t*e;return Math.pow(o*o/r.lenSq(),1/6)}function Ct(a,t){let e=a.p1.sub(a.p0),n=a.p2.sub(a.p1);return Math.abs(a.w-1)*n.sub(e).len()<t*(a.w+1)}function dt(a,t,e){let n=a.p1.sub(a.p0),s=a.p2.sub(a.p1).sub(n),r=t*e*(a.w+1);return Math.pow(r/(Math.abs(a.w-1)*s.len()),1/4)}function Fn(a){let t=a.p0.lerp(a.p1,1.5),e=a.p3.lerp(a.p2,1.5),n=t.lerp(e,.5);return new A(a.p0,n,a.p3)}function K(a){let t=a.p0.lerp(a.p1,.75),e=a.p3.lerp(a.p2,.75),n=t.lerp(e,.5),i=new A(a.p0,t,n),s=new A(n,e,a.p3);return[i,s]}function W(a){return new A(a.p0,a.p1,a.p2)}function ft(a){let t=a.p1.sub(a.p0),e=a.p2.sub(a.p1);return t.dot(e)<fe*Math.sqrt(t.lenSq()*e.lenSq())}var ge=class{state;simplifyTolerance;tanOffsetTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance),this.state=new Ht}process(t,e,n){if(!t.isValid())return;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=b.ZERO,u=b.ZERO,l=C.ZERO;for(this.initialize(e,n);r<i.length;){let p=i[r++];switch(p.type){case 0:{l.isZero()||this.state.finalizeOpen(e),u=s[o++],l=C.ZERO,c=u;break}case 1:{let h=new S(u,s[o++]),d=h.getDerivative();d.isZero()||(this.state.dashFirst(u,l),this.state.dashLinear(h),u=h.p1,l=d);break}case 2:{let h=new A(u,s[o++],s[o++]);h.getTangentStart().isZero()||(this.state.dashFirst(u,l),this.dashQuadratic(h),u=h.p2,l=h.getTangentEnd());break}case 3:{let h=new U(u,s[o++],s[o++],s[o++]);h.getTangentStart().isZero()||(this.state.dashFirst(u,l),this.dashCubic(h),u=h.p3,l=h.getTangentEnd());break}case 4:{let h=new Q(u,s[o++],s[o++],p.w);h.getTangentStart().isZero()||(this.state.dashFirst(u,l),this.dashConic(h),u=h.p2,l=h.getTangentEnd());break}case 5:{let h=new S(u,c);h.getDerivative().isZero()||this.state.dashLinear(h),l.isZero()||this.state.finalizeClosed(e),u=c,l=C.ZERO;break}default:F(p)}}l.isZero()||this.state.finalizeOpen(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance)}dashConic(t){let e=dt(t,4,this.simplifyTolerance),n=t;for(;e<1;){let[s,r]=n.splitAt(e),o=W(s);this.dashQuadratic(o),e=e/(1-e),n=r}let i=W(n);this.dashQuadratic(i)}dashCubic(t){let e=ht(t,54,this.simplifyTolerance),n=t;for(;e<1;){let[r,o]=n.splitAt(e),[c,u]=K(r);this.dashQuadratic(c),this.dashQuadratic(u),e=e/(1-e),n=o}let[i,s]=K(n);this.dashQuadratic(i),this.dashQuadratic(s)}dashQuadratic(t){let e=t.getVertexParameter();e>0&&e<1&&ft(t)?this.state.dashDegenerateQuad(t.p0,t.getValueAt(e),t.p2):this.dashQuadraticSimplify(t)}dashQuadraticSimplify(t){let e=bt(t,this.tanOffsetTolerance),n=t;for(;e>0&&e<_;){let[i,s]=n.splitAt(e);this.state.dashQuadraticSimple(i),e=bt(s,this.tanOffsetTolerance),n=s}this.state.dashQuadraticSimple(n)}initialize(t,e){this.state.initialize(t,e)}},ve=class{state;cosOffsetTolerance;simplifyTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance),this.state=new Ht}process(t,e,n){if(!t.isValid())return;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=b.ZERO,u=b.ZERO,l=C.ZERO;for(this.state.initialize(e,n);r<i.length;){let p=i[r++];switch(p.type){case 0:{l.isZero()||this.state.finalizeOpen(e),u=s[o++],l=C.ZERO,c=u;break}case 1:{let h=new S(u,s[o++]),d=h.getDerivative();d.isZero()||(this.state.dashFirst(u,l),this.state.dashLinear(h),u=h.p1,l=d);break}case 2:{let h=new A(u,s[o++],s[o++]);h.getTangentStart().isZero()||(this.state.dashFirst(u,l),this.dashQuadratic(h),u=h.p2,l=h.getTangentEnd());break}case 3:{let h=new U(u,s[o++],s[o++],s[o++]);h.getTangentStart().isZero()||(this.state.dashFirst(u,l),this.dashCubic(h),u=h.p3,l=h.getTangentEnd());break}case 4:{let h=new Q(u,s[o++],s[o++],p.w);h.getTangentStart().isZero()||(this.state.dashFirst(u,l),this.dashConic(h),u=h.p2,l=h.getTangentEnd());break}case 5:{let h=new S(u,c);h.getDerivative().isZero()||this.state.dashLinear(h),l.isZero()||this.state.finalizeClosed(e),u=c,l=C.ZERO;break}default:F(p)}}l.isZero()||this.state.finalizeOpen(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance)}dashConic(t){let e=4*this.simplifyTolerance,n=i=>{if(Ct(i,e)){let s=W(i);this.dashQuadratic(s)}else{let[s,r]=i.splitAt(.5);n(s),n(r)}};n(t)}dashCubic(t){let e=54*this.simplifyTolerance,n=wt(t),i=(s,r)=>{if(e>r){let[o,c]=K(s);this.dashQuadratic(o),this.dashQuadratic(c)}else{let[o,c]=s.splitAt(.5);i(o,.125*r),i(c,.125*r)}};i(t,n)}dashQuadratic(t){let e=t.getVertexParameter();e>0&&e<1&&ft(t)?this.state.dashDegenerateQuad(t.p0,t.getValueAt(e),t.p2):this.dashQuadraticSimplify(t)}dashQuadraticSimplify(t){let e=this.cosOffsetTolerance,n=i=>{if(Qt(i,e))this.state.dashQuadraticSimple(i);else{let[s,r]=i.splitAt(.5);n(s),n(r)}};n(t)}};var xe=class{simplifyTolerance;tolerance;constructor(t){this.tolerance=t.flattenTolerance,this.simplifyTolerance=t.simplifyTolerance}process(t,e,n){if(!t.isValid())return;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=b.ZERO,u=b.ZERO;for(;r<i.length;){let l=i[r++];switch(l.type){case 0:{n&&!u.eq(c)&&e.lineTo(c),c=s[o++],e.moveTo(c),u=c;break}case 1:{let p=s[o++];e.lineTo(p),u=p;break}case 2:{let p=new A(u,s[o++],s[o++]);this.flattenQuadratic(p,e),u=p.p2;break}case 3:{let p=new U(u,s[o++],s[o++],s[o++]);this.flattenCubic(p,e),u=p.p3;break}case 4:{let p=new Q(u,s[o++],s[o++],l.w);this.flattenConic(p,e),u=p.p2;break}case 5:{u.eq(c)||e.lineTo(c),e.close();break}default:F(l)}}n&&!u.eq(c)&&(e.lineTo(c),e.close())}setQualityOptions(t){this.tolerance=t.flattenTolerance,this.simplifyTolerance=t.simplifyTolerance}flattenConic(t,e){let n=dt(t,4,this.simplifyTolerance),i=t;for(;n<1;){let[s,r]=i.splitAt(n);this.flattenQuadratic(W(s),e),n=n/(1-n),i=r}this.flattenQuadratic(W(i),e)}flattenCubic(t,e){let n=ht(t,54,this.simplifyTolerance),i=t;for(;n<1;){let[s,r]=i.splitAt(n);this.flattenQuadratic(Fn(s),e),n=n/(1-n),i=r}this.flattenQuadratic(Fn(i),e)}flattenQuadratic(t,e){let[n,i,s]=t.getCoefficients(),r=Math.sqrt(4*this.tolerance/n.len());for(let o=r;o<1;o+=r){let c=n.mul(o).add(i).mul(o).addPt(s);e.lineTo(c)}e.lineTo(t.p2)}},ye=class{tolerance;constructor(t){this.tolerance=t.flattenTolerance}process(t,e,n){if(!t.isValid())return;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=b.ZERO,u=b.ZERO;for(;r<i.length;){let l=i[r++];switch(l.type){case 0:{n&&!u.eq(c)&&e.lineTo(c),c=s[o++],e.moveTo(c),u=c;break}case 1:{let p=s[o++];e.lineTo(p),u=p;break}case 2:{let p=new A(u,s[o++],s[o++]);this.flattenQuadratic(p,e),u=p.p2;break}case 3:{let p=new U(u,s[o++],s[o++],s[o++]);this.flattenCubic(p,e),u=p.p3;break}case 4:{let p=new Q(u,s[o++],s[o++],l.w);this.flattenConic(p,e),u=p.p2;break}case 5:{u.eq(c)||e.lineTo(c),e.close();break}default:F(l)}}n&&!u.eq(c)&&(e.lineTo(c),e.close())}setQualityOptions(t){this.tolerance=t.flattenTolerance}flattenConic(t,e){let n=this.tolerance*this.tolerance,i=s=>{let r=s.p2.sub(s.p0),c=s.w/(s.w+1)*r.cross(s.p1.sub(s.p0));if(c*c>n*r.lenSq()){let[u,l]=s.splitAt(.5);i(u),i(l)}else e.lineTo(s.p2)};i(t)}flattenCubic(t,e){let i=1.7777777777777777*this.tolerance*this.tolerance,s=r=>{let o=r.p3.sub(r.p0);o.isZero()&&(o=r.p2.sub(r.p1));let c=o.cross(r.p1.sub(r.p0)),u=o.cross(r.p2.sub(r.p0));if(Math.max(c*c,u*u)>i*o.lenSq()){let[l,p]=r.splitAt(.5);s(l),s(p)}else e.lineTo(r.p3)};s(t)}flattenQuadratic(t,e){let i=4*this.tolerance*this.tolerance,s=r=>{let o=r.p2.sub(r.p0),c=o.cross(r.p1.sub(r.p0));if(c*c>i*o.lenSq()){let[u,l]=r.splitAt(.5);s(u),s(l)}else e.lineTo(r.p2)};s(t)}};function Nt(a,t,e){let n=t.getTangentStart(),i=t.getTangentEnd();n.isZero()||(n=n.unit().normal(),i=i.unit().normal(),n=n.add(i),n=n.mul(2*e).div(n.lenSq()),i=i.mul(e),a.quadTo(t.p1.add(n),t.p2.add(i)))}function zn(a,t,e,n,i){let s=new A(t,e,e),r=new A(e,e,n),o=e.sub(t).unit().normal(),c=n.sub(e).unit().normal();Nt(a,s,i),gt(a,e,o,c,i,0,3),Nt(a,r,i)}function kn(a,t,e,n,i,s,r){let o=e.unit().normal(),c=n.unit().normal();o.dot(c)<Ce&&(i*o.cross(c)>=0?gt(a,t,o,c,i,s,r):Pe(a,t,c,i))}function gt(a,t,e,n,i,s,r){let o=s*Math.abs(i);switch(r){case 0:{a.lineTo(t.addMul(n,i));break}case 1:{let c=e.add(n);c=c.mul(2*i).div(c.lenSq()),c.lenSq()<=o*o&&a.lineTo(t.add(c)),a.lineTo(t.addMul(n,i));break}case 2:{let c=e.add(n);c=c.mul(2*i).div(c.lenSq());let u=t.addMul(e,i),l=t.addMul(n,i);if(c.lenSq()<=o*o)a.lineTo(t.add(c));else if(e.dot(n)<=fe)a.lineTo(u.addMul(e.normal(),-o)),a.lineTo(l.addMul(n.normal(),o));else{let p=c.dot(t.sub(u)),h=c.dot(c),d=(p+o*Math.sqrt(h))/(p+h);if(d>0){let m=t.add(c);a.lineTo(u.lerp(m,d)),a.lineTo(l.lerp(m,d))}}a.lineTo(l);break}case 3:{let c=t.addMul(e,i),u=t.addMul(n,i);if(e.dot(n)<0){let l=u.sub(c).unitOrZero().normal(),p=e.add(l);p=p.mul(2*i).div(p.lenSq());let h=t.add(p),d=t.addMul(l,i),m=h.lerp(d,2),f=Q.getWeightFromVectors(t,h,d);a.conicTo(h,d,f),a.conicTo(m,u,f)}else{let l=e.add(n);l=l.mul(2*i).div(l.lenSq());let p=t.add(l),h=Q.getWeightFromVectors(t,p,u);a.conicTo(p,u,h)}break}default:F(r)}}function Pe(a,t,e,n){a.lineTo(t),a.lineTo(t.addMul(e,n))}var Ee=class{buffer;d;join;miterLimit;ms;ps;simplifyTolerance;tanOffsetTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance),this.buffer=new w,this.d=0,this.join=0,this.miterLimit=0,this.ms=C.ZERO,this.ps=b.ZERO}process(t,e,n){if(!t.isValid())return;this.join=n.join,this.miterLimit=n.miterLimit,this.d=n.distance;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=this.ps,u=C.ZERO;for(this.buffer.clear();r<i.length;){let l=i[r++];switch(l.type){case 0:{u.isZero()||this.finalizeOpenOffset(e),c=s[o++],u=C.ZERO,this.ps=c;break}case 1:{let p=new S(c,s[o++]),h=p.getDerivative();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetLinear(p.p1,h),c=p.p1,u=h);break}case 2:{let p=new A(c,s[o++],s[o++]),h=p.getTangentStart();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetQuadratic(p),c=p.p2,u=p.getTangentEnd());break}case 3:{let p=new U(c,s[o++],s[o++],s[o++]),h=p.getTangentStart();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetCubic(p),c=p.p3,u=p.getTangentEnd());break}case 4:{let p=new Q(c,s[o++],s[o++],l.w),h=p.getTangentStart();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetConic(p),c=p.p2,u=p.getTangentEnd());break}case 5:{let p=new S(c,this.ps),h=p.getDerivative();h.isZero()||(this.offsetFirstOrJoin(p.p0,u,h),this.offsetLinear(p.p1,h),u=h),u.isZero()||(this.offsetFirstOrJoin(this.ps,u,this.ms),this.finalizeClosed(e)),c=this.ps,u=C.ZERO;break}default:F(l)}}u.isZero()||this.finalizeOpenOffset(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance)}finalizeClosed(t){this.buffer.close(),t.addPath(this.buffer,!1),this.buffer.clear()}finalizeOpenOffset(t){t.addPath(this.buffer,!1),this.buffer.clear()}offsetConic(t){let e=dt(t,4,this.simplifyTolerance),n=t;for(;e<1;){let[s,r]=n.splitAt(e),o=W(s);this.offsetQuadratic(o),e=e/(1-e),n=r}let i=W(n);this.offsetQuadratic(i)}offsetCubic(t){let e=ht(t,54,this.simplifyTolerance),n=t;for(;e<1;){let[r,o]=n.splitAt(e),[c,u]=K(r);this.offsetQuadratic(c),this.offsetQuadratic(u),e=e/(1-e),n=o}let[i,s]=K(n);this.offsetQuadratic(i),this.offsetQuadratic(s)}offsetFirstOrJoin(t,e,n){e.isZero()?(this.offsetMove(t,n),this.ms=n):kn(this.buffer,t,e,n,this.d,this.miterLimit,this.join)}offsetLinear(t,e){let n=e.unit().normal().mul(this.d);this.buffer.lineTo(t.add(n))}offsetMove(t,e){let n=e.unit().normal().mul(this.d);this.buffer.moveTo(t.add(n))}offsetQuadratic(t){let[e,n]=t.getOffsetCuspParameter(this.d),i=e-n,s=e+n;if(i<1&&s>0)if(ft(t))zn(this.buffer,t.p0,t.getValueAt(e),t.p2,this.d);else{let r=0;i>r&&i<_&&(this.offsetQuadraticSimplify(t.splitBefore(i),this.d),r=i),s>r&&s<_&&(this.offsetQuadraticSimplify(t.splitBetween(r,s),this.d),r=s),r>0?this.offsetQuadraticSimplify(t.splitAfter(r),this.d):this.offsetQuadraticSimplify(t,this.d)}else this.offsetQuadraticSimplify(t,this.d)}offsetQuadraticSimplify(t,e){let n=bt(t,this.tanOffsetTolerance),i=t;for(;n>0&&n<_;){let[s,r]=i.splitAt(n);Nt(this.buffer,s,e),n=bt(r,this.tanOffsetTolerance),i=r}Nt(this.buffer,i,e)}},Se=class{buffer;cosOffsetTolerance;d;join;miterLimit;ms;ps;simplifyTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance),this.buffer=new w,this.d=0,this.join=0,this.miterLimit=0,this.ms=C.ZERO,this.ps=b.ZERO}process(t,e,n){if(!t.isValid())return;this.join=n.join,this.miterLimit=n.miterLimit,this.d=n.distance;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=this.ps,u=C.ZERO;for(this.buffer.clear();r<i.length;){let l=i[r++];switch(l.type){case 0:{u.isZero()||this.finalizeOpenOffset(e),c=s[o++],u=C.ZERO,this.ps=c;break}case 1:{let p=new S(c,s[o++]),h=p.getDerivative();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetLinear(p.p1,h),c=p.p1,u=h);break}case 2:{let p=new A(c,s[o++],s[o++]),h=p.getTangentStart();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetQuadratic(p),c=p.p2,u=p.getTangentEnd());break}case 3:{let p=new U(c,s[o++],s[o++],s[o++]),h=p.getTangentStart();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetCubic(p),c=p.p3,u=p.getTangentEnd());break}case 4:{let p=new Q(c,s[o++],s[o++],l.w),h=p.getTangentStart();h.isZero()||(this.offsetFirstOrJoin(c,u,h),this.offsetConic(p),c=p.p2,u=p.getTangentEnd());break}case 5:{let p=new S(c,this.ps),h=p.getDerivative();h.isZero()||(this.offsetFirstOrJoin(p.p0,u,h),this.offsetLinear(p.p1,h),u=h),u.isZero()||(this.offsetFirstOrJoin(this.ps,u,this.ms),this.finalizeClosed(e)),c=this.ps,u=C.ZERO;break}default:F(l)}}u.isZero()||this.finalizeOpenOffset(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.tan(t.offsetTolerance)}finalizeClosed(t){this.buffer.close(),t.addPath(this.buffer,!1),this.buffer.clear()}finalizeOpenOffset(t){t.addPath(this.buffer,!1),this.buffer.clear()}offsetConic(t){let e=4*this.simplifyTolerance,n=i=>{if(Ct(i,e)){let s=W(i);this.offsetQuadratic(s)}else{let[s,r]=i.splitAt(.5);n(s),n(r)}};n(t)}offsetCubic(t){let e=54*this.simplifyTolerance,n=wt(t),i=(s,r)=>{if(e>r){let[o,c]=K(s);this.offsetQuadratic(o),this.offsetQuadratic(c)}else{let[o,c]=s.splitAt(.5);i(o,.125*r),i(c,.125*r)}};i(t,n)}offsetFirstOrJoin(t,e,n){e.isZero()?(this.offsetMove(t,n),this.ms=n):kn(this.buffer,t,e,n,this.d,this.miterLimit,this.join)}offsetLinear(t,e){let n=e.unit().normal().mul(this.d);this.buffer.lineTo(t.add(n))}offsetMove(t,e){let n=e.unit().normal().mul(this.d);this.buffer.moveTo(t.add(n))}offsetQuadratic(t){let[e,n]=t.getOffsetCuspParameter(this.d),i=e-n,s=e+n;if(i<1&&s>0)if(ft(t))zn(this.buffer,t.p0,t.getValueAt(e),t.p2,this.d);else{let r=0;i>r&&i<_&&(this.offsetQuadraticSimplify(t.splitBefore(i),this.d),r=i),s>r&&s<_&&(this.offsetQuadraticSimplify(t.splitBetween(r,s),this.d),r=s),r>0?this.offsetQuadraticSimplify(t.splitAfter(r),this.d):this.offsetQuadraticSimplify(t,this.d)}else this.offsetQuadraticSimplify(t,this.d)}offsetQuadraticSimplify(t,e){let n=this.cosOffsetTolerance,i=s=>{if(Qt(s,n))Nt(this.buffer,s,e);else{let[r,o]=s.splitAt(.5);i(r),i(o)}};i(t)}};var Te=class{tolerance;constructor(t){this.tolerance=t.simplifyTolerance}process(t,e){if(!t.isValid())return;let n=t.getCommands(),i=t.getPoints(),s=0,r=0,o=b.ZERO;for(;s<n.length;){let c=n[s++];switch(c.type){case 0:{o=i[r++],e.moveTo(o);break}case 1:{let u=i[r++];e.lineTo(u),o=u;break}case 2:{let u=new A(o,i[r++],i[r++]);e.quadTo(u.p1,u.p2),o=u.p2;break}case 3:{let u=new U(o,i[r++],i[r++],i[r++]);this.simplifyCubic(e,u),o=u.p3;break}case 4:{let u=new Q(o,i[r++],i[r++],c.w);this.simplifyConic(e,u),o=u.p2;break}case 5:{e.close();break}default:F(c)}}}setQualityOptions(t){this.tolerance=t.simplifyTolerance}simplifyConic(t,e){let n=dt(e,4,this.tolerance),i=e;for(;n<1;){let[r,o]=i.splitAt(n),c=W(r);t.quadTo(c.p1,c.p2),n=n/(1-n),i=o}let s=W(i);t.quadTo(s.p1,s.p2)}simplifyCubic(t,e){let n=ht(e,54,this.tolerance),i=e;for(;n<1;){let[o,c]=i.splitAt(n),[u,l]=K(o);t.quadTo(u.p1,u.p2),t.quadTo(l.p1,l.p2),n=n/(1-n),i=c}let[s,r]=K(i);t.quadTo(s.p1,s.p2),t.quadTo(r.p1,r.p2)}},Ae=class{tolerance;constructor(t){this.tolerance=t.simplifyTolerance}process(t,e){if(!t.isValid())return;let n=t.getCommands(),i=t.getPoints(),s=0,r=0,o=b.ZERO;for(;s<n.length;){let c=n[s++];switch(c.type){case 0:{o=i[r++],e.moveTo(o);break}case 1:{let u=i[r++];e.lineTo(u),o=u;break}case 2:{let u=new A(o,i[r++],i[r++]);e.quadTo(u.p1,u.p2),o=u.p2;break}case 3:{let u=new U(o,i[r++],i[r++],i[r++]);this.simplifyCubic(e,u),o=u.p3;break}case 4:{let u=new Q(o,i[r++],i[r++],c.w);this.simplifyConic(e,u),o=u.p2;break}case 5:{e.close();break}default:F(c)}}}setQualityOptions(t){this.tolerance=t.simplifyTolerance}simplifyConic(t,e){let n=4*this.tolerance,i=s=>{if(Ct(s,n)){let r=W(s);t.quadTo(r.p1,r.p2)}else{let[r,o]=s.splitAt(.5);i(r),i(o)}};i(e)}simplifyCubic(t,e){let n=54*this.tolerance,i=wt(e),s=(r,o)=>{if(n>o){let[c,u]=K(r);t.quadTo(c.p1,c.p2),t.quadTo(u.p1,u.p2)}else{let[c,u]=r.splitAt(.5);s(c,.125*o),s(u,.125*o)}};s(e,i)}};var Jt=class{caps;currentIndex;currentLength;currentPhase;dashArray;dashCaps;distance;isDash;isFirstDash;join;left;leftFirst;leftMain;miterLimit;ms;output;right;rightFirst;rightMain;startAdvancedLength;startIndex;startPhase;constructor(){this.caps=vt.caps,this.dashArray=vt.dashArray,this.dashCaps=vt.dashCaps,this.distance=.5*vt.width,this.join=vt.join,this.miterLimit=vt.miterLimit,this.currentIndex=0,this.currentLength=0,this.currentPhase=!1,this.isDash=!1,this.isFirstDash=!0,this.ms=C.ZERO,this.output=new w,this.startAdvancedLength=0,this.startIndex=0,this.startPhase=!1;let t=new w,e=new w,n=new w,i=new w;this.left=t,this.leftFirst=t,this.leftMain=n,this.right=e,this.rightFirst=e,this.rightMain=i}finalizeClosed(){this.isDash?this.finalizeClosedDashStroke():this.finalizeClosedStroke()}finalizeOpen(){this.isDash?this.finalizeOpenDashStroke():this.finalizeOpenStroke()}finalizePoint(t){this.insertMoveStroke(t,C.UNIT_X),this.finalizeOpen()}initialize(t,e){this.output=t,e.dashArray.length>0?(this.initializeStroke(e),this.initializeDashStroke(e),this.resetDash(),this.isDash=!0):(this.initializeStroke(e),this.resetStroke(),this.left=this.leftMain,this.right=this.rightMain,this.isDash=!1)}strokeFirstOrJoin(t,e,n){this.isDash?this.insertFirstOrJoinDashStroke(t,e,n):this.insertFirstOrJoinStroke(t,e,n)}strokeLinear(t,e){this.isDash?this.insertLinearDashStroke(t):this.insertLinearStroke(t.p1,e)}strokeQuadraticDegenerate(t,e,n){this.isDash?this.insertQuadraticDegenerateDashStroke(t,e,n):this.insertQuadraticDegenerateStroke(t,e,n)}strokeQuadraticSimple(t){this.isDash?this.insertQuadraticSimpleDashStroke(t):this.insertQuadraticSimpleStroke(t)}advanceDash(){let t=be(this.dashArray,this.currentIndex);this.isFirstDash?(this.isFirstDash=!1,this.left=this.leftMain,this.right=this.rightMain):this.currentPhase&&(Ft(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.dashCaps.end),this.resetStroke()),this.currentLength=0,this.currentIndex=t,this.currentPhase=!this.currentPhase}finalizeClosedDashStroke(){this.startPhase&&this.currentPhase?this.isFirstDash?(this.leftFirst.close(),this.rightFirst.close(),this.output.addPath(this.leftFirst,!1),this.output.addPathReversed(this.rightFirst,!1)):(this.leftMain.addPath(this.leftFirst,!0),this.rightMain.addPath(this.rightFirst,!0),Ft(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.dashCaps.end)):(Ft(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.caps.end),Ft(this.output,this.leftFirst,this.rightFirst,this.caps.start,this.dashCaps.end)),this.resetDash()}finalizeClosedStroke(){this.left.close(),this.right.close(),this.output.addPath(this.left,!1),this.output.addPathReversed(this.right,!1),this.resetStroke()}finalizeOpenDashStroke(){this.isFirstDash||Ft(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.caps.end),this.startPhase&&Ft(this.output,this.leftFirst,this.rightFirst,this.caps.start,this.dashCaps.end),this.resetDash()}finalizeOpenStroke(){Ft(this.output,this.left,this.right,this.caps.start,this.caps.end),this.resetStroke()}getDashLength(){return this.dashArray[this.currentIndex]}initializeDashStroke(t){this.dashArray=t.dashArray,this.dashCaps=t.dashCaps;let[e,n,i]=Mn(t.dashArray,t.dashOffset);this.startAdvancedLength=e,this.startIndex=n,this.startPhase=i}initializeStroke(t){this.caps=t.caps,this.distance=.5*t.width,this.join=t.join,this.miterLimit=t.miterLimit}insertFirstOrJoinDashStroke(t,e,n){this.currentPhase&&this.insertFirstOrJoinStroke(t,e,n)}insertFirstOrJoinStroke(t,e,n){e.isZero()?(this.insertMoveStroke(t,n),this.ms=n):fi(this.left,this.right,t,e,n,this.distance,this.miterLimit,this.join)}insertLinearDashStroke(t){let e=this.getDashLength()-this.currentLength,n=Dt(t),i=t;for(;e<n;){let s=In(i,e),r=i.splitAfter(s),o=r.getDerivative();this.currentPhase?this.insertLinearStroke(r.p0,o):this.insertMoveStroke(r.p0,o),this.advanceDash(),e=this.getDashLength(),n=Dt(r),i=r}if(this.currentLength+=n,this.currentPhase){let s=i.getTangentStart();this.insertLinearStroke(i.p1,s)}}insertLinearStroke(t,e){let n=e.unit().normal().mul(this.distance);this.left.lineTo(t.add(n)),this.right.lineTo(t.add(n.neg()))}insertMoveStroke(t,e){let n=e.unit().normal().mul(this.distance);this.left.moveTo(t.add(n)),this.right.moveTo(t.add(n.neg()))}insertQuadraticDegenerateDashStroke(t,e,n){let i=new A(t,e,e),s=new A(e,e,n),r=e.sub(t).unit().normal(),o=n.sub(e).unit().normal();this.insertQuadraticSimpleStroke(i),this.currentPhase&&(gt(this.left,e,r,o,this.distance,0,3),gt(this.right,e,r.neg(),o.neg(),this.distance,0,3)),this.insertQuadraticSimpleStroke(s)}insertQuadraticDegenerateStroke(t,e,n){let i=new A(t,e,e),s=new A(e,e,n),r=e.sub(t).unit().normal(),o=n.sub(e).unit().normal();this.insertQuadraticSimpleStroke(i),gt(this.left,e,r,o,this.distance,0,3),gt(this.right,e,r.neg(),o.neg(),this.distance,0,3),this.insertQuadraticSimpleStroke(s)}insertQuadraticSimpleDashStroke(t){let e=this.getDashLength()-this.currentLength,n=qt(t),i=t;for(;e<n;){let s=On(i,e),[r,o]=i.splitAt(s);if(this.currentPhase)this.insertQuadraticSimpleStroke(r);else{let c=o.getTangentStart();this.insertMoveStroke(o.p0,c)}this.advanceDash(),e=this.getDashLength(),n=qt(o),i=o}this.currentLength+=n,this.currentPhase&&this.insertQuadraticSimpleStroke(i)}insertQuadraticSimpleStroke(t){let e=t.getTangentStart(),n=t.getTangentEnd();if(!e.isZero()){let i=this.distance;e=e.unit().normal(),n=n.unit().normal(),e=e.add(n),e=e.mul(2*i).div(e.lenSq()),n=n.mul(i),this.left.quadTo(t.p1.add(e),t.p2.add(n)),this.right.quadTo(t.p1.add(e.neg()),t.p2.add(n.neg()))}}resetDash(){this.leftFirst.clear(),this.rightFirst.clear(),this.leftMain.clear(),this.rightMain.clear(),this.currentIndex=this.startIndex,this.currentLength=this.startAdvancedLength,this.startPhase?(this.left=this.leftFirst,this.right=this.rightFirst,this.currentPhase=!0,this.isFirstDash=!0):(this.left=this.leftMain,this.right=this.rightMain,this.currentPhase=!1,this.isFirstDash=!1)}resetStroke(){this.leftMain.clear(),this.rightMain.clear()}};function fi(a,t,e,n,i,s,r,o){let c=n.unit().normal(),u=i.unit().normal();c.dot(u)<Ce&&(c.cross(u)>=0?(gt(a,e,c,u,s,r,o),Pe(t,e,u,-s)):(gt(t,e,c,u,-s,r,o),Pe(a,e,u,s)))}function jn(a,t,e){switch(e){case 0:{a.lineTo(t);break}case 1:{let n=a.getLastPoint();if(n===void 0)break;let i=t.sub(n).mul(.5).normal();a.lineTo(n.add(i)),a.lineTo(t.add(i)),a.lineTo(t);break}case 2:{let n=a.getLastPoint();if(n===void 0)break;let i=t.sub(n).mul(.5).normal();a.arcTo(n.add(i),n.add(i.sub(i.normal()))),a.arcTo(t.add(i),t);break}default:{let n=a.getLastPoint();if(n===void 0||(e(a,n,t),a.getLastPoint()?.eq(t)===!0))break;a.lineTo(t)}}}function Ft(a,t,e,n,i){let s=e.getLastPoint(),r=t.getFirstPoint();s!==void 0&&r!==void 0&&(a.addPath(t,!1),jn(a,s,i),a.addPathReversed(e,!0),jn(a,r,n),a.close())}var Me=class{state;simplifyTolerance;tanOffsetTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance),this.state=new Jt}process(t,e,n){if(!t.isValid())return;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=0,u=b.ZERO,l=b.ZERO,p=C.ZERO;for(this.state.initialize(e,n);r<i.length;){let h=i[r++],d=h.type;switch(d){case 0:{p.isZero()?c!==0&&c!==5&&this.state.finalizePoint(u):this.state.finalizeOpen(),u=s[o++],l=u,p=C.ZERO;break}case 1:{let m=new S(l,s[o++]),f=m.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.state.strokeLinear(m,f),l=m.p1,p=f);break}case 2:{let m=new A(l,s[o++],s[o++]),f=m.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.strokeQuadratic(m),l=m.p2,p=m.getTangentEnd());break}case 3:{let m=new U(l,s[o++],s[o++],s[o++]),f=m.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.strokeCubic(m),l=m.p3,p=m.getTangentEnd());break}case 4:{let m=new Q(l,s[o++],s[o++],h.w),f=m.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.strokeConic(m),l=m.p2,p=m.getTangentEnd());break}case 5:{let m=new S(l,u),f=m.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.state.strokeLinear(m,f),p=f),p.isZero()?c!==5&&this.state.finalizePoint(u):(this.state.strokeFirstOrJoin(u,p,this.state.ms),this.state.finalizeClosed()),l=u,p=C.ZERO;break}default:F(h)}c=d}p.isZero()?c!==0&&c!==5&&this.state.finalizePoint(u):this.state.finalizeOpen()}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance)}strokeConic(t){let e=dt(t,4,this.simplifyTolerance),n=t;for(;e>0&&e<1;){let[s,r]=n.splitAt(e),o=W(s);this.strokeQuadratic(o),e=e/(1-e),n=r}let i=W(n);this.strokeQuadratic(i)}strokeCubic(t){let e=ht(t,54,this.simplifyTolerance),n=t;for(;e<1;){let[r,o]=n.splitAt(e),[c,u]=K(r);this.strokeQuadratic(c),this.strokeQuadratic(u),e=e/(1-e),n=o}let[i,s]=K(n);this.strokeQuadratic(i),this.strokeQuadratic(s)}strokeQuadratic(t){let[e,n]=t.getOffsetCuspParameter(this.state.distance),i=e-n,s=e+n;if(i<1&&s>0)if(ft(t))this.state.strokeQuadraticDegenerate(t.p0,t.getValueAt(e),t.p2);else{let r=0;i>r&&i<_&&(this.strokeQuadraticSimplify(t.splitBefore(i)),r=i),s>r&&s<_&&(this.strokeQuadraticSimplify(t.splitBetween(r,s)),r=s),r>0?this.strokeQuadraticSimplify(t.splitAfter(r)):this.strokeQuadraticSimplify(t)}else this.strokeQuadraticSimplify(t)}strokeQuadraticSimplify(t){let e=bt(t,this.tanOffsetTolerance),n=t;for(;e>0&&e<_;){let[i,s]=n.splitAt(e);this.state.strokeQuadraticSimple(i),e=bt(s,this.tanOffsetTolerance),n=s}this.state.strokeQuadraticSimple(n)}},Ie=class{state;cosOffsetTolerance;simplifyTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance),this.state=new Jt}process(t,e,n){if(!t.isValid())return;let i=t.getCommands(),s=t.getPoints(),r=0,o=0,c=0,u=b.ZERO,l=b.ZERO,p=C.ZERO;for(this.state.initialize(e,n);o<i.length;){let h=i[o++],d=h.type;switch(h.type){case 0:{p.isZero()?r!==0&&r!==5&&this.state.finalizePoint(u):this.state.finalizeOpen(),u=s[c++],l=u,p=C.ZERO;break}case 1:{let m=new S(l,s[c++]),f=m.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.state.strokeLinear(m,f),l=m.p1,p=f);break}case 2:{let m=new A(l,s[c++],s[c++]),f=m.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.strokeQuadratic(m),l=m.p2,p=m.getTangentEnd());break}case 3:{let m=new U(l,s[c++],s[c++],s[c++]),f=m.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.strokeCubic(m),l=m.p3,p=m.getTangentEnd());break}case 4:{let m=new Q(l,s[c++],s[c++],h.w),f=m.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.strokeConic(m),l=m.p2,p=m.getTangentEnd());break}case 5:{let m=new S(l,u),f=m.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(l,p,f),this.state.strokeLinear(m,f),p=f),p.isZero()?r!==5&&this.state.finalizePoint(u):(this.state.strokeFirstOrJoin(u,p,this.state.ms),this.state.finalizeClosed()),l=u,p=C.ZERO;break}default:F(h)}r=d}p.isZero()?r!==0&&r!==5&&this.state.finalizePoint(u):this.state.finalizeOpen()}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance)}strokeConic(t){let e=4*this.simplifyTolerance,n=i=>{if(Ct(i,e)){let s=W(i);this.strokeQuadratic(s)}else{let[s,r]=i.splitAt(.5);n(s),n(r)}};n(t)}strokeCubic(t){let e=54*this.simplifyTolerance,n=wt(t),i=(s,r)=>{if(e>r){let[o,c]=K(s);this.strokeQuadratic(o),this.strokeQuadratic(c)}else{let[o,c]=s.splitAt(.5);i(o,.125*r),i(c,.125*r)}};i(t,n)}strokeQuadratic(t){let[e,n]=t.getOffsetCuspParameter(this.state.distance),i=e-n,s=e+n;if(i<1&&s>0)if(ft(t))this.state.strokeQuadraticDegenerate(t.p0,t.getValueAt(e),t.p2);else{let r=0;i>r&&i<_&&(this.strokeQuadraticSimplify(t.splitBefore(i)),r=i),s>r&&s<_&&(this.strokeQuadraticSimplify(t.splitBetween(r,s)),r=s),r>0?this.strokeQuadraticSimplify(t.splitAfter(r)):this.strokeQuadraticSimplify(t)}else this.strokeQuadraticSimplify(t)}strokeQuadraticSimplify(t){let e=this.cosOffsetTolerance,n=i=>{if(Qt(i,e))this.state.strokeQuadraticSimple(i);else{let[s,r]=i.splitAt(.5);n(s),n(r)}};n(t)}};var Gt={start:0,end:0},$n={start:2,end:2};var Y={clipPrecision:65536,dashMode:0,flattenMode:0,flattenTolerance:.2,offsetMode:0,offsetTolerance:.39269908169,simplifyMode:0,simplifyTolerance:.05,strokeMode:0},Kn={array:[],offset:0},Hn={join:1,miterLimit:4,distance:1},vt={caps:Gt,dashArray:[],dashCaps:Gt,dashOffset:0,join:1,miterLimit:4,width:1},at={booleanOperator:0,windingOperatorA:0,windingOperatorB:0},fe=-.9999999999984769,Ce=.9999999999984769,gi=5e-7,_=1-gi;function Oe(a){switch(a.flattenMode){case 0:return new xe(a);case 1:return new ye(a);default:return a.flattenMode}}function Jn(a){switch(a.simplifyMode){case 0:return new Te(a);case 1:return new Ae(a);default:return a.simplifyMode}}function Gn(a){switch(a.offsetMode){case 0:return new Ee(a);case 1:return new Se(a);default:return a.offsetMode}}function _n(a){switch(a.dashMode){case 0:return new ge(a);case 1:return new ve(a);default:return a.dashMode}}function Fe(a){switch(a.strokeMode){case 0:return new Me(a);case 1:return new Ie(a);default:return a.strokeMode}}function Bn(a,t,e,n,i){T(i<=a.length-t,"Parameter 'length' must be smaller or equal to length of 'src' to avoid over-read");let s=t,r=t+i-1,o=n,c=!1;for(a[t]?.type===0&&(e[o++]={type:0},s+=1),a[r]?.type===5&&(c=!0,r-=1);r>=s;){let u=a[r--];u.type===0?(c&&(e[o++]={type:5}),e[o++]={type:0},c=!1):u.type===5?(e[o++]={type:0},c=!0):e[o++]=u}c&&(e[o++]={type:5})}function Rn(a,t){switch(t){case 0:return a!==0;case 1:return(a&1)!==0;case 2:return a>0;case 3:return a<0;default:return t(a)}}function ti(a,t,e){let n=a+e,i=a*e-t*t;return .5*(Math.sqrt(n*n-4*i)+n)}var zt=class a{elements;constructor(t){this.elements=t}get type(){return 0}static createIdentity(){return new a([1,0,0,0,1,0])}static fromArray(t,e=0){let n=t,i=e;return new a([n[i+0],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5]])}static fromRotation(t,e){let n=t,i=-e,s=e,r=t;return new a([n,i,0,s,r,0])}static fromScale(t,e){return new a([t,0,0,0,e,0])}static fromTranslation(t,e){return new a([1,0,t,0,1,e])}add(t){let e=this.elements,n=t.elements;e[0]+=n[0],e[1]+=n[1],e[2]+=n[2],e[3]+=n[3],e[4]+=n[4],e[5]+=n[5]}addPre(t){let e=this.elements,n=t.elements;n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[3],n[4]+=e[4],n[5]+=e[5]}clone(){return new a([...this.elements])}copyFrom(t){let e=this.elements,n=t.elements;e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5]}eq(t){let e=this.elements,n=t.elements;return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]}getDeterminant(){let t=this.elements;return t[0]*t[4]-t[1]*t[3]}getInverse(){let t=this.getDeterminant();if(t===0)return a.createIdentity();let e=1/t,n=this.elements,i=e*n[4],s=e*-n[1],r=-(n[2]*i+n[5]*s),o=e*-n[3],c=e*n[0],u=-(n[2]*o+n[5]*c);return new a([i,s,r,o,c,u])}getMaxScale(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1],n=t[0]*t[3]+t[1]*t[4],i=t[3]*t[3]+t[4]*t[4],s=ti(e,n,i);return Math.sqrt(s)}mapPoint(t){let e=this.elements,n=t.x*e[0]+t.y*e[1]+e[2],i=t.x*e[3]+t.y*e[4]+e[5];return new b(n,i)}mapVector(t){let e=this.elements,n=t.x*e[0]+t.y*e[1]+e[2],i=t.x*e[3]+t.y*e[4]+e[5];return new C(n,i)}mul(t){let e=this.elements,n=t.elements,i=e[0]*n[0]+e[3]*n[1],s=e[0]*n[3]+e[3]*n[4];e[0]=i,e[3]=s;let r=e[1]*n[0]+e[4]*n[1],o=e[1]*n[3]+e[4]*n[4];e[1]=r,e[4]=o;let c=e[2]*n[0]+e[5]*n[1]+n[2],u=e[2]*n[3]+e[5]*n[4]+n[5];e[2]=c,e[5]=u}mulPre(t){let e=this.elements,n=t.elements,i=n[0]*e[0]+n[3]*e[1],s=n[1]*e[0]+n[4]*e[1],r=n[2]*e[0]+n[5]*e[1]+e[2];e[0]=i,e[1]=s,e[2]=r;let o=n[0]*e[3]+n[3]*e[4],c=n[1]*e[3]+n[4]*e[4],u=n[2]*e[3]+n[5]*e[4]+e[5];e[3]=o,e[4]=c,e[5]=u}rotate(t,e){let n=t,i=-e,s=e,r=t,o=this.elements,c=o[0]*n+o[3]*i,u=o[0]*s+o[3]*r;o[0]=c,o[3]=u;let l=o[1]*n+o[4]*i,p=o[1]*s+o[4]*r;o[1]=l,o[4]=p;let h=o[2]*n+o[5]*i,d=o[2]*s+o[5]*r;o[2]=h,o[5]=d}rotatePre(t,e){let n=t,i=-e,s=e,r=t,o=this.elements,c=n*o[0]+s*o[1],u=i*o[0]+r*o[1];o[0]=c,o[1]=u;let l=n*o[3]+s*o[4],p=i*o[3]+r*o[4];o[3]=l,o[4]=p}rotateSet(t,e){let n=t,i=-e,s=e,r=t;this.set(n,i,0,s,r,0)}scale(t,e){let n=this.elements;n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=e,n[4]*=e,n[5]*=e}scalePre(t,e){let n=this.elements;n[0]*=t,n[1]*=e,n[3]*=t,n[4]*=e}scaleSet(t,e){this.set(t,0,0,0,e,0)}set(t,e,n,i,s,r){let o=this.elements;o[0]=t,o[1]=e,o[2]=n,o[3]=i,o[4]=s,o[5]=r}sub(t){let e=this.elements,n=t.elements;e[0]-=n[0],e[1]-=n[1],e[2]-=n[2],e[3]-=n[3],e[4]-=n[4],e[5]-=n[5]}subPre(t){let e=this.elements,n=t.elements;n[0]-=e[0],n[1]-=e[1],n[2]-=e[2],n[3]-=e[3],n[4]-=e[4],n[5]-=e[5]}toArray(){return[...this.elements]}toString(){let t=this.elements;return`{e0: ${t[0]}, e3: ${t[3]},
 e1: ${t[1]}, e4: ${t[4]},
 e2: ${t[2]}, e5: ${t[5]}}`}translate(t,e){let n=this.elements;n[2]+=t,n[5]+=e}translatePre(t,e){let n=this.elements;n[2]+=t*n[0]+e*n[1],n[5]+=t*n[3]+e*n[4]}translateSet(t,e){this.set(1,0,t,0,1,e)}};var _t=class a{elements;constructor(t){this.elements=t}get type(){return 1}static createIdentity(){return new a([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static createZero(){return new a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}static fromArray(t,e=0){let n=t,i=e;return new a([n[i+0],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5],n[i+6],n[i+7],n[i+8],n[i+9],n[i+10],n[i+11],n[i+12],n[i+13],n[i+14],n[i+15]])}static fromOrthographic(t,e,n,i,s,r){let o=e-t,c=n-i,u=r-s,l=2/o,p=-(e+t)/o,h=2/c,d=-(n+i)/c,m=-2/u,f=-(r+s)/u;return new a([l,0,0,p,0,h,0,d,0,0,m,f,0,0,0,1])}static fromPerspective(t,e,n,i,s,r){let o=e-t,c=n-i,u=r-s,l=2*s/o,p=(e+t)/o,h=2*s/c,d=(n+i)/c,m=(s+r)/u,f=2*s*r/u;return new a([l,0,p,0,0,h,d,0,0,0,m,f,0,0,-1,0])}static fromPerspectiveFrustum(t,e,n,i){let s=n*Math.tan(t*(Math.PI/360)),r=2*s,o=e*r,c=-.5*o;return a.fromPerspective(c,c+o,s,s-r,n,i)}static fromRotation(t,e,n,i){let s=t*t,r=e*e,o=n*n,c=i*i,u=s+r-o-c,l=s-r+o-c,p=s-r-o+c,h=e*n,d=t*i,m=h+h-d-d,f=h+h+d+d,y=e*i,x=t*n,M=y+y+x+x,k=y+y-x-x,B=n*i,I=t*e,X=B+B-I-I,Z=B+B+I+I;return new a([u,m,M,0,f,l,X,0,k,Z,p,0,0,0,0,1])}static fromScale(t,e,n){return new a([t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1])}static fromTranslation(t,e,n){return new a([1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1])}add(t){let e=this.elements,n=t.elements;e[0]+=n[0],e[1]+=n[1],e[2]+=n[2],e[3]+=n[3],e[4]+=n[4],e[5]+=n[5],e[6]+=n[6],e[7]+=n[7],e[8]+=n[8],e[9]+=n[9],e[10]+=n[10],e[11]+=n[11],e[12]+=n[12],e[13]+=n[13],e[14]+=n[14],e[15]+=n[15]}addPre(t){let e=this.elements,n=t.elements;n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[3],n[4]+=e[4],n[5]+=e[5],n[6]+=e[6],n[7]+=e[7],n[8]+=e[8],n[9]+=e[9],n[10]+=e[10],n[11]+=e[11],n[12]+=e[12],n[13]+=e[13],n[14]+=e[14],n[15]+=e[15]}clone(){return new a([...this.elements])}copyFrom(t){let e=this.elements,n=t.elements;e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]}eq(t){let e=this.elements,n=t.elements;return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]}mapPoint(t){let e=this.elements,n=t.x*e[0]+t.y*e[1]+t.z*e[2]+e[3],i=t.x*e[4]+t.y*e[5]+t.z*e[6]+e[7],s=t.x*e[8]+t.y*e[9]+t.z*e[10]+e[11],r=t.x*e[12]+t.y*e[13]+t.z*e[14]+e[15];return z.fromXYZW(n,i,s,r)}mapVector(t){let e=this.elements,n=t.x*e[0]+t.y*e[1]+t.z*e[2]+e[3],i=t.x*e[4]+t.y*e[5]+t.z*e[6]+e[7],s=t.x*e[8]+t.y*e[9]+t.z*e[10]+e[11],r=t.x*e[12]+t.y*e[13]+t.z*e[14]+e[15];return pt.fromXYZW(n,i,s,r)}mul(t){let e=this.elements,n=t.elements,i=e[0]*n[0]+e[4]*n[1]+e[8]*n[2]+e[12]*n[3],s=e[0]*n[4]+e[4]*n[5]+e[8]*n[6]+e[12]*n[7],r=e[0]*n[8]+e[4]*n[9]+e[8]*n[10]+e[12]*n[11],o=e[0]*n[12]+e[4]*n[13]+e[8]*n[14]+e[12]*n[15];e[0]=i,e[4]=s,e[8]=r,e[12]=o;let c=e[1]*n[0]+e[5]*n[1]+e[9]*n[2]+e[13]*n[3],u=e[1]*n[4]+e[5]*n[5]+e[9]*n[6]+e[13]*n[7],l=e[1]*n[8]+e[5]*n[9]+e[9]*n[10]+e[13]*n[11],p=e[1]*n[12]+e[5]*n[13]+e[9]*n[14]+e[13]*n[15];e[1]=c,e[5]=u,e[9]=l,e[13]=p;let h=e[2]*n[0]+e[6]*n[1]+e[10]*n[2]+e[14]*n[3],d=e[2]*n[4]+e[6]*n[5]+e[10]*n[6]+e[14]*n[7],m=e[2]*n[8]+e[6]*n[9]+e[10]*n[10]+e[14]*n[11],f=e[2]*n[12]+e[6]*n[13]+e[10]*n[14]+e[14]*n[15];e[2]=h,e[6]=d,e[10]=m,e[14]=f;let y=e[3]*n[0]+e[7]*n[1]+e[11]*n[2]+e[15]*n[3],x=e[3]*n[4]+e[7]*n[5]+e[11]*n[6]+e[15]*n[7],M=e[3]*n[8]+e[7]*n[9]+e[11]*n[10]+e[15]*n[11],k=e[3]*n[12]+e[7]*n[13]+e[11]*n[14]+e[15]*n[15];e[3]=y,e[7]=x,e[11]=M,e[15]=k}mulPre(t){let e=this.elements,n=t.elements,i=n[0]*e[0]+n[4]*e[1]+n[8]*e[2]+n[12]*e[3],s=n[1]*e[0]+n[5]*e[1]+n[9]*e[2]+n[13]*e[3],r=n[2]*e[0]+n[6]*e[1]+n[10]*e[2]+n[14]*e[3],o=n[3]*e[0]+n[7]*e[1]+n[11]*e[2]+n[15]*e[3];e[0]=i,e[1]=s,e[2]=r,e[3]=o;let c=n[0]*e[4]+n[4]*e[5]+n[8]*e[6]+n[12]*e[7],u=n[1]*e[4]+n[5]*e[5]+n[9]*e[6]+n[13]*e[7],l=n[2]*e[4]+n[6]*e[5]+n[10]*e[6]+n[14]*e[7],p=n[3]*e[4]+n[7]*e[5]+n[11]*e[6]+n[15]*e[7];e[4]=c,e[5]=u,e[6]=l,e[7]=p;let h=n[0]*e[8]+n[4]*e[9]+n[8]*e[10]+n[12]*e[11],d=n[1]*e[8]+n[5]*e[9]+n[9]*e[10]+n[13]*e[11],m=n[2]*e[8]+n[6]*e[9]+n[10]*e[10]+n[14]*e[11],f=n[3]*e[8]+n[7]*e[9]+n[11]*e[10]+n[15]*e[11];e[8]=h,e[9]=d,e[10]=m,e[11]=f;let y=n[0]*e[12]+n[4]*e[13]+n[8]*e[14]+n[12]*e[15],x=n[1]*e[12]+n[5]*e[13]+n[9]*e[14]+n[13]*e[15],M=n[2]*e[12]+n[6]*e[13]+n[10]*e[14]+n[14]*e[15],k=n[3]*e[12]+n[7]*e[13]+n[11]*e[14]+n[15]*e[15];e[12]=y,e[13]=x,e[14]=M,e[15]=k}rotate(t,e,n,i){let s=t*t,r=e*e,o=n*n,c=i*i,u=s+r-o-c,l=s-r+o-c,p=s-r-o+c,h=e*n,d=t*i,m=h+h-d-d,f=h+h+d+d,y=e*i,x=t*n,M=y+y+x+x,k=y+y-x-x,B=n*i,I=t*e,X=B+B-I-I,Z=B+B+I+I,g=this.elements,Ut=g[0]*u+g[4]*m+g[8]*M,Rt=g[0]*f+g[4]*l+g[8]*X,Wt=g[0]*k+g[4]*Z+g[8]*p;g[0]=Ut,g[4]=Rt,g[8]=Wt;let Zt=g[1]*u+g[5]*m+g[9]*M,jt=g[1]*f+g[5]*l+g[9]*X,bn=g[1]*k+g[5]*Z+g[9]*p;g[1]=Zt,g[5]=jt,g[9]=bn;let fn=g[2]*u+g[6]*m+g[10]*M,gn=g[2]*m+g[6]*l+g[10]*X,vn=g[2]*M+g[6]*Z+g[10]*p;g[2]=fn,g[6]=gn,g[10]=vn;let xn=g[3]*u+g[7]*m+g[11]*M,yn=g[3]*m+g[7]*l+g[11]*X,Pn=g[3]*M+g[7]*Z+g[11]*p;g[3]=xn,g[7]=yn,g[11]=Pn}rotatePre(t,e,n,i){let s=t*t,r=e*e,o=n*n,c=i*i,u=s+r-o-c,l=s-r+o-c,p=s-r-o+c,h=e*n,d=t*i,m=h+h-d-d,f=h+h+d+d,y=e*i,x=t*n,M=y+y+x+x,k=y+y-x-x,B=n*i,I=t*e,X=B+B-I-I,Z=B+B+I+I,g=this.elements,Ut=u*g[0]+f*g[1]+k*g[2],Rt=m*g[0]+l*g[1]+Z*g[2],Wt=M*g[0]+X*g[1]+p*g[2];g[0]=Ut,g[1]=Rt,g[2]=Wt;let Zt=u*g[4]+f*g[5]+k*g[6],jt=m*g[4]+l*g[5]+Z*g[6],bn=M*g[4]+X*g[5]+p*g[6];g[4]=Zt,g[5]=jt,g[6]=bn;let fn=u*g[8]+f*g[9]+k*g[10],gn=m*g[8]+l*g[9]+Z*g[10],vn=M*g[8]+X*g[9]+p*g[10];g[8]=fn,g[9]=gn,g[10]=vn;let xn=u*g[12]+f*g[13]+k*g[14],yn=m*g[12]+l*g[13]+Z*g[14],Pn=M*g[12]+X*g[13]+p*g[14];g[12]=xn,g[13]=yn,g[14]=Pn}rotateSet(t,e,n,i){let s=t*t,r=e*e,o=n*n,c=i*i,u=s+r-o-c,l=s-r+o-c,p=s-r-o+c,h=e*n,d=t*i,m=h+h-d-d,f=h+h+d+d,y=e*i,x=t*n,M=y+y+x+x,k=y+y-x-x,B=n*i,I=t*e,X=B+B-I-I,Z=B+B+I+I;this.set(u,m,M,0,f,l,X,0,k,Z,p,0,0,0,0,1)}scale(t,e,n){let i=this.elements;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n}scalePre(t,e,n){let i=this.elements;i[0]*=t,i[1]*=e,i[2]*=n,i[4]*=t,i[5]*=e,i[6]*=n,i[8]*=t,i[9]*=e,i[10]*=n,i[12]*=t,i[13]*=e,i[14]*=n}scaleSet(t,e,n){this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}set(t,e,n,i,s,r,o,c,u,l,p,h,d,m,f,y){let x=this.elements;x[0]=t,x[1]=e,x[2]=n,x[3]=i,x[4]=s,x[5]=r,x[6]=o,x[7]=c,x[8]=u,x[9]=l,x[10]=p,x[11]=h,x[12]=d,x[13]=m,x[14]=f,x[15]=y}sub(t){let e=this.elements,n=t.elements;e[0]-=n[0],e[1]-=n[1],e[2]-=n[2],e[3]-=n[3],e[4]-=n[4],e[5]-=n[5],e[6]-=n[6],e[7]-=n[7],e[8]-=n[8],e[9]-=n[9],e[10]-=n[10],e[11]-=n[11],e[12]-=n[12],e[13]-=n[13],e[14]-=n[14],e[15]-=n[15]}subPre(t){let e=this.elements,n=t.elements;n[0]-=e[0],n[1]-=e[1],n[2]-=e[2],n[3]-=e[3],n[4]-=e[4],n[5]-=e[5],n[6]-=e[6],n[7]-=e[7],n[8]-=e[8],n[9]-=e[9],n[10]-=e[10],n[11]-=e[11],n[12]-=e[12],n[13]-=e[13],n[14]-=e[14],n[15]-=e[15]}toArray(){return[...this.elements]}toString(){let t=this.elements;return`{e0: ${t[0]}, e4: ${t[4]}, e8: ${t[8]}, e12: ${t[12]},
 e1: ${t[1]}, e5: ${t[5]}, e9: ${t[9]}, e13: ${t[13]},
 e2: ${t[2]}, e6: ${t[6]}, e10: ${t[10]}, e14: ${t[14]},
 e3: ${t[3]}, e7: ${t[7]}, e11: ${t[11]}, e15: ${t[15]}}`}translate(t,e,n){let i=this.elements;i[0]+=i[12]*t,i[1]+=i[13]*t,i[2]+=i[14]*t,i[3]+=i[15]*t,i[4]+=i[12]*e,i[5]+=i[13]*e,i[6]+=i[14]*e,i[7]+=i[15]*e,i[8]+=i[12]*n,i[9]+=i[13]*n,i[10]+=i[14]*n,i[11]+=i[15]*n}translatePre(t,e,n){let i=this.elements;i[3]+=t*i[0]+e*i[1]+n*i[2],i[7]+=t*i[4]+e*i[5]+n*i[6],i[11]+=t*i[8]+e*i[9]+n*i[10],i[15]+=t*i[12]+e*i[13]+n*i[14]}translateSet(t,e,n){this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1)}};var q=class a{points;constructor(t=[]){this.points=t}static isAreaIntersection(t,e,n){return!!(a.isEdgeIntersection(t,e)||a.isPointInside(t,e.points[0],n)||a.isPointInside(e,t.points[0],n))}static isEdgeIntersection(t,e){for(let n of t.getEdgeIterator())for(let i of e.getEdgeIterator())if(E.isIntersection(n,i))return!0;return!1}static isPointInside(t,e,n){let i=0;for(let s of t.getEdgeIterator())i+=s.toBezier().getWindingAt(e);return n||(i=i&1),i!==0}static isPolygonInside(t,e,n=!1){for(let i of e.points)if(!a.isPointInside(t,i,n))return!1;return!0}addPoint(t){this.points.push(t)}addXY(t,e){this.addPoint(new b(t,e))}clear(){this.points=[]}findClosestEdgePoint(t){let e=Number.POSITIVE_INFINITY,n;for(let i of this.getEdgeIterator()){let s=i.getClosestPoint(t).sub(t).lenSq();s<e&&(e=s,n=i)}return n}getBounds(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(let s of this.points)t=Math.min(t,s.x),e=Math.min(e,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);return new R(t,e,n,i)}getCentroid(){let t=0,e=0;for(let i of this.points)t+=i.x,e+=i.y;let n=this.points.length;return new b(t/n,e/n)}getConvexHull(){let t=this.points[0];for(let i=1;i<this.points.length;i++){let s=this.points[i];(s.y===t.y?s.x<t.x:s.y<t.y)&&(t=s)}let e=this.points.slice();e.sort((i,s)=>i.sub(t).angle()-s.sub(t).angle());let n=2;for(;n<e.length;){let i=e[n-2],s=e[n-1],r=e[n-0],o=i.sub(s),c=i.sub(r);o.cross(c)>0?n++:(n--,e.splice(n,1))}return new a(e)}getEdgeIterator(){return new me(this.points)}getEdges(){let t=[];for(let e of this.getEdgeIterator())t.push(e);return t}getOrientation(){let t=0;for(let e of this.getEdgeIterator())t+=e.p0.toVector().cross(e.p1.toVector());return t}getOrientedBoundingBox(){let t=Number.POSITIVE_INFINITY,e=[b.ZERO,b.ZERO,b.ZERO,b.ZERO],n=this.getConvexHull();for(let i of n.getEdgeIterator()){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;for(let d of n.points){let m=i.getParameterFromPoint(d),f=i.getSignedDistanceFromPoint(d);s=Math.min(s,m),r=Math.max(r,m),o=Math.min(o,f)}let c=i.getValueAt(s),u=i.getValueAt(r),l=u.sub(c),p=l.unit().normal().mul(o),h=l.cross(p);h<t&&(e[0]=c,e[1]=c.add(p),e[2]=u.add(p),e[3]=u,t=h)}return new a(e)}getPoints(){return this.points}hasPoints(){return this.points.length>0}isConvex(){let t=this.points.length,e=this.points[t-1],n=this.points[t-2],i=!1,s=!1;for(let r=0;r<t;r++){let o=this.points[r],c=e.sub(o).cross(n.sub(e));if(c>0?i=!0:c<0&&(s=!0),s&&i)return!1;n=e,e=o}return!0}isSimple(){for(let t of this.getEdgeIterator())for(let e of this.getEdgeIterator())if(t!==e&&!E.isAdjacent(t,e)&&E.isIntersection(t,e))return!1;return!0}reverse(){this.points.reverse()}toPath(){let t=new w;if(this.points.length>0){t.moveTo(this.points[0]);for(let e=1;e<this.points.length;e++)t.lineTo(this.points[e]);t.close()}return t}transform(t){let e=this.points;for(let n=0;n<e.length;n++)e[n]=t.mapPoint(e[n])}};var xt=class a{comp;data;constructor(t){this.comp=t,this.data=[]}static fromArray(t,e){let n=new a(e);return n.data=t.slice().sort(e),n}clear(){this.data=[]}dequeue(){return this.data.shift()}find(t){let e=this.findIndex(t);return e>=0?this.data[e]:void 0}findBy(t,e=0){for(let n=e;n<this.data.length;n++)if(t(this.data[n]))return this.data[n]}findIndex(t){let e=this.data,n=this.comp;if(e.length<8){for(let i=0;i<e.length;i++)if(n(t,e[i])===0)return i}else{let i=this.findIndexNearestStart(t);if(n(t,e[i])===0)return i}return-1}findIndexBy(t,e=0){for(let n=e;n<this.data.length;n++)if(t(this.data[n]))return n;return-1}findIndexNearestEnd(t,e=0){let n=this.data,i=this.comp,s=e,r=n.length;for(;s<r;){let o=s+r>>>1;i(t,n[o])<0?r=o:s=o+1}return s}findIndexNearestStart(t,e=0){let n=this.data,i=this.comp,s=e,r=n.length;for(;s<r;){let o=s+r>>>1;i(t,n[o])<=0?r=o:s=o+1}return s}getAt(t){return this.data[t]}insert(t){let e=this.findIndexNearestEnd(t);this.data.splice(e,0,t)}remove(t){let e=this.findIndex(t);return e<0?!1:(this.removeAt(e),!0)}removeAt(t,e=1){this.data.splice(t,e)}removeBy(t,e=0,n=1){let i=this.findIndexBy(t,e);return i<0?!1:(this.removeAt(i,n),!0)}removeRange(t,e){let n=this.findIndexNearestStart(t),s=this.findIndexNearestEnd(e??t,n)-n;return this.removeAt(n,s),s}size(){return this.data.length}toArray(){return this.data.slice()}values(){return this.data}},ke=class a{compareFn;data;constructor(t){this.compareFn=t,this.data=[]}static fromArray(t,e){let n=new a(e);return n.data=t.slice().sort((i,s)=>e(i.key,s.key)),n}clear(){this.data=[]}dequeue(){return this.data.shift()}entries(){return this.data}find(t){let e=this.findIndex(t);return e>=0?this.data[e].value:void 0}findBy(t,e=0){for(let n=e;n<this.data.length;n++)if(t(this.data[n].key))return this.data[n].value}findIndex(t){let e=this.data,n=this.compareFn;if(e.length<8){for(let i=0;i<e.length;i++)if(n(t,e[i].key)===0)return i}else{let i=this.findIndexNearestStart(t);if(n(t,e[i].key)===0)return i}return-1}findIndexBy(t,e=0){for(let n=e;n<this.data.length;n++)if(t(this.data[n].key))return n;return-1}findIndexNearestEnd(t,e=0){let n=this.data,i=this.compareFn,s=e,r=this.data.length;for(;s<r;){let o=s+r>>>1;i(t,n[o].key)<0?r=o:s=o+1}return s}findIndexNearestStart(t,e=0){let n=this.data,i=this.compareFn,s=e,r=n.length;for(;s<r;){let o=s+r>>>1;i(t,n[o].key)<=0?r=o:s=o+1}return s}getValueAt(t){return this.data[t].value}insert(t,e){let n=this.findIndexNearestEnd(t);this.data.splice(n,0,{key:t,value:e})}keys(){return this.data.map(t=>t.key)}remove(t){let e=this.findIndex(t);return e<0?!1:(this.removeAt(e),!0)}removeAt(t,e=1){this.data.splice(t,e)}removeBy(t,e=0,n=1){let i=this.findIndexBy(t,e);return i<0?!1:(this.removeAt(i,n),!0)}removeRange(t,e){let n=this.findIndexNearestStart(t),s=this.findIndexNearestEnd(e??t,n)-n;return this.removeAt(n,s),s}size(){return this.data.length}toArray(){return this.data.slice()}values(){return this.data.map(t=>t.value)}};function te(a,t,e,n,i){T(i<=a.length-t,"Parameter 'length' must be smaller or equal to length of 'src' to avoid over-read");let s=n+i;s>e.length&&(e.length=s);let r=t,o=n;for(;o<s;)e[o++]=a[r++]}function Vn(a,t,e,n,i){T(i<=a.length-t,"Parameter 'length' must be smaller or equal to length of 'src' to avoid over-read");let s=n+i;s>e.length&&(e.length=s);let r=t+i-1,o=n;for(;o<s;)e[o++]=a[r--]}function kt(a,t){if(a===t)return!0;if(a.length!==t.length)return!1;for(let e=0;e<a.length;e++)if(a[e]!==t[e])return!1;return!0}var P=class a{chain;data;face;lnext;onext;p0;seg;sym;constructor(t,e,n){this.p0=t,this.seg=e,this.data=n,this.lnext=this,this.onext=this,this.sym=this,this.chain=void 0,this.face=void 0}get lprev(){return this.onext.sym}get oprev(){return this.sym.lnext}get p1(){return this.sym.p0}static clear(t){t.lnext=t,t.onext=t,t.sym=t,t.chain=void 0,t.face=void 0}static compareQueue(t,e){return t.p0.x!==e.p0.x?t.p0.x-e.p0.x:t.p0.y!==e.p0.y?t.p0.y-e.p0.y:t.left()!==e.left()?t.left()?1:-1:t.left()?b.signedArea(t.p1,t.p0,e.p1):b.signedArea(t.p0,t.p1,e.p1)}static compareStatus(t,e){return t.p0.eq(e.p0)?t.p1.eq(e.p1)?0:b.signedArea(t.p0,t.p1,e.p1):a.compareQueue(t,e)<0?b.signedArea(t.p0,t.p1,e.p0):b.signedArea(e.p1,e.p0,t.p0)}static createPair(t,e){let n=new a(t.p0,t,void 0),i=new a(t.p1,e,void 0);return n.sym=i,n.lnext=i,i.sym=n,i.lnext=n,n}static detachPair(t){a.splice(t,t.oprev),a.splice(t.sym,t.sym.oprev)}static findConnectingEdge(t,e){if(t===t.onext)return t;let n=t;do{let i=n.onext;if(C.isBetweenCcw(e,n.vector(),i.vector()))return n;n=i}while(n!==t);return v.error("Mesh2: Cannot find connecting edge (Fallback)"),t}static isJoin(t,e){return t.p1.eq(e.p0)}static join(t,e){let n=t.sym,i=e.sym;t.lnext=e,e.onext=n,n.onext=e,i.lnext=n}static splice(t,e){let n=t.onext,i=e.onext;n.sym.lnext=e,i.sym.lnext=t,t.onext=i,e.onext=n}static swap(t){let e=t.face,n=t.sym.face;if(e===void 0||n===void 0)return;let i=t.oprev,s=t.lnext;a.splice(t,i),a.splice(t.sym,s),a.splice(t,i.lnext),a.splice(t.sym,s.lnext);let r=new S(i.p1,s.p1);t.p0=r.p0,t.seg=r,t.sym.p0=r.p1,t.sym.seg=r.reverse(),e.start=t,j.updateEdgeFaces(e,e),n.start=t.sym,j.updateEdgeFaces(n,n)}clonePair(){let t=this.sym,e=new a(this.p0,this.seg,this.data),n=new a(t.p0,t.seg,t.data);return e.sym=n,e.lnext=n,n.sym=e,n.lnext=e,e}getLnextIterator(){return new Lt(this,this.lprev)}getOnextIterator(){return new he(this,this.oprev)}left(){return this.p0.x!==this.p1.x?this.p0.x<this.p1.x:this.p0.y<this.p1.y}needsSwap(){if(this.face===void 0||this.sym.face===void 0)return!1;let t=this.p0,e=this.sym.p0,n=this.lnext.p1,i=this.sym.lnext.p1,s=t.sub(i),r=e.sub(i),o=n.sub(i),c=s.lenSq()*r.cross(o),u=r.lenSq()*s.cross(o),l=o.lenSq()*s.cross(r);return c-u+l>0}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}validate(){T(this.sym!==this),T(this.sym.sym===this),T(this.lnext.onext.sym===this),T(this.onext.sym.lnext===this),T(this.seg!==void 0==(this.face!==void 0));let t=this.onext;do{let e=t.oprev,n=t.onext;e!==n&&(T(t.p0.eq(e.p0)&&t.p0.eq(n.p0)),T(C.isBetweenCcw(t.vector(),e.vector(),n.vector()))),t=t.onext}while(t!==this.onext)}vector(){return this.p1.sub(this.p0)}},it=class{data;head;tail;constructor(t,e,n){this.head=t,this.tail=e,this.data=n}static updateEdgeChains(t,e){for(let n of t.getEdgeIterator())n.chain=e}getEdgeIterator(){return new Lt(this.tail,this.head)}isClosed(){return P.isJoin(this.head,this.tail)}printDebug(){let t=`MeshChain2 {
`;for(let e of this.getEdgeIterator())t+=`    MeshEdge2 ${e}
`;t+="}",v.infoDebug("{}",t)}writeToPath(t){let e=this.getEdgeIterator(),n=e.next();for(n.done!==!0&&(t.moveTo(n.value.p0),n=e.next());n.done!==!0;)t.lineTo(n.value.p0),n=e.next()}},j=class{data;start;constructor(t,e){this.start=t,this.data=e}static updateEdgeFaces(t,e){for(let n of t.getEdgeIterator())n.face=e}getEdgeIterator(){return new Lt(this.start,this.start.lprev)}getEdges(){let t=[];for(let e of this.getEdgeIterator())t.push(e);return t}getPoints(){let t=[];for(let e of this.getEdgeIterator())t.push(e.p0);return t}getSignedArea(){let t=0;for(let e of this.getEdgeIterator()){let n=e.seg??new S(e.p0,e.p1);t+=n.getSignedArea()}return t}hasPointInside(t){let e=0;for(let n of this.getEdgeIterator()){let i=n.seg??new S(n.p0,n.p1);e+=i.getWindingAt(t)}return e!==0}isMonotoneInX(){let t=this.start.lprev,e=0,n=t.p1.x-t.p0.x;for(let i of this.getEdgeIterator()){let s=i.p1.x-i.p0.x;(n>0||s>0)&&(n<0||s<0)&&(e+=1),n=s}return e<=2}printDebug(){let t=`MeshFace2 {
`;for(let e of this.getEdgeIterator())t+=`    MeshEdge2 ${e}
`;t+="}",v.infoDebug("{}",t)}writeToPath(t){let e=this.getEdgeIterator(),n=e.next();for(n.done!==!0&&(t.moveTo(n.value.p0),n=e.next());n.done!==!0;)t.lineTo(n.value.p0),n=e.next();t.close()}},D=class a{chains;edges;faces;constructor(){this.chains=[],this.edges=[],this.faces=[]}static createFromChain(t){let e=new a,n=t.getEdgeIterator(),i=n.curr.clonePair();e.edges.push(i),n.next();let s=i;for(let o of n){let c=o.clonePair();e.edges.push(c),P.join(s,c),s=c}let r=new it(i,s,t.data);return it.updateEdgeChains(r,r),e.chains.push(r),e}static createFromFace(t){let e=new a,n=t.getEdgeIterator(),i=n.curr.clonePair();e.edges.push(i),n.next();let s=i;for(let o of n){let c=o.clonePair();P.join(s,c),e.edges.push(c),s=c}P.join(s,i);let r=new j(i,t.data);return j.updateEdgeFaces(r,r),e.faces.push(r),e}addChainSegment(t,e){let n=this.createEdge(t);n.data=e;for(let i of this.chains){if(P.isJoin(i.head,n))return this.chainAddHead(i,n),n;if(P.isJoin(n,i.tail))return this.chainAddTail(i,n),n}return this.createChain(n,n),n}clear(){for(let t of this.edges)P.clear(t);this.chains=[],this.edges=[],this.faces=[]}clone(){let t=new a,e=new Map;for(let n=0;n<this.edges.length;n++){let i=this.edges[n],s=new P(i.p0,i.seg,i.data);t.edges.push(s),e.set(i,n)}for(let n=0;n<this.edges.length;n++){let i=this.edges[n],s=t.edges[n],r=e.get(i.sym),o=e.get(i.lnext),c=e.get(i.onext);r!==void 0&&(s.sym=t.edges[r]),o!==void 0&&(s.lnext=t.edges[o]),c!==void 0&&(s.onext=t.edges[c])}for(let n of this.chains){let i=e.get(n.head),s=e.get(n.tail);if(i!==void 0&&s!==void 0){let r=new it(t.edges[i],t.edges[s],n.data);it.updateEdgeChains(r,r),t.chains.push(r)}}for(let n of this.faces){let i=e.get(n.start);if(i!==void 0){let s=new j(t.edges[i],n.data);j.updateEdgeFaces(s,s),t.faces.push(s)}}return t}connectEdgePoints(t,e){let n=e.p0.sub(t.p0);if(n.isZero()){let i=P.findConnectingEdge(t,e.vector()),s=P.findConnectingEdge(e,t.vector());this.connectEdges(i,s)}else{let i=P.findConnectingEdge(t,n),s=P.findConnectingEdge(e,n.neg());this.connectEdges(i,s)}}connectEdges(t,e){if(t!==e){if(t.face===void 0||e.face===void 0){v.error("Mesh2: At least one face is undefined");return}if(t.p0.eq(e.p0))P.splice(t,e);else{let n=new S(t.p0,e.p0),i=this.createEdge(n,n.reverse());P.splice(t,i),P.splice(e,i.sym)}if(t.face===e.face){let n=t.face;n.start=t,j.updateEdgeFaces(n,n);let i=this.createFace(e);i.data=n.data,j.updateEdgeFaces(i,i)}else{let n=e.face;j.updateEdgeFaces(n,t.face);let i=this.destroyFace(n);T(i,"Unable to destroy face")}}}createChain(t,e){let n=new it(t,e,void 0);return this.chains.push(n),n}createEdge(t,e){let n=P.createPair(t,e);return this.edges.push(n,n.sym),n}createFace(t){let e=new j(t,void 0);return this.faces.push(e),e}deleteEdgePair(t){P.detachPair(t),t.chain=void 0,t.face=void 0,t.sym.chain=void 0,t.sym.face=void 0;let e=this.destroyEdge(t),n=this.destroyEdge(t.sym);T(e&&n,"Unable to destroy edges")}deleteFace(t){let e=t.start,n=e,i=n.lnext;do n=i,i=n.lnext,n.sym.face===void 0?this.deleteEdgePair(n):n.face=void 0;while(n!==e);let s=this.destroyFace(t);T(s,"Unable to destroy face")}destroyChain(t){let e=this.chains.indexOf(t);return e<0?!1:(this.chains.splice(e,1),!0)}destroyEdge(t){let e=this.edges.indexOf(t);return e<0?!1:(this.edges.splice(e,1),!0)}destroyFace(t){let e=this.faces.indexOf(t);return e<0?!1:(this.faces.splice(e,1),!0)}finalizeChain(t){let e=this.createFace(t.tail);e.data=t.data;let n=this.destroyChain(t);T(n,"Unable to destroy chain");for(let i of e.getEdgeIterator())i.face=e,i.chain=void 0}getChains(){return this.chains}getChainsPath(){let t=new w;for(let e of this.chains)e.writeToPath(t);return t}getEdges(){return this.edges}getFaces(){return this.faces}getFacesPath(){let t=new w;for(let e of this.faces)e.writeToPath(t);return t}getFacesPaths(){let t=[];for(let e of this.faces){let n=new w;e.writeToPath(n),t.push(n)}return t}monotonize(){let t=this.edges.filter(e=>e.face!==void 0);t.sort((e,n)=>P.compareQueue(e,n)),this.monotoneProcess(t)}monotonizeFaces(t){let e=[];for(let n of t)for(let i of n.getEdgeIterator())e.push(i);e.sort((n,i)=>P.compareQueue(n,i)),this.monotoneProcess(e)}printDebug(){let t=`Mesh2 {
`;for(let e of this.getChains()){t+=`    MeshChain2 {
`;for(let n of e.getEdgeIterator())t+=`        MeshEdge2 ${n}
`;t+=`    }
`}for(let e of this.getFaces()){t+=`    MeshFace2 {
`;for(let n of e.getEdgeIterator())t+=`        MeshEdge2 ${n}
`;t+=`    }
`}t+="}",v.infoDebug("{}",t)}triangulate(t=!1){this.monotonize();let e=this.faces.length;for(let n=0;n<e;n++)this.triangulateProcess(this.faces[n]);t&&this.triangulateOptimize()}triangulateAddPoint(t){for(let e of this.faces)if(e.hasPointInside(t)){let n=e.start,i=n.lnext,s=i.lnext,r=new S(t,n.p0),o=new S(t,i.p0),c=new S(t,s.p0),u=this.createEdge(r,r.reverse()),l=this.createEdge(o,o.reverse()),p=this.createEdge(c,c.reverse());P.splice(u,l),P.splice(l,p),P.splice(n,u.sym),P.splice(i,l.sym),P.splice(s,p.sym);let h=new j(i,void 0),d=new j(s,void 0);j.updateEdgeFaces(e,e),j.updateEdgeFaces(h,h),j.updateEdgeFaces(d,d),this.faces.push(h),this.faces.push(d);return}}triangulateOptimize(){let t=0;for(;t<this.edges.length;){let e=this.edges[t];e.needsSwap()?(P.swap(e),t=0):t++}}validate(){for(let t of this.edges)t.validate()}chainAddHead(t,e){P.join(t.head,e),t.head=e,t.isClosed()?(P.join(t.head,t.tail),this.finalizeChain(t)):this.chainCheckTails(t)}chainAddTail(t,e){P.join(e,t.tail),t.tail=e,t.isClosed()?(P.join(t.head,t.tail),this.finalizeChain(t)):this.chainCheckHeads(t)}chainCheckHeads(t){for(let e of this.chains)if(e!==t&&P.isJoin(e.head,t.tail)){P.join(e.head,t.tail),t.tail=e.tail;let n=this.destroyChain(e);T(n,"Unable to destroy chain"),t.isClosed()&&(P.join(t.head,t.tail),this.finalizeChain(t));return}}chainCheckTails(t){for(let e of this.chains)if(e!==t&&P.isJoin(t.head,e.tail)){P.join(t.head,e.tail),t.head=e.head;let n=this.destroyChain(e);T(n,"Unable to destroy chain"),t.isClosed()&&(P.join(t.head,t.tail),this.finalizeChain(t));return}}monotoneDelete(t,e,n){let i=t.findIndex(e);if(i<0){v.error("Mesh2: Unable to delete status");return}let s=t.getValueAt(i);s.isMerge===!0&&this.connectEdgePoints(n,s.helper),t.removeAt(i)}monotoneInsert(t,e){t.insert(e,{helper:e,face:e.face,isMerge:!1})}monotoneProcess(t){let e=new ke(P.compareStatus);for(let n of t){let i=n.lprev,s=n;if(s.seg===void 0){v.error("Mesh2: Unable to get segment");continue}let r=i.p0,o=s.p0,c=s.p1,u=o.sub(r),l=c.sub(o),p=u.cross(l);if(p>0){if(r.x>=o.x&&o.x<c.x){this.monotoneInsert(e,s);continue}if(r.x<=o.x&&o.x>c.x){this.monotoneDelete(e,i,s);continue}}else if(p<0){if(r.x>o.x&&o.x<=c.x){this.monotoneUpdate(e,s,!1,!0),this.monotoneInsert(e,s);continue}if(r.x<o.x&&o.x>=c.x){this.monotoneDelete(e,i,s),this.monotoneUpdate(e,s,!0,!1);continue}}o.lt(c)?(this.monotoneDelete(e,i,s),this.monotoneInsert(e,s)):this.monotoneUpdate(e,s,!1,!1)}}monotoneUpdate(t,e,n,i){let s=t.findIndexNearestEnd(e);if(s<0){v.error("Mesh2: Unable to update status");return}let r=t.getValueAt(s);(r.isMerge||i)&&this.connectEdgePoints(e,r.helper),r.helper=e,r.isMerge=n}triangulateProcess(t){let e=t.getEdges();e.sort((s,r)=>P.compareQueue(s,r));let n=[e[0],e[1]];for(let s=2;s<e.length-1;s++){let r=e[s],o=e[s-1],c=r.lnext.p0.eq(o.p0),u=o.lnext.p0.eq(r.p0);if(c||u)for(;n.length>1;){let l=n[n.length-1],p=n[n.length-2],h=b.signedArea(r.p0,l.p0,p.p0);if(c&&h>0||u&&h<0)this.connectEdgePoints(r,p),n.pop();else break}else{for(;n.length>1;){let l=n[n.length-1];this.connectEdgePoints(r,l),n.pop()}n.pop(),n.push(o)}n.push(r)}let i=e[e.length-1];for(let s=1;s<n.length-1;s++){let r=n[s];this.connectEdgePoints(i,r)}}};var ct=class a{left;p0;p1;seg;wind;constructor(t,e,n,i,s){this.p0=t,this.p1=e,this.seg=n,this.wind=i,this.left=s}static compareQueue(t,e){return t.p0.x!==e.p0.x?t.p0.x-e.p0.x:t.p0.y!==e.p0.y?t.p0.y-e.p0.y:t.left!==e.left?t.left?1:-1:t.left?b.signedArea(t.p1,t.p0,e.p1):b.signedArea(t.p0,t.p1,e.p1)}static compareStatus(t,e){return t.p0.eq(e.p0)?t.p1.eq(e.p1)?0:b.signedArea(t.p1,t.p0,e.p1):a.compareQueue(t,e)<0?b.signedArea(t.p1,t.p0,e.p0):b.signedArea(e.p0,e.p1,t.p0)}eq(t){return this.p0.eq(t.p0)&&this.p1.eq(t.p1)}printDebug(){v.infoDebug("{} -> {} ({}, id = {}, winding = {})",this.p0,this.p1,this.left?"left":"right",this.seg.ref.data,this.wind)}};function Be(a){a.process(),v.assertFn(()=>a.validate(),"PathClip2: Validation failed");let t=[];a.writeEdgeSegmentsTo(t);let e=[];for(let n of t){let i=n.p0,s=n.p1,r=n.ref.weight;i.eq(s)||(i.lt(s)?(e.push(new ct(i,s,n,r,!0)),e.push(new ct(s,i,n,r,!1))):(e.push(new ct(s,i,n,-r,!0)),e.push(new ct(i,s,n,-r,!1))))}return e.sort(ct.compareQueue),e}function ee(a,t,e){let n=!1,i=!1;switch(e){case 0:{n=a!==0,i=t!==0;break}case 1:{n=(a&1)!==0,i=(t&1)!==0;break}case 2:{n=a>0,i=t>0;break}case 3:{n=a<0,i=t<0;break}default:{n=e(a),i=e(t);break}}return[n,i]}function ni(a,t,e,n,i){let s=!1,r=!1;switch(i){case 0:{s=!a&&!e&&(t||n),r=!t&&!n&&(a||e);break}case 1:{s=t&&n&&(!a||!e),r=a&&e&&(!t||!n);break}case 2:{s=a===e&&t!==n,r=a!==e&&t===n;break}case 3:{s=t&&!n&&(!a||e),r=a&&!e&&(!t||n);break}case 4:{s=!t&&n&&(a||!e),r=!a&&e&&(t||!n);break}}return[s,r]}var tt=class a{hi;lo;constructor(t,e){this.hi=t,this.lo=e}static from(t){return new a(t,0)}add(t){let e=Ln(this.hi,t.hi),n=Ln(this.lo,t.lo),i=yt(e.hi,e.lo+n.hi);return yt(i.hi,n.lo+i.lo)}add64(t){let e=Ln(this.hi,t);return yt(e.hi,this.lo+e.lo)}div(t){let e=this.hi/t.hi,n=vi(this,e),i=this.hi-n.hi,s=this.lo-n.lo,r=i+s;return yt(e,r/t.hi)}div64(t){let e=this.hi/t,n=Re(e,t),r=this.hi-n.hi-n.lo+this.lo;return yt(e,r/t)}mul(t){let e=Re(this.hi,t.hi),n=this.hi*t.lo,i=this.lo*t.hi,s=n+i;return yt(e.hi,e.lo+s)}mul64(t){let e=Re(this.hi,t),n=this.lo*t;return yt(e.hi,e.lo+n)}neg(){return new a(-this.hi,-this.lo)}sub(t){return this.add(t.neg())}sub64(t){return this.add64(-t)}value(){return this.hi+this.lo}};function Ln(a,t){let e=a+t,n=e-t,i=e-n,s=a-n,r=t-i,o=s+r;return new tt(e,o)}function yt(a,t){let e=a+t,n=e-a,i=t-n;return new tt(e,i)}function vi(a,t){let e=Re(a.hi,t),n=yt(e.hi,a.lo*t);return yt(n.hi,n.lo+e.lo)}function Re(a,t){let e=ii(a),n=ii(t),i=a*t,c=-i+e.hi*n.hi+e.hi*n.lo+e.lo*n.hi+e.lo*n.lo;return new tt(i,c)}function ii(a){let t=134217729*a,e=a-t,n=t+e,i=a-n;return new tt(n,i)}var Dn=class{pixel;constructor(){this.pixel=new Map}addMagnet(t){let e=t.toString();this.pixel.set(e,{type:0,p:t})}addPin(t){let e=t.toString();this.pixel.has(e)||this.pixel.set(e,{type:1,p:t})}clear(){this.pixel.clear()}getMagnets(){let t=[];for(let e of this.pixel.values())e.type===0&&t.push(e.p);return t}getPins(){let t=[];for(let e of this.pixel.values())e.type===1&&t.push(e.p);return t}getValues(){return this.pixel.values()}},Et=class{key;left;p0;p1;seg;constructor(t,e,n,i,s){this.p0=t,this.p1=e,this.seg=n,this.key=i,this.left=s}static compareQueue(t,e){return t.p0.x!==e.p0.x?t.p0.x-e.p0.x:t.p0.y!==e.p0.y?t.p0.y-e.p0.y:t.left!==e.left?t.left?1:-1:0}static compareStatus(t,e){return t.key-e.key}},St=class{inputSegments;intersections;magnets;outputSegments;pins;pixelSet;precision;constructor(){this.precision=2**16,this.inputSegments=[],this.intersections=[],this.magnets=[],this.outputSegments=[],this.pins=[],this.pixelSet=new Dn}addSegment(t,e,n,i,s){v.assertFn(()=>t.isFinite(),"SnapRound2: BezierCurve2 is not finite"),t.type!==0&&v.warn("SnapRound2: Not implemented yet");let r=this.precision,o=this.addEndpoint(t.p0,r,i),c=this.addEndpoint(t.pn,r,i),u={set:e,weight:n,data:s};this.inputSegments.push({p0:o,p1:c,ref:u})}clear(){this.pixelSet.clear(),this.inputSegments=[],this.intersections=[],this.magnets=[],this.outputSegments=[],this.pins=[]}debugGetErrors(){return this.createIntersections(this.outputSegments)}debugGetInputSegments(){return this.inputSegments.slice()}debugGetIntersections(){return this.intersections.slice()}debugGetMagnets(){return this.magnets.slice()}debugGetOutputSegments(){return this.outputSegments.slice()}debugGetPins(){return this.pins.slice()}process(){this.intersections=this.createIntersections(this.inputSegments);for(let t of this.intersections){let e=Ve(t);this.pixelSet.addMagnet(e)}this.magnets=this.pixelSet.getMagnets(),this.pins=this.pixelSet.getPins(),this.intersectEdges(this.magnets,this.pins)}validate(){return this.debugGetErrors().length===0}writeEdgeSegmentsTo(t){let e=this.precision;for(let n of this.outputSegments){let i=new b(n.p0.x/e,n.p0.y/e),s=new b(n.p1.x/e,n.p1.y/e),r=n.ref;t.push({p0:i,p1:s,ref:r})}}writeEdges(t){let e=this.precision;for(let n of this.outputSegments){let i=new b(n.p0.x/e,n.p0.y/e),s=new b(n.p1.x/e,n.p1.y/e);t.push(new E(i,s))}}static signedArea(t,e,n){let i=tt.from(t.x),s=tt.from(t.y),r=tt.from(e.x),o=tt.from(e.y),c=tt.from(n.x),u=tt.from(n.y),l=r.sub(i),p=o.sub(s),h=c.sub(i),d=u.sub(s),m=l.mul(d),f=p.mul(h);return m.sub(f).value()}addEndpoint(t,e,n){let i=new b(e*t.x,e*t.y),s=Ve(i);return this.isPin(s,t,e)&&!n?(this.pixelSet.addPin(s),s):(this.pixelSet.addMagnet(s),i)}addSegmentCandidate(t,e,n,i){if(e.eq(n))return;let s=this.getPixelIntersections(e,n,i);this.sortByParameter(s);let r=e;for(let o of s){let c=b.signedArea(t.p0,t.p1,o.p),u=b.signedArea(e,n,o.p);c*u<=0&&(this.addSegmentOutput(r,o.p,t.ref),r=o.p)}this.addSegmentOutput(r,n,t.ref)}addSegmentOutput(t,e,n){t.eq(e)||this.outputSegments.push({p0:t,p1:e,ref:n})}createIntersections(t){let e=[],n=this.createQueue(t),i=new xt(Et.compareStatus);for(let s of n.values())if(s.left){for(let r of i.values())this.writeSegmentIntersectionsTo(s.seg,r.seg,e);i.insert(s)}else{let r=i.remove(s);T(r,`SnapRound2: Status event not found
{}`,s.seg)}return e}createQueue(t){let e=[];for(let n=0;n<t.length;n++){let i=t[n];i.p0.eq(i.p1)||(i.p0.lt(i.p1)?(e.push(new Et(i.p0,i.p1,i,n,!0)),e.push(new Et(i.p1,i.p0,i,n,!1))):(e.push(new Et(i.p1,i.p0,i,n,!0)),e.push(new Et(i.p0,i.p1,i,n,!1))))}return xt.fromArray(e,Et.compareQueue)}getPixelIntersections(t,e,n){let i=[];for(let s of n){if(s.eq(t)||s.eq(e))continue;let r=yi(t,e,s);if(r!==void 0){let[o,c]=r;i.push({p:s,min:o,max:c})}}return i}intersectEdges(t,e){for(let n of this.inputSegments){let i=Ve(n.p0),s=Ve(n.p1);if(i.eq(s)){this.outputSegments.push({p0:i,p1:s,ref:n.ref});continue}let r=this.getPixelIntersections(n.p0,n.p1,t);this.sortByParameter(r);let o=i;for(let c of r)this.addSegmentCandidate(n,o,c.p,e),o=c.p;this.addSegmentCandidate(n,o,s,e)}}isPin(t,e,n){return t.x/n===e.x&&t.y/n===e.y}sortByParameter(t){t.sort((e,n)=>e.min!==n.min?e.min-n.min:(e.max===n.max&&v.error("Max parameter values are equal"),e.max-n.max))}writeSegmentIntersectionsTo(t,e,n){if(t.p0.eq(e.p0)||t.p0.eq(e.p1)||t.p1.eq(e.p0)||t.p1.eq(e.p1))return;let i=b.signedArea(e.p0,e.p1,t.p0),s=b.signedArea(e.p0,e.p1,t.p1),r=mt(s-i,i);if(r<0||r>1||Number.isNaN(r))return;let o=b.signedArea(t.p0,t.p1,e.p0),c=b.signedArea(t.p0,t.p1,e.p1),u=mt(c-o,o);if(u<0||u>1||Number.isNaN(u))return;let l=t.p0.lerp(t.p1,r),p=e.p0.lerp(e.p1,u);n.push(l.lerp(p,.5))}};function yi(a,t,e){let n=e.x-.5,i=e.y-.5,s=e.x+.5,r=e.y+.5;if(a.x<n&&t.x<n||a.y<i&&t.y<i||a.x>s&&t.x>s||a.y>r&&t.y>r)return;let o=t.x-a.x,c=t.y-a.y,u=(n-a.x)/o,l=(s-a.x)/o,p=(i-a.y)/c,h=(r-a.y)/c;if(o===0){if(a.x===s)return;u=p,l=h}if(c===0){if(a.y===r)return;p=u,h=l}let d=Math.max(Math.min(u,l),Math.min(p,h)),m=Math.min(Math.max(u,l),Math.max(p,h)),f;if(d===m){let y=a.lerp(t,d);y.x===n&&y.y===i&&(f=[d,m])}else d<m&&(d>=0&&d<=1?f=[d,m]:m>=0&&m<=1&&(f=[m,d]));return f}function Ve(a){let t=Math.round(a.x),e=Math.round(a.y);return new b(t,e)}var et=class{booleanOperator;flattenTolerance;snapRound;status;windingOperatorA;windingOperatorB;constructor(t){this.status=new xt(ct.compareStatus),this.snapRound=new St,this.snapRound.precision=t.clipPrecision,this.flattenTolerance=t.flattenTolerance,this.booleanOperator=at.booleanOperator,this.windingOperatorA=at.windingOperatorA,this.windingOperatorB=at.windingOperatorB}addCurve(t,e=0,n=1,i=!1,s){this.snapRound.addSegment(t,e,n,i,s)}addEdge(t,e=0,n=1,i=!1,s){this.snapRound.addSegment(t.toBezier(),e,n,i,s)}addMesh(t,e=0,n=1,i=!1){for(let s of t.getChains())for(let r of s.getEdgeIterator())r.seg!==void 0&&this.snapRound.addSegment(r.seg,e,n,i,r.data);for(let s of t.getFaces())for(let r of s.getEdgeIterator())r.seg!==void 0&&this.snapRound.addSegment(r.seg,e,n,i,r.data)}addPath(t,e=0,n=1,i=!1){let s=t.flatten(!1,{flattenMode:1,flattenTolerance:this.flattenTolerance});for(let r of s.getCurveIterator())this.snapRound.addSegment(r,e,n,i,void 0)}process(t,e){this.booleanOperator=e.booleanOperator,this.windingOperatorA=e.windingOperatorA,this.windingOperatorB=e.windingOperatorB,this.status.clear();let n=Be(this.snapRound);for(let i of n)if(i.left)this.status.insert(i);else{let s=this.status.findIndexBy(u=>u.seg===i.seg);if(s<0){v.error("PathClip2: Status event segment {} not found",i.seg);continue}let r=this.status.getAt(s),[o,c]=this.isIncOut(r);if(o){let u=new S(r.p0,r.p1);t.addChainSegment(u,r.seg.ref.data)}else if(c){let u=new S(r.p1,r.p0);t.addChainSegment(u,r.seg.ref.data)}this.status.removeAt(s)}this.snapRound.clear()}setQualityOptions(t){this.snapRound.precision=t.clipPrecision,this.flattenTolerance=t.flattenTolerance}isIncOut(t){if(t.wind===0)return[!1,!1];let e=0,n=0,i=0,s=0,r=!1;for(let p=this.status.size()-1;p>=0;p--){let h=this.status.getAt(p);if(h.eq(t))h.seg.ref.set===0?e-=h.wind:i-=h.wind,h.wind=0,r=!0;else if(!r)h.seg.ref.set===0?n-=h.wind:s-=h.wind;else break}e+=n,i+=s;let[o,c]=ee(e,n,this.windingOperatorA),[u,l]=ee(i,s,this.windingOperatorB);return ni(o,c,u,l,this.booleanOperator)}};var w=class a{commands;points;constructor(){this.commands=[],this.points=[]}addArc(t,e,n){this.moveTo(t),this.arcTo(e,n)}addCircle(t,e){this.addCircleXY(t.x,t.y,e)}addCircleXY(t,e,n){this.moveToXY(t+n,e),this.arcToXY(t+n,e+n,t,e+n),this.arcToXY(t-n,e+n,t-n,e),this.arcToXY(t-n,e-n,t,e-n),this.arcToXY(t+n,e-n,t+n,e)}addConic(t,e,n,i){this.moveTo(t),this.conicTo(e,n,i)}addCubic(t,e,n,i){this.moveTo(t),this.cubicTo(e,n,i)}addCurveSplines(...t){if(t.length!==0){this.moveTo(t[0].p0);for(let e=0;e<t.length;e++){let n=t[e];switch(n.type){case 0:{this.lineTo(n.p1);break}case 1:{this.quadTo(n.p1,n.p2);break}case 2:{this.cubicTo(n.p1,n.p2,n.p3);break}case 3:{this.conicTo(n.p1,n.p2,n.w);break}default:F(n)}}}}addEllipse(t,e,n){this.addEllipseXY(t.x,t.y,e,n)}addEllipseXY(t,e,n,i){this.moveToXY(t+n,e),this.arcToXY(t+n,e+i,t,e+i),this.arcToXY(t-n,e+i,t-n,e),this.arcToXY(t-n,e-i,t,e-i),this.arcToXY(t+n,e-i,t+n,e),this.close()}addLine(t,e){this.moveTo(t),this.lineTo(e)}addLineXY(t,e,n,i){let s=new b(t,e),r=new b(n,i);this.addLine(s,r)}addPath(t,e=!1){e&&t.isValid()?(te(t.commands,1,this.commands,this.commands.length,t.commands.length-1),te(t.points,1,this.points,this.points.length,t.points.length-1)):(te(t.commands,0,this.commands,this.commands.length,t.commands.length),te(t.points,0,this.points,this.points.length,t.points.length))}addPathReversed(t,e=!1){e&&t.isValid()?(Bn(t.commands,1,this.commands,this.commands.length,t.commands.length-1),Vn(t.points,0,this.points,this.points.length,t.points.length-1)):(Bn(t.commands,0,this.commands,this.commands.length,t.commands.length),Vn(t.points,0,this.points,this.points.length,t.points.length))}addPie(t,e,n,i,s){let r=s;Math.abs(r)>2*Math.PI&&(r%=2*Math.PI);let o=Math.sin(i),c=Math.cos(i),u=zt.fromRotation(c,o);u.scale(e,n),u.translate(t.x,t.y),r<0&&u.scalePre(1,-1),r=Math.abs(r),o=Math.sin(r),c=Math.cos(r);let l=new C(1,0),p=new C(1,1),h=new C(c,o);for(this.moveTo(t),this.lineTo(u.mapVector(l).toPoint());r>.5*Math.PI+.005;){l=l.normal().neg();let f=u.mapVector(p).toPoint(),y=u.mapVector(l).toPoint();this.arcTo(f,y),p=p.normal().neg(),r-=.5*Math.PI}p=l.add(h),p=p.mul(2).div(p.dot(p)),c=Math.sqrt(.5*l.dot(h)+.5);let d=u.mapVector(p).toPoint(),m=u.mapVector(h).toPoint();this.conicTo(d,m,c),this.close()}addQuad(t,e,n){this.moveTo(t),this.quadTo(e,n)}addRect(t,e){this.addRectXY(t.x,t.y,e.x,e.y)}addRectXY(t,e,n,i){this.moveToXY(t,e),this.lineToXY(n,e),this.lineToXY(n,i),this.lineToXY(t,i),this.close()}arcTo(t,e){this.conicTo(t,e,Math.SQRT1_2)}arcToXY(t,e,n,i){let s=new b(t,e),r=new b(n,i);this.arcTo(s,r)}clear(){this.commands=[],this.points=[]}clip(t,e,n){let i=new D,s=new et({...Y,...n});return s.addPath(this,0),s.addPath(t,1),s.process(i,{...at,...e}),i.getFacesPath()}close(){this.commands.push({type:5})}conicTo(t,e,n){this.commands.push({type:4,w:n}),this.points.push(t),this.points.push(e)}conicToXY(t,e,n,i,s){let r=new b(t,e),o=new b(n,i);this.conicTo(r,o,s)}copyFrom(t){this.commands=t.commands.slice(),this.points=t.points.slice()}cubicTo(t,e,n){this.commands.push({type:3}),this.points.push(t),this.points.push(e),this.points.push(n)}cubicToXY(t,e,n,i,s,r){let o=new b(t,e),c=new b(n,i),u=new b(s,r);this.cubicTo(o,c,u)}dash(t,e){let n=new a;return _n({...Y,...e}).process(this,n,{...Kn,...t}),n}flatten(t=!1,e){let n=new a;return Oe({...Y,...e}).process(this,n,t),n}getBounds(){let t=R.createEmpty();for(let e of this.getCurveIterator())t.union(e.getBounds());return t}getCommands(){return this.commands}getCurveIterator(){return new de(this.commands,this.points)}getFirstCommand(){return this.commands[0]}getFirstPoint(){return this.points[0]}getLastCommand(){return this.commands[this.commands.length-1]}getLastPoint(){return this.points[this.points.length-1]}getPoints(){return this.points}getSignedArea(){let t=0;for(let e of this.getCurveIterator())t+=e.getSignedArea();return t}getSvgData(){let t=this.getCommands(),e=this.getPoints(),n=0,i=0,s="";for(;n<t.length;){let r=t[n++];switch(r.type){case 0:{let o=e[i++];s+=`M${o.x} ${o.y}`;break}case 1:{let o=e[i++];s+=`L${o.x} ${o.y}`;break}case 2:{let o=e[i++],c=e[i++];s+=`Q${o.x} ${o.y} ${c.x} ${c.y}`;break}case 3:{let o=e[i++],c=e[i++],u=e[i++];s+=`C${o.x} ${o.y} ${c.x} ${c.y} ${u.x} ${u.y}`;break}case 4:{let o=e[i++],c=e[i++];s+=`L${o.x} ${o.y} L${c.x} ${c.y}`;break}case 5:{s+="Z";break}default:F(r)}}return s}hasPointInside(t,e){if(!this.isValid())return!1;let n=0;for(let i of this.getCurveIterator()){let s=i.getControlBounds();t.y<s.y0||t.y>s.y1||t.x<s.x0||(n+=i.getWindingAt(t))}return Rn(n,e)}hasPointInsideFrac(t,e,n){if(!this.isValid())return!1;let i=n??2**-8,s=0;for(let r of this.getCurveIterator())s+=r.getWindingFracAt(t,i);return s=s/(2*Math.PI),s=Math.round(s),Rn(s,e)}isClosed(){return this.getLastCommand()?.type===5}isValid(){return this.getFirstCommand()?.type===0}lineTo(t){this.commands.push({type:1}),this.points.push(t)}lineToXY(t,e){let n=new b(t,e);this.lineTo(n)}moveTo(t){this.commands.push({type:0}),this.points.push(t)}moveToXY(t,e){let n=new b(t,e);this.moveTo(n)}offset(t,e){let n=new a;return Gn({...Y,...e}).process(this,n,{...Hn,...t}),n}quadTo(t,e){this.commands.push({type:2}),this.points.push(t),this.points.push(e)}quadToXY(t,e,n,i){let s=new b(t,e),r=new b(n,i);this.quadTo(s,r)}simplify(t){let e=new a;return Jn({...Y,...t}).process(this,e),e}stroke(t,e){let n=new a;return Fe({...Y,...e}).process(this,n,{...vt,...t}),n}svgArcTo(t,e,n,i,s,r){let o=this.getLastPoint();if(o===void 0||o===t||e===0||n===0){this.lineTo(t);return}let c=Math.sin(i),u=Math.cos(i),l=zt.fromRotation(u,-c),p=o.sub(t).mul(.5);p=l.mapVector(p);let h=Math.abs(e),d=Math.abs(n),m=p.x*p.x/(h*h)+p.y*p.y/(d*d);m>1&&(m=Math.sqrt(m),h*=m,d*=m),l.scale(1/h,1/d);let f=l.mapPoint(o),y=l.mapPoint(t);p=y.sub(f).mul(.5);let x=f.add(p),M=p.lenSq();if(M<1){let X=Math.sqrt(1/M-1);p=p.normal().neg().mul(X),s!==r?x=x.add(p):x=x.add(p.neg())}let k=f.sub(x),B=y.sub(x);l.rotateSet(k.x,k.y),l.translate(x.x,x.y),l.scale(h,d),l.rotate(u,c),c=k.cross(B),u=k.dot(B);let I=Math.atan2(c,u);for(r?(I<0&&(I+=2*Math.PI),B=new C(u,c)):(I>0&&(I-=2*Math.PI),l.scalePre(1,-1),B=new C(u,-c),I=Math.abs(I)),k=new C(1,0),p=new C(1,1);I>.5*Math.PI+.005;)k=k.normal().neg(),f=l.mapVector(p).toPoint(),y=l.mapVector(k).toPoint(),this.arcTo(f,y),p=p.normal().neg(),I-=.5*Math.PI;p=k.add(B),p=p.mul(2).div(p.dot(p)),f=l.mapVector(p).toPoint(),y=t,u=Math.sqrt(.5*(1+k.dot(B))),this.conicTo(f,y,u)}toMesh(t,e){let n=new D,i=new et({...Y,...e});return i.addPath(this,0),i.process(n,{...at,windingOperatorA:t}),n}toMultiPolygon(t,e){return this.toMesh(t,e).getFaces().map(i=>new q(i.getPoints()))}transform(t){let e=this.points;for(let n=0;n<e.length;n++)e[n]=t.mapPoint(e[n])}};var st=class a{a;b;g;r;constructor(t,e,n,i){this.r=t,this.g=e,this.b=n,this.a=i}static fromHsv(t,e,n,i){let s=Math.floor(t*6),r=t*6-s,o=n*(1-e),c=n*(1-e*r),u=n*(1-e*(1-r));switch(s%6){case 0:return new a(n,u,o,i);case 1:return new a(c,n,o,i);case 2:return new a(o,n,u,i);case 3:return new a(o,c,n,i);case 4:return new a(u,o,n,i);case 5:return new a(n,o,c,i)}return new a(0,0,0,i)}static fromNumber(t){let e=t>>>0&255,n=t>>>8&255,i=t>>>16&255,s=t>>>24&255;return new a(s/255,i/255,n/255,e/255)}style(){let t=this.clampFloatToHex(this.r),e=this.clampFloatToHex(this.g),n=this.clampFloatToHex(this.b),i=this.clampFloatToHex(this.a);return`#${t}${e}${n}${i}`}clampFloatToHex(t){return L(Math.round(255*t),0,255).toString(16).padStart(2,"0")}};function Yt(a,t,e,n,i){let s=new w;switch(s.moveTo(new b(n*a.nextFloat(),i*a.nextFloat())),t){case 0:{for(let r=0;r<e;r++){let o=new b(n*a.nextFloat(),i*a.nextFloat());s.lineTo(o)}break}case 1:{for(let r=0;r<e;r++){let o=new b(n*a.nextFloat(),i*a.nextFloat()),c=new b(n*a.nextFloat(),i*a.nextFloat());s.quadTo(o,c)}break}case 2:{for(let r=0;r<e;r++){let o=new b(n*a.nextFloat(),i*a.nextFloat()),c=new b(n*a.nextFloat(),i*a.nextFloat()),u=new b(n*a.nextFloat(),i*a.nextFloat());s.cubicTo(o,c,u)}break}case 3:{for(let r=0;r<e;r++){let o=new b(n*a.nextFloat(),i*a.nextFloat()),c=new b(n*a.nextFloat(),i*a.nextFloat());s.conicTo(o,c,4*a.nextFloat())}break}}return s}function Tt(a,t,e,n,i){let s=new q,r=new q;switch(t){case 0:{let u=a.nextIntBetween(3,50),l=a.nextIntBetween(3,50);for(let p=0;p<u;p++)s.addPoint(new b(n*a.nextFloat(),i*a.nextFloat()));for(let p=0;p<l;p++)r.addPoint(new b(n*a.nextFloat()+e,i*a.nextFloat()));break}case 1:{s.addXY(100,100),s.addXY(400,150),s.addXY(450,400),s.addXY(150,450),r.addXY(300+e,300),r.addXY(600+e,350),r.addXY(650+e,600),r.addXY(350+e,650);break}case 2:{s.addXY(100,100),s.addXY(400,100),s.addXY(400,400),s.addXY(100,400),r.addXY(200+e,150),r.addXY(300+e,150),r.addXY(300+e,350),r.addXY(200+e,350);break}case 3:{s.addXY(100,100),s.addXY(150,500),s.addXY(550,500),s.addXY(500,100),r.addXY(250+e,200),r.addXY(450+e,200),r.addXY(400+e,400),r.addXY(200+e,400);break}case 4:{s.addXY(100,100),s.addXY(400,100),s.addXY(400,400),s.addXY(100,400),r.addXY(150,150+e),r.addXY(350,350+e),r.addXY(350,150+e),r.addXY(150,350+e);break}case 5:{s.addXY(100,300),s.addXY(200,250),s.addXY(300,200+.1*e),s.addXY(400,150),s.addXY(510,100),s.addXY(505,300);break}case 6:{s.addXY(100,100),s.addXY(600,400),s.addXY(200,400),s.addXY(300,200),s.addXY(400,300),s.addXY(500,100);break}}return[s,r]}function si(a,t,e,n,i){let s=new q,r=t.getCenter(),o=2*Math.PI/e,c=.5*t.dx(),u=.5*t.dy();for(let l=0;l<e;l++){let p=l*o+o*a.nextFloatBetween(0,n),h=a.nextFloatBetween(i,1),d=c*h*Math.sin(p),m=u*h*Math.cos(p);s.addXY(r.x+d,r.y+m)}return s}function ri(a,t,e,n){return st.fromHsv(a.nextFloat(),t,e,n)}function qn(){return 16777215*Math.random()|0}function Le(a,t){let e=a.nextFloatBetween(t.x0,t.x1),n=a.nextFloatBetween(t.y0,t.y1);return new b(e,n)}var De=class a{context;constructor(t){this.context=t}get canvas(){return this.context.canvas}static fromCanvas(t){let e=t.getContext("2d");if(e!==null)return new a(e)}blitImage(t,e,n){let i=t.toImageData();i!==void 0&&this.context.putImageData(i,e,n)}clear(t="#FFFFFF"){let e=this.context;e.resetTransform(),e.save(),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}createLinePattern(t,e="#000000"){let n=document.createElement("canvas"),i=n.getContext("2d");if(i===null)return null;n.width=t,n.height=t,i.fillStyle=e;for(let s=0;s<t;s++)i.fillRect(s,s,1,1);return this.context.createPattern(n,"repeat")}drawBox(t,e="#000000",n=1){let i=this.context;i.save(),i.lineWidth=n,i.strokeStyle=e,i.strokeRect(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0),i.restore()}drawBoxes(t,e="#000000",n=1){let i=this.context;i.beginPath();for(let s of t)i.rect(s.x0,s.y0,s.x1-s.x0,s.y1-s.y0);i.save(),i.lineWidth=n,i.strokeStyle=e,i.stroke(),i.restore()}drawEdge(t,e="#000000",n=1){let i=this.context;i.beginPath(),i.moveTo(t.p0.x,t.p0.y),i.lineTo(t.p1.x,t.p1.y),i.save(),i.lineJoin="round",i.lineWidth=n,i.strokeStyle=e,i.stroke(),i.restore()}drawEdges(t,e="#000000",n=1){let i=this.context;i.beginPath();for(let s of t)i.moveTo(s.p0.x,s.p0.y),i.lineTo(s.p1.x,s.p1.y);i.save(),i.lineJoin="round",i.lineWidth=n,i.strokeStyle=e,i.stroke(),i.restore()}drawMeshEdges(t,e="#000000",n=1){let i=this.context;i.beginPath();for(let s of t.getEdges())i.moveTo(s.p0.x,s.p0.y),i.lineTo(s.p1.x,s.p1.y);i.save(),i.lineJoin="round",i.strokeStyle=e,i.lineWidth=n,i.stroke(),i.restore()}drawPath(t,e="#000000",n=1){let i=this.context;i.beginPath(),this.addPath(i,t),i.save(),i.lineJoin="round",i.lineCap="round",i.lineWidth=n,i.strokeStyle=e,i.stroke(),i.restore()}drawPolygon(t,e="#000000",n=1){let i=this.context;i.beginPath(),this.addPolygon(i,t),i.save(),i.lineJoin="round",i.lineWidth=n,i.strokeStyle=e,i.stroke(),i.restore()}fillBox(t,e="#000000"){let n=this.context;n.save(),n.fillStyle=e,n.fillRect(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0),n.restore()}fillBoxes(t,e="#000000"){let n=this.context;n.beginPath();for(let i of t)n.rect(i.x0,i.y0,i.x1-i.x0,i.y1-i.y0);n.save(),n.fillStyle=e,n.fill(),n.restore()}fillEdgePoints(t,e="#000000",n=1){let i=this.context;i.beginPath();for(let s of t)this.addCircle(i,s.p0,.5*n),this.addCircle(i,s.p1,.5*n);i.save(),i.fillStyle=e,i.fill(),i.restore()}fillMesh(t,e="#000000"){let n=this.context;n.beginPath();for(let i of t.getFaces())this.addMeshFaceToContext(n,i);n.save(),n.fillStyle=e,n.fill(),n.restore()}fillMeshRandom(t,e){let n=this.context;n.save();for(let i of t.getFaces())n.beginPath(),this.addMeshFaceToContext(n,i),n.fillStyle=ri(e,.25,1,1).style(),n.fill();n.restore()}fillPath(t,e="#000000",n){let i=this.context;i.beginPath(),this.addPath(i,t),i.save(),i.fillStyle=e,i.fill(n),i.restore()}fillPoints(t,e="#000000",n=1){let i=this.context;i.beginPath();for(let s of t)this.addCircle(i,s,.5*n);i.save(),i.fillStyle=e,i.fill(),i.restore()}fillPolygon(t,e="#000000"){let n=this.context;n.beginPath(),this.addPolygon(n,t),n.save(),n.lineJoin="round",n.fillStyle=e,n.fill(),n.restore()}fillText(t,e,n="#000000",i="16px Verdana"){let s=this.context;s.save(),s.font=i,s.fillStyle=n;let r=s.measureText(t),o=e.x-.5*(r.actualBoundingBoxRight+r.actualBoundingBoxLeft),c=e.y-.5*(r.actualBoundingBoxDescent-r.actualBoundingBoxAscent);s.fillText(t,o,c),s.restore()}getSize(t){let e=this.context.canvas;return t?[e.width,e.height]:[1400,700]}resize(t,e){if(t<0||e<0)return;let n=this.context.canvas;n.width=t,n.height=e}setTransform(t,e,n,i,s,r){this.context.setTransform(t,e,n,i,s,r)}addCircle(t,e,n){t.moveTo(e.x+n,e.y),t.arcTo(e.x+n,e.y+n,e.x,e.y+n,n),t.arcTo(e.x-n,e.y+n,e.x-n,e.y,n),t.arcTo(e.x-n,e.y-n,e.x,e.y-n,n),t.arcTo(e.x+n,e.y-n,e.x+n,e.y,n),t.closePath()}addMeshFaceToContext(t,e){let n=e.start.p0;t.moveTo(n.x,n.y);for(let i of e.getEdgeIterator())t.lineTo(i.p1.x,i.p1.y);t.closePath()}addPath(t,e){if(!e.isValid())return;let n=e.getCommands(),i=e.getPoints(),s=0,r=0,o=b.ZERO;for(;s<n.length;){let c=n[s++];switch(c.type){case 0:{o=i[r++],t.moveTo(o.x,o.y);break}case 1:{let u=i[r++];t.lineTo(u.x,u.y),o=u;break}case 2:{let u=i[r++],l=i[r++];t.quadraticCurveTo(u.x,u.y,l.x,l.y),o=l;break}case 3:{let u=i[r++],l=i[r++],p=i[r++];t.bezierCurveTo(u.x,u.y,l.x,l.y,p.x,p.y),o=p;break}case 4:{let u=i[r++],l=i[r++],p=c.w,h=4/3*(p/(p+1)),d=o.lerp(u,h),m=l.lerp(u,h);t.bezierCurveTo(d.x,d.y,m.x,m.y,l.x,l.y),o=l;break}case 5:{t.closePath();break}default:F(c)}}}addPolygon(t,e){let n=e.getPoints();if(n.length!==0){t.moveTo(n[0].x,n[0].y);for(let i=1;i<n.length;i++)t.lineTo(n[i].x,n[i].y);t.closePath()}}};var qe=class{element;events;id;isBound;style;constructor(t,e){t.id=e,this.element=t,this.id=e,this.events=[],this.isBound=!1}addEventListener(t,e){this.isBound?wn("Cannot add event listener on bound input element"):this.events.push({type:t,listener:e})}focus(){this.element.focus()}getElement(){return this.element}getId(){return this.id}register(t){if(this.isBound)wn("Already bound");else{this.isBound=!0;for(let e of this.events)this.element.addEventListener(e.type,e.listener);this.style!==void 0&&this.element.setAttribute("style",this.style),t.appendChild(this.element),t.append(`
`)}}setStyle(t){this.style=t}unregister(){for(let e of this.events)this.element.removeEventListener(e.type,e.listener);let t=this.element.parentElement;t!==null&&t.removeChild(this.element),this.isBound=!1}},At=class extends qe{defaultValue;valueInputElement;constructor(t,e,n){super(t,e),t.value=n,this.valueInputElement=t,this.defaultValue=n}getDefaultValue(){return this.defaultValue}getFloat(){return Number.parseFloat(this.getValue())}getInt(){return Number.parseInt(this.getValue())}getValue(){return this.valueInputElement.value}setDefaultValue(t){this.defaultValue=t}setValue(t){this.valueInputElement.value=t}},ne=class extends qe{constructor(t,e){let n=document.createElement("button");n.textContent=e,super(n,t)}},H=class extends At{constructor(t,e=""){let n=document.createElement("input");n.type="text",super(n,t,e)}},O=class extends At{constructor(t,e,n,i="0"){let s=document.createElement("input");s.type="range",s.className="slider",s.min=e,s.max=n,super(s,t,i)}},N=class extends At{selectElement;constructor(t,e=""){let n=document.createElement("select");super(n,t,e),this.selectElement=n}setOptionValues(...t){for(let e of t){let n=document.createElement("option");n.text=e,this.selectElement.appendChild(n)}this.selectElement.value=this.getDefaultValue()}};var ie=class a{animationFrameContext;currentEntry;inputs;options;parts;time;inputAppPart;inputGenerator;inputRandomize;inputSeed;inputUpdate;constructor(t){this.options=t,this.animationFrameContext=new oe(window,this,a.animationFrameCallback),this.inputs=new Map,this.parts=new Map,this.time=0,this.inputAppPart=new N("app"),this.inputAppPart.addEventListener("input",()=>this.onAppInput()),this.inputRandomize=new ne("randomize","randomize"),this.inputRandomize.addEventListener("click",()=>this.onRandomizeClick()),this.inputSeed=new H("seed",qn().toString()),this.inputSeed.setStyle("width: 80px"),this.inputGenerator=new H("generator","0"),this.inputGenerator.setStyle("width: 25px"),this.inputUpdate=new ne("update","update"),this.inputUpdate.addEventListener("click",()=>this.onUpdateClick())}static async createContext(){let t=a.createElement("div",{id:"params",style:"height: 30px"}),e=a.createElement("div",{id:"canvasContainer"}),n=a.createElement("canvas",{id:"canvas2D",style:"border: 1px solid black"});document.body.appendChild(t),document.body.appendChild(e);let i=De.fromCanvas(n);return{canvasContainerElement:e,canvas2DContext:i,canvas2DElement:n}}addAppInput(t){let e=t.getId(),n=this.inputs.get(e);n!==void 0&&n.unregister(),this.inputs.set(e,t)}addCanvas2D(t,e,n){if(this.options.canvas2DContext===void 0)return;let i=this.parts.get(t);i!==void 0&&i.part.reset(),this.parts.set(t,{animationMode:e,part:new n(this,this.options.canvas2DContext),contextId:0})}init(t){this.inputAppPart.setDefaultValue(t),window.addEventListener("resize",()=>this.onResize(),!1),this.inputAppPart.setOptionValues(...this.parts.keys());let e=new URLSearchParams(window.location.search),n=e.get("app")??this.inputAppPart.getValue();this.currentEntry=this.parts.get(n),this.updateLayout();for(let[i,s]of e.entries()){let r=this.inputs.get(i);r instanceof At&&r.setValue(s)}this.resizeContext(),this.run(!0,!0)}requestUpdate(t=!1){t&&this.writeParams(),this.currentEntry!==void 0&&this.currentEntry.animationMode===0&&this.animationFrameContext.stepAnimation()}static animationFrameCallback(t,e){let n=e.time,i=t-n;e.currentEntry!==void 0&&(e.time=t,e.currentEntry.part.update(i),e.currentEntry.part.render())}static createElement(t,e){let n=document.createElement(t);for(let i in e)n.setAttribute(i,e[i]);return n}onAppInput(){let t=this.inputAppPart.getValue(),e=this.parts.get(t);e!==void 0&&e!==this.currentEntry&&(this.currentEntry?.part.reset(),this.currentEntry=e,this.updateLayout()),this.run(!0,!0),this.inputAppPart.focus()}onRandomizeClick(){this.inputSeed.setValue(qn().toString()),this.run(!0,!0)}onResize(){this.resizeContext(),this.run(!1,!1)}onUpdateClick(){this.run(!0,!0)}resizeContext(){let t=window.innerWidth-20,e=window.innerHeight-50;this.options.canvas2DContext?.resize(t,e)}run(t,e){e&&this.writeParams();let n=this.currentEntry;if(n===void 0)return;let i=this.options.canvasContainerElement;if(this.animationFrameContext.stopAnimation(),t)for(let s of i.childNodes)i.removeChild(s);switch(n.contextId){case 0:{i.appendChild(this.options.canvas2DElement);break}default:F(n.contextId)}switch(t&&n.part.create(),n.animationMode){case 1:{this.animationFrameContext.startAnimation();break}case 0:{this.animationFrameContext.stepAnimation();break}default:F(n.animationMode)}}updateLayout(){for(let e of this.inputs.values())e.unregister();this.inputs.clear(),this.addAppInput(this.inputAppPart),this.addAppInput(this.inputRandomize),this.addAppInput(this.inputSeed),this.addAppInput(this.inputGenerator),this.addAppInput(this.inputUpdate),this.currentEntry?.part.updateLayout();let t=document.getElementById("params");if(t!==null)for(let e of this.inputs.values())e.register(t)}writeParams(){let t=new URLSearchParams;for(let e of this.inputs.values())e instanceof At&&t.set(e.getId(),e.getValue());window.history.pushState(null,"",`?${t}`)}};var oi=2**-32,wi=2**-53,V=class a{state;constructor(t){Yn(t.length===4,"Array length of 'state' must be equal to 4"),this.state=t}static fromSeedLcg(t){let e=Ci(t,4);return new a(e)}nextFloat(){let t=ci(this.state),e=Ei(this.state);return ai(this.state),oi*(t>>>0)+wi*(e>>>11)}nextFloatBetween(t,e){let n=this.nextFloat();return Xn(t,e,n)}nextInt(){let t=ci(this.state);return ai(this.state),t|0}nextIntBetween(t,e){let n=this.nextInt(),i=oi*(n>>>0);return Un(t,e,i)}};function Ci(a,t){let e=a??4294967296*Math.random(),n=new Int32Array(t),i=e|0;for(let s=0;s<t;s++)i=Math.imul(1549681957,i)|0,i=i+387420489|0,n[s]=i;return n}function ai(a){let t=a[1]<<9;a[2]^=a[0],a[3]^=a[1],a[1]^=a[2],a[0]^=a[3],a[2]^=t,a[3]=a[3]<<11|a[3]>>>21}function Ei(a){return a[0]+a[3]}function ci(a){let t=a[1]*5;return t=t<<7|t>>>25,t*9}var Qe=class{bPlusTree;context;launcher;inputBranchSize;inputCount;inputLeafSize;constructor(t,e){this.launcher=t,this.context=e,this.inputBranchSize=new H("branchsize","4"),this.inputBranchSize.setStyle("width: 40px"),this.inputLeafSize=new H("leafsize","16"),this.inputLeafSize.setStyle("width: 40px"),this.inputCount=new O("count","0","128","32"),this.inputCount.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputCount.setStyle("width: 200px");let n=(i,s)=>Math.floor(i)-Math.floor(s);this.bPlusTree=new Ne(n)}create(){}render(){this.context.clear(),this.drawBPlusTree(this.context,this.bPlusTree)}reset(){}update(t){let e=this.launcher.inputSeed.getInt(),n=this.inputBranchSize.getInt(),i=this.inputLeafSize.getInt(),s=this.inputCount.getInt(),r=V.fromSeedLcg(e),o=(u,l)=>Math.floor(u)-Math.floor(l),c=new Ne(o,n,i);for(let u=1;u<=s;u++){let l=r.nextIntBetween(0,10)+.003*u;c.add(l)}v.assertFn(()=>c.validate(o),"Validation failed"),this.bPlusTree=c}updateLayout(){this.launcher.addAppInput(this.inputBranchSize),this.launcher.addAppInput(this.inputLeafSize),this.launcher.addAppInput(this.inputCount)}drawBPlusTree(t,e){o(e.getRootNode(),0,0);function o(u,l,p){let h=p;if(u.type===0){c(u.keys,l,h,"#FF8888");for(let d of u.children)h=o(d,l+1,h+1)}else c(u.values,l,h,"#8888FF");return h}function c(u,l,p,h){let d=l;for(let m of u){let f=20+d*75,y=20+p*36,x=R.fromXYWH(f,y,65,26);t.fillBox(x,h),t.fillText(m.toFixed(3),x.getCenter(),"#FFFFFF"),d++}}}},Ne=class{branchSize;compareFn;leafSize;root;constructor(t,e,n){this.root=this.leafNodeCreate(void 0,0,[],void 0),this.compareFn=t,this.branchSize=e??16,this.leafSize=n??this.branchSize}add(t){let e=this.findLeafNode(this.root,t);e.length<this.leafSize?this.leafNodeAdd(e,t):this.leafNodeSplitAdd(e,t)}clear(){this.root=this.leafNodeCreate(void 0,0,[],void 0)}*getGenerator(){let t=this.getFirstLeaf();for(;;){for(let e=0;e<t.length;e++)yield t.values[e];if(t.next!==void 0)t=t.next;else return}}getRootNode(){return this.root}toArray(){let t=[];for(let e of this.getGenerator())t.push(e);return t}validate(t){let n=this.getGenerator().next();if(n.done===!0)return!0;let i=n.value;for(let r of this.getGenerator()){if(t(i,r)>0)return!1;i=r}return s(this.root,this.branchSize,this.leafSize);function s(r,o,c){let u=!0;if(r.type===0){u&&=r.length<=o;for(let l of r.children)u&&=s(l,o,c)}else u&&=r.length<=c;return u}}findLeafNode(t,e){if(t.type===0){let n=this.findNearestIndexEnd(t.keys,e);return this.findLeafNode(t.children[n],e)}else return t}findNearestIndexEnd(t,e,n=0){let i=this.compareFn,s=n,r=t.length;for(;s<r;){let o=s+r>>>1;i(e,t[o])<0?r=o:s=o+1}return s}getFirstLeaf(){let t=this.root;for(;t.type!==1;)t=t.children[0];return t}internalNodeAdd(t,e,n,i){let s=this.findNearestIndexEnd(t.keys,n);e.parent=t,t.keys.splice(s,0,i),t.children.splice(s+1,0,e),t.length+=1}internalNodeCreate(t,e,n,i){return{type:0,parent:t,length:e,keys:n,children:i}}internalNodeSplitAdd(t,e,n){let i=this.findNearestIndexEnd(t.keys,n);t.keys.splice(i,0,n);let s=t.length+2>>>1,r=i<s-1,o=r?s-1:s,[c]=t.keys.splice(s-1,1),u=t.length-o,l=t.keys.splice(s-1,u),p=t.children.splice(o,u),h=this.internalNodeCreate(t.parent,u,l,p);for(let d of p)d.parent=h;t.length=o,r?(e.parent=t,t.children.splice(i+1,0,e),t.length+=1):(e.parent=h,h.children.splice(i+1-o,0,e),h.length+=1),this.nodeAddToParent(t,h,n,c)}leafNodeAdd(t,e){let n=this.findNearestIndexEnd(t.values,e);t.values.splice(n,0,e),t.length+=1}leafNodeCreate(t,e,n,i){return{type:1,parent:t,length:e,values:n,next:i}}leafNodeSplitAdd(t,e){let n=t.length>>>1,i=this.compareFn(e,t.values[n])<0,s=i?n:n+1,r=t.length-s,o=t.values.splice(s,r),c=this.leafNodeCreate(t.parent,r,o,t.next);t.length=s,t.next=c,this.leafNodeAdd(i?t:c,e),this.nodeAddToParent(t,c,t.values[0],c.values[0])}nodeAddToParent(t,e,n,i){let s=t.parent;s!==void 0?s.length<this.branchSize?this.internalNodeAdd(s,e,n,i):this.internalNodeSplitAdd(s,e,i):this.nodeAddToRoot(t,e,i)}nodeAddToRoot(t,e,n){let i=this.internalNodeCreate(void 0,2,[n],[t,e]);t.parent=i,e.parent=i,this.root=i}};var ui={color:new st(0,0,0,255),compOp:1,rule:0},pi={caps:Gt,color:new st(0,0,0,255),compOp:1,dashArray:[],dashCaps:Gt,dashOffset:0,join:1,miterLimit:4,transformOrder:1,width:1};var Ye=class{buffer;sa;sb;sg;sr;mask;operator;constructor(){this.mask=new Uint8Array,this.operator=this.sourceOverSolid,this.sb=0,this.sg=0,this.sr=0,this.sa=0,this.buffer=new Uint8Array}fill(){let t=this.buffer,e=0;for(;e<t.length;)t[e++]=this.sr,t[e++]=this.sg,t[e++]=this.sb,t[e++]=this.sa}initialize(t){this.buffer=t.getBuffer8(),this.mask=new Uint8Array(t.getWidth())}setColor(t){this.sr=Xt(t.r,t.a),this.sg=Xt(t.g,t.a),this.sb=Xt(t.b,t.a),this.sa=t.a}setOperation(t){switch(t){case 0:{this.operator=this.sourceSolid;break}default:{this.operator=this.sourceOverSolid;break}}}sourceOverSolid(t,e,n){let i=this.buffer,s=e,r=4*(t+s);for(;s<n;){let o=this.mask[s],c=Xt(this.sa,o);i[r]=Mt(this.sr,o,i[r++],c),i[r]=Mt(this.sg,o,i[r++],c),i[r]=Mt(this.sb,o,i[r++],c),i[r]=Mt(this.sa,o,i[r++],c),this.mask[s++]=0}}sourceSolid(t,e,n){let i=this.buffer,s=e,r=4*(t+s);for(;s<n;){let o=this.mask[s];i[r]=Mt(this.sr,o,i[r++],o),i[r]=Mt(this.sg,o,i[r++],o),i[r]=Mt(this.sb,o,i[r++],o),i[r]=Mt(this.sa,o,i[r++],o),this.mask[s++]=0}}};function Mt(a,t,e,n){return Xt(a,t)+Xt(e,Si(n))}function Xt(a,t){let e=a*t+128;return e+(e>>>8)>>>8}function Si(a){return 255-a}var se=8,Xe=class{sign;x0;x1;y0;y1;constructor(t,e,n,i,s){this.x0=t,this.y0=e,this.x1=n,this.y1=i,this.sign=s}},Ue=class{activeEdges;compositor;edges;height;mask;width;constructor(t){this.height=0,this.width=0,this.compositor=t,this.mask=t.mask,this.edges=[],this.activeEdges=[]}addLine(t,e,n,i){T(t>=0,"Coordinate must not be NaN"),T(e>=0,"Coordinate must not be NaN"),T(n<=this.width,"Coordinate must not be NaN"),T(i<=this.height,"Coordinate must not be NaN");let s=e*256>>>0,r=i*256>>>0;if(s===r)return;let o=t*256>>>0,c=n*256>>>0;s<r?this.edges.push(new Xe(o,s,c,r,1)):this.edges.push(new Xe(c,r,o,s,-1))}initialize(t,e){this.width=t,this.height=e,this.mask=this.compositor.mask}render(t){let e=t===0?4294967295:1;this.quicksort(0,this.edges.length-1);let n=this.edges[0],i=1,s=n.y0>>>se;for(;s<this.height;){let r=s<<se;for(;i<=this.edges.length&&n.y0<=r;){let o=n.x1-n.x0,c=n.y1-n.y0,u=1;o<0&&(o=-o,u=-1),this.activeEdges.push({x0:n.x0>>>se,y1:n.y1,m0:o<<se,d0:c<<se,d:(r-n.y0)*o,inc:u,sign:n.sign}),n=this.edges[i++]}for(let o=0;o<this.activeEdges.length;o++)this.activeEdges[o].y1<=r&&(this.activeEdges.splice(o,1),o--);for(let o=0;o<this.activeEdges.length;o++){let c=this.activeEdges[o];for(;c.d>=c.d0;)c.d-=c.d0,c.x0+=c.inc;c.d+=c.m0}if(this.activeEdges.length>0){for(let c=1;c<this.activeEdges.length;c++){let u=this.activeEdges[c],l=c;for(;l>0&&this.activeEdges[l-1].x0>u.x0;)this.activeEdges[l]=this.activeEdges[l-1],l--;this.activeEdges[l]=u}let o=0;for(let c=1;c<this.activeEdges.length;c++){let u=this.activeEdges[c-1],l=this.activeEdges[c-0];if(o+=u.sign,o&e)for(let p=u.x0;p<l.x0;p++)this.mask[p]=255}this.compositor.operator(this.width*s,this.activeEdges[0].x0,this.activeEdges[this.activeEdges.length-1].x0)}s++}this.edges=[],this.activeEdges=[]}setCompositor(t){this.compositor=t,this.mask=t.mask}quicksort(t,e){let n=this.edges,i=n[t+e>>>1],s=t,r=e;for(;s<=r;){for(;n[s].y0<i.y0;)s++;for(;n[r].y0>i.y0;)r--;if(s<=r){let o=n[s];n[s]=n[r],n[r]=o,s++,r--}}t<r&&this.quicksort(t,r),s<e&&this.quicksort(s,e)}};var je=class{bottom;left;right;top;constructor(t,e,n,i){this.left=t,this.top=e,this.right=n,this.bottom=i}},$e=class{clipRect;compositor;pathFlatten;pathStroke;rasterizer;constructor(){this.compositor=new Ye,this.rasterizer=new Ue(this.compositor),this.clipRect=new je(0,0,0,0),this.pathFlatten=Oe(Y),this.pathStroke=Fe(Y)}addFill(t,e){let n=this.rentPath();n.copyFrom(t),n.transform(e),this.flatten(n),this.returnPath(n)}addStroke(t,e,n){let i=this.rentPath();if(n.transformOrder===0){let s=this.rentPath();s.copyFrom(t),s.transform(e),this.pathStroke.process(s,i,n),this.returnPath(s)}else this.pathStroke.process(t,i,n),i.transform(e);this.flatten(i),this.returnPath(i)}begin(t){let e=t.getWidth(),n=t.getWidth();this.clipRect=new je(0,n,e,0),this.compositor.initialize(t),this.rasterizer.initialize(e,n)}clear(t){this.compositor.setColor(t.color),this.compositor.fill()}end(){}renderFill(t){this.compositor.setColor(t.color),this.compositor.setOperation(t.compOp),this.rasterizer.render(t.rule)}renderStroke(t){this.compositor.setColor(t.color),this.compositor.setOperation(t.compOp),this.rasterizer.render(0)}rentPath(){return new w}returnPath(t){}clipPolyline(t,e){let n=this.rasterizer,i=t[0],s=L(i.y,e.bottom,e.top),r=s,o=s,c=t.length;for(let u=1;u<c;u++){let l=i;i=t[u];let p=l,h=i;if(p.x<e.left){if(h.x<e.left)continue;p=Ze(l,i,e.left),s=L(p.y,e.bottom,e.top),n.addLine(e.left,r,e.left,s)}else h.x<e.left&&(h=Ze(l,i,e.left),r=L(h.y,e.bottom,e.top));if(p.x>e.right){if(h.x>e.right)continue;p=Ze(l,i,e.right),s=L(p.y,e.bottom,e.top),n.addLine(e.right,o,e.right,s)}else h.x>e.right&&(h=Ze(l,i,e.right),o=L(h.y,e.bottom,e.top));if(p.y<e.bottom){if(h.y<e.bottom)continue;p=We(l,i,e.bottom)}else h.y<e.bottom&&(h=We(l,i,e.bottom));if(p.y>e.top){if(h.y>e.top)continue;p=We(l,i,e.top)}else h.y>e.top&&(h=We(l,i,e.top));n.addLine(p.x,p.y,h.x,h.y)}i.x>e.right?(s=L(i.y,e.bottom,e.top),n.addLine(e.right,o,e.right,s)):i.x<e.left&&(s=L(i.y,e.bottom,e.top),n.addLine(e.left,r,e.left,s))}flatten(t){let e=new w;this.pathFlatten.process(t,e,!0),this.clipPolyline(e.getPoints(),this.clipRect)}};function We(a,t,e){return new b(a.x+(t.x-a.x)*(e-a.y)/(t.y-a.y),e)}function Ze(a,t,e){return new b(e,a.y+(t.y-a.y)*(e-a.x)/(t.x-a.x))}var Ke=class{fillOptions;pipeline;strokeOptions;transform;constructor(){this.fillOptions={...ui},this.strokeOptions={...pi},this.pipeline=new $e,this.transform=zt.createIdentity()}get caps(){return this.strokeOptions.caps}set caps(t){this.strokeOptions.caps=t}get dashArray(){return this.strokeOptions.dashArray}set dashArray(t){this.strokeOptions.dashArray=t}get dashCaps(){return this.strokeOptions.dashCaps}set dashCaps(t){this.strokeOptions.dashCaps=t}get dashOffset(){return this.strokeOptions.dashOffset}set dashOffset(t){this.strokeOptions.dashOffset=t}get fillColor(){return this.fillOptions.color}set fillColor(t){this.fillOptions.color=t}get fillCompOp(){return this.fillOptions.compOp}set fillCompOp(t){this.fillOptions.compOp=t}get fillRule(){return this.fillOptions.rule}set fillRule(t){this.fillOptions.rule=t}get join(){return this.strokeOptions.join}set join(t){this.strokeOptions.join=t}get miterLimit(){return this.strokeOptions.miterLimit}set miterLimit(t){this.strokeOptions.miterLimit=t}get strokeColor(){return this.strokeOptions.color}set strokeColor(t){this.strokeOptions.color=t}get strokeCompOp(){return this.strokeOptions.compOp}set strokeCompOp(t){this.strokeOptions.compOp=t}get strokeWidth(){return this.strokeOptions.width}set strokeWidth(t){this.strokeOptions.width=t}get transformOrder(){return this.strokeOptions.transformOrder}set transformOrder(t){this.strokeOptions.transformOrder=t}begin(t){this.pipeline.begin(t)}clear(){this.pipeline.clear(this.fillOptions)}end(){this.pipeline.end()}fillCircle(t,e,n){let i=this.rentPath();i.addCircleXY(t,e,n),this.fillPath(i),this.returnPath(i)}fillEllipse(t,e,n,i){let s=this.rentPath();s.addEllipseXY(t,e,n,i),this.fillPath(s),this.returnPath(s)}fillPath(t){this.pipeline.addFill(t,this.transform),this.pipeline.renderFill(this.fillOptions)}fillRect(t,e,n,i){let s=this.rentPath();s.addRectXY(t,e,n,i),this.fillPath(s),this.returnPath(s)}rentPath(){return this.pipeline.rentPath()}returnPath(t){this.pipeline.returnPath(t)}strokeCircle(t,e,n){let i=this.rentPath();i.addCircleXY(t,e,n),this.strokePath(i),this.returnPath(i)}strokeEllipse(t,e,n,i){let s=this.rentPath();s.addEllipseXY(t,e,n,i),this.strokePath(s),this.returnPath(s)}strokeLine(t,e,n,i){let s=this.rentPath();s.addLineXY(t,e,n,i),this.strokePath(s),this.returnPath(s)}strokePath(t){this.pipeline.addStroke(t,this.transform,this.strokeOptions),this.pipeline.renderStroke(this.strokeOptions)}strokeRect(t,e,n,i){let s=this.rentPath();s.addRectXY(t,e,n,i),this.strokePath(s),this.returnPath(s)}};var rt=class a{buffer;height;width;constructor(t,e,n){this.width=t,this.height=e,this.buffer=n??new ArrayBuffer(4*t*e)}fill(t){new Int32Array(this.buffer).fill(t)}getBuffer8(){let t=4*this.width*this.height;return new Uint8Array(this.buffer,0,t)}getHeight(){return this.height}getWidth(){return this.width}magnify(t){let e=new a(this.width*t,this.height*t),n=this.width*this.height,i=n*t*t,s=new Int32Array(this.buffer,0,n),r=new Int32Array(e.buffer,0,i),o=0;for(let c=0;c<this.height;c++)for(let u=0;u<t;u++){let l=c*this.width;for(let p=0;p<this.width;p++){let h=s[l++];for(let d=0;d<t;d++)r[o++]=h}}return e}resize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.buffer=new ArrayBuffer(4*t*e))}toImageData(){if(this.width!==0&&this.height!==0){let t=4*this.width*this.height,e=new Uint8ClampedArray(this.buffer,0,t);return new ImageData(e,this.width,this.height)}else return}};var He=class{context;image;launcher;inputColor;inputCount;inputSize;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputSize=new O("size","1","1024","200"),this.inputSize.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputSize.setStyle("width: 200px"),this.inputColor=new O("color","0","255","128"),this.inputColor.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputColor.setStyle("width: 200px"),this.image=new rt(0,0)}create(){}render(){this.context.clear(),this.context.blitImage(this.image,0,0)}reset(){this.image=new rt(0,0)}update(t){let e=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),i=this.inputCount.getInt(),s=this.inputSize.getInt(),r=this.inputColor.getInt(),o=V.fromSeedLcg(e),c=Yt(o,n,i,s,s);c.close(),this.image.resize(s,s);let u=new Ke;u.begin(this.image),u.fillRule=1,u.fillColor=new st(224,224,224,255),u.clear(),u.fillColor=new st(r,0,0,255),u.fillPath(c)}updateLayout(){this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputSize),this.launcher.addAppInput(this.inputColor)}};var Je=class a{map;constructor(){this.map=new Map}collectData(t){let e={tag:[],refs:[]},n={tag:[],refs:[]};for(let[i,s]of this.map.entries()){let r=s.w0+s.w1,o=s.w1,[c,u]=ee(r,o,t);c&&(e.tag.push(i),e.refs.push(...s.refs)),u&&(n.tag.push(i),n.refs.push(...s.refs))}return e.tag.sort(a.compareTag),n.tag.sort(a.compareTag),[e,n]}getEntry(t){let e=this.map.get(t);if(e!==void 0)return e;{let n={w0:0,w1:0,refs:[]};return this.map.set(t,n),n}}reset(){this.map.clear()}static compareTag(t,e){return t-e}};var Ge=class a{flattenTolerance;snapRound;status;windingOperator;constructor(t){this.status=new xt(ct.compareStatus),this.snapRound=new St,this.snapRound.precision=t.clipPrecision,this.flattenTolerance=t.flattenTolerance,this.windingOperator=at.windingOperatorA}addCurve(t,e=0,n=1,i=!1,s){this.snapRound.addSegment(t,e,n,i,s)}addEdge(t,e=0,n=1,i=!1,s){this.snapRound.addSegment(t.toBezier(),e,n,i,s)}addPath(t,e=0,n=1,i=!1){let s=t.flatten(!1,{flattenMode:1,flattenTolerance:this.flattenTolerance});for(let r of s.getCurveIterator())this.snapRound.addSegment(r,e,n,i,void 0)}process(t,e){this.windingOperator=e,this.status.clear();let n=Be(this.snapRound),i=new Je;for(let s of n)if(s.left)this.status.insert(s);else{let r=this.status.findIndexBy(l=>l.seg===s.seg);if(r<0){v.error("PathOverlay2: Status event segment {} not found",s.seg);continue}let o=this.status.getAt(r);this.setState(o,i);let[c,u]=i.collectData(this.windingOperator);if(i.reset(),!kt(c.tag,u.tag)){let l=new S(o.p1,o.p0),p=new S(o.p0,o.p1);this.addSegmentPair(t,l,p,c,u)}this.status.removeAt(r)}this.snapRound.clear()}setQualityOptions(t){this.snapRound.precision=t.clipPrecision}static isOpen(t,e){return t.p0.eq(e.p0)&&t!==e}addSegmentPair(t,e,n,i,s){let r=t.createEdge(e,n),o=r.sym;r.data=i,o.data=s;let c=t.getChains();for(let p of c)if(a.isOpen(p.head.sym,r)){this.connectSegmentPair(t,p.head.sym,r,o,i,s);break}else if(a.isOpen(r,p.tail)){this.connectSegmentPair(t,p.tail,r,o,i,s);break}for(let p of c)if(a.isOpen(p.head.sym,o)){this.connectSegmentPair(t,p.head.sym,o,r,s,i);break}else if(a.isOpen(o,p.tail)){this.connectSegmentPair(t,p.tail,o,r,s,i);break}let u=r.chain,l=o.chain;if(u===void 0){let p=t.createChain(r,r);p.data=i.tag,it.updateEdgeChains(p,p)}else u.isClosed()&&t.finalizeChain(u);if(l===void 0){let p=t.createChain(o,o);p.data=s.tag,it.updateEdgeChains(p,p)}else l.isClosed()&&t.finalizeChain(l)}connectSegmentPair(t,e,n,i,s,r){let o=P.findConnectingEdge(n,e.vector()),c=P.findConnectingEdge(e,n.vector());P.splice(o,c);let u=n.lprev.chain,l=i.lnext.chain;if(u===void 0||l===void 0){v.error("PathOverlay: No chain");return}if(u===l){v.error("PathOverlay: Chain would need splitting");return}let p=u.data,h=l.data;if(kt(p,s.tag)){if(n.chain===void 0)n.chain=u,u.head=n;else if(n.chain!==u){it.updateEdgeChains(u,n.chain),n.chain.tail=u.tail;let d=t.destroyChain(u);T(d,"Unable to destroy chain")}}if(kt(h,r.tag)){if(i.chain===void 0)i.chain=l,l.tail=i;else if(i.chain!==l){it.updateEdgeChains(l,i.chain),i.chain.head=l.head;let d=t.destroyChain(l);T(d,"Unable to destroy chain")}}}setState(t,e){if(t.wind===0)return;let n=!1;for(let i=this.status.size()-1;i>=0;i--){let s=this.status.getAt(i),r=s.seg.ref,o=e.getEntry(r.set);if(s.eq(t))o.w0-=s.wind,o.refs.push(r),s.wind=0,n=!0;else if(!n)o.w1-=s.wind;else break}}};var hi=class a{a;b;static IDENTITY=new a(1,0);constructor(t,e){this.a=t,this.b=e}static fromArray(t,e=0){return new a(t[e],t[e+1])}static fromRotationAngle(t){let e=Math.sin(t),n=Math.cos(t);return new a(n,e)}add(t){return new a(this.a+t.a,this.b+t.b)}conjugate(){return new a(this.a,-this.b)}cross(t){return new a(0,this.a*t.b-this.b*t.a)}dot(t){return this.a*t.a+this.b*t.b}eq(t){return this.a===t.a&&this.b===t.b}inverse(){return this.unit().conjugate()}len(){return Math.sqrt(this.lenSq())}lenSq(){return this.a*this.a+this.b*this.b}mapPoint(t){return new b(this.a*t.x-this.b*t.y,this.a*t.y+this.b*t.x)}mapVector(t){return new C(this.a*t.x-this.b*t.y,this.a*t.y+this.b*t.x)}mul(t){return new a(this.a*t.a-this.b*t.b,this.a*t.b+this.b*t.a)}rotate(t){let e=Math.sin(t),n=Math.cos(t);return new a(this.a*n-this.b*e,this.b*n+this.a*e)}sub(t){return new a(this.a-t.a,this.b-t.b)}toArray(){return[this.a,this.b]}toString(){return`{a: ${this.a}, b: ${this.b}}`}unit(){let t=this.len();return new a(this.a/t,this.b/t)}};var di=new ArrayBuffer(8),nc=new Float64Array(di),ic=new Int32Array(di);var _e=class a{a;b;c;d;static IDENTITY=new a(1,0,0,0);constructor(t,e,n,i){this.a=t,this.b=e,this.c=n,this.d=i}static fromArray(t,e=0){return new a(t[e],t[e+1],t[e+2],t[e+3])}static fromRotationAngleX(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(n,e,0,0)}static fromRotationAngleY(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(n,0,e,0)}static fromRotationAngleZ(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(n,0,0,e)}static fromRotationAxis(t,e){let n=Math.sin(.5*e),i=Math.cos(.5*e);return new a(i*t.len(),n*t.x,n*t.y,n*t.z)}static fromRotationEuler(t,e,n,i){let s=Math.sin(.5*t),r=Math.cos(.5*t),o=Math.sin(.5*e),c=Math.cos(.5*e),u=Math.sin(.5*n),l=Math.cos(.5*n),p=r*c*l,h=s*o*u,d=s*c*l,m=r*o*u,f=r*o*l,y=s*c*u,x=r*c*u,M=s*o*l;switch(i){case 0:return new a(p-h,d+m,f-y,x+M);case 1:return new a(p+h,d-m,f-y,x+M);case 2:return new a(p+h,d+m,f-y,x-M);case 3:return new a(p-h,d+m,f+y,x-M);case 4:return new a(p-h,d-m,f+y,x+M);case 5:return new a(p+h,d-m,f+y,x-M);default:F(i)}}add(t){return new a(this.a+t.a,this.b+t.b,this.c+t.c,this.d+t.d)}axis(){return new pt(this.b,this.c,this.d)}conjugate(){return new a(this.a,-this.b,-this.c,-this.d)}cross(t){let e=this.c*t.d-this.d*t.c,n=this.d*t.b-this.b*t.d,i=this.b*t.c-this.c*t.b;return new a(0,e,n,i)}dot(t){return this.a*t.a+this.b*t.b+this.c*t.c+this.d*t.d}eq(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d}inverse(){return this.unit().conjugate()}len(){return Math.sqrt(this.lenSq())}lenSq(){return this.a*this.a+this.b*this.b+this.c*this.c+this.d*this.d}mapPoint(t){let e=this.b*t.x+this.c*t.y+this.d*t.z,n=this.a*t.x+this.c*t.z-this.d*t.y,i=this.a*t.y-this.b*t.z+this.d*t.x,s=this.a*t.z+this.b*t.y-this.c*t.x;return new z(e*this.b+n*this.a-i*this.d+s*this.c,e*this.c+n*this.d+i*this.a-s*this.b,e*this.d-n*this.c+i*this.b+s*this.a)}mapVector(t){let e=this.b*t.x+this.c*t.y+this.d*t.z,n=this.a*t.x+this.c*t.z-this.d*t.y,i=this.a*t.y-this.b*t.z+this.d*t.x,s=this.a*t.z+this.b*t.y-this.c*t.x;return new pt(e*this.b+n*this.a-i*this.d+s*this.c,e*this.c+n*this.d+i*this.a-s*this.b,e*this.d-n*this.c+i*this.b+s*this.a)}mul(t){return new a(this.a*t.a-this.b*t.b-this.c*t.c-this.d*t.d,this.a*t.b+this.b*t.a+this.c*t.d-this.d*t.c,this.a*t.c-this.b*t.d+this.c*t.a+this.d*t.b,this.a*t.d+this.b*t.c-this.c*t.b+this.d*t.a)}mulPre(t){return new a(t.a*this.a-t.b*this.b-t.c*this.c-t.d*this.d,t.a*this.b+t.b*this.a+t.c*this.d-t.d*this.c,t.a*this.c-t.b*this.d+t.c*this.a+t.d*this.b,t.a*this.d+t.b*this.c-t.c*this.b+t.d*this.a)}rotateX(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(this.a*n-this.b*e,this.b*n+this.a*e,this.c*n+this.d*e,this.d*n-this.c*e)}rotateXPre(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(n*this.a-e*this.b,n*this.b+e*this.a,n*this.c-e*this.d,n*this.d+e*this.c)}rotateY(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(this.a*n-this.c*e,this.b*n-this.d*e,this.c*n+this.a*e,this.d*n+this.b*e)}rotateYPre(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(n*this.a-e*this.c,n*this.b+e*this.d,n*this.c+e*this.a,n*this.d-e*this.b)}rotateZ(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(this.a*n-this.d*e,this.b*n+this.c*e,this.c*n-this.b*e,this.d*n+this.a*e)}rotateZPre(t){let e=Math.sin(.5*t),n=Math.cos(.5*t);return new a(n*this.a-e*this.d,n*this.b-e*this.c,n*this.c+e*this.b,n*this.d+e*this.a)}sub(t){return new a(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}toArray(){return[this.a,this.b,this.c,this.d]}toString(){return`{a: ${this.a}, b: ${this.b}, c: ${this.c}, d: ${this.d}}`}unit(){let t=this.len();return new a(this.a/t,this.b/t,this.c/t,this.d/t)}};var tn=class{context;edges;launcher;inputCount;inputProjection;inputRotation;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputRotation=new O("rotation","0","360","0"),this.inputRotation.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputRotation.setStyle("width: 200px"),this.inputProjection=new N("projection","orthographic"),this.inputProjection.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputProjection.setOptionValues("orthographic","perspective"),this.edges=[]}create(){}render(){this.context.clear(),this.context.drawEdges(this.edges,"#000000")}reset(){this.edges=[]}update(t){this.reset();let e=this.inputRotation.getInt(),[n,i]=this.context.getSize(!0),s=this.createCube(),r=.5*n,o=.5*i,c=.2*Math.min(n,i),u=e*Math.PI/180,l;this.inputProjection.getValue()==="orthographic"?l=_t.fromOrthographic(-1,1,1,-1,-10,1e3):l=_t.fromPerspective(-1,1,1,-1,-10,1e3),l.scale(c,c,c),l.translate(r,o,0),l.translatePre(0,0,-10);let p=_e.fromRotationEuler(1.1*u,1.3*u,1.7*u,5);l.rotatePre(p.a,p.b,p.c,p.d),this.edges=this.transformEdges(s,l)}updateLayout(){this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputRotation),this.launcher.addAppInput(this.inputProjection)}createCube(){let t=new z(1,1,1),e=new z(1,1,-1),n=new z(1,-1,1),i=new z(1,-1,-1),s=new z(-1,1,1),r=new z(-1,1,-1),o=new z(-1,-1,1),c=new z(-1,-1,-1);return[new J(t,e),new J(n,i),new J(s,r),new J(o,c),new J(t,n),new J(e,i),new J(s,o),new J(r,c),new J(t,s),new J(e,r),new J(n,o),new J(i,c)]}nextPointFromBox(t,e){let n=t.nextFloatBetween(e.x0,e.x1),i=t.nextFloatBetween(e.y0,e.y1),s=t.nextFloatBetween(e.z0,e.z1);return new z(n,i,s)}transformEdges(t,e){let n=[];for(let i of t){let s=e.mapPoint(i.p0),r=e.mapPoint(i.p1),o=b.fromObject(s),c=b.fromObject(r);n.push(new E(o,c))}return n}};var en=class{context;launcher;mesh;points;inputCount;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new O("count","0","50","1"),this.inputCount.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputCount.setStyle("width: 200px"),this.mesh=new D,this.points=[]}create(){}render(){let t=this.launcher.inputSeed.getInt(),e=V.fromSeedLcg(t);this.context.clear(),this.context.fillMeshRandom(this.mesh,e),this.context.drawMeshEdges(this.mesh,"#666666",.5),this.context.fillPoints(this.points,"#000000",5)}reset(){this.mesh=new D,this.points=[]}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),n=this.inputCount.getInt(),i=V.fromSeedLcg(e),[s,r]=this.context.getSize(!1),o=new R(0,0,s,r),c=Le(i,o),u=Le(i,o),l=Le(i,o);this.points.push(c,u,l);let p=new w;p.moveTo(c),p.lineTo(u),p.lineTo(l),p.close();let h=new D,d=new et(Y);d.addPath(p),d.process(h,at);for(let m=0;m<n;m++){let f=c.lerp(u,i.nextFloat()),y=u.lerp(l,i.nextFloat()),x=f.lerp(y,i.nextFloat());h.triangulateAddPoint(x),this.points.push(x)}h.triangulateOptimize(),h.validate(),this.mesh=h}updateLayout(){this.launcher.addAppInput(this.inputCount)}};var nn=class{bounds;context;input;isInside;launcher;inputCount;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.input=new w,this.bounds=R.createEmpty(),this.isInside=!1}create(){document.getElementById("canvas2D")?.addEventListener("mousemove",e=>this.onMouseMove(e))}render(){this.context.clear(),this.context.fillBox(this.bounds,"#ADD8E644"),this.context.fillPath(this.input,this.isInside?"#FFCCCC":"#CCCCCC","evenodd"),this.context.drawPath(this.input,"#666666"),this.context.fillPoints(this.input.getPoints(),"#000000",5)}reset(){this.input.clear()}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),i=this.inputCount.getInt(),s=V.fromSeedLcg(e),[r,o]=this.context.getSize(!1),c=Yt(s,n,i,r,o);c.close(),this.input=c,this.bounds=c.getBounds(),v.info("Path area = {}",c.getSignedArea())}updateLayout(){this.launcher.addAppInput(this.inputCount)}onMouseMove(t){let e=new b(t.offsetX,t.offsetY);this.isInside=this.input.hasPointInside(e,1),this.launcher.requestUpdate()}};function sn(a){switch(a){case"intersection":return 1;case"exclusion":return 2;case"awithoutb":return 3;case"bwithouta":return 4;default:return 0}}function rn(a){switch(a){case"miter":return 1;case"miterclip":return 2;case"round":return 3;default:return 0}}function It(a){switch(a){case"evenodd":return 1;case"positive":return 2;case"negative":return 3;case"absgeqtwo":return t=>Math.abs(t)>2;default:return 0}}var on=class{chains;context;faces;launcher;polygonA;polygonB;inputBoolOp;inputParameter;inputWindA;inputWindB;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new O("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputBoolOp=new N("boolOp","union"),this.inputBoolOp.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputBoolOp.setOptionValues("union","intersection","exclusion","awithoutb","bwithouta"),this.inputWindA=new N("windA","nonzero"),this.inputWindA.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindA.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.inputWindB=new N("windB","nonzero"),this.inputWindB.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindB.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.polygonA=new q,this.polygonB=new q,this.chains=new w,this.faces=new w}create(){}render(){this.context.clear(),this.context.fillPolygon(this.polygonA,"#00FF0022"),this.context.fillPolygon(this.polygonB,"#0000FF22");let t=this.context.createLinePattern(6,"#FF0000")??"#FF000022";this.context.fillPath(this.faces,t),this.context.drawPath(this.faces,"#FF3333",1.5),this.context.drawPath(this.chains,"#3333FF",1.5)}reset(){this.polygonA=new q,this.polygonB=new q,this.chains=new w,this.faces=new w}update(t){let e=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),i=2*(this.inputParameter.getInt()-100),s=V.fromSeedLcg(e),[r,o]=this.context.getSize(!1);[this.polygonA,this.polygonB]=Tt(s,n,i,r,o);let c=new et(Y);for(let l of this.polygonA.getEdges())c.addEdge(l,0);for(let l of this.polygonB.getEdges())c.addEdge(l,1);this.faces.clear(),this.chains.clear();let u=new D;c.process(u,{booleanOperator:sn(this.inputBoolOp.getValue()),windingOperatorA:It(this.inputWindA.getValue()),windingOperatorB:It(this.inputWindB.getValue())}),this.faces=u.getFacesPath(),this.chains=u.getChainsPath()}updateLayout(){this.launcher.addAppInput(this.inputParameter),this.launcher.addAppInput(this.inputBoolOp),this.launcher.addAppInput(this.inputWindA),this.launcher.addAppInput(this.inputWindB)}};var an=class{context;launcher;path;points;inputParameter;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new O("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.path=new w,this.points=[]}create(){}render(){this.context.clear(),this.context.drawPath(this.path),this.context.fillPoints(this.points,"#FF0000",5)}reset(){this.path=new w,this.points=[]}update(t){let e=this.inputParameter.getInt(),n=new A(new b(100,150),new b(300,400),new b(600,250)),i=new A(new b(100,500),new b(300,100),new b(500,100+3*e));this.points=[],this.path=new w,n.intersectQuad(i,this.points),this.path.addCurveSplines(n),this.path.addCurveSplines(i)}updateLayout(){this.launcher.addAppInput(this.inputParameter)}};var cn=class{context;input;launcher;output;inputCount;inputJoin;inputOp;inputParam1;inputParam2;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputOp=new N("op","flatten"),this.inputOp.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputOp.setOptionValues("flatten","simplify","offset","dash","stroke","dashstroke"),this.inputParam1=new O("param1","0","100","50"),this.inputParam1.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam1.setStyle("width: 200px"),this.inputParam2=new O("param2","0","100","50"),this.inputParam2.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam2.setStyle("width: 200px"),this.inputJoin=new N("join","bevel"),this.inputJoin.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputJoin.setOptionValues("bevel","miter","miterclip","round"),this.input=new w,this.output=new w}create(){}render(){this.context.clear(),this.context.drawPath(this.input,"#666666FF",1),this.context.drawPath(this.output,"#FF0000FF",2),this.context.fillPoints(this.input.getPoints(),"#00000088",5),this.context.fillPoints(this.output.getPoints(),"#FF000088",5)}reset(){this.input.clear(),this.output.clear()}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),i=this.inputCount.getInt(),s=this.inputOp.getValue(),r=V.fromSeedLcg(e),[o,c]=this.context.getSize(!1),u=Yt(r,n,i,o,c);this.input=u;let l=$n;switch(s){case"flatten":{let p=(10*this.inputParam1.getFloat()+1)/10,h=(10*this.inputParam2.getFloat()+1)/10;this.output=u.flatten(!1,{flattenTolerance:h,simplifyTolerance:p});break}case"simplify":{let p=(10*this.inputParam1.getFloat()+1)/10;this.output=u.simplify({simplifyTolerance:p});break}case"offset":{let p=this.inputParam1.getFloat()-50,h=this.inputParam2.getFloat()/10,d=rn(this.inputJoin.getValue());this.output=u.offset({distance:p,join:d,miterLimit:h});break}case"dash":{let p=this.inputParam1.getFloat(),h=[2*p,p],d=10*this.inputParam2.getFloat();this.output=u.dash({array:h,offset:d});break}case"stroke":{let p=this.inputParam1.getFloat(),h=this.inputParam2.getFloat()/10,d=rn(this.inputJoin.getValue());this.output=u.stroke({caps:l,join:d,miterLimit:h,width:p});break}case"dashstroke":{let p=this.inputParam1.getFloat(),h=10*this.inputParam2.getFloat(),d=rn(this.inputJoin.getValue()),m=[2*p,p],f=50;this.output=u.stroke({caps:l,dashArray:m,dashOffset:h,join:d,width:f});break}}}updateLayout(){this.launcher.addAppInput(this.inputOp),this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputParam1),this.launcher.addAppInput(this.inputParam2),this.launcher.addAppInput(this.inputJoin)}};var un=class{context;launcher;mesh;polygonA;polygonB;tagEntries;inputParameter;inputWind;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new O("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputWind=new N("wind","nonzero"),this.inputWind.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWind.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.polygonA=new q,this.polygonB=new q,this.mesh=new D,this.tagEntries=[]}create(){}render(){this.context.clear();let t=[],e=1/this.tagEntries.length;for(let n=0;n<1;n+=e){let i=st.fromHsv(n,.25,1,1);t.push(i.style())}for(let n of this.mesh.getFaces()){let i=n.data;if(i.length===0)continue;let s=new w;n.writeToPath(s);let r=this.tagEntries.findIndex(o=>kt(o.tag,i));r<0||this.context.fillPath(s,t[r])}this.context.drawMeshEdges(this.mesh,"#888888",.5)}reset(){this.polygonA=new q,this.polygonB=new q,this.mesh=new D}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),i=2*(this.inputParameter.getInt()-100),s=V.fromSeedLcg(e),[r,o]=this.context.getSize(!1);[this.polygonA,this.polygonB]=Tt(s,n,i,r,o);let c=new Ge(Y);for(let l of this.polygonA.getEdges())c.addEdge(l,0);for(let l of this.polygonB.getEdges())c.addEdge(l,1);c.addEdge(E.fromXY(325,175,350,175),2),c.addEdge(E.fromXY(350,175,350,225),2),c.addEdge(E.fromXY(350,225,325,225),2),c.addEdge(E.fromXY(325,225,325,175),2),c.addEdge(E.fromXY(300,275,375,275),3),c.addEdge(E.fromXY(375,275,375,325),3),c.addEdge(E.fromXY(375,325,300,325),3),c.addEdge(E.fromXY(300,325,300,275),3);let u=new D;c.process(u,It(this.inputWind.getValue())),this.updateTagEntries(u),this.mesh=u}updateLayout(){this.launcher.addAppInput(this.inputParameter),this.launcher.addAppInput(this.inputWind)}updateTagEntries(t){let e=[];for(let n of t.getFaces()){T(n.data!==void 0,"Face data must not be undefined");let i=n.data,s=e.find(r=>kt(r.tag,i));s!==void 0?s.faces.push(n):e.push({tag:i,faces:[n]})}for(let n of e)n.tag.length>0&&t.monotonizeFaces(n.faces);this.tagEntries=e}};var pn=class{context;launcher;inputParam1;inputParam2;constructor(t,e){this.launcher=t,this.context=e,this.inputParam1=new O("param1","1","100","50"),this.inputParam1.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam1.setStyle("width: 200px"),this.inputParam2=new O("param2","1","100","50"),this.inputParam2.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam2.setStyle("width: 200px")}create(){}render(){this.context.clear()}reset(){}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),n=this.inputParam1.getInt(),i=this.inputParam2.getInt(),s=V.fromSeedLcg(e);v.infoDebug("param1 = {}, param2 = {}, random = {}",n,i,s.nextInt())}updateLayout(){this.launcher.addAppInput(this.inputParam1),this.launcher.addAppInput(this.inputParam2)}};var Ti=[0,1,1,7,1,19,21,127,1,259,261,1807,273,4915,5461,32767,1,65539,65541,458767,65553,1245235,1376341,8323327,65793,16974595,17106181,118427407,17895697,322122547],ln=class{boxes;context;image;launcher;inputCount;inputFormat;inputSize;constructor(t,e){this.launcher=t,this.context=e,this.inputSize=new O("size","16","1024","512"),this.inputSize.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputSize.setStyle("width: 200px"),this.inputCount=new O("count","0","16","8"),this.inputCount.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputCount.setStyle("width: 200px"),this.inputFormat=new N("format","none"),this.inputFormat.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputFormat.setOptionValues("none","u8","u16","u32","f32"),this.image=new rt(0,0),this.boxes=[]}create(){}render(){let t=this.image.getWidth(),e=this.inputSize.getInt(),n=Math.trunc(e/t);n=L(n,1,128);let i=this.image.magnify(n);this.context.clear(),this.context.blitImage(i,0,0),this.context.fillBoxes(this.boxes,"#000000")}reset(){this.image=new rt(0,0),this.boxes=[]}update(t){this.reset();let e=this.launcher.inputGenerator.getInt(),n=2**this.inputCount.getFloat(),i=this.launcher.inputSeed.getInt(),s=this.inputSize.getInt(),r=V.fromSeedLcg(i),o=[];switch(e){case 0:{this.sampleWhiteNoise(r,n,o);break}case 1:{this.sampleJitteredGrid(r,n,o);break}case 2:{this.sampleStochasticSobol(r,n,o);break}}switch(this.inputFormat.getValue()){case"none":{this.boxes=this.createBoxes(o,s,s/256);break}case"u8":{this.image=this.createImage(o,"u8");break}case"u16":{this.image=this.createImage(o,"u16");break}case"u32":{this.image=this.createImage(o,"u32");break}case"f32":{this.image=this.createImage(o,"f32");break}}}updateLayout(){this.launcher.addAppInput(this.inputSize),this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputFormat)}createBoxes(t,e,n){let i=[];for(let s=0;s<t.length;s+=2){let r=e*t[s+0],o=e*t[s+1],c=new R(r-n,o-n,r+n,o+n);i.push(c)}return i}createImage(t,e){switch(e){case"u8":{let n=this.getImageMinSize(t.length,4),i=new Uint8Array(4*n*n);for(let s=0;s<t.length;s++)i[s]=256*t[s];return new rt(n,n,i.buffer)}case"u16":{let n=this.getImageMinSize(t.length,2),i=new Uint16Array(2*n*n);for(let s=0;s<t.length;s++)i[s]=65536*t[s];return new rt(n,n,i.buffer)}case"u32":{let n=this.getImageMinSize(t.length,1),i=new Uint32Array(n*n);for(let s=0;s<t.length;s++)i[s]=4294967296*t[s];return new rt(n,n,i.buffer)}case"f32":{let n=this.getImageMinSize(t.length,1),i=new Float32Array(n*n);for(let s=0;s<t.length;s++)i[s]=t[s];return new rt(n,n,i.buffer)}default:F(e)}}createStratifiedSample(t,e,n,i,s){let r=e+t.nextFloat(),o=n+t.nextFloat();s.push(r/i),s.push(o/i)}getImageMinSize(t,e){let n=Math.sqrt(t/e);return Math.ceil(n)}sampleJitteredGrid(t,e,n){let i=Math.sqrt(e),s=1/Math.ceil(i);for(let r=0;r<1;r+=s)for(let o=0;o<1;o+=s){let c=s*t.nextFloat(),u=s*t.nextFloat();n.push(o+c),n.push(r+u)}}sampleStochasticSobol(t,e,n){let i=0,s=0,r=1;this.createStratifiedSample(t,i,s,r,n);for(let o=0,c=1;c<e;o++,c=r){r=2*c;for(let u=0;u<c;u++){let l=2*(u^0),p=2*(u^Ti[o]);i=r*n[l+0]^1,s=r*n[p+1]^1,this.createStratifiedSample(t,i,s,r,n)}}}sampleWhiteNoise(t,e,n){for(let i=0;i<e;i++){let s=t.nextFloat(),r=t.nextFloat();n.push(s),n.push(r)}}};var hn=class{context;inner;launcher;mesh;meshOriginal;outer;vertices;inputTime;constructor(t,e){this.launcher=t,this.context=e,this.inputTime=new O("time","0","500","50"),this.inputTime.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputTime.setStyle("width: 200px"),this.inner=new w,this.outer=new w,this.mesh=new D,this.meshOriginal=new D,this.vertices=[]}create(){}render(){this.context.clear(),this.context.drawEdges(this.getVertexEdges(),"#FF0000"),this.context.drawMeshEdges(this.meshOriginal,"#000000"),this.context.drawMeshEdges(this.mesh,"#00FF00")}reset(){this.inner.clear(),this.outer.clear(),this.mesh=new D,this.meshOriginal=new D,this.vertices=[]}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),n=V.fromSeedLcg(e),[i,s]=this.context.getSize(!1),r=new R(0,0,i,s),o=this.launcher.inputGenerator.getInt(),c=this.inputTime.getInt(),u=si(n,r,o,1,0).toPath();this.mesh=u.toMesh(0),this.meshOriginal=this.mesh.clone(),this.mesh.triangulate(!1),this.initializeMesh(this.mesh),this.createStraightSkeleton(this.mesh,c)}updateLayout(){this.launcher.addAppInput(this.inputTime)}createStraightSkeleton(t,e){let n=t.getFaces().slice();for(;n.length>0;){n.sort((s,r)=>Pt.compareFace(s,r));let i=n[0].data;if(T(i.t1>=0,"Parameter must be positve (t = {})",i.t1),this.printEvents(n,e),e<i.t1){for(let s of n)this.updateFacePositionAt(s,e),this.dumpVerticesAt(s,e);break}for(let s of n)this.updateFacePositionAt(s,i.t1);this.handleEvent(i),i.type!==2&&n.splice(0,1);for(let s of n)this.updateFaceEvent(s)}}deleteEdgeAndMerge(t){let e=t.lnext,n=e.lnext,i=t.sym,s=e.sym,r=n.sym;t.data=void 0,P.splice(i,e);let o=e;do o.p0=t.p0,o.onext.p0=t.p0,o=o.onext;while(o!==e);P.splice(t,e),P.detachPair(t),P.clear(e),P.clear(n),s.lnext.onext=r,r.lnext.onext=s,s.sym=r,r.sym=s}deleteEdgeAndSplit(t){let e=t.lnext,n=e.lnext;P.detachPair(e),e.p0=b.ZERO,e.sym.p0=b.ZERO,t.data=void 0,P.splice(t,Bt.getWavefrontEdgeCcw(t)),t.face=void 0,e.face=void 0,n.face=void 0}dumpVerticesAt(t,e){let n=t.start,i=n.lnext,s=i.lnext,r=n.data,o=i.data,c=s.data;r!==void 0&&(r.t1=e,this.vertices.push(r)),o!==void 0&&(o.t1=e,this.vertices.push(o)),c!==void 0&&(c.t1=e,this.vertices.push(c))}getEdgeCollapseParameter(t,e){let n=t.getPositionAt(0),i=e.getPositionAt(0),s=t.vel,o=e.vel.sub(s),c=i.sub(n);return o.dot(c.neg())/o.dot(o)}getEdgeCrashParameter(t,e,n){let i=t.getPositionAt(0),s=e.getPositionAt(0),r=n.getPositionAt(0),o=t.vel,c=s.sub(i),l=r.sub(s).unit().normal();return c.dot(l)/(1+o.dot(l))}getKineticEventTypeName(t){switch(t){case 0:return"EdgeEvent";case 1:return"SplitEvent";case 2:return"FlipEvent";case 3:return"FullEvent"}}getRandomMesh(t,e,n,i,s){let[r,o]=Tt(t,e,n,i,s),c=new et(Y);for(let l of r.getEdges())c.addEdge(l,0);for(let l of o.getEdges())c.addEdge(l,1);let u=new D;return c.process(u,{booleanOperator:2,windingOperatorA:0,windingOperatorB:0}),u}getTriangleCollapseParameter(t,e,n){let i=t.getPositionAt(0).toVector(),s=e.getPositionAt(0).toVector(),r=n.getPositionAt(0).toVector(),o=t.vel,c=e.vel,u=n.vel,l=o.cross(c)-o.cross(u)+c.cross(u),p=i.cross(c)-i.cross(u)+s.cross(u)-s.cross(o)+r.cross(o)-r.cross(c),h=i.cross(s)-i.cross(r)+s.cross(r),d=$(l,.5*p,h);return d.type===2?d:{type:1,x:mt(2*l,p)}}getVertexEdges(){let t=[];for(let e of this.vertices){let n=e.getPositionAt(e.t0),i=e.getPositionAt(e.t1);t.push(new E(n,i))}return t}handleEvent(t){let e=t.e,n=e.lnext,i=n.lnext,s=e.data,r=n.data,o=i.data,c=t.t1;switch(t.type){case 0:{this.stopVertexAt(s,c),this.stopVertexAt(r,c);let u=s.getPositionAt(c),l=new Bt(u,r.n1,s.n2,c),p=n.sym,h=i.sym;this.deleteEdgeAndMerge(e),p.face!==void 0&&this.updateVerticesCw(p.sym,l),h.face!==void 0&&this.updateVerticesCcw(h,l);break}case 1:{this.stopVertexAt(s,c);let u=s.getPositionAt(c),l=new Bt(u,s.n1,r.n1,c),p=new Bt(u,o.n2,s.n2,c);this.deleteEdgeAndSplit(e),this.updateVerticesCw(e,l),this.updateVerticesCcw(i.sym,p);break}case 2:{P.swap(e),e.data=e.oprev.data,e.sym.data=e.sym.oprev.data;break}case 3:{this.stopVertexAt(s,c),this.stopVertexAt(r,c),this.stopVertexAt(o,c);break}}}handleTriangle0(t,e,n){let i=t.data,s=e.data,r=n.data,o=this.getTriangleCollapseParameter(i,s,r),c;o.type===2?o.x1<o.x2||o.x2<0?c=o.x1:c=o.x2:c=o.x;let u=i.getPositionAt(c),l=s.getPositionAt(c),p=r.getPositionAt(c),h=l.sub(u).lenSq(),d=p.sub(l).lenSq(),m=u.sub(p).lenSq(),f=h,y=t;return d>f&&(f=d,y=e),m>f&&(f=m,y=n),new Pt(2,y,c)}handleTriangle1(t,e,n){let i=t.data,s=e.data,r=n.data;T(t.sym.face!==void 0),T(e.sym.face===void 0),T(n.sym.face!==void 0);let o=this.getEdgeCrashParameter(i,s,r),c=this.getEdgeCollapseParameter(s,r);if(c<=o&&c>0)return{type:0,e,t1:c};let u=i.getPositionAt(o),l=s.getPositionAt(o),p=r.getPositionAt(o),h=l.sub(u).lenSq(),d=p.sub(l).lenSq(),m=u.sub(p).lenSq(),f=h,y=t;return d>f&&(f=d,y=e),m>f&&(f=m,y=n),y===e?new Pt(1,t,o):new Pt(2,y,o)}handleTriangle2(t,e,n){let i=t.data,s=e.data,r=n.data,o=this.getEdgeCollapseParameter(i,s),c=this.getEdgeCollapseParameter(i,r);return o<c||c<0?new Pt(0,t,o):new Pt(0,n,c)}handleTriangle3(t,e){let n=t.data,i=e.data,s=this.getEdgeCollapseParameter(n,i);return new Pt(3,t,s)}initializeMesh(t){for(let e of t.getEdges()){if(e.data!==void 0)continue;let n=Bt.createFrom(e),i=e;do T(i.data===void 0),i.data=n,i=i.onext;while(i!==e)}for(let e of t.getFaces())this.updateFaceEvent(e)}printEdgesLnext(t,e){v.infoDebug("lnext");let n=0;for(let i of t.getLnextIterator())v.infoDebug("  [{}] p0: {}",n,i.p0),v.infoDebug("      p1: {}",i.p1),e&&i.validate(),n++}printEdgesOnext(t,e){v.infoDebug("onext");let n=0;for(let i of t.getOnextIterator())v.infoDebug("  [{}] p0: {}",n,i.p0),v.infoDebug("      p1: {}",i.p1),v.infoDebug("      angle: {}",i.p1.sub(i.p0).angle()*180/Math.PI),e&&(T(i.data===t.data),i.validate()),n++}printEvents(t,e){v.infoDebug("******************************************************************"),v.infoDebug("Parameter = {}",e),v.infoDebug("******************************************************************");for(let n=0;n<t.length;n++){let s=t[n].data;v.infoDebug("[{}] type = {}",n,this.getKineticEventTypeName(s.type)),v.infoDebug("    t = {}",s.t1),v.infoDebug("    edge = {}",s.e.p0),v.infoDebug("           {}",s.e.p1)}}printFace(t){v.infoDebug("******************************************************************");let e=t.start,n=e.lnext,i=n.lnext;v.infoDebug("Face: e0 = {}",e.p0),v.infoDebug("           {}",e.p1),v.infoDebug("      e1 = {}",n.p0),v.infoDebug("           {}",n.p1),v.infoDebug("      e2 = {}",i.p0),v.infoDebug("           {}",i.p1)}printVerticesAt(t,e){v.infoDebug("******************************************************************");let n=t.start,i=n.lnext,s=i.lnext,r=n.data,o=i.data,c=s.data;v.infoDebug("vtx0: pos = {}",r.getPositionAt(e)),v.infoDebug("      vel = {}",r.vel),v.infoDebug("       n1 = {}",r.n1),v.infoDebug("       n2 = {}",r.n2),v.infoDebug("vtx1: pos = {}",o.getPositionAt(e)),v.infoDebug("      vel = {}",o.vel),v.infoDebug("       n1 = {}",o.n1),v.infoDebug("       n2 = {}",o.n2),v.infoDebug("vtx2: pos = {}",c.getPositionAt(e)),v.infoDebug("      vel = {}",c.vel),v.infoDebug("       n1 = {}",c.n1),v.infoDebug("       n2 = {}",c.n2)}stopVertexAt(t,e){t.t1=e,this.vertices.push(t)}updateEdgePositionAt(t,e){let n=t.data,i=t.sym.data;t.p0=n.getPositionAt(e),t.sym.p0=i.getPositionAt(e)}updateFaceEvent(t){let e=t.start,n=e.lnext,i=n.lnext,s;e.sym.face===void 0?n.sym.face===void 0?i.sym.face===void 0?s=this.handleTriangle3(e,n):s=this.handleTriangle2(n,i,e):i.sym.face===void 0?s=this.handleTriangle2(e,n,i):s=this.handleTriangle1(i,e,n):n.sym.face===void 0?i.sym.face===void 0?s=this.handleTriangle2(i,e,n):s=this.handleTriangle1(e,n,i):i.sym.face===void 0?s=this.handleTriangle1(n,i,e):s=this.handleTriangle0(e,n,i),t.data=s}updateFacePositionAt(t,e){let n=t.start,i=n.lnext,s=i.lnext;this.updateEdgePositionAt(n,e),this.updateEdgePositionAt(i,e),this.updateEdgePositionAt(s,e)}updateVerticesCcw(t,e){let n=t;do n.data=e,n=n.onext;while(n!==t)}updateVerticesCw(t,e){let n=t;do n.data=e,n=n.oprev;while(n!==t)}},Bt=class a{n1;n2;orig;t0;t1;vel;constructor(t,e,n,i){this.orig=t,this.vel=a.getVelocity(e,n),this.n1=e,this.n2=n,this.t0=i,this.t1=Number.POSITIVE_INFINITY}static createFrom(t){let e=t.p0,n=a.getWavefrontEdgeCw(t),i=a.getWavefrontEdgeCcw(t),s=n.p1.sub(n.p0).unit().normal().neg(),r=i.p0.sub(i.p1).unit().normal().neg();return new a(e,s,r,0)}static getVelocity(t,e){let n=t.add(e);return n.mul(2).div(n.lenSq())}static getWavefrontEdgeCcw(t){let e=t;do{if(e.face===void 0&&e.sym.face!==void 0)return e;e=e.onext}while(e!==t);return v.error("Fallback (ccw)"),t}static getWavefrontEdgeCw(t){let e=t;do{if(e.face!==void 0&&e.sym.face===void 0)return e;e=e.oprev}while(e!==t);return v.error("Fallback (cw)"),t}getPositionAt(t){return this.orig.addMul(this.vel,t-this.t0)}},Pt=class{e;t1;type;constructor(t,e,n){this.type=t,this.e=e,this.t1=n}static compareFace(t,e){let n=t.data,i=e.data,s=n.t1,r=i.t1;return s<0==r<0?s-r:r}};var dn=class{context;errors;inputSegments;intersections;launcher;magnets;outputSegments;pins;inputParameter;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new O("parameter","1","200","50"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputSegments=[],this.outputSegments=[],this.intersections=[],this.magnets=[],this.pins=[],this.errors=[]}create(){}render(){let t=this.inputParameter.getInt();this.context.clear(),this.context.fillBoxes(this.magnets,"#E4E4E4"),this.context.drawEdges(this.inputSegments,"#888888"),this.context.fillPoints(this.pins,"#CCCCCC",.25*t),this.context.fillBoxes(this.errors,"#0088FF44"),this.context.drawEdges(this.outputSegments),this.context.fillEdgePoints(this.outputSegments,"#000000",5),this.context.fillPoints(this.intersections,"#FF0000",5)}reset(){this.inputSegments=[],this.outputSegments=[],this.intersections=[],this.magnets=[],this.pins=[],this.errors=[]}update(t){let e=this.inputParameter.getInt(),n=1/e,i=new St;i.precision=n;let[s,r]=this.context.getSize(!1);this.fillEdges(i,n,s,r);let o=performance.now();i.process();let c=performance.now();v.info("Snap round time: {} ms",(c-o).toFixed(1)),this.inputSegments=this.transformSegments(i.debugGetInputSegments(),e),this.outputSegments=this.transformSegments(i.debugGetOutputSegments(),e),this.intersections=this.transformPoints(i.debugGetIntersections(),e),this.magnets=this.transformBox(i.debugGetMagnets(),e),this.pins=this.transformPoints(i.debugGetPins(),e),this.errors=this.transformBox(this.transformPoints(i.debugGetErrors(),1),e),v.info("Got {} input edges",this.inputSegments.length),v.info("Found {} intersections, {} magnets and {} pins",this.intersections.length,this.magnets.length,this.pins.length),v.info("Created {} output edges",this.outputSegments.length),this.errors.length>0&&v.error("*** {} errors ***",this.errors.length)}updateLayout(){this.launcher.addAppInput(this.inputParameter)}addEdge(t,e,n,i=!1){let s=new S(e,n);t.addSegment(s,0,1,i,void 0)}addEdges(t,e){for(let n of e){let i=new S(n.p0,n.p1);t.addSegment(i,0,1,!1,void 0)}}fillEdges(t,e,n,i){let s=this.launcher.inputGenerator.getInt(),r=this.launcher.inputSeed.getInt(),o=V.fromSeedLcg(r);switch(s){case 0:{let p=o.nextIntBetween(10,30);for(let h=0;h<p;h++){let d=new b(n*o.nextFloat(),i*o.nextFloat()),m=new b(n*o.nextFloat(),i*o.nextFloat());o.nextFloat()<.5&&(d=b.roundToPrecision(d,e)),o.nextFloat()<.5&&(m=b.roundToPrecision(m,e)),this.addEdge(t,d,m)}break}case 1:{let c=[];c.push(E.fromXY(100,200,600,300)),c.push(E.fromXY(75,425,575,625)),c.push(E.fromXY(100,500,300,100)),c.push(E.fromXY(100,500,400,600)),c.push(E.fromXY(300,500,500,200)),this.addEdges(t,c);break}case 2:{let c=[];c.push(E.fromXY(200,200,500,200)),c.push(E.fromXY(500,200,500,500)),c.push(E.fromXY(500,500,200,500)),c.push(E.fromXY(200,500,200,200)),c.push(E.fromXY(300,220,400,220)),c.push(E.fromXY(400,220,400,320)),c.push(E.fromXY(400,320,300,320)),c.push(E.fromXY(300,320,300,220)),this.addEdges(t,c);break}case 3:{let c=new b(n*o.nextFloat(),i*o.nextFloat()),u=new b(n*o.nextFloat(),i*o.nextFloat()),l=o.nextFloatBetween(0,.5),p=o.nextFloatBetween(.5,1),h=b.roundToPrecision(c.lerp(u,l),e),d=b.roundToPrecision(c.lerp(u,p),e);this.addEdge(t,c,u),this.addEdge(t,h,d,!0);break}}}transformBox(t,e){let n=[];for(let i of t){let s=Math.round(e*(i.x-.5)),r=Math.round(e*(i.y-.5)),o=Math.round(e);n.push(new R(s,r,s+o,r+o))}return n}transformEdges(t,e){let n=[];for(let i of t){let s=Math.round(e*i.p0.x),r=Math.round(e*i.p0.y),o=Math.round(e*i.p1.x),c=Math.round(e*i.p1.y);n.push(E.fromXY(s,r,o,c))}return n}transformPoints(t,e){let n=[];for(let i of t){let s=Math.round(e*i.x),r=Math.round(e*i.y);n.push(new b(s,r))}return n}transformSegments(t,e){let n=[];for(let i of t){let s=Math.round(e*i.p0.x),r=Math.round(e*i.p0.y),o=Math.round(e*i.p1.x),c=Math.round(e*i.p1.y);n.push(E.fromXY(s,r,o,c))}return n}};var mn=class{context;error;launcher;mesh;polygonA;polygonB;inputBoolOp;inputOptions;inputParameter;inputWindA;inputWindB;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new O("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputBoolOp=new N("boolOp","union"),this.inputBoolOp.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputBoolOp.setOptionValues("union","intersection","exclusion","awithoutb","bwithouta"),this.inputWindA=new N("windA","nonzero"),this.inputWindA.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindA.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.inputWindB=new N("windB","nonzero"),this.inputWindB.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindB.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.inputOptions=new N("options","triangulate"),this.inputOptions.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputOptions.setOptionValues("monotonize","triangulate","triangulateOpt"),this.polygonA=new q,this.polygonB=new q,this.error=new w,this.mesh=new D}create(){}render(){let t=this.launcher.inputSeed.getInt(),e=V.fromSeedLcg(t);this.context.clear(),this.context.fillMeshRandom(this.mesh,e);let n=this.context.createLinePattern(10,"#FF0000")??"#FF000022";this.context.fillPath(this.error,n),this.context.drawMeshEdges(this.mesh,"#AAAAAA",1.5)}reset(){this.polygonA=new q,this.polygonB=new q,this.error=new w,this.mesh=new D}update(t){let e=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),i=2*(this.inputParameter.getInt()-100),s=V.fromSeedLcg(e),[r,o]=this.context.getSize(!1);[this.polygonA,this.polygonB]=Tt(s,n,i,r,o);let c=new et(Y);for(let l of this.polygonA.getEdges())c.addEdge(l,0);for(let l of this.polygonB.getEdges())c.addEdge(l,1);let u=new D;switch(c.process(u,{booleanOperator:sn(this.inputBoolOp.getValue()),windingOperatorA:It(this.inputWindA.getValue()),windingOperatorB:It(this.inputWindB.getValue())}),this.inputOptions.getValue()){case"monotonize":{u.monotonize();break}case"triangulate":{u.triangulate(!1);break}case"triangulateOpt":{u.triangulate(!0);break}}u.validate(),this.mesh=u,this.error=new w;for(let l of this.mesh.getFaces()){let p=l.getSignedArea();p<=0&&v.warn("Negative path area: {}",p),l.isMonotoneInX()||(l.writeToPath(this.error),v.error("Face not monotone"))}}updateLayout(){this.launcher.addAppInput(this.inputParameter),this.launcher.addAppInput(this.inputBoolOp),this.launcher.addAppInput(this.inputWindA),this.launcher.addAppInput(this.inputWindB),this.launcher.addAppInput(this.inputOptions)}};var Ai=await ie.createContext(),G=new ie(Ai);G.addCanvas2D("bplustree",0,Qe);G.addCanvas2D("image",0,He);G.addCanvas2D("matrix",0,tn);G.addCanvas2D("mesh",0,en);G.addCanvas2D("path-area",0,nn);G.addCanvas2D("path-clip",0,on);G.addCanvas2D("path-intersection",0,an);G.addCanvas2D("path-operations",0,cn);G.addCanvas2D("path-overlay",0,un);G.addCanvas2D("playground",0,pn);G.addCanvas2D("sampling",0,ln);G.addCanvas2D("skeleton",0,hn);G.addCanvas2D("snaprounding",0,dn);G.addCanvas2D("triangulate",0,mn);G.init("playground");
