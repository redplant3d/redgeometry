var at=class{comp;data;constructor(t){this.comp=t,this.data=[]}get length(){return this.data.length}get values(){return this.data}static fromArray(t,e){let i=new at(e);return i.data=t.slice().sort(e),i}clear(){this.data=[]}dequeue(){return this.data.shift()}find(t){let e=this.findIndex(t);return e>=0?this.data[e]:void 0}findBy(t,e=0){for(let i=e;i<this.data.length;i++)if(t(this.data[i]))return this.data[i]}findIndex(t){let e=this.data,i=this.comp;if(e.length<8){for(let n=0;n<e.length;n++)if(i(t,e[n])===0)return n}else{let n=this.findIndexNearestStart(t);if(i(t,e[n])===0)return n}return-1}findIndexBy(t,e=0){for(let i=e;i<this.data.length;i++)if(t(this.data[i]))return i;return-1}findIndexNearestEnd(t,e=0){let i=this.data,n=this.comp,s=e,r=i.length;for(;s<r;){let o=s+r>>>1;n(t,i[o])<0?r=o:s=o+1}return s}findIndexNearestStart(t,e=0){let i=this.data,n=this.comp,s=e,r=i.length;for(;s<r;){let o=s+r>>>1;n(t,i[o])<=0?r=o:s=o+1}return s}getAt(t){return this.data[t]}insert(t){let e=this.findIndexNearestEnd(t);this.data.splice(e,0,t)}remove(t){let e=this.findIndex(t);return e<0?!1:(this.removeAt(e),!0)}removeAt(t,e=1){this.data.splice(t,e)}removeBy(t,e=0,i=1){let n=this.findIndexBy(t,e);return n<0?!1:(this.removeAt(n,i),!0)}removeRange(t,e){let i=this.findIndexNearestStart(t),s=this.findIndexNearestEnd(e??t,i)-i;return this.removeAt(i,s),s}toArray(){return this.data.slice()}},Vt=class{compareFn;data;constructor(t){this.compareFn=t,this.data=[]}get entries(){return this.data}get keys(){return this.data.map(t=>t.key)}get length(){return this.data.length}get values(){return this.data.map(t=>t.value)}static fromArray(t,e){let i=new Vt(e);return i.data=t.slice().sort((n,s)=>e(n.key,s.key)),i}clear(){this.data=[]}dequeue(){return this.data.shift()}find(t){let e=this.findIndex(t);return e>=0?this.data[e].value:void 0}findBy(t,e=0){for(let i=e;i<this.data.length;i++)if(t(this.data[i].key))return this.data[i].value}findIndex(t){let e=this.data,i=this.compareFn;if(e.length<8){for(let n=0;n<e.length;n++)if(i(t,e[n].key)===0)return n}else{let n=this.findIndexNearestStart(t);if(i(t,e[n].key)===0)return n}return-1}findIndexBy(t,e=0){for(let i=e;i<this.data.length;i++)if(t(this.data[i].key))return i;return-1}findIndexNearestEnd(t,e=0){let i=this.data,n=this.compareFn,s=e,r=this.data.length;for(;s<r;){let o=s+r>>>1;n(t,i[o].key)<0?r=o:s=o+1}return s}findIndexNearestStart(t,e=0){let i=this.data,n=this.compareFn,s=e,r=i.length;for(;s<r;){let o=s+r>>>1;n(t,i[o].key)<=0?r=o:s=o+1}return s}getValueAt(t){return this.data[t].value}insert(t,e){let i=this.findIndexNearestEnd(t);this.data.splice(i,0,{key:t,value:e})}remove(t){let e=this.findIndex(t);return e<0?!1:(this.removeAt(e),!0)}removeAt(t,e=1){this.data.splice(t,e)}removeBy(t,e=0,i=1){let n=this.findIndexBy(t,e);return n<0?!1:(this.removeAt(n,i),!0)}removeRange(t,e){let i=this.findIndexNearestStart(t),s=this.findIndexNearestEnd(e??t,i)-i;return this.removeAt(i,s),s}toArray(){return this.data.slice()}};function Gt(u,t,e,i,n){A(n<=u.length-t,"Parameter 'length' must be smaller or equal to length of 'src' to avoid over-read");let s=i+n;s>e.length&&(e.length=s);let r=t,o=i;for(;o<s;)e[o++]=u[r++]}function di(u,t,e,i,n){A(n<=u.length-t,"Parameter 'length' must be smaller or equal to length of 'src' to avoid over-read");let s=i+n;s>e.length&&(e.length=s);let r=t+n-1,o=i;for(;o<s;)e[o++]=u[r--]}function Bt(u,t){if(u===t)return!0;if(u.length!==t.length)return!1;for(let e=0;e<u.length;e++)if(u[e]!==t[e])return!1;return!0}var Fi="{",zi="}";function pt(u,...t){let e={value:0},i="",n=0,s=!1,r=!1;for(let o=0;o<u.length;o++){let a=u[o];if(a===Fi)if(!r)i+=u.substring(n,o),n=o+1,r=!0;else if(u[o-1]===Fi)r=!1;else{s=!0;break}else if(a===zi)if(r){let c=u.substring(n,o);i+=hn(t,e,c),n=o+1,r=!1}else if(u[o+1]===zi)i+=u.substring(n,o),n=o+1,o=n;else{s=!0;break}}if(s||r)throw new Error("Invalid format string");return i+=u.substring(n),i}function hn(u,t,e){let i=parseInt(e);return(Number.isNaN(i)||i<0)&&(i=t.value,t.value+=1),String(u[i])}var se=class{errorFn;infoFn;warnFn;constructor(t){this.errorFn=t.errorFn,this.infoFn=t.infoFn,this.warnFn=t.warnFn}static getStackTrace(t){let e=t.stack;if(e!==void 0){let i=e.indexOf(`
`);return e.substring(i)}else return}assert(t,e,...i){if(!t){let n=pt(e,...i);this.errorFn(n)}}assertDebug(t,e,...i){}assertFn(t,e,...i){if(!t()){let n=pt(e,...i);this.errorFn(n)}}assertFnDebug(t,e,...i){}error(t,...e){let i=pt(t,...e);this.errorFn(i)}errorDebug(t,...e){}info(t,...e){let i=pt(t,...e);this.infoFn(i)}infoDebug(t,...e){}warn(t,...e){let i=pt(t,...e);this.warnFn(i)}warnDebug(t,...e){}};var g=new se({errorFn:console.error,warnFn:console.warn,infoFn:console.info});function ki(u,t,...e){if(!u){let i=pt(t??"Assertion failed",...e);throw new Error(i)}}function A(u,t,...e){}function B(u){let t=pt("Object with value '{}' must not exist",u);throw new Error(t)}function Ct(u,...t){let e=pt(u,...t);throw new Error(e)}var j=class{hi;lo;constructor(t,e){this.hi=t,this.lo=e}get neg(){return new j(-this.hi,-this.lo)}get value(){return this.hi+this.lo}static from(t){return new j(t,0)}add(t){let e=bi(this.hi,t.hi),i=bi(this.lo,t.lo),n=bt(e.hi,e.lo+i.hi);return bt(n.hi,i.lo+n.lo)}add64(t){let e=bi(this.hi,t);return bt(e.hi,this.lo+e.lo)}div(t){let e=this.hi/t.hi,i=pn(this,e),n=this.hi-i.hi,s=this.lo-i.lo,r=n+s;return bt(e,r/t.hi)}div64(t){let e=this.hi/t,i=re(e,t),r=this.hi-i.hi-i.lo+this.lo;return bt(e,r/t)}mul(t){let e=re(this.hi,t.hi),i=this.hi*t.lo,n=this.lo*t.hi,s=i+n;return bt(e.hi,e.lo+s)}mul64(t){let e=re(this.hi,t),i=this.lo*t;return bt(e.hi,e.lo+i)}sub(t){return this.add(t.neg)}sub64(t){return this.add64(-t)}};function bi(u,t){let e=u+t,i=e-t,n=e-i,s=u-i,r=t-n,o=s+r;return new j(e,o)}function bt(u,t){let e=u+t,i=e-u,n=t-i;return new j(e,n)}function pn(u,t){let e=re(u.hi,t),i=bt(e.hi,u.lo*t);return bt(i.hi,i.lo+e.lo)}function re(u,t){let e=Bi(u),i=Bi(t),n=u*t,a=-n+e.hi*i.hi+e.hi*i.lo+e.lo*i.hi+e.lo*i.lo;return new j(n,a)}function Bi(u){let t=134217729*u,e=u-t,i=t+e,n=u-i;return new j(i,n)}var Li=new ArrayBuffer(8),Xn=new Float64Array(Li),Kn=new Int32Array(Li);var X=class{a;b;constructor(t,e){this.a=t,this.b=e}get diameter(){return this.b-this.a}get mid(){return .5*(this.a+this.b)}static fromUnordered(t,e){return t<=e?new X(t,e):new X(e,t)}clamp(t,e){let i=Math.max(this.a,t),n=Math.min(this.b,e);return new X(i,n)}contains(t){return this.a<t&&this.b>t}encloseInterval(t){let e=Math.min(this.a,t.a),i=Math.max(this.b,t.b);return new X(e,i)}encloseValue(t){let e=Math.min(this.a,t),i=Math.max(this.b,t);return new X(e,i)}intersects(t){return this.a<t.b&&this.b>t.a}isDegenerate(){return this.a===this.b}isEmpty(){return this.a>this.b}widen(t){return new X(this.a-t,this.b+t)}withEnd(t){return new X(this.a,t)}withStart(t){return new X(t,this.b)}};function Di(u,t,e){let i=Math.min(t,e),s=Math.max(t,e)-i;return i+u*s}function qi(u,t,e){let i=Math.min(t,e),n=Math.max(t,e);i=Math.ceil(i),n=Math.floor(n);let s=n-i+1;return Math.floor(i+u*s)}function D(u,t,e){return u<=t?t:u>=e?e:u}function lt(u,t,e){return u+e*(t-u)}function Rt(u,t){return Math.round(t*u)/t}var Vi=2**-32,ln=2**-53,F=class{state;constructor(t){ki(t.length===4,"Array length of 'state' must be equal to 4"),this.state=t}static fromSeedLcg(t){let e=mn(t,4);return new F(e)}nextFloat(){let t=Ni(this.state),e=dn(this.state);return Ri(this.state),(t>>>0)*Vi+(e>>>11)*ln}nextFloatBetween(t,e){let i=this.nextFloat();return Di(i,t,e)}nextInt(){let t=Ni(this.state);return Ri(this.state),t|0}nextIntBetween(t,e){let i=this.nextInt()>>>0;return qi(i*Vi,t|0,e|0)}};function mn(u,t){let e=u??4294967296*Math.random(),i=new Int32Array(t),n=e|0;for(let s=0;s<t;s++)n=Math.imul(1549681957,n)|0,n=n+387420489|0,i[s]=n;return i}function Ri(u){let t=u[1]<<9;u[2]^=u[0],u[3]^=u[1],u[1]^=u[2],u[0]^=u[3],u[2]^=t,u[3]=u[3]<<11|u[3]>>>21}function dn(u){return u[0]+u[3]}function Ni(u){let t=u[1]*5;return t=t<<7|t>>>25,t*9}function ft(u,t){return-t/u}function $(u,t,e){let i=t*t-u*e;if(i<0)return{type:0};{let n,s;return i=Math.sqrt(i),t>0?(i=-t-i,n=e/i,s=i/u):t<0?(i=-t+i,n=i/u,s=e/i):u*u>=e*e?(n=i/u,s=-i/u):(n=e/-i,s=e/i),{type:2,x1:n,x2:s}}}function fi(u,t,e,i){let n=u*e-t*t,s=u*i-t*e,r=t*i-e*e,o=4*n*r-s*s;if(o<0){let a;if(t*t*t*i>=u*e*e*e){let c=2*t*n-u*s,p=(c<0?-1:1)*Math.abs(u)*Math.sqrt(-o),l=p+c,d=Math.cbrt(.5*l),b=p===l?-d:-n/d;a=((n<=0?d+b:c/(d*d+b*b+n))-t)/u}else{let c=i*s-2*e*r,p=(c<0?-1:1)*Math.abs(i)*Math.sqrt(-o),l=p+c,d=Math.cbrt(.5*l),b=p===l?-d:-r/d,f=r<=0?d+b:c/(d*d+b*b+r);a=-i/(f+e)}return{type:1,x:a}}else{let a=Math.sqrt(o),c=2*t*n-u*s,h=i*s-2*e*r,p=Math.abs(Math.atan2(u*a,c)/3),l=Math.abs(Math.atan2(i*a,h)/3),d=2*Math.sqrt(-n),b=2*Math.sqrt(-r),f=Math.cos(p),w=Math.cos(l),T=d*f,Z=b*w,tt=-d*(.5*f+.8660254037844386*Math.sin(p)),Mi=-b*(.5*w+.8660254037844386*Math.sin(l)),hi=T+tt>2*t?T-t:tt-t,pi=u,li=-i,mi=Z+Mi<2*e?Z+e:Mi+e,on=pi*mi,Oi=-hi*mi-pi*li,an=hi*li,cn=e*Oi-t*an,un=e*on-t*Oi;return{type:3,x1:hi/pi,x2:li/mi,x3:cn/un}}}var oe=class{callbackContext;constructor(t,e,i){this.callbackContext={provider:t,target:e,callback:i,requestHandle:0}}startAnimation(){let t=this.callbackContext;if(t.requestHandle!==0)return;let e=i=>{t.callback(i,t.target),t.requestHandle=t.provider.requestAnimationFrame(e)};t.requestHandle=t.provider.requestAnimationFrame(e)}stepAnimation(){let t=this.callbackContext;if(t.requestHandle!==0)return;let e=i=>{t.callback(i,t.target),t.requestHandle=0};t.requestHandle=t.provider.requestAnimationFrame(e)}stopAnimation(){let t=this.callbackContext;t.provider.cancelAnimationFrame(t.requestHandle),t.requestHandle=0}};var v=class{x;y;constructor(t,e){this.x=t,this.y=e}static get one(){return new v(1,1)}static get unitX(){return new v(1,0)}static get unitY(){return new v(0,1)}static get zero(){return new v(0,0)}get angle(){return Math.atan2(this.y,this.x)}get length(){return Math.sqrt(this.lengthSq)}get lengthSq(){return this.dot(this)}get neg(){return new v(-this.x,-this.y)}get normal(){return new v(this.y,-this.x)}get unit(){return this.div(this.length)}static fromArray(t,e=0){return new v(t[e],t[e+1])}static fromObject(t){return new v(t.x,t.y)}static fromXYW(t,e,i){return new v(t/i,e/i)}static isBetweenCcw(t,e,i){return e.cross(i)>0?e.cross(t)>0&&i.cross(t)<0:e.cross(t)>0||i.cross(t)<0}add(t){return new v(this.x+t.x,this.y+t.y)}addMul(t,e){return new v(this.x+e*t.x,this.y+e*t.y)}addPt(t){return new m(t.x+this.x,t.y+this.y)}clamp(t,e){let i=D(this.x,t.x,e.x),n=D(this.y,t.y,e.y);return new v(i,n)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y}cross(t){return this.x*t.y-this.y*t.x}div(t){return new v(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}eq(t){return this.x===t.x&&this.y===t.y}isZero(){return this.x===0&&this.y===0}mul(t){return new v(t*this.x,t*this.y)}sub(t){return new v(this.x-t.x,this.y-t.y)}toArray(){return[this.x,this.y]}toPoint(){return new m(this.x,this.y)}toString(){return`{x: ${this.x}, y: ${this.y}}`}},z=class{x;y;z;constructor(t,e,i){this.x=t,this.y=e,this.z=i}static get one(){return new z(1,1,1)}static get unitX(){return new z(1,0,0)}static get unitY(){return new z(0,1,0)}static get unitZ(){return new z(0,0,1)}static get zero(){return new z(0,0,0)}get length(){return Math.sqrt(this.lengthSq)}get lengthSq(){return this.dot(this)}get neg(){return new z(-this.x,-this.y,-this.z)}get normalX(){return new z(0,this.z,-this.y)}get normalY(){return new z(-this.z,0,this.x)}get normalZ(){return new z(this.y,-this.x,0)}get unit(){return this.div(this.length)}static fromArray(t,e=0){return new z(t[e],t[e+1],t[e+2])}static fromObject(t){return new z(t.x,t.y,t.z)}static fromXY(t,e){return new z(t,e,1)}static fromXYW(t,e,i){return new z(i*t,i*e,i)}static fromXYZW(t,e,i,n){return new z(t/n,e/n,i/n)}add(t){return new z(this.x+t.x,this.y+t.y,this.z+t.z)}addMul(t,e){return new z(this.x+e*t.x,this.y+e*t.y,this.z+e*t.z)}clamp(t,e){let i=D(this.x,t.x,e.x),n=D(this.y,t.y,e.y),s=D(this.z,t.z,e.z);return new z(i,n,s)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z}cross(t){return new z(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}div(t){return new z(this.x/t,this.y/t,this.z/t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}eq(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}mul(t){return new z(t*this.x,t*this.y,t*this.z)}sub(t){return new z(this.x-t.x,this.y-t.y,this.z-t.z)}toArray(){return[this.x,this.y,this.z]}toPoint(){return new S(this.x,this.y,this.z)}toString(){return`{x: ${this.x}, y: ${this.y}, z: ${this.z}}`}};var m=class{x;y;constructor(t,e){this.x=t,this.y=e}static get zero(){return new m(0,0)}static fromArray(t,e=0){return new m(t[e],t[e+1])}static fromObject(t){return new m(t.x,t.y)}static fromXYW(t,e,i){return new m(t/i,e/i)}static isPointInTriangle(t,e,i,n){let s=n.sub(t),r=e.sub(t),o=i.sub(t),a=s.cross(o),c=r.cross(s),h=r.cross(o);return h>0?a>0&&c>0&&a+c<h:a<0&&c<0&&a+c>h}static roundToPrecision(t,e){let i=Rt(t.x,e),n=Rt(t.y,e);return new m(i,n)}static signedArea(t,e,i){let n=e.sub(t),s=i.sub(t);return n.cross(s)}add(t){return new m(this.x+t.x,this.y+t.y)}addMul(t,e){return new m(this.x+e*t.x,this.y+e*t.y)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y}eq(t){return this.x===t.x&&this.y===t.y}gt(t){return this.x===t.x?this.y>t.y:this.x>t.x}gte(t){return this.x===t.x?this.y>=t.y:this.x>t.x}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.x)}isZero(){return this.x===0&&this.y===0}lerp(t,e){let i=lt(this.x,t.x,e),n=lt(this.y,t.y,e);return new m(i,n)}lt(t){return this.x===t.x?this.y<t.y:this.x<t.x}lte(t){return this.x===t.x?this.y<=t.y:this.x<t.x}sub(t){return new v(this.x-t.x,this.y-t.y)}toArray(){return[this.x,this.y]}toString(){return`{x: ${this.x}, y: ${this.y}}`}toVector(){return new v(this.x,this.y)}},S=class{x;y;z;constructor(t,e,i){this.x=t,this.y=e,this.z=i}static get zero(){return new S(0,0,0)}static fromArray(t,e=0){return new S(t[e],t[e+1],t[e+2])}static fromObject(t){return new S(t.x,t.y,t.z)}static fromXY(t,e){return new S(t,e,1)}static fromXYW(t,e,i){return new S(i*t,i*e,i)}static fromXYZW(t,e,i,n){return new S(t/n,e/n,i/n)}static max(t,e){return new S(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}static min(t,e){return new S(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static round(t){return new S(Math.round(t.x),Math.round(t.y),Math.round(t.z))}static roundToPrecision(t,e){let i=Rt(t.x,e),n=Rt(t.y,e),s=Rt(t.z,e);return new S(i,n,s)}add(t){return new S(this.x+t.x,this.y+t.y,this.z+t.z)}addMul(t,e){return new S(this.x+e*t.x,this.y+e*t.y,this.z+e*t.z)}copyTo(t,e=0){t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z}eq(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.x)&&Number.isFinite(this.y)}lerp(t,e){let i=lt(this.x,t.x,e),n=lt(this.y,t.y,e),s=lt(this.z,t.z,e);return new S(i,n,s)}sub(t){return new z(this.x-t.x,this.y-t.y,this.z-t.z)}toArray(){return[this.x,this.y,this.z]}toString(){return`{x: ${this.x}, y: ${this.y}, z: ${this.z}}`}toVector(){return new z(this.x,this.y,this.z)}};var I=class{x0;x1;y0;y1;constructor(t,e,i,n){this.x0=t,this.y0=e,this.x1=i,this.y1=n}static get empty(){return new I(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}get dx(){return this.x1-this.x0}get dy(){return this.y1-this.y0}static fromPoints(t,e){let i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),s=Math.max(t.x,e.x),r=Math.max(t.y,e.y);return new I(i,n,s,r)}static fromXYWH(t,e,i,n){let s=Math.min(t,t+i),r=Math.min(e,e+n),o=Math.max(t,t+i),a=Math.max(e,e+n);return new I(s,r,o,a)}contains(t){return this.x0<t.x&&this.y0<t.y&&this.x1>t.x&&this.y1>t.y}containsInclusive(t){return this.x0<=t.x&&this.y0<=t.y&&this.x1>=t.x&&this.y1>=t.y}enclose(t){this.x0=Math.min(this.x0,t.x),this.y0=Math.min(this.y0,t.y),this.x1=Math.max(this.x1,t.x),this.y1=Math.max(this.y1,t.y)}getCenter(){return new m(.5*(this.x0+this.x1),.5*(this.y0+this.y1))}intersects(t){return this.x0<t.x1&&this.x1>t.x0&&this.y0<t.y1&&this.y1>t.y0}intersectsInclusive(t){return this.x0<=t.x1&&this.x1>=t.x0&&this.y0<=t.y1&&this.y1>=t.y0}isEmpty(){return this.x0>this.x1||this.y0>this.y1}isPoint(){return this.x0===this.x1&&this.y0===this.y1}scale(t,e){let i=.5*(t-1)*this.dx,n=.5*(e-1)*this.dy;return this.scaleAbsolute(i,n)}scaleAbsolute(t,e){return new I(this.x0-t,this.y0-e,this.x1+t,this.y1+e)}toString(){return`{x0: ${this.x0}, y0: ${this.y0}, x1: ${this.x1}, y1: ${this.y1}}`}union(t){this.x0=Math.min(this.x0,t.x0),this.y0=Math.min(this.y0,t.y0),this.x1=Math.max(this.x1,t.x1),this.y1=Math.max(this.y1,t.y1)}},Et=class{x0;x1;y0;y1;z0;z1;constructor(t,e,i,n,s,r){this.x0=t,this.y0=e,this.z0=i,this.x1=n,this.y1=s,this.z1=r}static get empty(){return new Et(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}get dx(){return this.x1-this.x0}get dy(){return this.y1-this.y0}get dz(){return this.z1-this.z0}static fromPoints(t,e){let i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),s=Math.min(t.z,e.z),r=Math.max(t.x,e.x),o=Math.max(t.y,e.y),a=Math.max(t.z,e.z);return new Et(i,n,s,r,o,a)}contains(t){return this.x0<t.x&&this.y0<t.y&&this.z0<t.z&&this.x1>t.x&&this.y1>t.y&&this.z1>t.z}containsInclusive(t){return this.x0<=t.x&&this.y0<=t.y&&this.z0<=t.z&&this.x1>=t.x&&this.y1>=t.y&&this.z1>=t.z}enclose(t){this.x0=Math.min(this.x0,t.x),this.y0=Math.min(this.y0,t.y),this.z0=Math.min(this.z0,t.z),this.x1=Math.max(this.x1,t.x),this.y1=Math.max(this.y1,t.y),this.z1=Math.max(this.z1,t.z)}getCenter(){return new S(.5*(this.x0+this.x1),.5*(this.y0+this.y1),.5*(this.z0+this.z1))}intersects(t){return this.x0<t.x1&&this.x1>t.x0&&this.y0<t.y1&&this.y1>t.y0&&this.z0<t.z1&&this.z1>t.z0}intersectsInclusive(t){return this.x0<=t.x1&&this.x1>=t.x0&&this.y0<=t.y1&&this.y1>=t.y0&&this.z0<=t.z1&&this.z1>=t.z0}isEmpty(){return this.x0>this.x1||this.y0>this.y1||this.z0>this.z1}isPoint(){return this.x0===this.x1&&this.y0===this.y1&&this.z0===this.z1}scale(t,e,i){let n=.5*(t-1)*this.dx,s=.5*(e-1)*this.dy,r=.5*(i-1)*this.dz;return this.scaleAbsolute(n,s,r)}scaleAbsolute(t,e,i){return new Et(this.x0-t,this.y0-e,this.z0-i,this.x1+t,this.y1+e,this.z1+i)}toString(){return`{x0: ${this.x0}, y0: ${this.y0}, z0: ${this.z0}, x1: ${this.x1}, y1: ${this.y1}}, z1: ${this.z1}}`}union(t){this.x0=Math.min(this.x0,t.x0),this.y0=Math.min(this.y0,t.y0),this.z0=Math.min(this.z0,t.z0),this.x1=Math.max(this.x1,t.x1),this.y1=Math.max(this.y1,t.y1),this.z1=Math.max(this.z1,t.z1)}};var y=class{p0;p1;constructor(t,e){this.p0=t,this.p1=e}get length(){return this.vector.length}get lengthSq(){return this.vector.lengthSq}get normal(){return new y(this.p0,this.p0.add(this.vector.normal))}get vector(){return this.p1.sub(this.p0)}static clip(t,...e){let i=t;for(let n of e){let[s]=y.getIntersectionParameter(i,n),r=m.signedArea(n.p0,n.p1,i.p0);if(s>0&&s<1){let o=i.getValueAt(s);r<=0?i=new y(o,i.p1):i=new y(i.p0,o)}else if(r<=0)return}if(!i.isPoint())return i}static fromArray(t,e=0){return new y(t[e],t[e+1])}static fromObject(t){return new y(t.p0,t.p1)}static fromXY(t,e,i,n){let s=new m(t,e),r=new m(i,n);return new y(s,r)}static getCircleIntersectionParameter(t,e,i){let n=t.p1.sub(t.p0),s=e.sub(t.p0),r=n.dot(n),o=n.dot(s.neg),a=s.dot(s)-i*i,c=$(r,o,a);if(c.type===2){let h=c.x1,p=c.x2;return[h,p]}else return}static getClosestDistance(t,e){let[i,n]=y.getClosestParameter(t,e),s=t.getValueAt(i),r=e.getValueAt(n);return s.sub(r).length}static getClosestParameter(t,e){let i=t.vector,n=e.vector,s=t.p0.sub(e.p0),r=i.dot(i),o=i.dot(n),a=n.dot(n),c=i.dot(s),h=n.dot(s),p=r*a-o*o,l,d;if(p>0){let b=o*h-a*c,f=r*h-o*c;b<=0?h<=0?(l=D(-c/r,0,1),d=0):h<a?(l=0,d=h/a):(l=D((o-c)/r,0,1),d=1):p<=b?o+h<=0?(l=D(-c/r,0,1),d=0):o+h<a?(l=1,d=(o+h)/a):(l=D((o-c)/r,0,1),d=1):f<=0?(l=D(-c/r,0,1),d=0):f<p?(l=b/p,d=f/p):(l=D((o-c)/r,0,1),d=1)}else h<=0?(l=D(-c/r,0,1),d=0):h<a?(l=0,d=h/a):(l=D((o-c)/r,0,1),d=1);return[l,d]}static getIntersection(t,e){let i=t.vector,n=e.vector,s=i.cross(n);if(s!==0){let r=e.p0.sub(t.p0),o=r.cross(n)/s,a=r.cross(i)/s;if(o>=0&&o<=1&&a>=0&&a<=1)return t.getValueAt(o)}}static getIntersectionParameter(t,e){let i,n=t.vector,s=e.vector,r=n.cross(s);if(r!==0){let o=e.p0.sub(t.p0),a=o.cross(s)/r,c=o.cross(n)/r;i=[a,c]}else i=[Number.NaN,Number.NaN];return i}static isAdjacent(t,e){return t.p0.eq(e.p0)||t.p0.eq(e.p1)||t.p1.eq(e.p0)||t.p1.eq(e.p1)}static isEqual(t,e){return t.p0.eq(e.p0)&&t.p1.eq(e.p1)}static isIntersection(t,e){let i=m.signedArea(t.p0,t.p1,e.p0),n=m.signedArea(t.p0,t.p1,e.p1),s=i*n;if(s>0)return!1;let r=m.signedArea(e.p0,e.p1,t.p0),o=m.signedArea(e.p0,e.p1,t.p1),a=r*o;return a>0?!1:s*a>0?!0:!!(i===0&&t.isPointInside(e.p0)||n===0&&t.isPointInside(e.p1)||r===0&&e.isPointInside(t.p0)||o===0&&e.isPointInside(t.p1))}static isOpposite(t,e){return t.p0.eq(e.p1)&&t.p1.eq(e.p0)}eq(t){return this.p0.eq(t.p0)&&this.p1.eq(t.p1)}getBounds(){return I.fromPoints(this.p0,this.p1)}getClosestPoint(t){let e=this.getParameterFromPoint(t);return e<=0?this.p0:e>=1?this.p1:this.getValueAt(e)}getClosestPointDistance(t){return this.getClosestPoint(t).sub(t).length}getParameterFromPoint(t){let e=this.vector,i=t.sub(this.p0);return e.dot(i)/e.lengthSq}getSignedDistanceFromPoint(t){let e=this.vector,i=this.p0.sub(t);return e.cross(i)/e.length}getValueAt(t){return this.p0.lerp(this.p1,t)}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()}isPoint(){return this.p0.eq(this.p1)}isPointInside(t){let e=this.getParameterFromPoint(t);return e>=0&&e<=1}reverse(){return new y(this.p1,this.p0)}toBezier(){return new C(this.p0,this.p1)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}translate(t){return new y(this.p0.add(t),this.p1.add(t))}},Q=class{p0;p1;constructor(t,e){this.p0=t,this.p1=e}get length(){return this.vector.length}get lengthSq(){return this.vector.lengthSq}get vector(){return this.p1.sub(this.p0)}static fromArray(t,e=0){return new Q(t[e],t[e+1])}static fromObject(t){return new Q(t.p0,t.p1)}static fromXYZ(t,e,i,n,s,r){let o=new S(t,e,i),a=new S(n,s,r);return new Q(o,a)}static isAdjacent(t,e){return t.p0.eq(e.p0)||t.p0.eq(e.p1)||t.p1.eq(e.p0)||t.p1.eq(e.p1)}static isEqual(t,e){return t.p0.eq(e.p0)&&t.p1.eq(e.p1)}static isOpposite(t,e){return t.p0.eq(e.p1)&&t.p1.eq(e.p0)}eq(t){return this.p0.eq(t.p0)&&this.p1.eq(t.p1)}getBounds(){return Et.fromPoints(this.p0,this.p1)}getClosestPoint(t){let e=this.getParameterFromPoint(t);return e<=0?this.p0:e>=1?this.p1:this.getValueAt(e)}getClosestPointDistance(t){return this.getClosestPoint(t).sub(t).length}getDistanceFromPoint(t){let e=this.vector,i=this.p0.sub(t);return e.cross(i).length/e.length}getNormalAround(t){return new Q(this.p0,this.p0.add(this.vector.cross(t)))}getParameterFromPoint(t){let e=this.vector,i=t.sub(this.p0);return e.dot(i)/e.lengthSq}getProjectedEdge(t,e){let i=y.fromXY(this.p0.x,this.p0.y,this.p1.x,this.p1.y),n=i.getParameterFromPoint(t),s=i.getParameterFromPoint(e);return new Q(this.getValueAt(n),this.getValueAt(s))}getValueAt(t){return this.p0.lerp(this.p1,t)}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()}reverse(){return new Q(this.p1,this.p0)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}translate(t){return new Q(this.p0.add(t),this.p1.add(t))}};var C=class{p0;p1;constructor(t,e){this.p0=t,this.p1=e}get pn(){return this.p1}get type(){return 0}static fromXY(t,e,i,n){let s=new m(t,e),r=new m(i,n);return new C(s,r)}static getIntersectionParameter(t,e){let i,n=t.p1.sub(t.p0),s=e.p1.sub(e.p0),r=e.p0.sub(t.p0),o=n.cross(s);if(o!==0){let a=r.cross(s)/o,c=r.cross(n)/o;i=[a,c]}else i=[Number.NaN,Number.NaN];return i}getBounds(){return I.fromPoints(this.p0,this.p1)}getControlBounds(){return I.fromPoints(this.p0,this.p1)}getDerivative(){return this.p1.sub(this.p0)}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector();return t.cross(e)/2}getTangentEnd(){return this.getDerivative()}getTangentStart(){return this.getDerivative()}getValueAt(t){return this.p0.lerp(this.p1,t)}getWindingAt(t){let e=this.p0.y-t.y,i=this.p1.y-this.p0.y,n=ft(i,e);return Qi(this,n,t.x)}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()}isPoint(){return this.p0.eq(this.p1)}reverse(){return new C(this.p1,this.p0)}splitAfter(t){let e=this.p0.lerp(this.p1,t);return new C(e,this.p1)}splitAt(t){let e=this.p0.lerp(this.p1,t),i=new C(this.p0,e),n=new C(e,this.p1);return[i,n]}splitBefore(t){let e=this.p0.lerp(this.p1,t);return new C(this.p0,e)}splitBetween(t,e){let i=this.p0.lerp(this.p1,t),n=this.p0.lerp(this.p1,e);return new C(i,n)}toEdge(){return new y(this.p0,this.p1)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}},E=class{p0;p1;p2;constructor(t,e,i){this.p0=t,this.p1=e,this.p2=i}get pn(){return this.p2}get type(){return 1}static fromXY(t,e,i,n,s,r){let o=new m(t,e),a=new m(i,n),c=new m(s,r);return new E(o,a,c)}getBounds(){let t=I.fromPoints(this.p0,this.p2),[e,i]=this.getDerivativeCoefficients(),n=ft(e.x,i.x),s=ft(e.y,i.y);return ct(this,t,n),ct(this,t,s),t}getClosestParameter(t){let e=this.p0.sub(t),i=this.p1.sub(this.p0),n=this.p2.sub(this.p1),s=i.dot(e),r=i.dot(i),o=n.dot(e),a=n.dot(i),h=2*(n.dot(n)-a-a+r),p=2*(a-r),l=2/3*(o+r+r-s),d=2*s,b=fi(h,p,l,d),f=this.p0.sub(t).lengthSq,w=this.p2.sub(t).lengthSq,T=f<w?{param:0,distSq:f}:{param:1,distSq:w};return b.type===3?(Jt(this,t,b.x1,T),Jt(this,t,b.x2,T),Jt(this,t,b.x3,T)):Jt(this,t,b.x,T),T.param}getCoefficients(){let t=this.p1.sub(this.p0),i=this.p2.sub(this.p1).sub(t),n=t.add(t),s=this.p0;return[i,n,s]}getControlBounds(){let t=I.fromPoints(this.p0,this.p2);return t.enclose(this.p1),t}getCurvatureAt(t){let[e,i]=this.getDerivativeCoefficients(),n=e.mul(t).add(i),s=e,r=n.length;return n.cross(s)/(r*r*r)}getCurvatureMetric(){let[t,e]=this.getDerivativeCoefficients();return t.cross(e)}getDerivativeAt(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t);return e.sub(i).mul(2)}getDerivativeCoefficients(){let t=this.p1.sub(this.p0),i=this.p2.sub(this.p1).sub(t).mul(2),n=t.add(t);return[i,n]}getEvoluteAt(t){let[e,i,n]=this.getCoefficients(),s=e.mul(t).add(i).mul(t).addPt(n),r=e.mul(2*t).add(i),o=e.mul(2);return s.addMul(r.normal,r.lengthSq/r.cross(o))}getOffsetCuspParameter(t){let[e,i]=this.getDerivativeCoefficients(),n=e.lengthSq,s=i.lengthSq,r=e.cross(i),o=e.dot(i),a=1/n,c=a*-o,h=0;if(r!==0){let p=Math.cbrt(t*t*r*r),l=Math.sqrt(o*o-n*(s-p));h=a*l}return[c,h]}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector(),i=this.p2.toVector(),n=2*t.cross(e),s=2*e.cross(i),r=t.cross(i);return(n+r+s)/6}getTangentEnd(){return this.p2.eq(this.p1)?this.p1.sub(this.p0):this.p2.sub(this.p1)}getTangentStart(){return this.p1.eq(this.p0)?this.p2.sub(this.p1):this.p1.sub(this.p0)}getValueAt(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t);return e.lerp(i,t)}getVertexParameter(){let[t,e]=this.getDerivativeCoefficients();return t.dot(e.neg)/t.lengthSq}getWindingAt(t){let e=this.p0.y-t.y,i=this.p1.y-this.p0.y,n=this.p2.y-this.p1.y,s=$(n-i,i,e),r=0;return s.type===2&&(r+=gi(this,s.x1,t.x),r+=gi(this,s.x2,t.x)),r}intersectLine(t,e){let i=m.signedArea(t.p0,t.p1,this.p0),n=m.signedArea(t.p0,t.p1,this.p1),s=m.signedArea(t.p0,t.p1,this.p2),r=n-i,o=s-n,a=$(o-r,r,i);a.type===2&&(a.x1>=0&&a.x1<=1&&e.push(a.x1),a.x2>=0&&a.x2<=1&&e.push(a.x2))}intersectQuad(t,e){let i=new X(0,1),n=new X(0,1);xi(this,i,t,n,e)}isCollinear(){return this.getCurvatureMetric()===0}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()&&this.p2.isFinite()}isPoint(){return this.p0.eq(this.p1)&&this.p1.eq(this.p2)}reverse(){return new E(this.p2,this.p1,this.p0)}splitAfter(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=e.lerp(i,t);return new E(n,i,this.p2)}splitAt(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=e.lerp(i,t),s=new E(this.p0,e,n),r=new E(n,i,this.p2);return[s,r]}splitBefore(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=e.lerp(i,t);return new E(this.p0,e,n)}splitBetween(t,e){let i=this.p0.lerp(this.p1,t),n=this.p0.lerp(this.p1,e),s=this.p1.lerp(this.p2,t),r=this.p1.lerp(this.p2,e),o=i.lerp(s,t),a=n.lerp(r,t),c=n.lerp(r,e);return new E(o,a,c)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}, p2: ${this.p2}}`}},q=class{p0;p1;p2;p3;constructor(t,e,i,n){this.p0=t,this.p1=e,this.p2=i,this.p3=n}get pn(){return this.p3}get type(){return 2}static fromXY(t,e,i,n,s,r,o,a){let c=new m(t,e),h=new m(i,n),p=new m(s,r),l=new m(o,a);return new q(c,h,p,l)}getBounds(){let t=I.fromPoints(this.p0,this.p3),[e,i,n]=this.getDerivativeCoefficients(),s=$(e.x,.5*i.x,n.x),r=$(e.y,.5*i.y,n.y);return s.type===2&&(ct(this,t,s.x1),ct(this,t,s.x2)),r.type===2&&(ct(this,t,r.x1),ct(this,t,r.x2)),t}getCoefficients(){let t=this.p1.sub(this.p0),e=this.p2.sub(this.p1),n=this.p3.sub(this.p2).sub(e).sub(e).add(t),s=e.sub(t).mul(3),r=t.mul(3),o=this.p0;return[n,s,r,o]}getControlBounds(){let t=I.fromPoints(this.p0,this.p3);return t.enclose(this.p1),t.enclose(this.p2),t}getCurvatureAt(t){let[e,i,n]=this.getDerivativeCoefficients(),s=e.mul(t).add(i).mul(t).add(n),r=e.mul(2*t).add(i),o=s.length;return s.cross(r)/(o*o*o)}getCurvatureMetric(){let[t,e]=this.getDerivativeCoefficients();return t.cross(e)}getDerivativeAt(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=this.p2.lerp(this.p3,t),s=e.lerp(i,t),r=i.lerp(n,t);return s.sub(r).mul(3)}getDerivativeCoefficients(){let t=this.p1.sub(this.p0),e=this.p2.sub(this.p1),n=this.p3.sub(this.p2).sub(e).sub(e).add(t).mul(3),s=e.sub(t).mul(6),r=t.mul(3);return[n,s,r]}getEvoluteAt(t){let[e,i,n,s]=this.getCoefficients(),r=e.mul(t).add(i).mul(t).add(n).mul(t).addPt(s),o=e.mul(3*t).addMul(i,2).mul(t).add(n),a=e.mul(6*t).addMul(i,2);return r.addMul(o.normal,o.lengthSq/o.cross(a))}getInflectionParameter(){let[t,e,i]=this.getDerivativeCoefficients(),n,s,r=e.cross(t);return r!==0?(n=t.cross(i)/r,s=n*n+e.cross(i)/r,s>0&&(s=Math.sqrt(s))):(n=-.5*i.cross(e)/i.cross(t),s=Number.NaN),[n,s]}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector(),i=this.p2.toVector(),n=this.p3.toVector(),s=6*t.cross(e),r=6*i.cross(n),o=3*t.cross(i),a=3*e.cross(i),c=3*e.cross(n),h=t.cross(n);return(s+o+h+a+c+r)/20}getTangentEnd(){return this.p3.eq(this.p2)?this.p2.eq(this.p1)?this.p1.sub(this.p0):this.p2.sub(this.p1):this.p3.sub(this.p2)}getTangentStart(){return this.p1.eq(this.p0)?this.p2.eq(this.p1)?this.p3.sub(this.p2):this.p2.sub(this.p1):this.p1.sub(this.p0)}getValueAt(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=this.p2.lerp(this.p3,t),s=e.lerp(i,t),r=i.lerp(n,t);return s.lerp(r,t)}getWindingAt(t){let e=this.p0.y-t.y,i=this.p1.y-this.p0.y,n=this.p2.y-this.p1.y,s=this.p3.y-this.p2.y,r=fi(s-n-n+i,n-i,i,e),o=0;return r.type===3?(o+=jt(this,r.x1,t.x),o+=jt(this,r.x2,t.x),o+=jt(this,r.x3,t.x)):o+=jt(this,r.x,t.x),o}isCollinear(){return this.getCurvatureMetric()===0}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()&&this.p2.isFinite()&&this.p3.isFinite()}isPoint(){return this.p0.eq(this.p1)&&this.p1.eq(this.p2)&&this.p2.eq(this.p3)}reverse(){return new q(this.p3,this.p2,this.p1,this.p0)}splitAfter(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=this.p2.lerp(this.p3,t),s=e.lerp(i,t),r=i.lerp(n,t),o=s.lerp(r,t);return new q(this.p0,e,s,o)}splitAt(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=this.p2.lerp(this.p3,t),s=e.lerp(i,t),r=i.lerp(n,t),o=s.lerp(r,t),a=new q(this.p0,e,s,o),c=new q(o,r,n,this.p3);return[a,c]}splitBefore(t){let e=this.p0.lerp(this.p1,t),i=this.p1.lerp(this.p2,t),n=this.p2.lerp(this.p3,t),s=e.lerp(i,t),r=i.lerp(n,t),o=s.lerp(r,t);return new q(o,r,n,this.p3)}splitBetween(t,e){let i=this.p0.lerp(this.p1,t),n=this.p0.lerp(this.p1,e),s=this.p1.lerp(this.p2,t),r=this.p1.lerp(this.p2,e),o=this.p2.lerp(this.p3,t),a=this.p2.lerp(this.p3,e);return i=i.lerp(s,t),s=s.lerp(o,t),a=r.lerp(a,e),r=n.lerp(r,e),i=i.lerp(s,t),n=i.lerp(s,e),o=r.lerp(a,t),a=r.lerp(a,e),new q(i,n,o,a)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}, p2: ${this.p2},p2: ${this.p3}}`}},k=class{p0;p1;p2;w;constructor(t,e,i,n){this.p0=t,this.p1=e,this.p2=i,this.w=n}get pn(){return this.p2}get type(){return 3}static fromCenterPoint(t,e,i,n){let r=t.lerp(i,.5).sub(n).length,o=e.sub(n).length,a=Math.sqrt(r/o);return new k(t,e,i,a)}static fromProjectivePoints(t,e,i){let n=m.fromXYW(t.x,t.y,t.z),s=m.fromXYW(e.x,e.y,e.z),r=m.fromXYW(i.x,i.y,i.z),o=this.getNormalizedWeight(t.z,e.z,i.z);return new k(n,s,r,o)}static fromXY(t,e,i,n,s,r,o){let a=new m(t,e),c=new m(i,n),h=new m(s,r);return new k(a,c,h,o)}static getNormalizedWeight(t,e,i){return e/Math.sqrt(t*i)}static getWeightFromVectors(t,e,i){let n=e.sub(t),s=i.sub(t);return n.dot(s)/Math.sqrt(n.lengthSq*s.lengthSq)}getBounds(){let t=I.fromPoints(this.p0,this.p2),[e,i,n]=this.getDerivativeCoefficients(),s=$(e.x,.5*i.x,n.x),r=$(e.y,.5*i.y,n.y);return s.type===2&&(ct(this,t,s.x1),ct(this,t,s.x2)),r.type===2&&(ct(this,t,r.x1),ct(this,t,r.x2)),t}getControlBounds(){let t=I.fromPoints(this.p0,this.p2);return t.enclose(this.p1),t}getDerivativeCoefficients(){let t=this.p1.sub(this.p0),e=this.p2.sub(this.p0),i=this.w,n=e.mul(2*i-2),s=t.mul(-4*i).addMul(e,2),r=t.mul(2*i);return[n,s,r]}getProjectivePoints(){let t=S.fromXY(this.p0.x,this.p0.y),e=S.fromXYW(this.p1.x,this.p1.y,this.w),i=S.fromXY(this.p2.x,this.p2.y);return[t,e,i]}getSignedArea(){let t=this.p0.toVector(),e=this.p1.toVector(),i=this.p2.toVector(),n=this.w,s=t.cross(e),r=t.cross(i),o=e.cross(i),a=2**-23;if(n<1-a){if(n<=-1+a)return r/2;{let c=1-n*n,h=(1-n)/(1+n),p=Math.sqrt(c),l=Math.sqrt(h),d=n*n*(s+o)-r,b=2*n*(s+o-r),f=2*p*c;return(b*Math.atan(l)-d*p)/f}}else if(n<=1+a){let c=(2*s+r+2*o)/6,h=2/15*(r-s-o)*(n-1);return c-h}else{let c=n*n-1,h=(n-1)/(n+1),p=Math.sqrt(c),l=Math.sqrt(h),d=n*n*(s+o)-r,b=2*n*(s+o-r),f=2*p*c;return(d*p-b*Math.atanh(l))/f}}getTangentEnd(){return this.p2.eq(this.p1)?this.p1.sub(this.p0):this.p2.sub(this.p1)}getTangentStart(){return this.p1.eq(this.p0)?this.p2.sub(this.p1):this.p1.sub(this.p0)}getValueAt(t){let[e,i,n]=this.getProjectivePoints(),s=e.lerp(i,t),r=i.lerp(n,t),o=s.lerp(r,t);return m.fromXYW(o.x,o.y,o.z)}getWindingAt(t){let e=this.w*this.p1.y-this.w*t.y+t.y,i=this.p0.y-t.y,n=e-this.p0.y,s=this.p2.y-e,r=$(s-n,n,i),o=0;return r.type===2&&(o+=vi(this,r.x1,t.x),o+=vi(this,r.x2,t.x)),o}isFinite(){return this.p0.isFinite()&&this.p1.isFinite()&&this.p2.isFinite()&&Number.isFinite(this.w)}isPoint(){return this.p0.eq(this.p1)&&this.p1.eq(this.p2)}reverse(){return new k(this.p2,this.p1,this.p0,this.w)}splitAfter(t){let[e,i,n]=this.getProjectivePoints(),s=e.lerp(i,t),r=i.lerp(n,t),o=s.lerp(r,t);return k.fromProjectivePoints(e,s,o)}splitAt(t){let[e,i,n]=this.getProjectivePoints(),s=e.lerp(i,t),r=i.lerp(n,t),o=s.lerp(r,t),a=k.fromProjectivePoints(e,s,o),c=k.fromProjectivePoints(o,r,n);return[a,c]}splitBefore(t){let[e,i,n]=this.getProjectivePoints(),s=i.lerp(n,t),o=e.lerp(i,t).lerp(s,t);return k.fromProjectivePoints(o,s,n)}splitBetween(t,e){let[i,n,s]=this.getProjectivePoints(),r=i.lerp(n,t),o=i.lerp(n,e),a=n.lerp(s,t),c=n.lerp(s,e),h=r.lerp(a,t),p=o.lerp(c,t),l=o.lerp(c,e);return k.fromProjectivePoints(h,p,l)}toString(){return`{p0: ${this.p0}, p1: ${this.p1}, p2: ${this.p2}, w: ${this.w}}`}};var U=class{a;b;g;r;constructor(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}get style(){let t=this.clampFloatToHex(this.r),e=this.clampFloatToHex(this.g),i=this.clampFloatToHex(this.b),n=this.clampFloatToHex(this.a);return"#"+t+e+i+n}static fromHsv(t,e,i,n){let s=Math.floor(t*6),r=t*6-s,o=i*(1-e),a=i*(1-e*r),c=i*(1-e*(1-r));switch(s%6){case 0:return new U(i,c,o,n);case 1:return new U(a,i,o,n);case 2:return new U(o,i,c,n);case 3:return new U(o,a,i,n);case 4:return new U(c,o,i,n);case 5:return new U(i,o,a,n)}return new U(0,0,0,n)}static fromNumber(t){let e=t>>>0&255,i=t>>>8&255,n=t>>>16&255,s=t>>>24&255;return new U(s/255,n/255,i/255,e/255)}clampFloatToHex(t){return D(Math.round(255*t),0,255).toString(16).padStart(2,"0")}};var R=class{m11;m12;m13;m21;m22;m23;constructor(t,e,i,n,s,r){this.m11=t,this.m12=e,this.m13=i,this.m21=n,this.m22=s,this.m23=r}static get identity(){return new R(1,0,0,0,1,0)}static fromAffine(t,e,i,n){return new R(t,e,0,i,n,0)}static fromArray(t,e=0,i=!1){let n,s,r,o,a,c;return i?(n=t[e],o=t[e+1],s=t[e+2],a=t[e+3],r=t[e+4],c=t[e+5]):(n=t[e],s=t[e+1],r=t[e+2],o=t[e+3],a=t[e+4],c=t[e+5]),new R(n,s,r,o,a,c)}static fromRotation(t,e){return new R(e,-t,0,t,e,0)}static fromRotationAngle(t){let e=Math.sin(t),i=Math.cos(t);return R.fromRotation(e,i)}static fromScale(t,e){return new R(t,0,0,0,e,0)}static fromTranslation(t,e){return new R(1,0,t,0,1,e)}add(t){let e=this.m11+t.m11,i=this.m12+t.m12,n=this.m13+t.m13,s=this.m21+t.m21,r=this.m22+t.m22,o=this.m23+t.m23;return new R(e,i,n,s,r,o)}clone(){let t=this.m11,e=this.m12,i=this.m13,n=this.m21,s=this.m22,r=this.m23;return new R(t,e,i,n,s,r)}getDeterminant(){return this.m11*this.m22-this.m12*this.m21}getMaxScale(){let t=this.m11*this.m11+this.m12*this.m12,e=this.m11*this.m21+this.m12*this.m22,i=this.m21*this.m21+this.m22*this.m22,n=Pi(t,e,i);return Math.sqrt(n)}inverse(){let t=this.getDeterminant();if(t===0)return R.identity;let e=1/t,i=e*this.m22,n=e*-this.m12,s=e*(this.m12*this.m23-this.m13*this.m22),r=e*-this.m21,o=e*this.m11,a=e*(this.m13*this.m21-this.m11*this.m23);return new R(i,n,s,r,o,a)}mapPoint(t){let e=this.m11*t.x+this.m12*t.y+this.m13,i=this.m21*t.x+this.m22*t.y+this.m23;return new m(e,i)}mapVector(t){let e=this.m11*t.x+this.m12*t.y+this.m13,i=this.m21*t.x+this.m22*t.y+this.m23;return new v(e,i)}mul(t){let e=this.m11*t.m11+this.m12*t.m21,i=this.m11*t.m12+this.m12*t.m22,n=this.m11*t.m13+this.m12*t.m23+this.m13,s=this.m21*t.m11+this.m22*t.m21,r=this.m21*t.m12+this.m22*t.m22,o=this.m21*t.m13+this.m22*t.m23+this.m23;return new R(e,i,n,s,r,o)}rotateAnglePost(t){let e=Math.sin(t),i=Math.cos(t);this.rotatePost(e,i)}rotateAnglePre(t){let e=Math.sin(t),i=Math.cos(t);this.rotatePre(e,i)}rotateAngleSet(t){let e=Math.sin(t),i=Math.cos(t);this.rotateSet(e,i)}rotateAroundAnglePost(t,e,i){let n=Math.sin(t),s=Math.cos(t);this.rotateAroundPost(n,s,e,i)}rotateAroundAnglePre(t,e,i){let n=Math.sin(t),s=Math.cos(t);this.rotateAroundPre(n,s,e,i)}rotateAroundPost(t,e,i,n){this.translatePost(i,n),this.rotatePost(t,e),this.translatePost(-i,-n)}rotateAroundPre(t,e,i,n){this.translatePre(-i,-n),this.rotatePre(t,e),this.translatePre(i,n)}rotatePost(t,e){let i=this.m12*t+this.m11*e,n=this.m12*e-this.m11*t;this.m11=i,this.m12=n;let s=this.m22*t+this.m21*e,r=this.m22*e-this.m21*t;this.m21=s,this.m22=r}rotatePre(t,e){let i=this.m11*e-this.m21*t,n=this.m21*e+this.m11*t;this.m11=i,this.m21=n;let s=this.m12*e-this.m22*t,r=this.m22*e+this.m12*t;this.m12=s,this.m22=r;let o=this.m13*e-this.m23*t,a=this.m23*e+this.m13*t;this.m13=o,this.m23=a}rotateSet(t,e){this.set(e,-t,0,t,e,0)}scalePost(t,e){this.m11*=t,this.m21*=t,this.m12*=e,this.m22*=e}scalePre(t,e){this.m11*=t,this.m12*=t,this.m13*=t,this.m21*=e,this.m22*=e,this.m23*=e}scaleSet(t,e){this.set(t,0,0,0,e,0)}set(t,e,i,n,s,r){this.m11=t,this.m12=e,this.m13=i,this.m21=n,this.m22=s,this.m23=r}skewSet(t,e){this.set(1,t,0,e,1,0)}sub(t){let e=this.m11-t.m11,i=this.m12-t.m12,n=this.m13-t.m13,s=this.m21-t.m21,r=this.m22-t.m22,o=this.m23-t.m23;return new R(e,i,n,s,r,o)}toArray(t=!1){return t?[this.m11,this.m21,0,this.m12,this.m22,0,this.m13,this.m23,1]:[this.m11,this.m12,this.m13,this.m21,this.m22,this.m23,0,0,1]}toString(){return`{m11: ${this.m11}, m12: ${this.m12}, m13: ${this.m13},
 m21: ${this.m21}, m22: ${this.m22}, m23: ${this.m23}}`}translatePost(t,e){this.m13+=this.m11*t+this.m12*e,this.m23+=this.m21*t+this.m22*e}translatePre(t,e){this.m13+=t,this.m23+=e}translateSet(t,e){this.set(1,0,t,0,1,e)}},Y=class{m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(t,e,i,n,s,r,o,a,c){this.m11=t,this.m12=e,this.m13=i,this.m21=n,this.m22=s,this.m23=r,this.m31=o,this.m32=a,this.m33=c}static get identity(){return new Y(1,0,0,0,1,0,0,0,1)}static get zero(){return new Y(0,0,0,0,0,0,0,0,0)}static fromAffine(t,e,i,n){return new Y(t,e,0,i,n,0,0,0,1)}static fromArray(t,e=0,i=!1){let n,s,r,o,a,c,h,p,l;return i?(n=t[e],o=t[e+1],h=t[e+2],s=t[e+3],a=t[e+4],p=t[e+5],r=t[e+6],c=t[e+7],l=t[e+8]):(n=t[e],s=t[e+1],r=t[e+2],o=t[e+3],a=t[e+4],c=t[e+5],h=t[e+6],p=t[e+7],l=t[e+8]),new Y(n,s,r,o,a,c,h,p,l)}static fromRotation(t,e){return new Y(e,-t,0,t,e,0,0,0,1)}static fromRotationAngle(t){let e=Math.sin(t),i=Math.cos(t);return Y.fromRotation(e,i)}static fromScale(t,e){return new Y(t,0,0,0,e,0,0,0,1)}static fromTranslation(t,e){return new Y(1,0,t,0,1,e,0,0,1)}add(t){let e=this.m11+t.m11,i=this.m12+t.m12,n=this.m13+t.m13,s=this.m21+t.m21,r=this.m22+t.m22,o=this.m23+t.m23,a=this.m31+t.m31,c=this.m32+t.m32,h=this.m33+t.m33;return new Y(e,i,n,s,r,o,a,c,h)}clone(){let t=this.m11,e=this.m12,i=this.m13,n=this.m21,s=this.m22,r=this.m23,o=this.m31,a=this.m32,c=this.m33;return new Y(t,e,i,n,s,r,o,a,c)}getDeterminant(){let t=this.m11*(this.m22*this.m33-this.m23*this.m32),e=this.m12*(this.m21*this.m33-this.m23*this.m31),i=this.m13*(this.m21*this.m32-this.m22*this.m31);return t-e+i}getMaxScale(){let t=this.m11*this.m11+this.m12*this.m12,e=this.m11*this.m21+this.m12*this.m22,i=this.m21*this.m21+this.m22*this.m22,n=Pi(t,e,i);return Math.sqrt(n)}inverse(){let t=this.getDeterminant();if(t===0)return Y.identity;let e=1/t,i=e*(this.m22*this.m33-this.m23*this.m32),n=e*(this.m13*this.m32-this.m12*this.m33),s=e*(this.m12*this.m23-this.m13*this.m22),r=e*(this.m23*this.m31-this.m21*this.m33),o=e*(this.m11*this.m33-this.m13*this.m31),a=e*(this.m13*this.m21-this.m11*this.m23),c=e*(this.m21*this.m32-this.m22*this.m31),h=e*(this.m12*this.m31-this.m11*this.m32),p=e*(this.m11*this.m22-this.m12*this.m21);return new Y(i,n,s,r,o,a,c,h,p)}mapPoint(t){let e=this.m11*t.x+this.m12*t.y+this.m13,i=this.m21*t.x+this.m22*t.y+this.m23,n=this.m31*t.x+this.m32*t.y+this.m33;return m.fromXYW(e,i,n)}mapVector(t){let e=this.m11*t.x+this.m12*t.y+this.m13,i=this.m21*t.x+this.m22*t.y+this.m23,n=this.m31*t.x+this.m32*t.y+this.m33;return v.fromXYW(e,i,n)}mul(t){let e=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,i=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,n=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,s=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,r=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,o=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,a=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,c=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,h=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33;return new Y(e,i,n,s,r,o,a,c,h)}rotateAnglePost(t){let e=Math.sin(t),i=Math.cos(t);this.rotatePost(e,i)}rotateAnglePre(t){let e=Math.sin(t),i=Math.cos(t);this.rotatePre(e,i)}rotateAngleSet(t){let e=Math.sin(t),i=Math.cos(t);this.rotateSet(e,i)}rotateAroundAnglePost(t,e,i){let n=Math.sin(t),s=Math.cos(t);this.rotateAroundPost(n,s,e,i)}rotateAroundAnglePre(t,e,i){let n=Math.sin(t),s=Math.cos(t);this.rotateAroundPre(n,s,e,i)}rotateAroundPost(t,e,i,n){this.translatePost(i,n),this.rotatePost(t,e),this.translatePost(-i,-n)}rotateAroundPre(t,e,i,n){this.translatePre(-i,-n),this.rotatePre(t,e),this.translatePre(i,n)}rotatePost(t,e){let i=this.m12*t+this.m11*e,n=this.m12*e-this.m11*t;this.m11=i,this.m12=n;let s=this.m22*t+this.m21*e,r=this.m22*e-this.m21*t;this.m21=s,this.m22=r;let o=this.m32*t+this.m31*e,a=this.m32*e-this.m31*t;this.m31=o,this.m32=a}rotatePre(t,e){let i=this.m11*e-this.m21*t,n=this.m11*t+this.m21*e;this.m11=i,this.m21=n;let s=this.m12*e-this.m22*t,r=this.m12*t+this.m22*e;this.m12=s,this.m22=r;let o=this.m13*e-this.m23*t,a=this.m13*t+this.m23*e;this.m13=o,this.m23=a}rotateSet(t,e){this.set(e,-t,0,t,e,0,0,0,1)}scalePost(t,e){this.m11*=t,this.m21*=t,this.m31*=t,this.m12*=e,this.m22*=e,this.m32*=e}scalePre(t,e){this.m11*=t,this.m12*=t,this.m13*=t,this.m21*=e,this.m22*=e,this.m23*=e}scaleSet(t,e){this.set(t,0,0,0,e,0,0,0,1)}set(t,e,i,n,s,r,o,a,c){this.m11=t,this.m12=e,this.m13=i,this.m21=n,this.m22=s,this.m23=r,this.m31=o,this.m32=a,this.m33=c}skewSet(t,e){this.set(1,t,0,e,1,0,0,0,1)}sub(t){let e=this.m11-t.m11,i=this.m12-t.m12,n=this.m13-t.m13,s=this.m21-t.m21,r=this.m22-t.m22,o=this.m23-t.m23,a=this.m31-t.m31,c=this.m32-t.m32,h=this.m33-t.m33;return new Y(e,i,n,s,r,o,a,c,h)}toArray(t=!1){return t?[this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33]:[this.m11,this.m12,this.m13,this.m21,this.m22,this.m23,this.m31,this.m32,this.m33]}toString(){return`{m11: ${this.m11}, m12: ${this.m12}, m13: ${this.m13},
 m21: ${this.m21}, m22: ${this.m22}, m23: ${this.m23},
 m31: ${this.m31}, m32: ${this.m32}, m33: ${this.m33}}`}translatePost(t,e){this.m13+=this.m11*t+this.m12*e,this.m23+=this.m21*t+this.m22*e,this.m33+=this.m31*t+this.m32*e}translatePre(t,e){this.m11+=this.m31*t,this.m12+=this.m32*t,this.m13+=this.m33*t,this.m21+=this.m31*e,this.m22+=this.m32*e,this.m23+=this.m33*e}translateSet(t,e){this.set(1,0,t,0,1,e,0,0,1)}},O=class{m11;m12;m13;m14;m21;m22;m23;m24;m31;m32;m33;m34;m41;m42;m43;m44;constructor(t,e,i,n,s,r,o,a,c,h,p,l,d,b,f,w){this.m11=t,this.m12=e,this.m13=i,this.m14=n,this.m21=s,this.m22=r,this.m23=o,this.m24=a,this.m31=c,this.m32=h,this.m33=p,this.m34=l,this.m41=d,this.m42=b,this.m43=f,this.m44=w}static get identity(){return new O(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static get zero(){return new O(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}static fromArray(t,e=0,i=!1){let n,s,r,o,a,c,h,p,l,d,b,f,w,T,Z,tt;return i?(n=t[e],a=t[e+1],l=t[e+2],w=t[e+3],s=t[e+4],c=t[e+5],d=t[e+6],T=t[e+7],r=t[e+8],h=t[e+9],b=t[e+10],Z=t[e+11],o=t[e+12],p=t[e+13],f=t[e+14],tt=t[e+15]):(n=t[e],s=t[e+1],r=t[e+2],o=t[e+3],a=t[e+4],c=t[e+5],h=t[e+6],p=t[e+7],l=t[e+8],d=t[e+9],b=t[e+10],f=t[e+11],w=t[e+12],T=t[e+13],Z=t[e+14],tt=t[e+15]),new O(n,s,r,o,a,c,h,p,l,d,b,f,w,T,Z,tt)}static fromOrthographic(t,e,i,n,s,r){let o=e-t,a=i-n,c=r-s,h=2/o,p=-(e+t)/o,l=2/a,d=-(i+n)/a,b=-2/c,f=-(r+s)/c;return new O(h,0,0,p,0,l,0,d,0,0,b,f,0,0,0,1)}static fromPerspective(t,e,i,n,s,r){let o=e-t,a=i-n,c=r-s,h=2*s/o,p=(e+t)/o,l=2*s/a,d=(i+n)/a,b=(s+r)/c,f=2*s*r/c;return new O(h,0,p,0,0,l,d,0,0,0,b,f,0,0,-1,0)}static fromPerspectiveFrustum(t,e,i,n){let s=i*Math.tan(t*(Math.PI/360)),r=2*s,o=e*r,a=-.5*o;return this.fromPerspective(a,a+o,s,s-r,i,n)}static fromRotationX(t,e){return new O(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1)}static fromRotationXAngle(t){let e=Math.sin(t),i=Math.cos(t);return O.fromRotationX(e,i)}static fromRotationY(t,e){return new O(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1)}static fromRotationYAngle(t){let e=Math.sin(t),i=Math.cos(t);return O.fromRotationX(e,i)}static fromRotationZ(t,e){return new O(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1)}static fromRotationZAngle(t){let e=Math.sin(t),i=Math.cos(t);return O.fromRotationX(e,i)}static fromScale(t,e,i){return new O(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)}static fromTranslation(t,e,i){return new O(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)}add(t){let e=this.m11+t.m11,i=this.m12+t.m12,n=this.m13+t.m13,s=this.m14+t.m14,r=this.m21+t.m21,o=this.m22+t.m22,a=this.m23+t.m23,c=this.m24+t.m24,h=this.m31+t.m31,p=this.m32+t.m32,l=this.m33+t.m33,d=this.m34+t.m34,b=this.m41+t.m41,f=this.m42+t.m42,w=this.m43+t.m43,T=this.m44+t.m44;return new O(e,i,n,s,r,o,a,c,h,p,l,d,b,f,w,T)}clone(){let t=this.m11,e=this.m12,i=this.m13,n=this.m14,s=this.m21,r=this.m22,o=this.m23,a=this.m24,c=this.m31,h=this.m32,p=this.m33,l=this.m34,d=this.m41,b=this.m42,f=this.m43,w=this.m44;return new O(t,e,i,n,s,r,o,a,c,h,p,l,d,b,f,w)}getMaxScale(){let t=this.m11*this.m11+this.m12*this.m12+this.m13*this.m13,e=this.m11*this.m21+this.m12*this.m22+this.m13*this.m23,i=this.m11*this.m31+this.m12*this.m32+this.m13*this.m33,n=this.m21*this.m21+this.m22*this.m22+this.m23*this.m23,s=this.m21*this.m31+this.m22*this.m32+this.m23*this.m33,r=this.m31*this.m31+this.m32*this.m32+this.m33*this.m33,o=Ui(t,e,i,n,s,r);return Math.sqrt(o)}mapPoint(t){let e=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,i=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,n=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34,s=this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44;return S.fromXYZW(e,i,n,s)}mapVector(t){let e=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,i=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,n=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34,s=this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44;return z.fromXYZW(e,i,n,s)}mul(t){let e=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31+this.m14*t.m41,i=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32+this.m14*t.m42,n=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33+this.m14*t.m43,s=this.m11*t.m14+this.m12*t.m24+this.m13*t.m34+this.m14*t.m44,r=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31+this.m24*t.m41,o=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32+this.m24*t.m42,a=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33+this.m24*t.m43,c=this.m21*t.m14+this.m22*t.m24+this.m23*t.m34+this.m24*t.m44,h=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31+this.m34*t.m41,p=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32+this.m34*t.m42,l=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33+this.m34*t.m43,d=this.m31*t.m14+this.m32*t.m24+this.m33*t.m34+this.m34*t.m44,b=this.m41*t.m11+this.m42*t.m21+this.m43*t.m31+this.m44*t.m41,f=this.m41*t.m12+this.m42*t.m22+this.m43*t.m32+this.m44*t.m42,w=this.m41*t.m13+this.m42*t.m23+this.m43*t.m33+this.m44*t.m43,T=this.m41*t.m14+this.m42*t.m24+this.m43*t.m34+this.m44*t.m44;return new O(e,i,n,s,r,o,a,c,h,p,l,d,b,f,w,T)}rotateAroundAnglePost(t,e,i,n,s,r){let o=Math.sin(t),a=Math.cos(t),c=Math.sin(e),h=Math.cos(e),p=Math.sin(i),l=Math.cos(i);this.rotateAroundPost(o,a,c,h,p,l,n,s,r)}rotateAroundAnglePre(t,e,i,n,s,r){let o=Math.sin(t),a=Math.cos(t),c=Math.sin(e),h=Math.cos(e),p=Math.sin(i),l=Math.cos(i);this.rotateAroundPre(o,a,c,h,p,l,n,s,r)}rotateAroundPost(t,e,i,n,s,r,o,a,c){this.translatePost(o,a,c),this.rotateXPost(t,e),this.rotateYPost(i,n),this.rotateZPost(s,r),this.translatePost(-o,-a,-c)}rotateAroundPre(t,e,i,n,s,r,o,a,c){this.translatePre(o,a,c),this.rotateXPre(t,e),this.rotateYPre(i,n),this.rotateZPre(s,r),this.translatePre(-o,-a,-c)}rotateXAnglePost(t){let e=Math.sin(t),i=Math.cos(t);this.rotateXPost(e,i)}rotateXAnglePre(t){let e=Math.sin(t),i=Math.cos(t);this.rotateXPre(e,i)}rotateXAngleSet(t){let e=Math.sin(t),i=Math.cos(t);this.rotateXSet(e,i)}rotateXPost(t,e){let i=this.m13*t+this.m12*e,n=this.m13*e-this.m12*t;this.m12=i,this.m13=n;let s=this.m23*t+this.m22*e,r=this.m23*e-this.m22*t;this.m22=s,this.m23=r;let o=this.m33*t+this.m32*e,a=this.m33*e-this.m32*t;this.m32=o,this.m33=a;let c=this.m43*t+this.m42*e,h=this.m43*e-this.m42*t;this.m42=c,this.m43=h}rotateXPre(t,e){let i=this.m21*e-this.m31*t,n=this.m21*t+this.m31*e;this.m21=i,this.m31=n;let s=this.m22*e-this.m32*t,r=this.m22*t+this.m32*e;this.m22=s,this.m32=r;let o=this.m23*e-this.m33*t,a=this.m23*t+this.m33*e;this.m23=o,this.m33=a;let c=this.m24*e-this.m34*t,h=this.m24*t+this.m34*e;this.m24=c,this.m34=h}rotateXSet(t,e){this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1)}rotateYAnglePost(t){let e=Math.sin(t),i=Math.cos(t);this.rotateYPost(e,i)}rotateYAnglePre(t){let e=Math.sin(t),i=Math.cos(t);this.rotateYPre(e,i)}rotateYAngleSet(t){let e=Math.sin(t),i=Math.cos(t);this.rotateYSet(e,i)}rotateYPost(t,e){let i=this.m11*e-this.m13*t,n=this.m11*t+this.m13*e;this.m11=i,this.m13=n;let s=this.m21*e-this.m23*t,r=this.m21*t+this.m23*e;this.m21=s,this.m23=r;let o=this.m31*e-this.m33*t,a=this.m31*t+this.m33*e;this.m31=o,this.m33=a;let c=this.m41*e-this.m43*t,h=this.m41*t+this.m43*e;this.m41=c,this.m43=h}rotateYPre(t,e){let i=this.m31*t+this.m11*e,n=this.m31*e-this.m11*t;this.m11=i,this.m31=n;let s=this.m32*t+this.m12*e,r=this.m32*e-this.m12*t;this.m12=s,this.m32=r;let o=this.m33*t+this.m13*e,a=this.m33*e-this.m13*t;this.m13=o,this.m33=a;let c=this.m34*t+this.m14*e,h=this.m34*e-this.m14*t;this.m14=c,this.m34=h}rotateYSet(t,e){this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1)}rotateZAnglePost(t){let e=Math.sin(t),i=Math.cos(t);this.rotateZPost(e,i)}rotateZAnglePre(t){let e=Math.sin(t),i=Math.cos(t);this.rotateZPre(e,i)}rotateZAngleSet(t){let e=Math.sin(t),i=Math.cos(t);this.rotateZSet(e,i)}rotateZPost(t,e){let i=this.m12*t+this.m11*e,n=this.m12*e-this.m11*t;this.m11=i,this.m12=n;let s=this.m22*t+this.m21*e,r=this.m22*e-this.m21*t;this.m21=s,this.m22=r;let o=this.m32*t+this.m31*e,a=this.m32*e-this.m31*t;this.m31=o,this.m32=a;let c=this.m42*t+this.m41*e,h=this.m42*e-this.m41*t;this.m41=c,this.m42=h}rotateZPre(t,e){let i=this.m11*e-this.m21*t,n=this.m11*t+this.m21*e;this.m11=i,this.m21=n;let s=this.m12*e-this.m22*t,r=this.m12*t+this.m22*e;this.m12=s,this.m22=r;let o=this.m13*e-this.m23*t,a=this.m13*t+this.m23*e;this.m13=o,this.m23=a;let c=this.m14*e-this.m24*t,h=this.m14*t+this.m24*e;this.m14=c,this.m24=h}rotateZSet(t,e){this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1)}scalePost(t,e,i){this.m11*=t,this.m21*=t,this.m31*=t,this.m41*=t,this.m12*=e,this.m22*=e,this.m32*=e,this.m42*=e,this.m13*=i,this.m23*=i,this.m33*=i,this.m43*=i}scalePre(t,e,i){this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m21*=e,this.m22*=e,this.m23*=e,this.m24*=e,this.m31*=i,this.m32*=i,this.m33*=i,this.m34*=i}scaleSet(t,e,i){this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)}set(t,e,i,n,s,r,o,a,c,h,p,l,d,b,f,w){this.m11=t,this.m12=e,this.m13=i,this.m14=n,this.m21=s,this.m22=r,this.m23=o,this.m24=a,this.m31=c,this.m32=h,this.m33=p,this.m34=l,this.m41=d,this.m42=b,this.m43=f,this.m44=w}sub(t){let e=this.m11-t.m11,i=this.m12-t.m12,n=this.m13-t.m13,s=this.m14-t.m14,r=this.m21-t.m21,o=this.m22-t.m22,a=this.m23-t.m23,c=this.m24-t.m24,h=this.m31-t.m31,p=this.m32-t.m32,l=this.m33-t.m33,d=this.m34-t.m34,b=this.m41-t.m41,f=this.m42-t.m42,w=this.m43-t.m43,T=this.m44-t.m44;return new O(e,i,n,s,r,o,a,c,h,p,l,d,b,f,w,T)}toArray(t=!1){return t?[this.m11,this.m21,this.m31,this.m41,this.m12,this.m22,this.m32,this.m42,this.m13,this.m23,this.m33,this.m43,this.m14,this.m24,this.m34,this.m44]:[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44]}toString(){return`{m11: ${this.m11}, m12: ${this.m12}, m13: ${this.m13}, m14: ${this.m14},
 m21: ${this.m21}, m22: ${this.m22}, m23: ${this.m23}, m24: ${this.m24},
 m31: ${this.m31}, m32: ${this.m32}, m33: ${this.m33}, m34: ${this.m34},
 m41: ${this.m41}, m42: ${this.m42}, m43: ${this.m43}, m44: ${this.m44}}`}translatePost(t,e,i){this.m14+=this.m11*t+this.m12*e+this.m13*i,this.m24+=this.m21*t+this.m22*e+this.m23*i,this.m34+=this.m31*t+this.m32*e+this.m33*i,this.m44+=this.m41*t+this.m42*e+this.m43*i}translatePre(t,e,i){this.m11+=this.m41*t,this.m12+=this.m42*t,this.m13+=this.m43*t,this.m14+=this.m44*t,this.m21+=this.m41*e,this.m22+=this.m42*e,this.m23+=this.m43*e,this.m24+=this.m44*e,this.m31+=this.m41*i,this.m32+=this.m42*i,this.m33+=this.m43*i,this.m34+=this.m44*i}translateSet(t,e,i){this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)}};var V=class{points;constructor(t=[]){this.points=t}static isAreaIntersection(t,e,i){return!!(this.isEdgeIntersection(t,e)||this.isPointInside(t,e.points[0],i)||this.isPointInside(e,t.points[0],i))}static isEdgeIntersection(t,e){for(let i of t.getEdgeIterator())for(let n of e.getEdgeIterator())if(y.isIntersection(i,n))return!0;return!1}static isPointInside(t,e,i){let n=0;for(let s of t.getEdgeIterator())n+=s.toBezier().getWindingAt(e);return i||(n=n&1),n!==0}static isPolygonInside(t,e,i=!1){for(let n of e.points)if(!this.isPointInside(t,n,i))return!1;return!0}addPoint(t){this.points.push(t)}addXY(t,e){this.addPoint(new m(t,e))}clear(){this.points=[]}findClosestEdgePoint(t){let e=Number.POSITIVE_INFINITY,i;for(let n of this.getEdgeIterator()){let s=n.getClosestPoint(t).sub(t).lengthSq;s<e&&(e=s,i=n)}return i}getBounds(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let s of this.points)t=Math.min(t,s.x),e=Math.min(e,s.y),i=Math.max(i,s.x),n=Math.max(n,s.y);return new I(t,e,i,n)}getCentroid(){let t=0,e=0;for(let n of this.points)t+=n.x,e+=n.y;let i=this.points.length;return new m(t/i,e/i)}getConvexHull(){let t=this.points[0];for(let n=1;n<this.points.length;n++){let s=this.points[n];(s.y===t.y?s.x<t.x:s.y<t.y)&&(t=s)}let e=this.points.slice();e.sort((n,s)=>n.sub(t).angle-s.sub(t).angle);let i=2;for(;i<e.length;){let n=e[i-2],s=e[i-1],r=e[i-0],o=n.sub(s),a=n.sub(r);o.cross(a)>0?i++:(i--,e.splice(i,1))}return new V(e)}getEdgeIterator(){return new ce(this.points)}getEdges(){let t=[];for(let e of this.getEdgeIterator())t.push(e);return t}getOrientation(){let t=0;for(let e of this.getEdgeIterator())t+=e.p0.toVector().cross(e.p1.toVector());return t}getOrientedBoundingBox(){let t=Number.POSITIVE_INFINITY,e=[m.zero,m.zero,m.zero,m.zero],i=this.getConvexHull();for(let n of i.getEdgeIterator()){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;for(let d of i.points){let b=n.getParameterFromPoint(d),f=n.getSignedDistanceFromPoint(d);s=Math.min(s,b),r=Math.max(r,b),o=Math.min(o,f)}let a=n.getValueAt(s),c=n.getValueAt(r),h=c.sub(a),p=h.unit.normal.mul(o),l=h.cross(p);l<t&&(e[0]=a,e[1]=a.add(p),e[2]=c.add(p),e[3]=c,t=l)}return new V(e)}getPoints(){return this.points}hasPoints(){return this.points.length>0}isConvex(){let t=this.points.length,e=this.points[t-1],i=this.points[t-2],n=!1,s=!1;for(let r=0;r<t;r++){let o=this.points[r],a=e.sub(o).cross(i.sub(e));if(a>0?n=!0:a<0&&(s=!0),s&&n)return!1;i=e,e=o}return!0}isSimple(){for(let t of this.getEdgeIterator())for(let e of this.getEdgeIterator())if(t!==e&&!y.isAdjacent(t,e)&&y.isIntersection(t,e))return!1;return!0}reverse(){this.points.reverse()}toPath(){let t=new P;if(this.points.length>0){t.moveTo(this.points[0]);for(let e=1;e<this.points.length;e++)t.lineTo(this.points[e]);t.close()}return t}transform(t){let e=this.points;for(let i=0;i<e.length;i++)e[i]=t.mapPoint(e[i])}};function ct(u,t,e){e>0&&e<1&&t.enclose(u.getValueAt(e))}function Jt(u,t,e,i){if(e>0&&e<1){let n=u.getValueAt(e).sub(t).lengthSq;n<i.distSq&&(i.param=e,i.distSq=n)}}function Qi(u,t,e){if(t<0||t>1)return 0;let i=lt(u.p0.x,u.p1.x,t),n=u.p0.y-u.p1.y;return he(e,i,n)}function gi(u,t,e){if(t<0||t>1)return 0;let i=u.p0.lerp(u.p1,t),n=u.p1.lerp(u.p2,t),s=lt(i.x,n.x,t),r=i.y-n.y;return he(e,s,r)}function jt(u,t,e){if(t<0||t>1)return 0;let i=u.p0.lerp(u.p1,t),n=u.p1.lerp(u.p2,t),s=u.p2.lerp(u.p3,t),r=i.lerp(n,t),o=n.lerp(s,t),a=lt(r.x,o.x,t),c=r.y-o.y;return he(e,a,c)}function vi(u,t,e){if(t<0||t>1)return 0;let[i,n,s]=u.getProjectivePoints(),r=i.lerp(n,t),o=n.lerp(s,t),a=r.lerp(o,t),c=a.x/a.z,h=a.y*(o.z-r.z)-a.z*(o.y-r.y);return he(e,c,h)}function he(u,t,e){return u<t||e===0?0:e<0?-1:1}function ue(u,t,e,i,n,s){let r=8881784197001252e-31;if(n.intersects(t))if(n=n.clamp(t.a,t.b),g.infoDebug("Intersection candidate: [{}, {}]",n.a,n.b),n.diameter<r){let o=n.mid;g.infoDebug("Intersection found at t = {} (Diam: {})",o,n.diameter),s.push(u.getValueAt(n.mid))}else xi(e,i,u,n,s)}function xi(u,t,e,i,n){let s=e.splitBetween(i.a,i.b),r=.5*m.signedArea(s.p0,s.p2,s.p1),o=m.signedArea(s.p0,s.p2,u.p0),a=m.signedArea(s.p0,s.p2,u.p1),c=m.signedArea(s.p0,s.p2,u.p2),h=a-o,p=c-a,l=Math.min(0,r),d=Math.max(0,r),b=$(p-h,h,o-l),f=$(p-h,h,o-d);if(b.type===2&&f.type===2){let w=X.fromUnordered(b.x1,f.x1),T=X.fromUnordered(b.x2,f.x2);ue(u,t,e,i,w,n),ue(u,t,e,i,T,n)}else if(b.type===2){let w=X.fromUnordered(b.x1,b.x2);ue(u,t,e,i,w,n)}else if(f.type===2){let w=X.fromUnordered(f.x1,f.x2);ue(u,t,e,i,w,n)}}var Nt=class{curr;last;wasLast;constructor(t,e){this.curr=t,this.last=e,this.wasLast=!1}[Symbol.iterator](){return this}next(){let t=this.wasLast,e=this.curr;return this.wasLast=this.last===e||t,this.curr=e.lnext,{done:t,value:e}}},pe=class{curr;last;wasLast;constructor(t,e){this.curr=t,this.last=e,this.wasLast=!1}[Symbol.iterator](){return this}next(){let t=this.wasLast,e=this.curr;return this.wasLast=this.last===e||t,this.curr=e.onext,{done:t,value:e}}},le=class{cIdx;commands;p0;pIdx;points;ps;constructor(t,e){this.commands=t,this.points=e,this.cIdx=0,this.pIdx=0,this.ps=m.zero,this.p0=m.zero}[Symbol.iterator](){return this}next(){let t=this.commands,e=this.points;for(;this.cIdx<t.length;){let i=t[this.cIdx++];switch(i.type){case 0:{this.ps=e[this.pIdx++],this.p0=this.ps;break}case 1:{let n=new C(this.p0,e[this.pIdx++]);return this.p0=n.p1,{done:!1,value:n}}case 2:{let n=new E(this.p0,e[this.pIdx++],e[this.pIdx++]);return this.p0=n.p2,{done:!1,value:n}}case 3:{let n=new q(this.p0,e[this.pIdx++],e[this.pIdx++],e[this.pIdx++]);return this.p0=n.p3,{done:!1,value:n}}case 4:{let n=new k(this.p0,e[this.pIdx++],e[this.pIdx++],i.w);return this.p0=n.p2,{done:!1,value:n}}case 5:{let n=new C(this.p0,this.ps);if(this.p0=n.p1,!n.isPoint())return{done:!1,value:n};break}default:B(i)}}return{done:!0,value:void 0}}},ce=class{idx;points;constructor(t){this.points=t,this.idx=1}[Symbol.iterator](){return this}next(){let t=this.points,e=this.idx;if(e<t.length){let i=new y(t[e-1],t[e]);return this.idx+=1,{done:!1,value:i}}else if(e===t.length){let i=new y(t[e-1],t[0]);return this.idx+=1,{done:!1,value:i}}else return{done:!0,value:void 0}}};function Pi(u,t,e){let i=u+e,n=u*e-t*t;return .5*(Math.sqrt(i*i-4*n)+i)}function Ui(u,t,e,i,n,s){let r=2*(t*t+e*e+n*n);if(r===0)return Math.max(u,i,s);let o=(u+i+s)/3,a=u-o,c=i-o,h=s-o,p=a*a+c*c+h*h,l=Math.sqrt((r+p)/6),d=a*(c*h-n*n),b=t*(t*h-e*n),f=e*(t*n-e*c),T=(d-b+f)/(2*l*l*l),Z;return T>=1?Z=0:T<=-1?Z=Math.PI:Z=Math.acos(T),2*l*Math.cos(Z/3)+o}function yi(u,t,e,i,n){A(n<=u.length-t,"Parameter 'length' must be smaller or equal to length of 'src' to avoid over-read");let s=t,r=t+n-1,o=i,a=!1;for(u[t]?.type===0&&(e[o++]={type:0},s+=1),u[r]?.type===5&&(a=!0,r-=1);r>=s;){let c=u[r--];c.type===0?(a&&(e[o++]={type:5}),e[o++]={type:0},a=!1):c.type===5?(e[o++]={type:0},a=!0):e[o++]=c}a&&(e[o++]={type:5})}var _t=class{currentIndex;currentLength;currentPhase;dashArray;isFirst;output;path;pathFirst;startAdvancedLength;startIndex;startPhase;constructor(){this.currentIndex=0,this.currentLength=0,this.currentPhase=!1,this.dashArray=[],this.isFirst=!0,this.output=new P,this.startAdvancedLength=0,this.startIndex=0,this.startPhase=!1;let t=new P;this.path=t,this.pathFirst=t}dashDegenerateQuad(t,e,i){let n=new E(t,e,e),s=new E(e,e,i);this.dashQuadraticSimple(n),this.dashQuadraticSimple(s)}dashFirst(t,e){this.currentPhase&&e.isZero()&&this.insertMove(t)}dashLinear(t){let e=t,i=this.getDashLength()-this.currentLength,n=Qt(e);for(;i<n;){let s=Ci(e,i);e=e.splitAfter(s),n=Qt(e),this.currentPhase?this.insertLinear(e.p0):this.insertMove(e.p0),this.advance(),i=this.getDashLength()}this.currentLength+=n,this.currentPhase&&this.insertLinear(e.p1)}dashQuadraticSimple(t){let e=t,i=this.getDashLength()-this.currentLength,n=Ut(e);for(;i<n;){let s=Ei(e,i),[r,o]=e.splitAt(s);n=Ut(o),this.currentPhase?this.insertQuadratic(r.p1,r.p2):this.insertMove(o.p0),this.advance(),i=this.getDashLength(),e=o}this.currentLength+=n,this.currentPhase&&this.insertQuadratic(e.p1,e.p2)}finalizeClosed(t){this.startPhase&&t.addPath(this.pathFirst,this.currentPhase),this.reset()}finalizeOpen(t){this.startPhase&&t.addPath(this.pathFirst,!1),this.reset()}initialize(t,e){this.dashArray=e.array;let[i,n,s]=wi(e.array,e.offset);this.startAdvancedLength=i,this.startIndex=n,this.startPhase=s,this.output=t,this.reset()}advance(){let t=de(this.dashArray,this.currentIndex);this.currentLength=0,this.currentIndex=t,this.currentPhase=!this.currentPhase,this.isFirst&&(this.isFirst=!1,this.path=this.output)}getDashLength(){return this.dashArray[this.currentIndex]}insertLinear(t){this.path.lineTo(t)}insertMove(t){this.path.moveTo(t)}insertQuadratic(t,e){this.path.quadTo(t,e)}reset(){this.pathFirst.clear(),this.currentIndex=this.startIndex,this.currentLength=this.startAdvancedLength,this.startPhase?(this.path=this.pathFirst,this.currentPhase=!0,this.isFirst=!0):(this.path=this.output,this.currentPhase=!1,this.isFirst=!1)}};function de(u,t){return(t+1)%u.length}function wi(u,t){let e=2*bn(u),i=t%e;i<0&&(i+=e);let n=0,s=!0;for(e=u[n];i>=e;)i-=e,n=de(u,n),s=!s,e=u[n];return e=i,[e,n,s]}function Qt(u){return u.p1.sub(u.p0).length}function Ut(u){let t=0,[e,i]=u.getDerivativeCoefficients();return t+=me(.1739274225687269,.06943184420297371,e,i),t+=me(.3260725774312731,.3300094782075719,e,i),t+=me(.3260725774312731,.6699905217924281,e,i),t+=me(.1739274225687269,.9305681557970263,e,i),t}function Ci(u,t){return t/Qt(u)}function Ei(u,t){let e=Wi(u,t);if(e<1){let[i,n]=u.splitAt(e),s=t-Ut(i);e+=(1-e)*Wi(n,s)}return e}function me(u,t,e,i){return e.mul(t).add(i).mul(u).length}function bn(u){let t=0;for(let e of u)t+=e;return t}function Wi(u,t){let e=u.p1.sub(u.p0).length,i=u.p2.sub(u.p1).length,n=$(i-e,e,-t);return n.type!==0?n.x1:(e+i)/t}function Wt(u,t,e){let i=t.getTangentStart(),n=t.getTangentEnd();i.isZero()||(i=i.unit.normal,n=n.unit.normal,i=i.add(n),i=i.mul(2*e).div(i.lengthSq),n=n.mul(e),u.quadTo(t.p1.add(i),t.p2.add(n)))}function Si(u,t,e,i,n){let s=new E(t,e,e),r=new E(e,e,i),o=e.sub(t).unit.normal,a=i.sub(e).unit.normal;Wt(u,s,n),gt(u,e,o,a,n,0,3),Wt(u,r,n)}function Ti(u,t,e,i,n,s,r){let o=e.unit.normal,a=i.unit.normal;o.dot(a)<ve&&(n*o.cross(a)>=0?gt(u,t,o,a,n,s,r):be(u,t,a,n))}function gt(u,t,e,i,n,s,r){switch(s*=Math.abs(n),r){case 0:{u.lineTo(t.addMul(i,n));break}case 1:{let o=e.add(i);o=o.mul(2*n).div(o.lengthSq),o.lengthSq<=s*s&&u.lineTo(t.add(o)),u.lineTo(t.addMul(i,n));break}case 2:{let o=e.add(i);o=o.mul(2*n).div(o.lengthSq);let a=t.addMul(e,n),c=t.addMul(i,n);if(o.lengthSq<=s*s)u.lineTo(t.add(o));else if(e.dot(i)<=ge)u.lineTo(a.addMul(e.normal,-s)),u.lineTo(c.addMul(i.normal,s));else{let h=o.dot(t.sub(a)),p=o.dot(o),l=(h+s*Math.sqrt(p))/(h+p);if(l>0){let d=t.add(o);u.lineTo(a.lerp(d,l)),u.lineTo(c.lerp(d,l))}}u.lineTo(c);break}case 3:{let o=t.addMul(e,n),a=t.addMul(i,n);if(e.dot(i)<0){let c=a.sub(o).unit.normal,h=e.add(c);h=h.mul(2*n).div(h.lengthSq);let p=t.add(h),l=t.addMul(c,n),d=p.lerp(l,2),b=k.getWeightFromVectors(t,p,l);u.conicTo(p,l,b),u.conicTo(d,a,b)}else{let c=e.add(i);c=c.mul(2*n).div(c.lengthSq);let h=t.add(c),p=k.getWeightFromVectors(t,h,a);u.conicTo(h,a,p)}break}default:B(r)}}function be(u,t,e,i){u.lineTo(t),u.lineTo(t.addMul(e,i))}var nt=class{left;p0;p1;seg;wind;constructor(t,e,i,n,s){this.p0=t,this.p1=e,this.seg=i,this.wind=n,this.left=s}static compareQueue(t,e){return t.p0.x!==e.p0.x?t.p0.x-e.p0.x:t.p0.y!==e.p0.y?t.p0.y-e.p0.y:t.left!==e.left?t.left?1:-1:t.left?m.signedArea(t.p1,t.p0,e.p1):m.signedArea(t.p0,t.p1,e.p1)}static compareStatus(t,e){return t.p0.eq(e.p0)?t.p1.eq(e.p1)?0:m.signedArea(t.p1,t.p0,e.p1):nt.compareQueue(t,e)<0?m.signedArea(t.p1,t.p0,e.p0):m.signedArea(e.p0,e.p1,t.p0)}eq(t){return this.p0.eq(t.p0)&&this.p1.eq(t.p1)}printDebug(){g.infoDebug("{} -> {} ({}, id = {}, winding = {})",this.p0,this.p1,this.left?"left":"right",this.seg.ref.data,this.wind)}};function xe(u){u.process(),g.assertFn(()=>u.validate(),"PathClip2: Validation failed");let t=[];u.writeEdgeSegmentsTo(t);let e=[];for(let i of t){let n=i.p0,s=i.p1,r=i.ref.weight;n.eq(s)||(n.lt(s)?(e.push(new nt(n,s,i,r,!0)),e.push(new nt(s,n,i,r,!1))):(e.push(new nt(s,n,i,-r,!0)),e.push(new nt(n,s,i,-r,!1))))}return e.sort(nt.compareQueue),e}function te(u,t,e){let i=!1,n=!1;switch(e){case 0:{i=u!==0,n=t!==0;break}case 1:{i=(u&1)!==0,n=(t&1)!==0;break}case 2:{i=u>0,n=t>0;break}case 3:{i=u<0,n=t<0;break}default:{i=e(u),n=e(t);break}}return[i,n]}function Yi(u,t,e,i,n){let s=!1,r=!1;switch(n){case 0:{s=!u&&!e&&(t||i),r=!t&&!i&&(u||e);break}case 1:{s=t&&i&&(!u||!e),r=u&&e&&(!t||!i);break}case 2:{s=u===e&&t!==i,r=u!==e&&t===i;break}case 3:{s=t&&!i&&(!u||e),r=u&&!e&&(!t||i);break}case 4:{s=!t&&i&&(u||!e),r=!u&&e&&(t||!i);break}}return[s,r]}var Dt=class{map;constructor(){this.map=new Map}collectData(t){let e={tag:[],refs:[]},i={tag:[],refs:[]};for(let[n,s]of this.map.entries()){let r=s.w0+s.w1,o=s.w1,[a,c]=te(r,o,t);a&&(e.tag.push(n),e.refs.push(...s.refs)),c&&(i.tag.push(n),i.refs.push(...s.refs))}return e.tag.sort(Dt.compareTag),i.tag.sort(Dt.compareTag),[e,i]}getEntry(t){let e=this.map.get(t);if(e!==void 0)return e;{let i={w0:0,w1:0,refs:[]};return this.map.set(t,i),i}}reset(){this.map.clear()}static compareTag(t,e){return t-e}};function Yt(u,t){let e=u.p1.sub(u.p0),i=u.p2.sub(u.p1);return e.dot(i)>t*Math.sqrt(e.lengthSq*i.lengthSq)}function vt(u,t){let[e,i]=u.getDerivativeCoefficients();return t*i.lengthSq/(Math.abs(e.cross(i))-t*e.dot(i))}function St(u){let t=u.p1.sub(u.p0),e=u.p2.sub(u.p1);return u.p3.sub(u.p2).sub(e).sub(e).add(t).length}function mt(u,t,e){let i=u.p1.sub(u.p0),n=u.p2.sub(u.p1),r=u.p3.sub(u.p2).sub(n).sub(n).add(i),o=t*e;return Math.pow(o*o/r.lengthSq,1/6)}function Tt(u,t){let e=u.p1.sub(u.p0),i=u.p2.sub(u.p1);return Math.abs(u.w-1)*i.sub(e).length<t*(u.w+1)}function dt(u,t,e){let i=u.p1.sub(u.p0),s=u.p2.sub(u.p1).sub(i),r=t*e*(u.w+1);return Math.pow(r/(Math.abs(u.w-1)*s.length),1/4)}function Ai(u){let t=u.p0.lerp(u.p1,1.5),e=u.p3.lerp(u.p2,1.5),i=t.lerp(e,.5);return new E(u.p0,i,u.p3)}function _(u){let t=u.p0.lerp(u.p1,.75),e=u.p3.lerp(u.p2,.75),i=t.lerp(e,.5),n=new E(u.p0,t,i),s=new E(i,e,u.p3);return[n,s]}function K(u){return new E(u.p0,u.p1,u.p2)}function xt(u){let t=u.p1.sub(u.p0),e=u.p2.sub(u.p1);return t.dot(e)<ge*Math.sqrt(t.lengthSq*e.lengthSq)}var ee=class{caps;currentIndex;currentLength;currentPhase;dashArray;dashCaps;distance;isDash;isFirstDash;join;left;leftFirst;leftMain;miterLimit;ms;output;right;rightFirst;rightMain;startAdvancedLength;startIndex;startPhase;constructor(){this.caps=Pt.caps,this.dashArray=Pt.dashArray,this.dashCaps=Pt.dashCaps,this.distance=.5*Pt.width,this.join=Pt.join,this.miterLimit=Pt.miterLimit,this.currentIndex=0,this.currentLength=0,this.currentPhase=!1,this.isDash=!1,this.isFirstDash=!0,this.ms=v.zero,this.output=new P,this.startAdvancedLength=0,this.startIndex=0,this.startPhase=!1;let t=new P,e=new P,i=new P,n=new P;this.left=t,this.leftFirst=t,this.leftMain=i,this.right=e,this.rightFirst=e,this.rightMain=n}finalizeClosed(){this.isDash?this.finalizeClosedDashStroke():this.finalizeClosedStroke()}finalizeOpen(){this.isDash?this.finalizeOpenDashStroke():this.finalizeOpenStroke()}finalizePoint(t){this.insertMoveStroke(t,v.unitX),this.finalizeOpen()}initialize(t,e){this.output=t,e.dashArray.length>0?(this.initializeStroke(e),this.initializeDashStroke(e),this.resetDash(),this.isDash=!0):(this.initializeStroke(e),this.resetStroke(),this.left=this.leftMain,this.right=this.rightMain,this.isDash=!1)}strokeFirstOrJoin(t,e,i){this.isDash?this.insertFirstOrJoinDashStroke(t,e,i):this.insertFirstOrJoinStroke(t,e,i)}strokeLinear(t,e){this.isDash?this.insertLinearDashStroke(t):this.insertLinearStroke(t.p1,e)}strokeQuadraticDegenerate(t,e,i){this.isDash?this.insertQuadraticDegenerateDashStroke(t,e,i):this.insertQuadraticDegenerateStroke(t,e,i)}strokeQuadraticSimple(t){this.isDash?this.insertQuadraticSimpleDashStroke(t):this.insertQuadraticSimpleStroke(t)}advanceDash(){let t=de(this.dashArray,this.currentIndex);this.isFirstDash?(this.isFirstDash=!1,this.left=this.leftMain,this.right=this.rightMain):this.currentPhase&&(qt(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.dashCaps.end),this.resetStroke()),this.currentLength=0,this.currentIndex=t,this.currentPhase=!this.currentPhase}finalizeClosedDashStroke(){this.startPhase&&this.currentPhase?this.isFirstDash?(this.leftFirst.close(),this.rightFirst.close(),this.output.addPath(this.leftFirst,!1),this.output.addPathReversed(this.rightFirst,!1)):(this.leftMain.addPath(this.leftFirst,!0),this.rightMain.addPath(this.rightFirst,!0),qt(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.dashCaps.end)):(qt(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.caps.end),qt(this.output,this.leftFirst,this.rightFirst,this.caps.start,this.dashCaps.end)),this.resetDash()}finalizeClosedStroke(){this.left.close(),this.right.close(),this.output.addPath(this.left,!1),this.output.addPathReversed(this.right,!1),this.resetStroke()}finalizeOpenDashStroke(){this.isFirstDash||qt(this.output,this.leftMain,this.rightMain,this.dashCaps.start,this.caps.end),this.startPhase&&qt(this.output,this.leftFirst,this.rightFirst,this.caps.start,this.dashCaps.end),this.resetDash()}finalizeOpenStroke(){qt(this.output,this.left,this.right,this.caps.start,this.caps.end),this.resetStroke()}getDashLength(){return this.dashArray[this.currentIndex]}initializeDashStroke(t){this.dashArray=t.dashArray,this.dashCaps=t.dashCaps;let[e,i,n]=wi(t.dashArray,t.dashOffset);this.startAdvancedLength=e,this.startIndex=i,this.startPhase=n}initializeStroke(t){this.caps=t.caps,this.distance=.5*t.width,this.join=t.join,this.miterLimit=t.miterLimit}insertFirstOrJoinDashStroke(t,e,i){this.currentPhase&&this.insertFirstOrJoinStroke(t,e,i)}insertFirstOrJoinStroke(t,e,i){e.isZero()?(this.insertMoveStroke(t,i),this.ms=i):fn(this.left,this.right,t,e,i,this.distance,this.miterLimit,this.join)}insertLinearDashStroke(t){let e=t,i=this.getDashLength()-this.currentLength,n=Qt(e);for(;i<n;){let s=Ci(e,i);e=e.splitAfter(s),n=Qt(e),this.currentPhase?this.insertLinearStroke(e.p0,e.getDerivative()):this.insertMoveStroke(e.p0,e.getDerivative()),this.advanceDash(),i=this.getDashLength()}this.currentLength+=n,this.currentPhase&&this.insertLinearStroke(e.p1,e.getTangentStart())}insertLinearStroke(t,e){let i=e.unit.normal.mul(this.distance);this.left.lineTo(t.add(i)),this.right.lineTo(t.add(i.neg))}insertMoveStroke(t,e){let i=e.unit.normal.mul(this.distance);this.left.moveTo(t.add(i)),this.right.moveTo(t.add(i.neg))}insertQuadraticDegenerateDashStroke(t,e,i){let n=new E(t,e,e),s=new E(e,e,i),r=e.sub(t).unit.normal,o=i.sub(e).unit.normal;this.insertQuadraticSimpleStroke(n),this.currentPhase&&(gt(this.left,e,r,o,this.distance,0,3),gt(this.right,e,r.neg,o.neg,this.distance,0,3)),this.insertQuadraticSimpleStroke(s)}insertQuadraticDegenerateStroke(t,e,i){let n=new E(t,e,e),s=new E(e,e,i),r=e.sub(t).unit.normal,o=i.sub(e).unit.normal;this.insertQuadraticSimpleStroke(n),gt(this.left,e,r,o,this.distance,0,3),gt(this.right,e,r.neg,o.neg,this.distance,0,3),this.insertQuadraticSimpleStroke(s)}insertQuadraticSimpleDashStroke(t){let e=t,i=this.getDashLength()-this.currentLength,n=Ut(e);for(;i<n;){let s=Ei(e,i),[r,o]=e.splitAt(s);n=Ut(o),this.currentPhase?this.insertQuadraticSimpleStroke(r):this.insertMoveStroke(o.p0,o.getTangentStart()),this.advanceDash(),i=this.getDashLength(),e=o}this.currentLength+=n,this.currentPhase&&this.insertQuadraticSimpleStroke(e)}insertQuadraticSimpleStroke(t){let e=t.getTangentStart(),i=t.getTangentEnd();if(!e.isZero()){let n=this.distance;e=e.unit.normal,i=i.unit.normal,e=e.add(i),e=e.mul(2*n).div(e.lengthSq),i=i.mul(n),this.left.quadTo(t.p1.add(e),t.p2.add(i)),this.right.quadTo(t.p1.add(e.neg),t.p2.add(i.neg))}}resetDash(){this.leftFirst.clear(),this.rightFirst.clear(),this.leftMain.clear(),this.rightMain.clear(),this.currentIndex=this.startIndex,this.currentLength=this.startAdvancedLength,this.startPhase?(this.left=this.leftFirst,this.right=this.rightFirst,this.currentPhase=!0,this.isFirstDash=!0):(this.left=this.leftMain,this.right=this.rightMain,this.currentPhase=!1,this.isFirstDash=!1)}resetStroke(){this.leftMain.clear(),this.rightMain.clear()}};function fn(u,t,e,i,n,s,r,o){let a=i.unit.normal,c=n.unit.normal;a.dot(c)<ve&&(a.cross(c)>=0?(gt(u,e,a,c,s,r,o),be(t,e,c,-s)):(gt(t,e,a,c,-s,r,o),be(u,e,c,s)))}function Ki(u,t,e){switch(e){case 0:{u.lineTo(t);break}case 1:{let i=u.getLastPoint();if(i===void 0)break;let n=t.sub(i).mul(.5).normal;u.lineTo(i.add(n)),u.lineTo(t.add(n)),u.lineTo(t);break}case 2:{let i=u.getLastPoint();if(i===void 0)break;let n=t.sub(i).mul(.5).normal;u.arcTo(i.add(n),i.add(n.sub(n.normal))),u.arcTo(t.add(n),t);break}default:{let i=u.getLastPoint();if(i===void 0||(e(u,i,t),u.getLastPoint()?.eq(t)===!0))break;u.lineTo(t)}}}function qt(u,t,e,i,n){let s=e.getLastPoint(),r=t.getFirstPoint();s!==void 0&&r!==void 0&&(u.addPath(t,!1),Ki(u,s,n),u.addPathReversed(e,!0),Ki(u,r,i),u.close())}function Zi(u){return JSON.parse(u,(t,e)=>{let i=e.type,n=e.data;return i===void 0||n===void 0?e:i==="Int8Array"?new Int8Array(n):i==="Int16Array"?new Int16Array(n):i==="Int32Array"?new Int32Array(n):i==="Uint8Array"?new Uint8Array(n):i==="Uint8ClampedArray"?new Uint8ClampedArray(n):i==="Uint16Array"?new Uint16Array(n):i==="Uint32Array"?new Uint32Array(n):i==="Float32Array"?new Float32Array(n):i==="Float64Array"?new Float64Array(n):i==="Set"?new Set(n):i==="Map"?new Map(n):i==="Point2"?m.fromArray(n):i==="Vector2"?v.fromArray(n):i==="Point3"?S.fromArray(n):i==="Vector3"?z.fromArray(n):i==="Matrix3x2"?R.fromArray(n):i==="Matrix3x3"?Y.fromArray(n):i==="Matrix4x4"?O.fromArray(n):e})}function Hi(u){return JSON.stringify(u,(t,e)=>typeof e!="object"?e:e instanceof Int8Array?{type:"Int8Array",data:[...e]}:e instanceof Int16Array?{type:"Int16Array",data:[...e]}:e instanceof Int32Array?{type:"Int32Array",data:[...e]}:e instanceof Uint8Array?{type:"Uint8Array",data:[...e]}:e instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",data:[...e]}:e instanceof Uint16Array?{type:"Uint16Array",data:[...e]}:e instanceof Uint32Array?{type:"Uint32Array",data:[...e]}:e instanceof Float32Array?{type:"Float32Array",data:[...e]}:e instanceof Float64Array?{type:"Float64Array",data:[...e]}:e instanceof Set?{type:"Set",data:[...e]}:e instanceof Map?{type:"Map",data:[...e]}:e instanceof m?{type:"Point2",data:e.toArray()}:e instanceof v?{type:"Vector2",data:e.toArray()}:e instanceof S?{type:"Point3",data:e.toArray()}:e instanceof z?{type:"Vector3",data:e.toArray()}:e instanceof R?{type:"Matrix3x2",data:e.toArray()}:e instanceof Y?{type:"Matrix3x3",data:e.toArray()}:e instanceof O?{type:"Matrix4x4",data:e.toArray()}:e)}var ye=class{state;simplifyTolerance;tanOffsetTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance),this.state=new _t}process(t,e,i){if(!t.isValid())return;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=m.zero,c=m.zero,h=v.zero;for(this.initialize(e,i);r<n.length;){let p=n[r++];switch(p.type){case 0:{h.isZero()||this.state.finalizeOpen(e),c=s[o++],h=v.zero,a=c;break}case 1:{let l=new C(c,s[o++]),d=l.getDerivative();d.isZero()||(this.state.dashFirst(c,h),this.state.dashLinear(l),c=l.p1,h=d);break}case 2:{let l=new E(c,s[o++],s[o++]);l.getTangentStart().isZero()||(this.state.dashFirst(c,h),this.dashQuadratic(l),c=l.p2,h=l.getTangentEnd());break}case 3:{let l=new q(c,s[o++],s[o++],s[o++]);l.getTangentStart().isZero()||(this.state.dashFirst(c,h),this.dashCubic(l),c=l.p3,h=l.getTangentEnd());break}case 4:{let l=new k(c,s[o++],s[o++],p.w);l.getTangentStart().isZero()||(this.state.dashFirst(c,h),this.dashConic(l),c=l.p2,h=l.getTangentEnd());break}case 5:{let l=new C(c,a);l.getDerivative().isZero()||this.state.dashLinear(l),h.isZero()||this.state.finalizeClosed(e),c=a,h=v.zero;break}default:B(p)}}h.isZero()||this.state.finalizeOpen(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance)}dashConic(t){let e=dt(t,4,this.simplifyTolerance),i=t;for(;e<1;){let[s,r]=i.splitAt(e),o=K(s);this.dashQuadratic(o),e=e/(1-e),i=r}let n=K(i);this.dashQuadratic(n)}dashCubic(t){let e=mt(t,54,this.simplifyTolerance),i=t;for(;e<1;){let[r,o]=i.splitAt(e),[a,c]=_(r);this.dashQuadratic(a),this.dashQuadratic(c),e=e/(1-e),i=o}let[n,s]=_(i);this.dashQuadratic(n),this.dashQuadratic(s)}dashQuadratic(t){let e=t.getVertexParameter();e>0&&e<1&&xt(t)?this.state.dashDegenerateQuad(t.p0,t.getValueAt(e),t.p2):this.dashQuadraticSimplify(t)}dashQuadraticSimplify(t){let e=vt(t,this.tanOffsetTolerance),i=t;for(;e>0&&e<et;){let[n,s]=i.splitAt(e);this.state.dashQuadraticSimple(n),e=vt(s,this.tanOffsetTolerance),i=s}this.state.dashQuadraticSimple(i)}initialize(t,e){this.state.initialize(t,e)}},we=class{state;cosOffsetTolerance;simplifyTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance),this.state=new _t}process(t,e,i){if(!t.isValid())return;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=m.zero,c=m.zero,h=v.zero;for(this.state.initialize(e,i);r<n.length;){let p=n[r++];switch(p.type){case 0:{h.isZero()||this.state.finalizeOpen(e),c=s[o++],h=v.zero,a=c;break}case 1:{let l=new C(c,s[o++]),d=l.getDerivative();d.isZero()||(this.state.dashFirst(c,h),this.state.dashLinear(l),c=l.p1,h=d);break}case 2:{let l=new E(c,s[o++],s[o++]);l.getTangentStart().isZero()||(this.state.dashFirst(c,h),this.dashQuadratic(l),c=l.p2,h=l.getTangentEnd());break}case 3:{let l=new q(c,s[o++],s[o++],s[o++]);l.getTangentStart().isZero()||(this.state.dashFirst(c,h),this.dashCubic(l),c=l.p3,h=l.getTangentEnd());break}case 4:{let l=new k(c,s[o++],s[o++],p.w);l.getTangentStart().isZero()||(this.state.dashFirst(c,h),this.dashConic(l),c=l.p2,h=l.getTangentEnd());break}case 5:{let l=new C(c,a);l.getDerivative().isZero()||this.state.dashLinear(l),h.isZero()||this.state.finalizeClosed(e),c=a,h=v.zero;break}default:B(p)}}h.isZero()||this.state.finalizeOpen(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance)}dashConic(t){let e=4*this.simplifyTolerance,i=n=>{if(Tt(n,e)){let s=K(n);this.dashQuadratic(s)}else{let[s,r]=n.splitAt(.5);i(s),i(r)}};i(t)}dashCubic(t){let e=54*this.simplifyTolerance,i=St(t),n=(s,r)=>{if(e>r){let[o,a]=_(s);this.dashQuadratic(o),this.dashQuadratic(a)}else{let[o,a]=s.splitAt(.5);n(o,.125*r),n(a,.125*r)}};n(t,i)}dashQuadratic(t){let e=t.getVertexParameter();e>0&&e<1&&xt(t)?this.state.dashDegenerateQuad(t.p0,t.getValueAt(e),t.p2):this.dashQuadraticSimplify(t)}dashQuadraticSimplify(t){let e=this.cosOffsetTolerance,i=n=>{if(Yt(n,e))this.state.dashQuadraticSimple(n);else{let[s,r]=n.splitAt(.5);i(s),i(r)}};i(t)}};var Ce=class{simplifyTolerance;tolerance;constructor(t){this.tolerance=t.flattenTolerance,this.simplifyTolerance=t.simplifyTolerance}process(t,e,i){if(!t.isValid())return;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=m.zero,c=m.zero;for(;r<n.length;){let h=n[r++];switch(h.type){case 0:{i&&!c.eq(a)&&e.lineTo(a),a=s[o++],e.moveTo(a),c=a;break}case 1:{let p=s[o++];e.lineTo(p),c=p;break}case 2:{let p=new E(c,s[o++],s[o++]);this.flattenQuadratic(p,e),c=p.p2;break}case 3:{let p=new q(c,s[o++],s[o++],s[o++]);this.flattenCubic(p,e),c=p.p3;break}case 4:{let p=new k(c,s[o++],s[o++],h.w);this.flattenConic(p,e),c=p.p2;break}case 5:{c.eq(a)||e.lineTo(a),e.close();break}default:B(h)}}i&&!c.eq(a)&&(e.lineTo(a),e.close())}setQualityOptions(t){this.tolerance=t.flattenTolerance,this.simplifyTolerance=t.simplifyTolerance}flattenConic(t,e){let i=dt(t,4,this.simplifyTolerance),n=t;for(;i<1;){let[s,r]=n.splitAt(i);this.flattenQuadratic(K(s),e),i=i/(1-i),n=r}this.flattenQuadratic(K(n),e)}flattenCubic(t,e){let i=mt(t,54,this.simplifyTolerance),n=t;for(;i<1;){let[s,r]=n.splitAt(i);this.flattenQuadratic(Ai(s),e),i=i/(1-i),n=r}this.flattenQuadratic(Ai(n),e)}flattenQuadratic(t,e){let[i,n,s]=t.getCoefficients(),r=Math.sqrt(4*this.tolerance/i.length);for(let o=r;o<1;o+=r){let a=i.mul(o).add(n).mul(o).addPt(s);e.lineTo(a)}e.lineTo(t.p2)}},Ee=class{tolerance;constructor(t){this.tolerance=t.flattenTolerance}process(t,e,i){if(!t.isValid())return;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=m.zero,c=m.zero;for(;r<n.length;){let h=n[r++];switch(h.type){case 0:{i&&!c.eq(a)&&e.lineTo(a),a=s[o++],e.moveTo(a),c=a;break}case 1:{let p=s[o++];e.lineTo(p),c=p;break}case 2:{let p=new E(c,s[o++],s[o++]);this.flattenQuadratic(p,e),c=p.p2;break}case 3:{let p=new q(c,s[o++],s[o++],s[o++]);this.flattenCubic(p,e),c=p.p3;break}case 4:{let p=new k(c,s[o++],s[o++],h.w);this.flattenConic(p,e),c=p.p2;break}case 5:{c.eq(a)||e.lineTo(a),e.close();break}default:B(h)}}i&&!c.eq(a)&&(e.lineTo(a),e.close())}setQualityOptions(t){this.tolerance=t.flattenTolerance}flattenConic(t,e){let i=this.tolerance*this.tolerance,n=s=>{let r=s.p2.sub(s.p0),a=s.w/(s.w+1)*r.cross(s.p1.sub(s.p0));if(a*a>i*r.lengthSq){let[c,h]=s.splitAt(.5);n(c),n(h)}else e.lineTo(s.p2)};n(t)}flattenCubic(t,e){let n=1.7777777777777777*this.tolerance*this.tolerance,s=r=>{let o=r.p3.sub(r.p0);o.isZero()&&(o=r.p2.sub(r.p1));let a=o.cross(r.p1.sub(r.p0)),c=o.cross(r.p2.sub(r.p0));if(Math.max(a*a,c*c)>n*o.lengthSq){let[h,p]=r.splitAt(.5);s(h),s(p)}else e.lineTo(r.p3)};s(t)}flattenQuadratic(t,e){let n=4*this.tolerance*this.tolerance,s=r=>{let o=r.p2.sub(r.p0),a=o.cross(r.p1.sub(r.p0));if(a*a>n*o.lengthSq){let[c,h]=r.splitAt(.5);s(c),s(h)}else e.lineTo(r.p2)};s(t)}};var Se=class{buffer;d;join;miterLimit;ms;ps;simplifyTolerance;tanOffsetTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance),this.buffer=new P,this.d=0,this.join=0,this.miterLimit=0,this.ms=v.zero,this.ps=m.zero}process(t,e,i){if(!t.isValid())return;this.join=i.join,this.miterLimit=i.miterLimit,this.d=i.distance;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=this.ps,c=v.zero;for(this.buffer.clear();r<n.length;){let h=n[r++];switch(h.type){case 0:{c.isZero()||this.finalizeOpenOffset(e),a=s[o++],c=v.zero,this.ps=a;break}case 1:{let p=new C(a,s[o++]),l=p.getDerivative();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetLinear(p.p1,l),a=p.p1,c=l);break}case 2:{let p=new E(a,s[o++],s[o++]),l=p.getTangentStart();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetQuadratic(p),a=p.p2,c=p.getTangentEnd());break}case 3:{let p=new q(a,s[o++],s[o++],s[o++]),l=p.getTangentStart();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetCubic(p),a=p.p3,c=p.getTangentEnd());break}case 4:{let p=new k(a,s[o++],s[o++],h.w),l=p.getTangentStart();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetConic(p),a=p.p2,c=p.getTangentEnd());break}case 5:{let p=new C(a,this.ps),l=p.getDerivative();l.isZero()||(this.offsetFirstOrJoin(p.p0,c,l),this.offsetLinear(p.p1,l),c=l),c.isZero()||(this.offsetFirstOrJoin(this.ps,c,this.ms),this.finalizeClosed(e)),a=this.ps,c=v.zero;break}default:B(h)}}c.isZero()||this.finalizeOpenOffset(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance)}finalizeClosed(t){this.buffer.close(),t.addPath(this.buffer,!1),this.buffer.clear()}finalizeOpenOffset(t){t.addPath(this.buffer,!1),this.buffer.clear()}offsetConic(t){let e=dt(t,4,this.simplifyTolerance),i=t;for(;e<1;){let[s,r]=i.splitAt(e),o=K(s);this.offsetQuadratic(o),e=e/(1-e),i=r}let n=K(i);this.offsetQuadratic(n)}offsetCubic(t){let e=mt(t,54,this.simplifyTolerance),i=t;for(;e<1;){let[r,o]=i.splitAt(e),[a,c]=_(r);this.offsetQuadratic(a),this.offsetQuadratic(c),e=e/(1-e),i=o}let[n,s]=_(i);this.offsetQuadratic(n),this.offsetQuadratic(s)}offsetFirstOrJoin(t,e,i){e.isZero()?(this.offsetMove(t,i),this.ms=i):Ti(this.buffer,t,e,i,this.d,this.miterLimit,this.join)}offsetLinear(t,e){let i=e.unit.normal.mul(this.d);this.buffer.lineTo(t.add(i))}offsetMove(t,e){let i=e.unit.normal.mul(this.d);this.buffer.moveTo(t.add(i))}offsetQuadratic(t){let[e,i]=t.getOffsetCuspParameter(this.d),n=e-i,s=e+i;if(n<1&&s>0)if(xt(t))Si(this.buffer,t.p0,t.getValueAt(e),t.p2,this.d);else{let r=0;n>r&&n<et&&(this.offsetQuadraticSimplify(t.splitBefore(n),this.d),r=n),s>r&&s<et&&(this.offsetQuadraticSimplify(t.splitBetween(r,s),this.d),r=s),r>0?this.offsetQuadraticSimplify(t.splitAfter(r),this.d):this.offsetQuadraticSimplify(t,this.d)}else this.offsetQuadraticSimplify(t,this.d)}offsetQuadraticSimplify(t,e){let i=vt(t,this.tanOffsetTolerance),n=t;for(;i>0&&i<et;){let[s,r]=n.splitAt(i);Wt(this.buffer,s,e),i=vt(r,this.tanOffsetTolerance),n=r}Wt(this.buffer,n,e)}},Te=class{buffer;cosOffsetTolerance;d;join;miterLimit;ms;ps;simplifyTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance),this.buffer=new P,this.d=0,this.join=0,this.miterLimit=0,this.ms=v.zero,this.ps=m.zero}process(t,e,i){if(!t.isValid())return;this.join=i.join,this.miterLimit=i.miterLimit,this.d=i.distance;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=this.ps,c=v.zero;for(this.buffer.clear();r<n.length;){let h=n[r++];switch(h.type){case 0:{c.isZero()||this.finalizeOpenOffset(e),a=s[o++],c=v.zero,this.ps=a;break}case 1:{let p=new C(a,s[o++]),l=p.getDerivative();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetLinear(p.p1,l),a=p.p1,c=l);break}case 2:{let p=new E(a,s[o++],s[o++]),l=p.getTangentStart();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetQuadratic(p),a=p.p2,c=p.getTangentEnd());break}case 3:{let p=new q(a,s[o++],s[o++],s[o++]),l=p.getTangentStart();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetCubic(p),a=p.p3,c=p.getTangentEnd());break}case 4:{let p=new k(a,s[o++],s[o++],h.w),l=p.getTangentStart();l.isZero()||(this.offsetFirstOrJoin(a,c,l),this.offsetConic(p),a=p.p2,c=p.getTangentEnd());break}case 5:{let p=new C(a,this.ps),l=p.getDerivative();l.isZero()||(this.offsetFirstOrJoin(p.p0,c,l),this.offsetLinear(p.p1,l),c=l),c.isZero()||(this.offsetFirstOrJoin(this.ps,c,this.ms),this.finalizeClosed(e)),a=this.ps,c=v.zero;break}default:B(h)}}c.isZero()||this.finalizeOpenOffset(e)}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.tan(t.offsetTolerance)}finalizeClosed(t){this.buffer.close(),t.addPath(this.buffer,!1),this.buffer.clear()}finalizeOpenOffset(t){t.addPath(this.buffer,!1),this.buffer.clear()}offsetConic(t){let e=4*this.simplifyTolerance,i=n=>{if(Tt(n,e)){let s=K(n);this.offsetQuadratic(s)}else{let[s,r]=n.splitAt(.5);i(s),i(r)}};i(t)}offsetCubic(t){let e=54*this.simplifyTolerance,i=St(t),n=(s,r)=>{if(e>r){let[o,a]=_(s);this.offsetQuadratic(o),this.offsetQuadratic(a)}else{let[o,a]=s.splitAt(.5);n(o,.125*r),n(a,.125*r)}};n(t,i)}offsetFirstOrJoin(t,e,i){e.isZero()?(this.offsetMove(t,i),this.ms=i):Ti(this.buffer,t,e,i,this.d,this.miterLimit,this.join)}offsetLinear(t,e){let i=e.unit.normal.mul(this.d);this.buffer.lineTo(t.add(i))}offsetMove(t,e){let i=e.unit.normal.mul(this.d);this.buffer.moveTo(t.add(i))}offsetQuadratic(t){let[e,i]=t.getOffsetCuspParameter(this.d),n=e-i,s=e+i;if(n<1&&s>0)if(xt(t))Si(this.buffer,t.p0,t.getValueAt(e),t.p2,this.d);else{let r=0;n>r&&n<et&&(this.offsetQuadraticSimplify(t.splitBefore(n),this.d),r=n),s>r&&s<et&&(this.offsetQuadraticSimplify(t.splitBetween(r,s),this.d),r=s),r>0?this.offsetQuadraticSimplify(t.splitAfter(r),this.d):this.offsetQuadraticSimplify(t,this.d)}else this.offsetQuadraticSimplify(t,this.d)}offsetQuadraticSimplify(t,e){let i=this.cosOffsetTolerance,n=s=>{if(Yt(s,i))Wt(this.buffer,s,e);else{let[r,o]=s.splitAt(.5);n(r),n(o)}};n(t)}};var Ae=class{tolerance;constructor(t){this.tolerance=t.simplifyTolerance}process(t,e){if(!t.isValid())return;let i=t.getCommands(),n=t.getPoints(),s=0,r=0,o=m.zero;for(;s<i.length;){let a=i[s++];switch(a.type){case 0:{o=n[r++],e.moveTo(o);break}case 1:{let c=n[r++];e.lineTo(c),o=c;break}case 2:{let c=new E(o,n[r++],n[r++]);e.quadTo(c.p1,c.p2),o=c.p2;break}case 3:{let c=new q(o,n[r++],n[r++],n[r++]);this.simplifyCubic(e,c),o=c.p3;break}case 4:{let c=new k(o,n[r++],n[r++],a.w);this.simplifyConic(e,c),o=c.p2;break}case 5:{e.close();break}default:B(a)}}}setQualityOptions(t){this.tolerance=t.simplifyTolerance}simplifyConic(t,e){let i=dt(e,4,this.tolerance),n=e;for(;i<1;){let[r,o]=n.splitAt(i),a=K(r);t.quadTo(a.p1,a.p2),i=i/(1-i),n=o}let s=K(n);t.quadTo(s.p1,s.p2)}simplifyCubic(t,e){let i=mt(e,54,this.tolerance),n=e;for(;i<1;){let[o,a]=n.splitAt(i),[c,h]=_(o);t.quadTo(c.p1,c.p2),t.quadTo(h.p1,h.p2),i=i/(1-i),n=a}let[s,r]=_(n);t.quadTo(s.p1,s.p2),t.quadTo(r.p1,r.p2)}},Ie=class{tolerance;constructor(t){this.tolerance=t.simplifyTolerance}process(t,e){if(!t.isValid())return;let i=t.getCommands(),n=t.getPoints(),s=0,r=0,o=m.zero;for(;s<i.length;){let a=i[s++];switch(a.type){case 0:{o=n[r++],e.moveTo(o);break}case 1:{let c=n[r++];e.lineTo(c),o=c;break}case 2:{let c=new E(o,n[r++],n[r++]);e.quadTo(c.p1,c.p2),o=c.p2;break}case 3:{let c=new q(o,n[r++],n[r++],n[r++]);this.simplifyCubic(e,c),o=c.p3;break}case 4:{let c=new k(o,n[r++],n[r++],a.w);this.simplifyConic(e,c),o=c.p2;break}case 5:{e.close();break}default:B(a)}}}setQualityOptions(t){this.tolerance=t.simplifyTolerance}simplifyConic(t,e){let i=4*this.tolerance,n=s=>{if(Tt(s,i)){let r=K(s);t.quadTo(r.p1,r.p2)}else{let[r,o]=s.splitAt(.5);n(r),n(o)}};n(e)}simplifyCubic(t,e){let i=54*this.tolerance,n=St(e),s=(r,o)=>{if(i>o){let[a,c]=_(r);t.quadTo(a.p1,a.p2),t.quadTo(c.p1,c.p2)}else{let[a,c]=r.splitAt(.5);s(a,.125*o),s(c,.125*o)}};s(e,n)}};var Me=class{state;simplifyTolerance;tanOffsetTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance),this.state=new ee}process(t,e,i){if(!t.isValid())return;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=0,c=m.zero,h=m.zero,p=v.zero;for(this.state.initialize(e,i);r<n.length;){let l=n[r++],d=l.type;switch(d){case 0:{p.isZero()?a!==0&&a!==5&&this.state.finalizePoint(c):this.state.finalizeOpen(),c=s[o++],h=c,p=v.zero;break}case 1:{let b=new C(h,s[o++]),f=b.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.state.strokeLinear(b,f),h=b.p1,p=f);break}case 2:{let b=new E(h,s[o++],s[o++]),f=b.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.strokeQuadratic(b),h=b.p2,p=b.getTangentEnd());break}case 3:{let b=new q(h,s[o++],s[o++],s[o++]),f=b.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.strokeCubic(b),h=b.p3,p=b.getTangentEnd());break}case 4:{let b=new k(h,s[o++],s[o++],l.w),f=b.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.strokeConic(b),h=b.p2,p=b.getTangentEnd());break}case 5:{let b=new C(h,c),f=b.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.state.strokeLinear(b,f),p=f),p.isZero()?a!==5&&this.state.finalizePoint(c):(this.state.strokeFirstOrJoin(c,p,this.state.ms),this.state.finalizeClosed()),h=c,p=v.zero;break}default:B(l)}a=d}p.isZero()?a!==0&&a!==5&&this.state.finalizePoint(c):this.state.finalizeOpen()}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.tanOffsetTolerance=Math.tan(t.offsetTolerance)}strokeConic(t){let e=dt(t,4,this.simplifyTolerance),i=t;for(;e>0&&e<1;){let[s,r]=i.splitAt(e),o=K(s);this.strokeQuadratic(o),e=e/(1-e),i=r}let n=K(i);this.strokeQuadratic(n)}strokeCubic(t){let e=mt(t,54,this.simplifyTolerance),i=t;for(;e<1;){let[r,o]=i.splitAt(e),[a,c]=_(r);this.strokeQuadratic(a),this.strokeQuadratic(c),e=e/(1-e),i=o}let[n,s]=_(i);this.strokeQuadratic(n),this.strokeQuadratic(s)}strokeQuadratic(t){let[e,i]=t.getOffsetCuspParameter(this.state.distance),n=e-i,s=e+i;if(n<1&&s>0)if(xt(t))this.state.strokeQuadraticDegenerate(t.p0,t.getValueAt(e),t.p2);else{let r=0;n>r&&n<et&&(this.strokeQuadraticSimplify(t.splitBefore(n)),r=n),s>r&&s<et&&(this.strokeQuadraticSimplify(t.splitBetween(r,s)),r=s),r>0?this.strokeQuadraticSimplify(t.splitAfter(r)):this.strokeQuadraticSimplify(t)}else this.strokeQuadraticSimplify(t)}strokeQuadraticSimplify(t){let e=vt(t,this.tanOffsetTolerance),i=t;for(;e>0&&e<et;){let[n,s]=i.splitAt(e);this.state.strokeQuadraticSimple(n),e=vt(s,this.tanOffsetTolerance),i=s}this.state.strokeQuadraticSimple(i)}},Oe=class{state;cosOffsetTolerance;simplifyTolerance;constructor(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance),this.state=new ee}process(t,e,i){if(!t.isValid())return;let n=t.getCommands(),s=t.getPoints(),r=0,o=0,a=0,c=m.zero,h=m.zero,p=v.zero;for(this.state.initialize(e,i);o<n.length;){let l=n[o++],d=l.type;switch(l.type){case 0:{p.isZero()?r!==0&&r!==5&&this.state.finalizePoint(c):this.state.finalizeOpen(),c=s[a++],h=c,p=v.zero;break}case 1:{let b=new C(h,s[a++]),f=b.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.state.strokeLinear(b,f),h=b.p1,p=f);break}case 2:{let b=new E(h,s[a++],s[a++]),f=b.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.strokeQuadratic(b),h=b.p2,p=b.getTangentEnd());break}case 3:{let b=new q(h,s[a++],s[a++],s[a++]),f=b.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.strokeCubic(b),h=b.p3,p=b.getTangentEnd());break}case 4:{let b=new k(h,s[a++],s[a++],l.w),f=b.getTangentStart();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.strokeConic(b),h=b.p2,p=b.getTangentEnd());break}case 5:{let b=new C(h,c),f=b.getDerivative();f.isZero()||(this.state.strokeFirstOrJoin(h,p,f),this.state.strokeLinear(b,f),p=f),p.isZero()?r!==5&&this.state.finalizePoint(c):(this.state.strokeFirstOrJoin(c,p,this.state.ms),this.state.finalizeClosed()),h=c,p=v.zero;break}default:B(l)}r=d}p.isZero()?r!==0&&r!==5&&this.state.finalizePoint(c):this.state.finalizeOpen()}setQualityOptions(t){this.simplifyTolerance=t.simplifyTolerance,this.cosOffsetTolerance=Math.cos(t.offsetTolerance)}strokeConic(t){let e=4*this.simplifyTolerance,i=n=>{if(Tt(n,e)){let s=K(n);this.strokeQuadratic(s)}else{let[s,r]=n.splitAt(.5);i(s),i(r)}};i(t)}strokeCubic(t){let e=54*this.simplifyTolerance,i=St(t),n=(s,r)=>{if(e>r){let[o,a]=_(s);this.strokeQuadratic(o),this.strokeQuadratic(a)}else{let[o,a]=s.splitAt(.5);n(o,.125*r),n(a,.125*r)}};n(t,i)}strokeQuadratic(t){let[e,i]=t.getOffsetCuspParameter(this.state.distance),n=e-i,s=e+i;if(n<1&&s>0)if(xt(t))this.state.strokeQuadraticDegenerate(t.p0,t.getValueAt(e),t.p2);else{let r=0;n>r&&n<et&&(this.strokeQuadraticSimplify(t.splitBefore(n)),r=n),s>r&&s<et&&(this.strokeQuadraticSimplify(t.splitBetween(r,s)),r=s),r>0?this.strokeQuadraticSimplify(t.splitAfter(r)):this.strokeQuadraticSimplify(t)}else this.strokeQuadraticSimplify(t)}strokeQuadraticSimplify(t){let e=this.cosOffsetTolerance,i=n=>{if(Yt(n,e))this.state.strokeQuadraticSimple(n);else{let[s,r]=n.splitAt(.5);i(s),i(r)}};i(t)}};var ie={start:0,end:0},$i={start:2,end:2};var W={clipPrecision:65536,dashMode:0,flattenMode:0,flattenTolerance:.2,offsetMode:0,offsetTolerance:.39269908169,simplifyMode:0,simplifyTolerance:.05,strokeMode:0},Gi={array:[],offset:0},Ji={join:1,miterLimit:4,distance:1},Pt={caps:ie,dashArray:[],dashCaps:ie,dashOffset:0,join:1,miterLimit:4,width:1},ut={booleanOperator:0,windingOperatorA:0,windingOperatorB:0},ge=-.9999999999984769,ve=.9999999999984769,gn=5e-7,et=1-gn;function Fe(u){switch(u.flattenMode){case 0:return new Ce(u);case 1:return new Ee(u);default:return u.flattenMode}}function ji(u){switch(u.simplifyMode){case 0:return new Ae(u);case 1:return new Ie(u);default:return u.simplifyMode}}function _i(u){switch(u.offsetMode){case 0:return new Se(u);case 1:return new Te(u);default:return u.offsetMode}}function tn(u){switch(u.dashMode){case 0:return new ye(u);case 1:return new we(u);default:return u.dashMode}}function ze(u){switch(u.strokeMode){case 0:return new Me(u);case 1:return new Oe(u);default:return u.strokeMode}}var Ii=class{pixel;constructor(){this.pixel=new Map}addMagnet(t){let e=t.toString();this.pixel.set(e,{type:0,p:t})}addPin(t){let e=t.toString();this.pixel.has(e)||this.pixel.set(e,{type:1,p:t})}clear(){this.pixel.clear()}getMagnets(){let t=[];for(let e of this.pixel.values())e.type===0&&t.push(e.p);return t}getPins(){let t=[];for(let e of this.pixel.values())e.type===1&&t.push(e.p);return t}getValues(){return this.pixel.values()}},At=class{key;left;p0;p1;seg;constructor(t,e,i,n,s){this.p0=t,this.p1=e,this.seg=i,this.key=n,this.left=s}static compareQueue(t,e){return t.p0.x!==e.p0.x?t.p0.x-e.p0.x:t.p0.y!==e.p0.y?t.p0.y-e.p0.y:t.left!==e.left?t.left?1:-1:0}static compareStatus(t,e){return t.key-e.key}},It=class{inputSegments;intersections;magnets;outputSegments;pins;pixelSet;precision;constructor(){this.precision=2**16,this.inputSegments=[],this.intersections=[],this.magnets=[],this.outputSegments=[],this.pins=[],this.pixelSet=new Ii}addSegment(t,e,i,n,s){g.assertFn(()=>t.isFinite(),"SnapRound2: BezierCurve2 is not finite"),t.type!==0&&g.warn("SnapRound2: Not implemented yet");let r=this.precision,o=this.addEndpoint(t.p0,r,n),a=this.addEndpoint(t.pn,r,n),c={set:e,weight:i,data:s};this.inputSegments.push({p0:o,p1:a,ref:c})}clear(){this.pixelSet.clear(),this.inputSegments=[],this.intersections=[],this.magnets=[],this.outputSegments=[],this.pins=[]}debugGetErrors(){return this.createIntersections(this.outputSegments)}debugGetInputSegments(){return this.inputSegments.slice()}debugGetIntersections(){return this.intersections.slice()}debugGetMagnets(){return this.magnets.slice()}debugGetOutputSegments(){return this.outputSegments.slice()}debugGetPins(){return this.pins.slice()}process(){this.intersections=this.createIntersections(this.inputSegments);for(let t of this.intersections){let e=ke(t);this.pixelSet.addMagnet(e)}this.magnets=this.pixelSet.getMagnets(),this.pins=this.pixelSet.getPins(),this.intersectEdges(this.magnets,this.pins)}validate(){return this.debugGetErrors().length===0}writeEdgeSegmentsTo(t){let e=this.precision;for(let i of this.outputSegments){let n=new m(i.p0.x/e,i.p0.y/e),s=new m(i.p1.x/e,i.p1.y/e),r=i.ref;t.push({p0:n,p1:s,ref:r})}}writeEdges(t){let e=this.precision;for(let i of this.outputSegments){let n=new m(i.p0.x/e,i.p0.y/e),s=new m(i.p1.x/e,i.p1.y/e);t.push(new y(n,s))}}static signedArea(t,e,i){let n=j.from(t.x),s=j.from(t.y),r=j.from(e.x),o=j.from(e.y),a=j.from(i.x),c=j.from(i.y),h=r.sub(n),p=o.sub(s),l=a.sub(n),d=c.sub(s),b=h.mul(d),f=p.mul(l);return b.sub(f).value}addEndpoint(t,e,i){let n=new m(e*t.x,e*t.y),s=ke(n);return this.isPin(s,t,e)&&!i?(this.pixelSet.addPin(s),s):(this.pixelSet.addMagnet(s),n)}addSegmentCandidate(t,e,i,n){if(e.eq(i))return;let s=this.getPixelIntersections(e,i,n);this.sortByParameter(s);let r=e;for(let o of s){let a=m.signedArea(t.p0,t.p1,o.p),c=m.signedArea(e,i,o.p);a*c<=0&&(this.addSegmentOutput(r,o.p,t.ref),r=o.p)}this.addSegmentOutput(r,i,t.ref)}addSegmentOutput(t,e,i){t.eq(e)||this.outputSegments.push({p0:t,p1:e,ref:i})}createIntersections(t){let e=[],i=this.createQueue(t),n=new at(At.compareStatus);for(let s of i.values)if(s.left){for(let r of n.values)this.writeSegmentIntersectionsTo(s.seg,r.seg,e);n.insert(s)}else{let r=n.remove(s);A(r,`SnapRound2: Status event not found
{}`,s.seg)}return e}createQueue(t){let e=[];for(let i=0;i<t.length;i++){let n=t[i];n.p0.eq(n.p1)||(n.p0.lt(n.p1)?(e.push(new At(n.p0,n.p1,n,i,!0)),e.push(new At(n.p1,n.p0,n,i,!1))):(e.push(new At(n.p1,n.p0,n,i,!0)),e.push(new At(n.p0,n.p1,n,i,!1))))}return at.fromArray(e,At.compareQueue)}getPixelIntersections(t,e,i){let n=[];for(let s of i){if(s.eq(t)||s.eq(e))continue;let r=xn(t,e,s);if(r!==void 0){let[o,a]=r;n.push({p:s,min:o,max:a})}}return n}intersectEdges(t,e){for(let i of this.inputSegments){let n=ke(i.p0),s=ke(i.p1);if(n.eq(s)){this.outputSegments.push({p0:n,p1:s,ref:i.ref});continue}let r=this.getPixelIntersections(i.p0,i.p1,t);this.sortByParameter(r);let o=n;for(let a of r)this.addSegmentCandidate(i,o,a.p,e),o=a.p;this.addSegmentCandidate(i,o,s,e)}}isPin(t,e,i){return t.x/i===e.x&&t.y/i===e.y}sortByParameter(t){t.sort((e,i)=>e.min!==i.min?e.min-i.min:(e.max===i.max&&g.error("Max parameter values are equal"),e.max-i.max))}writeSegmentIntersectionsTo(t,e,i){if(t.p0.eq(e.p0)||t.p0.eq(e.p1)||t.p1.eq(e.p0)||t.p1.eq(e.p1))return;let n=m.signedArea(e.p0,e.p1,t.p0),s=m.signedArea(e.p0,e.p1,t.p1),r=ft(s-n,n);if(r<0||r>1||Number.isNaN(r))return;let o=m.signedArea(t.p0,t.p1,e.p0),a=m.signedArea(t.p0,t.p1,e.p1),c=ft(a-o,o);if(c<0||c>1||Number.isNaN(c))return;let h=t.p0.lerp(t.p1,r),p=e.p0.lerp(e.p1,c);i.push(h.lerp(p,.5))}};function xn(u,t,e){let i=e.x-.5,n=e.y-.5,s=e.x+.5,r=e.y+.5;if(u.x<i&&t.x<i||u.y<n&&t.y<n||u.x>s&&t.x>s||u.y>r&&t.y>r)return;let o=t.x-u.x,a=t.y-u.y,c=(i-u.x)/o,h=(s-u.x)/o,p=(n-u.y)/a,l=(r-u.y)/a;if(o===0){if(u.x===s)return;c=p,h=l}if(a===0){if(u.y===r)return;p=c,l=h}let d=Math.max(Math.min(c,h),Math.min(p,l)),b=Math.min(Math.max(c,h),Math.max(p,l)),f;if(d===b){let w=u.lerp(t,d);w.x===i&&w.y===n&&(f=[d,b])}else d<b&&(d>=0&&d<=1?f=[d,b]:b>=0&&b<=1&&(f=[b,d]));return f}function ke(u){let t=Math.round(u.x),e=Math.round(u.y);return new m(t,e)}var st=class{booleanOperator;flattenTolerance;snapRound;status;windingOperatorA;windingOperatorB;constructor(t){this.status=new at(nt.compareStatus),this.snapRound=new It,this.snapRound.precision=t.clipPrecision,this.flattenTolerance=t.flattenTolerance,this.booleanOperator=ut.booleanOperator,this.windingOperatorA=ut.windingOperatorA,this.windingOperatorB=ut.windingOperatorB}addCurve(t,e=0,i=1,n=!1,s){this.snapRound.addSegment(t,e,i,n,s)}addEdge(t,e=0,i=1,n=!1,s){this.snapRound.addSegment(t.toBezier(),e,i,n,s)}addMesh(t,e=0,i=1,n=!1){for(let s of t.getChains())for(let r of s.getEdgeIterator())r.seg!==void 0&&this.snapRound.addSegment(r.seg,e,i,n,r.data);for(let s of t.getFaces())for(let r of s.getEdgeIterator())r.seg!==void 0&&this.snapRound.addSegment(r.seg,e,i,n,r.data)}addPath(t,e=0,i=1,n=!1){let s=t.flatten(!1,{flattenMode:1,flattenTolerance:this.flattenTolerance});for(let r of s.getCurveIterator())this.snapRound.addSegment(r,e,i,n,void 0)}process(t,e){this.booleanOperator=e.booleanOperator,this.windingOperatorA=e.windingOperatorA,this.windingOperatorB=e.windingOperatorB,this.status.clear();let i=xe(this.snapRound);for(let n of i)if(n.left)this.status.insert(n);else{let s=this.status.findIndexBy(c=>c.seg===n.seg);if(s<0){g.error("PathClip2: Status event segment {} not found",n.seg);continue}let r=this.status.getAt(s),[o,a]=this.isIncOut(r);if(o){let c=new C(r.p0,r.p1);t.addChainSegment(c,r.seg.ref.data)}else if(a){let c=new C(r.p1,r.p0);t.addChainSegment(c,r.seg.ref.data)}this.status.removeAt(s)}this.snapRound.clear()}setQualityOptions(t){this.snapRound.precision=t.clipPrecision,this.flattenTolerance=t.flattenTolerance}isIncOut(t){if(t.wind===0)return[!1,!1];let e=0,i=0,n=0,s=0,r=!1;for(let p=this.status.length-1;p>=0;p--){let l=this.status.getAt(p);if(l.eq(t))l.seg.ref.set===0?e-=l.wind:n-=l.wind,l.wind=0,r=!0;else if(!r)l.seg.ref.set===0?i-=l.wind:s-=l.wind;else break}e+=i,n+=s;let[o,a]=te(e,i,this.windingOperatorA),[c,h]=te(n,s,this.windingOperatorB);return Yi(o,a,c,h,this.booleanOperator)}};var P=class{commands;points;constructor(){this.commands=[],this.points=[]}addArc(t,e,i){this.moveTo(t),this.arcTo(e,i)}addCircle(t,e){this.addCircleXY(t.x,t.y,e)}addCircleXY(t,e,i){this.moveToXY(t+i,e),this.arcToXY(t+i,e+i,t,e+i),this.arcToXY(t-i,e+i,t-i,e),this.arcToXY(t-i,e-i,t,e-i),this.arcToXY(t+i,e-i,t+i,e)}addConic(t,e,i,n){this.moveTo(t),this.conicTo(e,i,n)}addCubic(t,e,i,n){this.moveTo(t),this.cubicTo(e,i,n)}addCurveSplines(...t){if(t.length!==0){this.moveTo(t[0].p0);for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case 0:{this.lineTo(i.p1);break}case 1:{this.quadTo(i.p1,i.p2);break}case 2:{this.cubicTo(i.p1,i.p2,i.p3);break}case 3:{this.conicTo(i.p1,i.p2,i.w);break}default:B(i)}}}}addEllipse(t,e,i){this.addEllipseXY(t.x,t.y,e,i)}addEllipseXY(t,e,i,n){this.moveToXY(t+i,e),this.arcToXY(t+i,e+n,t,e+n),this.arcToXY(t-i,e+n,t-i,e),this.arcToXY(t-i,e-n,t,e-n),this.arcToXY(t+i,e-n,t+i,e),this.close()}addLine(t,e){this.moveTo(t),this.lineTo(e)}addLineXY(t,e,i,n){let s=new m(t,e),r=new m(i,n);this.addLine(s,r)}addPath(t,e=!1){e&&t.isValid()?(Gt(t.commands,1,this.commands,this.commands.length,t.commands.length-1),Gt(t.points,1,this.points,this.points.length,t.points.length-1)):(Gt(t.commands,0,this.commands,this.commands.length,t.commands.length),Gt(t.points,0,this.points,this.points.length,t.points.length))}addPathReversed(t,e=!1){e&&t.isValid()?(yi(t.commands,1,this.commands,this.commands.length,t.commands.length-1),di(t.points,0,this.points,this.points.length,t.points.length-1)):(yi(t.commands,0,this.commands,this.commands.length,t.commands.length),di(t.points,0,this.points,this.points.length,t.points.length))}addPie(t,e,i,n,s){Math.abs(s)>2*Math.PI&&(s%=2*Math.PI);let r=Math.sin(n),o=Math.cos(n),a=R.fromRotation(r,o);a.scalePre(e,i),a.translatePre(t.x,t.y),s<0&&a.scalePost(1,-1),s=Math.abs(s),r=Math.sin(s),o=Math.cos(s);let c=new v(1,0),h=new v(1,1),p=new v(o,r);for(this.moveTo(t),this.lineTo(a.mapVector(c).toPoint());s>.5*Math.PI+.005;){c=c.normal.neg;let b=a.mapVector(h).toPoint(),f=a.mapVector(c).toPoint();this.arcTo(b,f),h=h.normal.neg,s-=.5*Math.PI}h=c.add(p),h=h.mul(2).div(h.dot(h)),o=Math.sqrt(.5*c.dot(p)+.5);let l=a.mapVector(h).toPoint(),d=a.mapVector(p).toPoint();this.conicTo(l,d,o),this.close()}addQuad(t,e,i){this.moveTo(t),this.quadTo(e,i)}addRect(t,e){this.addRectXY(t.x,t.y,e.x,e.y)}addRectXY(t,e,i,n){this.moveToXY(t,e),this.lineToXY(i,e),this.lineToXY(i,n),this.lineToXY(t,n),this.close()}arcTo(t,e){this.conicTo(t,e,.7071067811865476)}arcToXY(t,e,i,n){let s=new m(t,e),r=new m(i,n);this.arcTo(s,r)}clear(){this.commands=[],this.points=[]}clip(t,e,i){let n=new L,s=new st({...W,...i});return s.addPath(this,0),s.addPath(t,1),s.process(n,{...ut,...e}),n.getFacesPath()}close(){this.commands.push({type:5})}conicTo(t,e,i){this.commands.push({type:4,w:i}),this.points.push(t),this.points.push(e)}conicToXY(t,e,i,n,s){let r=new m(t,e),o=new m(i,n);this.conicTo(r,o,s)}copyFrom(t){this.commands=t.commands.slice(),this.points=t.points.slice()}cubicTo(t,e,i){this.commands.push({type:3}),this.points.push(t),this.points.push(e),this.points.push(i)}cubicToXY(t,e,i,n,s,r){let o=new m(t,e),a=new m(i,n),c=new m(s,r);this.cubicTo(o,a,c)}dash(t,e){let i=new P;return tn({...W,...e}).process(this,i,{...Gi,...t}),i}flatten(t=!1,e){let i=new P;return Fe({...W,...e}).process(this,i,t),i}getBounds(){let t=I.empty;for(let e of this.getCurveIterator())t.union(e.getBounds());return t}getCommands(){return this.commands}getCurveIterator(){return new le(this.commands,this.points)}getFirstCommand(){return this.commands[0]}getFirstPoint(){return this.points[0]}getLastCommand(){return this.commands[this.commands.length-1]}getLastPoint(){return this.points[this.points.length-1]}getPoints(){return this.points}getSignedArea(){let t=0;for(let e of this.getCurveIterator())t+=e.getSignedArea();return t}getSvgData(){let t=this.getCommands(),e=this.getPoints(),i=0,n=0,s="";for(;i<t.length;){let r=t[i++];switch(r.type){case 0:{let o=e[n++];s+=`M${o.x} ${o.y}`;break}case 1:{let o=e[n++];s+=`L${o.x} ${o.y}`;break}case 2:{let o=e[n++],a=e[n++];s+=`Q${o.x} ${o.y} ${a.x} ${a.y}`;break}case 3:{let o=e[n++],a=e[n++],c=e[n++];s+=`C${o.x} ${o.y} ${a.x} ${a.y} ${c.x} ${c.y}`;break}case 4:{let o=e[n++],a=e[n++];s+=`L${o.x} ${o.y} L${a.x} ${a.y}`;break}case 5:{s+="Z";break}default:B(r)}}return s}hasPointInside(t,e){if(!this.isValid())return!1;let i=0;for(let n of this.getCurveIterator()){let s=n.getControlBounds();t.y<s.y0||t.y>s.y1||t.x<s.x0||(i+=n.getWindingAt(t))}switch(e){case 0:return i!==0;case 1:return(i&1)!==0;case 2:return i>0;case 3:return i<0;default:return e(i)}}isClosed(){return this.getLastCommand()?.type===5}isValid(){return this.getFirstCommand()?.type===0}lineTo(t){this.commands.push({type:1}),this.points.push(t)}lineToXY(t,e){let i=new m(t,e);this.lineTo(i)}moveTo(t){this.commands.push({type:0}),this.points.push(t)}moveToXY(t,e){let i=new m(t,e);this.moveTo(i)}offset(t,e){let i=new P;return _i({...W,...e}).process(this,i,{...Ji,...t}),i}quadTo(t,e){this.commands.push({type:2}),this.points.push(t),this.points.push(e)}quadToXY(t,e,i,n){let s=new m(t,e),r=new m(i,n);this.quadTo(s,r)}simplify(t){let e=new P;return ji({...W,...t}).process(this,e),e}stroke(t,e){let i=new P;return ze({...W,...e}).process(this,i,{...Pt,...t}),i}svgArcTo(t,e,i,n,s,r){let o=this.getLastPoint();if(o===void 0||o===t||e===0||i===0){this.lineTo(t);return}let a=Math.sin(n),c=Math.cos(n),h=R.fromRotation(-a,c),p=o.sub(t).mul(.5);p=h.mapVector(p),e=Math.abs(e),i=Math.abs(i);let l=p.x*p.x/(e*e)+p.y*p.y/(i*i);l>1&&(l=Math.sqrt(l),e*=l,i*=l),h.scalePre(1/e,1/i);let d=h.mapPoint(o),b=h.mapPoint(t);p=b.sub(d).mul(.5);let f=d.add(p),w=p.lengthSq;w<1&&(p=p.normal.neg.mul(Math.sqrt(1/w-1)),s!==r?f=f.add(p):f=f.add(p.neg));let T=d.sub(f),Z=b.sub(f);h.rotateSet(T.y,T.x),h.translatePre(f.x,f.y),h.scalePre(e,i),h.rotatePre(a,c),a=T.cross(Z),c=T.dot(Z);let tt=Math.atan2(a,c);for(r?(tt<0&&(tt+=2*Math.PI),Z=new v(c,a)):(tt>0&&(tt-=2*Math.PI),h.scalePost(1,-1),Z=new v(c,-a),tt=Math.abs(tt)),T=new v(1,0),p=new v(1,1);tt>.5*Math.PI+.005;)T=T.normal.neg,d=h.mapVector(p).toPoint(),b=h.mapVector(T).toPoint(),this.arcTo(d,b),p=p.normal.neg,tt-=.5*Math.PI;p=T.add(Z),p=p.mul(2).div(p.dot(p)),d=h.mapVector(p).toPoint(),b=t,c=Math.sqrt(.5*(1+T.dot(Z))),this.conicTo(d,b,c)}toMesh(t,e){let i=new L,n=new st({...W,...e});return n.addPath(this,0),n.process(i,{...ut,windingOperatorA:t}),i}toMultiPolygon(t,e){return this.toMesh(t,e).getFaces().map(n=>new V(n.getPoints()))}transform(t){let e=this.points;for(let i=0;i<e.length;i++)e[i]=t.mapPoint(e[i])}};var x=class{chain;data;face;lnext;onext;p0;seg;sym;constructor(t,e,i){this.p0=t,this.seg=e,this.data=i,this.lnext=this,this.onext=this,this.sym=this,this.chain=void 0,this.face=void 0}get left(){return this.p0.x!==this.p1.x?this.p0.x<this.p1.x:this.p0.y<this.p1.y}get lprev(){return this.onext.sym}get oprev(){return this.sym.lnext}get p1(){return this.sym.p0}get vector(){return this.p1.sub(this.p0)}static clear(t){t.lnext=t,t.onext=t,t.sym=t,t.chain=void 0,t.face=void 0}static compareQueue(t,e){return t.p0.x!==e.p0.x?t.p0.x-e.p0.x:t.p0.y!==e.p0.y?t.p0.y-e.p0.y:t.left!==e.left?t.left?1:-1:t.left?m.signedArea(t.p1,t.p0,e.p1):m.signedArea(t.p0,t.p1,e.p1)}static compareStatus(t,e){return t.p0.eq(e.p0)?t.p1.eq(e.p1)?0:m.signedArea(t.p0,t.p1,e.p1):x.compareQueue(t,e)<0?m.signedArea(t.p0,t.p1,e.p0):m.signedArea(e.p1,e.p0,t.p0)}static createPair(t,e){let i=new x(t.p0,t,void 0),n=new x(t.p1,e,void 0);return i.sym=n,i.lnext=n,n.sym=i,n.lnext=i,i}static detachPair(t){x.splice(t,t.oprev),x.splice(t.sym,t.sym.oprev)}static findConnectingEdge(t,e){if(t===t.onext)return t;let i=t;do{let n=i.onext;if(v.isBetweenCcw(e,i.vector,n.vector))return i;i=n}while(i!==t);return g.error("Mesh2: Cannot find connecting edge (Fallback)"),t}static isJoin(t,e){return t.p1.eq(e.p0)}static join(t,e){let i=t.sym,n=e.sym;t.lnext=e,e.onext=i,i.onext=e,n.lnext=i}static splice(t,e){let i=t.onext,n=e.onext;i.sym.lnext=e,n.sym.lnext=t,t.onext=n,e.onext=i}static swap(t){let e=t.face,i=t.sym.face;if(e===void 0||i===void 0)return;let n=t.oprev,s=t.lnext;x.splice(t,n),x.splice(t.sym,s),x.splice(t,n.lnext),x.splice(t.sym,s.lnext);let r=new C(n.p1,s.p1);t.p0=r.p0,t.seg=r,t.sym.p0=r.p1,t.sym.seg=r.reverse(),e.start=t,G.updateEdgeFaces(e,e),i.start=t.sym,G.updateEdgeFaces(i,i)}clonePair(){let t=this.sym,e=new x(this.p0,this.seg,this.data),i=new x(t.p0,t.seg,t.data);return e.sym=i,e.lnext=i,i.sym=e,i.lnext=e,e}getLnextIterator(){return new Nt(this,this.lprev)}getOnextIterator(){return new pe(this,this.oprev)}needsSwap(){if(this.face===void 0||this.sym.face===void 0)return!1;let t=this.p0,e=this.sym.p0,i=this.lnext.p1,n=this.sym.lnext.p1,s=t.sub(n),r=e.sub(n),o=i.sub(n),a=s.lengthSq*r.cross(o),c=r.lengthSq*s.cross(o),h=o.lengthSq*s.cross(r);return a-c+h>0}toString(){return`{p0: ${this.p0}, p1: ${this.p1}}`}validate(){A(this.sym!==this),A(this.sym.sym===this),A(this.lnext.onext.sym===this),A(this.onext.sym.lnext===this),A(this.seg!==void 0==(this.face!==void 0));let t=this.onext;do{let e=t.oprev,i=t.onext;e!==i&&(A(t.p0.eq(e.p0)&&t.p0.eq(i.p0)),A(v.isBetweenCcw(t.vector,e.vector,i.vector))),t=t.onext}while(t!==this.onext)}},rt=class{data;head;tail;constructor(t,e,i){this.head=t,this.tail=e,this.data=i}static updateEdgeChains(t,e){for(let i of t.getEdgeIterator())i.chain=e}getEdgeIterator(){return new Nt(this.tail,this.head)}isClosed(){return x.isJoin(this.head,this.tail)}printDebug(){let t=`MeshChain2 {
`;for(let e of this.getEdgeIterator())t+=`    MeshEdge2 ${e}
`;t+="}",g.infoDebug("{}",t)}writeToPath(t){let e=this.getEdgeIterator(),i=e.next();for(i.done!==!0&&(t.moveTo(i.value.p0),i=e.next());i.done!==!0;)t.lineTo(i.value.p0),i=e.next()}},G=class{data;start;constructor(t,e){this.start=t,this.data=e}static updateEdgeFaces(t,e){for(let i of t.getEdgeIterator())i.face=e}getEdgeIterator(){return new Nt(this.start,this.start.lprev)}getEdges(){let t=[];for(let e of this.getEdgeIterator())t.push(e);return t}getPoints(){let t=[];for(let e of this.getEdgeIterator())t.push(e.p0);return t}getSignedArea(){let t=0;for(let e of this.getEdgeIterator()){let i=e.seg??new C(e.p0,e.p1);t+=i.getSignedArea()}return t}hasPointInside(t){let e=0;for(let i of this.getEdgeIterator()){let n=i.seg??new C(i.p0,i.p1);e+=n.getWindingAt(t)}return e!==0}isMonotoneInX(){let t=this.start.lprev,e=0,i=t.p1.x-t.p0.x;for(let n of this.getEdgeIterator()){let s=n.p1.x-n.p0.x;(i>0||s>0)&&(i<0||s<0)&&(e+=1),i=s}return e<=2}printDebug(){let t=`MeshFace2 {
`;for(let e of this.getEdgeIterator())t+=`    MeshEdge2 ${e}
`;t+="}",g.infoDebug("{}",t)}writeToPath(t){let e=this.getEdgeIterator(),i=e.next();for(i.done!==!0&&(t.moveTo(i.value.p0),i=e.next());i.done!==!0;)t.lineTo(i.value.p0),i=e.next();t.close()}},L=class{chains;edges;faces;constructor(){this.chains=[],this.edges=[],this.faces=[]}static createFromChain(t){let e=new L,i=t.getEdgeIterator(),n=i.curr.clonePair();e.edges.push(n),i.next();let s=n;for(let o of i){let a=o.clonePair();e.edges.push(a),x.join(s,a),s=a}let r=new rt(n,s,t.data);return rt.updateEdgeChains(r,r),e.chains.push(r),e}static createFromFace(t){let e=new L,i=t.getEdgeIterator(),n=i.curr.clonePair();e.edges.push(n),i.next();let s=n;for(let o of i){let a=o.clonePair();x.join(s,a),e.edges.push(a),s=a}x.join(s,n);let r=new G(n,t.data);return G.updateEdgeFaces(r,r),e.faces.push(r),e}addChainSegment(t,e){let i=this.createEdge(t);i.data=e;for(let n of this.chains){if(x.isJoin(n.head,i))return this.chainAddHead(n,i),i;if(x.isJoin(i,n.tail))return this.chainAddTail(n,i),i}return this.createChain(i,i),i}clear(){for(let t of this.edges)x.clear(t);this.chains=[],this.edges=[],this.faces=[]}clone(){let t=new L,e=new Map;for(let i=0;i<this.edges.length;i++){let n=this.edges[i],s=new x(n.p0,n.seg,n.data);t.edges.push(s),e.set(n,i)}for(let i=0;i<this.edges.length;i++){let n=this.edges[i],s=t.edges[i],r=e.get(n.sym),o=e.get(n.lnext),a=e.get(n.onext);r!==void 0&&(s.sym=t.edges[r]),o!==void 0&&(s.lnext=t.edges[o]),a!==void 0&&(s.onext=t.edges[a])}for(let i of this.chains){let n=e.get(i.head),s=e.get(i.tail);if(n!==void 0&&s!==void 0){let r=new rt(t.edges[n],t.edges[s],i.data);rt.updateEdgeChains(r,r),t.chains.push(r)}}for(let i of this.faces){let n=e.get(i.start);if(n!==void 0){let s=new G(t.edges[n],i.data);G.updateEdgeFaces(s,s),t.faces.push(s)}}return t}connectEdgePoints(t,e){let i=e.p0.sub(t.p0);if(i.isZero()){let n=x.findConnectingEdge(t,e.vector),s=x.findConnectingEdge(e,t.vector);this.connectEdges(n,s)}else{let n=x.findConnectingEdge(t,i),s=x.findConnectingEdge(e,i.neg);this.connectEdges(n,s)}}connectEdges(t,e){if(t!==e){if(t.face===void 0||e.face===void 0){g.error("Mesh2: At least one face is undefined");return}if(t.p0.eq(e.p0))x.splice(t,e);else{let i=new C(t.p0,e.p0),n=this.createEdge(i,i.reverse());x.splice(t,n),x.splice(e,n.sym)}if(t.face===e.face){let i=t.face;i.start=t,G.updateEdgeFaces(i,i);let n=this.createFace(e);n.data=i.data,G.updateEdgeFaces(n,n)}else{let i=e.face;G.updateEdgeFaces(i,t.face);let n=this.destroyFace(i);A(n,"Unable to destroy face")}}}createChain(t,e){let i=new rt(t,e,void 0);return this.chains.push(i),i}createEdge(t,e){let i=x.createPair(t,e);return this.edges.push(i,i.sym),i}createFace(t){let e=new G(t,void 0);return this.faces.push(e),e}deleteEdgePair(t){x.detachPair(t),t.chain=void 0,t.face=void 0,t.sym.chain=void 0,t.sym.face=void 0;let e=this.destroyEdge(t),i=this.destroyEdge(t.sym);A(e&&i,"Unable to destroy edges")}deleteFace(t){let e=t.start,i=e,n=i.lnext;do i=n,n=i.lnext,i.sym.face===void 0?this.deleteEdgePair(i):i.face=void 0;while(i!==e);let s=this.destroyFace(t);A(s,"Unable to destroy face")}destroyChain(t){let e=this.chains.indexOf(t);return e<0?!1:(this.chains.splice(e,1),!0)}destroyEdge(t){let e=this.edges.indexOf(t);return e<0?!1:(this.edges.splice(e,1),!0)}destroyFace(t){let e=this.faces.indexOf(t);return e<0?!1:(this.faces.splice(e,1),!0)}finalizeChain(t){let e=this.createFace(t.tail);e.data=t.data;let i=this.destroyChain(t);A(i,"Unable to destroy chain");for(let n of e.getEdgeIterator())n.face=e,n.chain=void 0}getChains(){return this.chains}getChainsPath(){let t=new P;for(let e of this.chains)e.writeToPath(t);return t}getEdges(){return this.edges}getFaces(){return this.faces}getFacesPath(){let t=new P;for(let e of this.faces)e.writeToPath(t);return t}getFacesPaths(){let t=[];for(let e of this.faces){let i=new P;e.writeToPath(i),t.push(i)}return t}monotonize(){let t=this.edges.filter(e=>e.face!==void 0);t.sort((e,i)=>x.compareQueue(e,i)),this.monotoneProcess(t)}monotonizeFaces(t){let e=[];for(let i of t)for(let n of i.getEdgeIterator())e.push(n);e.sort((i,n)=>x.compareQueue(i,n)),this.monotoneProcess(e)}printDebug(){let t=`Mesh2 {
`;for(let e of this.getChains()){t+=`    MeshChain2 {
`;for(let i of e.getEdgeIterator())t+=`        MeshEdge2 ${i}
`;t+=`    }
`}for(let e of this.getFaces()){t+=`    MeshFace2 {
`;for(let i of e.getEdgeIterator())t+=`        MeshEdge2 ${i}
`;t+=`    }
`}t+="}",g.infoDebug("{}",t)}triangulate(t=!1){this.monotonize();let e=this.faces.length;for(let i=0;i<e;i++)this.triangulateProcess(this.faces[i]);t&&this.triangulateOptimize()}triangulateAddPoint(t){for(let e of this.faces)if(e.hasPointInside(t)){let i=e.start,n=i.lnext,s=n.lnext,r=new C(t,i.p0),o=new C(t,n.p0),a=new C(t,s.p0),c=this.createEdge(r,r.reverse()),h=this.createEdge(o,o.reverse()),p=this.createEdge(a,a.reverse());x.splice(c,h),x.splice(h,p),x.splice(i,c.sym),x.splice(n,h.sym),x.splice(s,p.sym);let l=new G(n,void 0),d=new G(s,void 0);G.updateEdgeFaces(e,e),G.updateEdgeFaces(l,l),G.updateEdgeFaces(d,d),this.faces.push(l),this.faces.push(d);return}}triangulateOptimize(){let t=0;for(;t<this.edges.length;){let e=this.edges[t];e.needsSwap()?(x.swap(e),t=0):t++}}validate(){for(let t of this.edges)t.validate()}chainAddHead(t,e){x.join(t.head,e),t.head=e,t.isClosed()?(x.join(t.head,t.tail),this.finalizeChain(t)):this.chainCheckTails(t)}chainAddTail(t,e){x.join(e,t.tail),t.tail=e,t.isClosed()?(x.join(t.head,t.tail),this.finalizeChain(t)):this.chainCheckHeads(t)}chainCheckHeads(t){for(let e of this.chains)if(e!==t&&x.isJoin(e.head,t.tail)){x.join(e.head,t.tail),t.tail=e.tail;let i=this.destroyChain(e);A(i,"Unable to destroy chain"),t.isClosed()&&(x.join(t.head,t.tail),this.finalizeChain(t));return}}chainCheckTails(t){for(let e of this.chains)if(e!==t&&x.isJoin(t.head,e.tail)){x.join(t.head,e.tail),t.head=e.head;let i=this.destroyChain(e);A(i,"Unable to destroy chain"),t.isClosed()&&(x.join(t.head,t.tail),this.finalizeChain(t));return}}monotoneDelete(t,e,i){let n=t.findIndex(e);if(n<0){g.error("Mesh2: Unable to delete status");return}let s=t.getValueAt(n);s.isMerge===!0&&this.connectEdgePoints(i,s.helper),t.removeAt(n)}monotoneInsert(t,e){t.insert(e,{helper:e,face:e.face,isMerge:!1})}monotoneProcess(t){let e=new Vt(x.compareStatus);for(let i of t){let n=i.lprev,s=i;if(s.seg===void 0){g.error("Mesh2: Unable to get segment");continue}let r=n.p0,o=s.p0,a=s.p1,c=o.sub(r),h=a.sub(o),p=c.cross(h);if(p>0){if(r.x>=o.x&&o.x<a.x){this.monotoneInsert(e,s);continue}if(r.x<=o.x&&o.x>a.x){this.monotoneDelete(e,n,s);continue}}else if(p<0){if(r.x>o.x&&o.x<=a.x){this.monotoneUpdate(e,s,!1,!0),this.monotoneInsert(e,s);continue}if(r.x<o.x&&o.x>=a.x){this.monotoneDelete(e,n,s),this.monotoneUpdate(e,s,!0,!1);continue}}o.lt(a)?(this.monotoneDelete(e,n,s),this.monotoneInsert(e,s)):this.monotoneUpdate(e,s,!1,!1)}}monotoneUpdate(t,e,i,n){let s=t.findIndexNearestEnd(e);if(s<0){g.error("Mesh2: Unable to update status");return}let r=t.getValueAt(s);(r.isMerge||n)&&this.connectEdgePoints(e,r.helper),r.helper=e,r.isMerge=i}triangulateProcess(t){let e=t.getEdges();e.sort((s,r)=>x.compareQueue(s,r));let i=[e[0],e[1]];for(let s=2;s<e.length-1;s++){let r=e[s],o=e[s-1],a=r.lnext.p0.eq(o.p0),c=o.lnext.p0.eq(r.p0);if(a||c)for(;i.length>1;){let h=i[i.length-1],p=i[i.length-2],l=m.signedArea(r.p0,h.p0,p.p0);if(a&&l>0||c&&l<0)this.connectEdgePoints(r,p),i.pop();else break}else{for(;i.length>1;){let h=i[i.length-1];this.connectEdgePoints(r,h),i.pop()}i.pop(),i.push(o)}i.push(r)}let n=e[e.length-1];for(let s=1;s<i.length-1;s++){let r=i[s];this.connectEdgePoints(n,r)}}};var yt=class{flattenTolerance;snapRound;status;windingOperator;constructor(t){this.status=new at(nt.compareStatus),this.snapRound=new It,this.snapRound.precision=t.clipPrecision,this.flattenTolerance=t.flattenTolerance,this.windingOperator=ut.windingOperatorA}addCurve(t,e=0,i=1,n=!1,s){this.snapRound.addSegment(t,e,i,n,s)}addEdge(t,e=0,i=1,n=!1,s){this.snapRound.addSegment(t.toBezier(),e,i,n,s)}addPath(t,e=0,i=1,n=!1){let s=t.flatten(!1,{flattenMode:1,flattenTolerance:this.flattenTolerance});for(let r of s.getCurveIterator())this.snapRound.addSegment(r,e,i,n,void 0)}process(t,e){this.windingOperator=e,this.status.clear();let i=xe(this.snapRound),n=new Dt;for(let s of i)if(s.left)this.status.insert(s);else{let r=this.status.findIndexBy(h=>h.seg===s.seg);if(r<0){g.error("PathOverlay2: Status event segment {} not found",s.seg);continue}let o=this.status.getAt(r);this.setState(o,n);let[a,c]=n.collectData(this.windingOperator);if(n.reset(),!Bt(a.tag,c.tag)){let h=new C(o.p1,o.p0),p=new C(o.p0,o.p1);this.addSegmentPair(t,h,p,a,c)}this.status.removeAt(r)}this.snapRound.clear()}setQualityOptions(t){this.snapRound.precision=t.clipPrecision}static isOpen(t,e){return t.p0.eq(e.p0)&&t!==e}addSegmentPair(t,e,i,n,s){let r=t.createEdge(e,i),o=r.sym;r.data=n,o.data=s;let a=t.getChains();for(let p of a)if(yt.isOpen(p.head.sym,r)){this.connectSegmentPair(t,p.head.sym,r,o,n,s);break}else if(yt.isOpen(r,p.tail)){this.connectSegmentPair(t,p.tail,r,o,n,s);break}for(let p of a)if(yt.isOpen(p.head.sym,o)){this.connectSegmentPair(t,p.head.sym,o,r,s,n);break}else if(yt.isOpen(o,p.tail)){this.connectSegmentPair(t,p.tail,o,r,s,n);break}let c=r.chain,h=o.chain;if(c===void 0){let p=t.createChain(r,r);p.data=n.tag,rt.updateEdgeChains(p,p)}else c.isClosed()&&t.finalizeChain(c);if(h===void 0){let p=t.createChain(o,o);p.data=s.tag,rt.updateEdgeChains(p,p)}else h.isClosed()&&t.finalizeChain(h)}connectSegmentPair(t,e,i,n,s,r){let o=x.findConnectingEdge(i,e.vector),a=x.findConnectingEdge(e,i.vector);x.splice(o,a);let c=i.lprev.chain,h=n.lnext.chain;if(c===void 0||h===void 0){g.error("PathOverlay: No chain");return}if(c===h){g.error("PathOverlay: Chain would need splitting");return}let p=c.data,l=h.data;if(Bt(p,s.tag)){if(i.chain===void 0)i.chain=c,c.head=i;else if(i.chain!==c){rt.updateEdgeChains(c,i.chain),i.chain.tail=c.tail;let d=t.destroyChain(c);A(d,"Unable to destroy chain")}}if(Bt(l,r.tag)){if(n.chain===void 0)n.chain=h,h.tail=n;else if(n.chain!==h){rt.updateEdgeChains(h,n.chain),n.chain.head=h.head;let d=t.destroyChain(h);A(d,"Unable to destroy chain")}}}setState(t,e){if(t.wind===0)return;let i=!1;for(let n=this.status.length-1;n>=0;n--){let s=this.status.getAt(n),r=s.seg.ref,o=e.getEntry(r.set);if(s.eq(t))o.w0-=s.wind,o.refs.push(r),s.wind=0,i=!0;else if(!i)o.w1-=s.wind;else break}}};function Xt(u,t,e,i,n){let s=new P;switch(s.moveTo(new m(i*u.nextFloat(),n*u.nextFloat())),t){case 0:{for(let r=0;r<e;r++){let o=new m(i*u.nextFloat(),n*u.nextFloat());s.lineTo(o)}break}case 1:{for(let r=0;r<e;r++){let o=new m(i*u.nextFloat(),n*u.nextFloat()),a=new m(i*u.nextFloat(),n*u.nextFloat());s.quadTo(o,a)}break}case 2:{for(let r=0;r<e;r++){let o=new m(i*u.nextFloat(),n*u.nextFloat()),a=new m(i*u.nextFloat(),n*u.nextFloat()),c=new m(i*u.nextFloat(),n*u.nextFloat());s.cubicTo(o,a,c)}break}case 3:{for(let r=0;r<e;r++){let o=new m(i*u.nextFloat(),n*u.nextFloat()),a=new m(i*u.nextFloat(),n*u.nextFloat());s.conicTo(o,a,4*u.nextFloat())}break}}return s}function Mt(u,t,e,i,n){let s=new V,r=new V;switch(t){case 0:{let c=u.nextIntBetween(3,50),h=u.nextIntBetween(3,50);for(let p=0;p<c;p++)s.addPoint(new m(i*u.nextFloat(),n*u.nextFloat()));for(let p=0;p<h;p++)r.addPoint(new m(i*u.nextFloat()+e,n*u.nextFloat()));break}case 1:{s.addXY(100,100),s.addXY(400,150),s.addXY(450,400),s.addXY(150,450),r.addXY(300+e,300),r.addXY(600+e,350),r.addXY(650+e,600),r.addXY(350+e,650);break}case 2:{s.addXY(100,100),s.addXY(400,100),s.addXY(400,400),s.addXY(100,400),r.addXY(200+e,150),r.addXY(300+e,150),r.addXY(300+e,350),r.addXY(200+e,350);break}case 3:{s.addXY(100,100),s.addXY(150,500),s.addXY(550,500),s.addXY(500,100),r.addXY(250+e,200),r.addXY(450+e,200),r.addXY(400+e,400),r.addXY(200+e,400);break}case 4:{s.addXY(100,100),s.addXY(400,100),s.addXY(400,400),s.addXY(100,400),r.addXY(150,150+e),r.addXY(350,350+e),r.addXY(350,150+e),r.addXY(150,350+e);break}case 5:{s.addXY(100,300),s.addXY(200,250),s.addXY(300,200+.1*e),s.addXY(400,150),s.addXY(510,100),s.addXY(505,300);break}case 6:{s.addXY(100,100),s.addXY(600,400),s.addXY(200,400),s.addXY(300,200),s.addXY(400,300),s.addXY(500,100);break}}return[s,r]}function en(u,t,e,i,n){let s=new V,r=t.getCenter(),o=2*Math.PI/e,a=.5*t.dx,c=.5*t.dy;for(let h=0;h<e;h++){let p=h*o+o*u.nextFloatBetween(0,i),l=u.nextFloatBetween(n,1),d=a*l*Math.sin(p),b=c*l*Math.cos(p);s.addXY(r.x+d,r.y+b)}return s}function nn(u,t,e,i){return U.fromHsv(u.nextFloat(),t,e,i)}function Be(u,t){let e=u.nextFloatBetween(t.x0,t.x1),i=u.nextFloatBetween(t.y0,t.y1);return new m(e,i)}var Kt=class{canvas;context;constructor(t,e){this.canvas=t,this.context=e}static fromCanvas(t){let e=t.getContext("2d");if(e!==null)return new Kt(t,e)}blitImage(t,e,i){let n=t.toImageData();n!==void 0&&this.context.putImageData(n,e,i)}clear(t="#FFFFFF"){let e=this.context;e.resetTransform(),e.save(),e.fillStyle=t,e.fillRect(0,0,this.canvas.width,this.canvas.height),e.restore()}createLinePattern(t,e="#000000"){let i=document.createElement("canvas"),n=i.getContext("2d");if(n===null)return null;i.width=t,i.height=t,n.fillStyle=e;for(let s=0;s<t;s++)n.fillRect(s,s,1,1);return this.context.createPattern(i,"repeat")}drawBox(t,e="#000000",i=1){let n=this.context;n.save(),n.lineWidth=i,n.strokeStyle=e,n.strokeRect(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0),n.restore()}drawBoxes(t,e="#000000",i=1){let n=this.context;n.beginPath();for(let s of t)n.rect(s.x0,s.y0,s.x1-s.x0,s.y1-s.y0);n.save(),n.lineWidth=i,n.strokeStyle=e,n.stroke(),n.restore()}drawEdge(t,e="#000000",i=1){let n=this.context;n.beginPath(),n.moveTo(t.p0.x,t.p0.y),n.lineTo(t.p1.x,t.p1.y),n.save(),n.lineJoin="round",n.lineWidth=i,n.strokeStyle=e,n.stroke(),n.restore()}drawEdges(t,e="#000000",i=1){let n=this.context;n.beginPath();for(let s of t)n.moveTo(s.p0.x,s.p0.y),n.lineTo(s.p1.x,s.p1.y);n.save(),n.lineJoin="round",n.lineWidth=i,n.strokeStyle=e,n.stroke(),n.restore()}drawMeshEdges(t,e="#000000",i=1){let n=this.context;n.beginPath();for(let s of t.getEdges())n.moveTo(s.p0.x,s.p0.y),n.lineTo(s.p1.x,s.p1.y);n.save(),n.lineJoin="round",n.strokeStyle=e,n.lineWidth=i,n.stroke(),n.restore()}drawPath(t,e="#000000",i=1){let n=this.context;n.beginPath(),this.addPath(n,t),n.save(),n.lineJoin="round",n.lineCap="round",n.lineWidth=i,n.strokeStyle=e,n.stroke(),n.restore()}drawPolygon(t,e="#000000",i=1){let n=this.context;n.beginPath(),this.addPolygon(n,t),n.save(),n.lineJoin="round",n.lineWidth=i,n.strokeStyle=e,n.stroke(),n.restore()}fillBox(t,e="#000000"){let i=this.context;i.save(),i.fillStyle=e,i.fillRect(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0),i.restore()}fillBoxes(t,e="#000000"){let i=this.context;i.beginPath();for(let n of t)i.rect(n.x0,n.y0,n.x1-n.x0,n.y1-n.y0);i.save(),i.fillStyle=e,i.fill(),i.restore()}fillEdgePoints(t,e="#000000",i=1){let n=this.context;n.beginPath();for(let s of t)this.addCircle(n,s.p0,.5*i),this.addCircle(n,s.p1,.5*i);n.save(),n.fillStyle=e,n.fill(),n.restore()}fillMesh(t,e="#000000"){let i=this.context;i.beginPath();for(let n of t.getFaces())this.addMeshFaceToContext(i,n);i.save(),i.fillStyle=e,i.fill(),i.restore()}fillMeshRandom(t,e){let i=this.context;i.save();for(let n of t.getFaces())i.beginPath(),this.addMeshFaceToContext(i,n),i.fillStyle=nn(e,.25,1,1).style,i.fill();i.restore()}fillPath(t,e="#000000",i){let n=this.context;n.beginPath(),this.addPath(n,t),n.save(),n.fillStyle=e,n.fill(i),n.restore()}fillPoints(t,e="#000000",i=1){let n=this.context;n.beginPath();for(let s of t)this.addCircle(n,s,.5*i);n.save(),n.fillStyle=e,n.fill(),n.restore()}fillPolygon(t,e="#000000"){let i=this.context;i.beginPath(),this.addPolygon(i,t),i.save(),i.lineJoin="round",i.fillStyle=e,i.fill(),i.restore()}fillText(t,e,i="#000000",n="16px Verdana"){let s=this.context;s.save(),s.font=n,s.fillStyle=i;let r=s.measureText(t),o=e.x-.5*(r.actualBoundingBoxRight+r.actualBoundingBoxLeft),a=e.y-.5*(r.actualBoundingBoxDescent-r.actualBoundingBoxAscent);s.fillText(t,o,a),s.restore()}getSize(t){return t?[this.canvas.width,this.canvas.height]:[1400,700]}resize(t,e){t<0||e<0||(this.canvas.width=t,this.canvas.height=e)}setTransform(t,e,i,n,s,r){this.context.setTransform(t,e,i,n,s,r)}addCircle(t,e,i){t.moveTo(e.x+i,e.y),t.arcTo(e.x+i,e.y+i,e.x,e.y+i,i),t.arcTo(e.x-i,e.y+i,e.x-i,e.y,i),t.arcTo(e.x-i,e.y-i,e.x,e.y-i,i),t.arcTo(e.x+i,e.y-i,e.x+i,e.y,i),t.closePath()}addMeshFaceToContext(t,e){let i=e.start.p0;t.moveTo(i.x,i.y);for(let n of e.getEdgeIterator())t.lineTo(n.p1.x,n.p1.y);t.closePath()}addPath(t,e){if(!e.isValid())return;let i=e.getCommands(),n=e.getPoints(),s=0,r=0,o=m.zero;for(;s<i.length;){let a=i[s++];switch(a.type){case 0:{o=n[r++],t.moveTo(o.x,o.y);break}case 1:{let c=n[r++];t.lineTo(c.x,c.y),o=c;break}case 2:{let c=n[r++],h=n[r++];t.quadraticCurveTo(c.x,c.y,h.x,h.y),o=h;break}case 3:{let c=n[r++],h=n[r++],p=n[r++];t.bezierCurveTo(c.x,c.y,h.x,h.y,p.x,p.y),o=p;break}case 4:{let c=n[r++],h=n[r++],p=a.w,l=4/3*(p/(p+1)),d=o.lerp(c,l),b=h.lerp(c,l);t.bezierCurveTo(d.x,d.y,b.x,b.y,h.x,h.y),o=h;break}case 5:{t.closePath();break}default:B(a)}}}addPolygon(t,e){let i=e.getPoints();if(i.length!==0){t.moveTo(i[0].x,i[0].y);for(let n=1;n<i.length;n++)t.lineTo(i[n].x,i[n].y);t.closePath()}}},Zt=class{canvas;adapter;context;device;format;currentTexture;currentTextureView;constructor(t,e,i,n,s){this.canvas=t,this.format=i,this.adapter=n,this.context=e,this.device=s;let r=e.getCurrentTexture(),o=r.createView();this.currentTexture=r,this.currentTextureView=o}get height(){return this.canvas.height}get width(){return this.canvas.width}static async fromCanvas(t,e="premultiplied"){let i=navigator.gpu;if(i===void 0)return;let n=t.getContext("webgpu"),s=i.getPreferredCanvasFormat(),r=await i.requestAdapter();if(n===null||r===null)return;let o=await r.requestDevice();return n.configure({device:o,format:s,alphaMode:e}),new Zt(t,n,s,r,o)}beginFrame(){let t=this.context.getCurrentTexture(),e=t.createView();this.currentTexture=t,this.currentTextureView=e}getSize(t){return t?[this.width,this.height]:[1400,700]}resize(t,e){if(t<0||e<0)return;this.canvas.width=t,this.canvas.height=e;let i=this.device,n=this.format,s="premultiplied";this.context.configure({device:i,format:n,alphaMode:s})}};var Le=class{element;events;id;isBound;style;constructor(t,e){t.id=e,this.element=t,this.id=e,this.events=[],this.isBound=!1}addEventListener(t,e){this.isBound?Ct("Cannot add event listener on bound input element"):this.events.push({type:t,listener:e})}focus(){this.element.focus()}getElement(){return this.element}getId(){return this.id}register(t){if(this.isBound)Ct("Already bound");else{this.isBound=!0;for(let e of this.events)this.element.addEventListener(e.type,e.listener);this.style!==void 0&&this.element.setAttribute("style",this.style),t.appendChild(this.element),t.append(`
`)}}setStyle(t){this.style=t}unregister(){for(let e of this.events)this.element.removeEventListener(e.type,e.listener);let t=this.element.parentElement;t!==null&&t.removeChild(this.element),this.isBound=!1}},Ot=class extends Le{defaultValue;valueInputElement;constructor(t,e,i){super(t,e),t.value=i,this.valueInputElement=t,this.defaultValue=i}getDefaultValue(){return this.defaultValue}getFloat(){return parseFloat(this.getValue())}getInt(){return parseInt(this.getValue())}getValue(){return this.valueInputElement.value}setDefaultValue(t){this.defaultValue=t}setValue(t){this.valueInputElement.value=t}},Ft=class extends Le{constructor(t,e){let i=document.createElement("button");i.textContent=e,super(i,t)}},H=class extends Ot{constructor(t,e=""){let i=document.createElement("input");i.type="text",super(i,t,e)}},M=class extends Ot{constructor(t,e,i,n="0"){let s=document.createElement("input");s.type="range",s.className="slider",s.min=e,s.max=i,super(s,t,n)}},N=class extends Ot{selectElement;constructor(t,e=""){let i=document.createElement("select");super(i,t,e),this.selectElement=i}setOptionValues(...t){for(let e of t){let i=document.createElement("option");i.text=e,this.selectElement.appendChild(i)}this.selectElement.value=this.getDefaultValue()}};var ht=class{animationFrameContext;currentEntry;inputs;options;parts;time;inputAppPart;inputGenerator;inputRandomize;inputSeed;inputUpdate;constructor(t){this.options=t,this.animationFrameContext=new oe(window,this,ht.animationFrameCallback),this.inputs=new Map,this.parts=new Map,this.time=0,this.inputAppPart=new N("app"),this.inputAppPart.addEventListener("input",()=>this.onAppInput()),this.inputRandomize=new Ft("randomize","randomize"),this.inputRandomize.addEventListener("click",()=>this.onRandomizeClick()),this.inputSeed=new H("seed",this.getRandomSeed()),this.inputSeed.setStyle("width: 80px"),this.inputGenerator=new H("generator","0"),this.inputGenerator.setStyle("width: 25px"),this.inputUpdate=new Ft("update","update"),this.inputUpdate.addEventListener("click",()=>this.onUpdateClick())}static async createContext(){let t=ht.createElement("div",{id:"params",style:"height: 30px"}),e=ht.createElement("div",{id:"canvasContainer"}),i=ht.createElement("canvas",{id:"canvas2D",style:"border: 1px solid black"}),n=ht.createElement("canvas",{id:"canvasWebGPU",style:"border: 1px solid black"});document.body.appendChild(t),document.body.appendChild(e);let s=Kt.fromCanvas(i),r=await Zt.fromCanvas(n);return{canvasContainerElement:e,canvas2DContext:s,canvas2DElement:i,canvasWebGPUElement:n,webGPUContext:r}}addAppInput(t){let e=t.getId(),i=this.inputs.get(e);i!==void 0&&i.unregister(),this.inputs.set(e,t)}addCanvas2D(t,e,i){if(this.options.canvas2DContext===void 0)return;let n=this.parts.get(t);n!==void 0&&n.part.reset(),this.parts.set(t,{animationMode:e,part:new i(this,this.options.canvas2DContext),contextId:0})}addCanvasWebGPU(t,e,i){if(this.options.webGPUContext===void 0)return;let n=this.parts.get(t);n!==void 0&&n.part.reset(),this.parts.set(t,{part:new i(this,this.options.webGPUContext),animationMode:e,contextId:1})}init(t){this.inputAppPart.setDefaultValue(t),window.addEventListener("resize",()=>this.onResize(),!1),this.inputAppPart.setOptionValues(...this.parts.keys());let e=new URLSearchParams(window.location.search),i=e.get("app")??this.inputAppPart.getValue();this.currentEntry=this.parts.get(i),this.updateLayout();for(let[n,s]of e.entries()){let r=this.inputs.get(n);r instanceof Ot&&r.setValue(s)}this.resizeContext(),this.run(!0,!0)}requestUpdate(t=!1){t&&this.writeParams(),this.currentEntry!==void 0&&this.currentEntry.animationMode===0&&this.animationFrameContext.stepAnimation()}static animationFrameCallback(t,e){let i=e.time,n=t-i;e.currentEntry!==void 0&&(e.time=t,e.currentEntry.part.update(n),e.currentEntry.part.render())}static createElement(t,e){let i=document.createElement(t);for(let n in e)i.setAttribute(n,e[n]);return i}getRandomSeed(){return(16777215*Math.random()|0).toString()}onAppInput(){let t=this.inputAppPart.getValue(),e=this.parts.get(t);e!==void 0&&e!==this.currentEntry&&(this.currentEntry?.part.reset(),this.currentEntry=e,this.updateLayout()),this.run(!0,!0),this.inputAppPart.focus()}onRandomizeClick(){this.inputSeed.setValue(this.getRandomSeed()),this.run(!0,!0)}onResize(){this.resizeContext(),this.run(!1,!1)}onUpdateClick(){this.run(!0,!0)}resizeContext(){let t=window.innerWidth-20,e=window.innerHeight-50;this.options.canvas2DContext?.resize(t,e),this.options.webGPUContext?.resize(t,e)}run(t,e){e&&this.writeParams();let i=this.currentEntry;if(i===void 0)return;let n=this.options.canvasContainerElement;if(this.animationFrameContext.stopAnimation(),t){for(let s of n.childNodes)n.removeChild(s);i.part.create()}switch(i.contextId){case 0:{n.appendChild(this.options.canvas2DElement);break}case 1:{n.appendChild(this.options.canvasWebGPUElement);break}default:B(i.contextId)}switch(i.animationMode){case 1:{this.animationFrameContext.startAnimation();break}case 0:{this.animationFrameContext.stepAnimation();break}default:B(i.animationMode)}}updateLayout(){for(let e of this.inputs.values())e.unregister();this.inputs.clear(),this.addAppInput(this.inputAppPart),this.addAppInput(this.inputRandomize),this.addAppInput(this.inputSeed),this.addAppInput(this.inputGenerator),this.addAppInput(this.inputUpdate),this.currentEntry?.part.updateLayout();let t=document.getElementById("params");if(t!==null)for(let e of this.inputs.values())e.register(t)}writeParams(){let t=new URLSearchParams;for(let e of this.inputs.values())e instanceof Ot&&t.set(e.getId(),e.getValue());window.history.pushState(null,"","?"+t.toString())}};var De=class{bPlusTree;context;launcher;inputBranchSize;inputCount;inputLeafSize;constructor(t,e){this.launcher=t,this.context=e,this.inputBranchSize=new H("branchsize","4"),this.inputBranchSize.setStyle("width: 40px"),this.inputLeafSize=new H("leafsize","16"),this.inputLeafSize.setStyle("width: 40px"),this.inputCount=new M("count","0","128","32"),this.inputCount.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputCount.setStyle("width: 200px");let i=(n,s)=>Math.floor(n)-Math.floor(s);this.bPlusTree=new qe(i)}create(){}render(){this.context.clear(),this.drawBPlusTree(this.context,this.bPlusTree)}reset(){}update(t){let e=this.launcher.inputSeed.getInt(),i=this.inputBranchSize.getInt(),n=this.inputLeafSize.getInt(),s=this.inputCount.getInt(),r=F.fromSeedLcg(e),o=(c,h)=>Math.floor(c)-Math.floor(h),a=new qe(o,i,n);for(let c=1;c<=s;c++){let h=r.nextIntBetween(0,10)+.003*c;a.add(h)}g.assertFn(()=>a.validate(o),"Validation failed"),this.bPlusTree=a}updateLayout(){this.launcher.addAppInput(this.inputBranchSize),this.launcher.addAppInput(this.inputLeafSize),this.launcher.addAppInput(this.inputCount)}drawBPlusTree(t,e){o(e.getRootNode(),0,0);function o(c,h,p){if(c.type===0){a(c.keys,h,p,"#FF8888");for(let l of c.children)p=o(l,h+1,p+1);return p}else return a(c.values,h,p,"#8888FF"),p}function a(c,h,p,l){for(let d of c){let b=20+h*75,f=20+p*(26+10),w=I.fromXYWH(b,f,65,26);t.fillBox(w,l),t.fillText(d.toFixed(3),w.getCenter(),"#FFFFFF"),h++}}}},qe=class{branchSize;compareFn;leafSize;root;constructor(t,e,i){this.root=this.leafNodeCreate(void 0,0,[],void 0),this.compareFn=t,this.branchSize=e??16,this.leafSize=i??this.branchSize}add(t){let e=this.findLeafNode(this.root,t);e.length<this.leafSize?this.leafNodeAdd(e,t):this.leafNodeSplitAdd(e,t)}clear(){this.root=this.leafNodeCreate(void 0,0,[],void 0)}*getGenerator(){let t=this.getFirstLeaf();for(;;){for(let e=0;e<t.length;e++)yield t.values[e];if(t.next!==void 0)t=t.next;else return}}getRootNode(){return this.root}toArray(){let t=[];for(let e of this.getGenerator())t.push(e);return t}validate(t){let i=this.getGenerator().next();if(i.done===!0)return!0;let n=i.value;for(let r of this.getGenerator()){if(t(n,r)>0)return!1;n=r}return s(this.root,this.branchSize,this.leafSize);function s(r,o,a){let c=!0;if(r.type===0){c&&=r.length<=o;for(let h of r.children)c&&=s(h,o,a)}else c&&=r.length<=a;return c}}findLeafNode(t,e){if(t.type===0){let i=this.findNearestIndexEnd(t.keys,e);return this.findLeafNode(t.children[i],e)}else return t}findNearestIndexEnd(t,e,i=0){let n=this.compareFn,s=i,r=t.length;for(;s<r;){let o=s+r>>>1;n(e,t[o])<0?r=o:s=o+1}return s}getFirstLeaf(){let t=this.root;for(;t.type!==1;)t=t.children[0];return t}internalNodeAdd(t,e,i,n){let s=this.findNearestIndexEnd(t.keys,i);e.parent=t,t.keys.splice(s,0,n),t.children.splice(s+1,0,e),t.length+=1}internalNodeCreate(t,e,i,n){return{type:0,parent:t,length:e,keys:i,children:n}}internalNodeSplitAdd(t,e,i){let n=this.findNearestIndexEnd(t.keys,i);t.keys.splice(n,0,i);let s=t.length+2>>>1,r=n<s-1,o=r?s-1:s,[a]=t.keys.splice(s-1,1),c=t.length-o,h=t.keys.splice(s-1,c),p=t.children.splice(o,c),l=this.internalNodeCreate(t.parent,c,h,p);for(let d of p)d.parent=l;t.length=o,r?(e.parent=t,t.children.splice(n+1,0,e),t.length+=1):(e.parent=l,l.children.splice(n+1-o,0,e),l.length+=1),this.nodeAddToParent(t,l,i,a)}leafNodeAdd(t,e){let i=this.findNearestIndexEnd(t.values,e);t.values.splice(i,0,e),t.length+=1}leafNodeCreate(t,e,i,n){return{type:1,parent:t,length:e,values:i,next:n}}leafNodeSplitAdd(t,e){let i=t.length>>>1,n=this.compareFn(e,t.values[i])<0,s=n?i:i+1,r=t.length-s,o=t.values.splice(s,r),a=this.leafNodeCreate(t.parent,r,o,t.next);t.length=s,t.next=a,this.leafNodeAdd(n?t:a,e),this.nodeAddToParent(t,a,t.values[0],a.values[0])}nodeAddToParent(t,e,i,n){let s=t.parent;s!==void 0?s.length<this.branchSize?this.internalNodeAdd(s,e,i,n):this.internalNodeSplitAdd(s,e,n):this.nodeAddToRoot(t,e,n)}nodeAddToRoot(t,e,i){let n=this.internalNodeCreate(void 0,2,[i],[t,e]);t.parent=n,e.parent=n,this.root=n}};function Ve(u,t){return t.every(e=>e in u)}var Ht=class{data;entities;events;startupSystemEntries;systemEntries;updateQueue;constructor(){this.entities=new Map,this.data=new Map,this.events=new Map,this.systemEntries=[],this.startupSystemEntries=[],this.updateQueue=new Set}addComponent(t,e){let i=this.getComponents(t);i!==void 0&&(this.updateQueue.add(t),i[e.componentId]=e)}addComponents(t,...e){let i=this.getComponents(t);if(i!==void 0){this.updateQueue.add(t);for(let n of e)i[n.componentId]=n}}addSystem(t){t.startup===!0?this.startupSystemEntries.push(t):this.systemEntries.push(t)}clearEntities(){this.entities.clear()}createEntity(...t){let e=this.entities.size,i={};for(let n of t)i[n.componentId]=n;return this.entities.set(e,i),this.updateQueue.add(e),e}destroyEntity(t){return this.updateQueue.delete(t),this.entities.delete(t)}getComponent(t,e){let i=this.getComponents(t);if(i!==void 0)return i[e]}getComponents(t){return this.entities.get(t)}getTypedComponents(t,e){let i=this.getComponents(t);if(i!==void 0&&Ve(i,e))return i}loadEntities(t){this.clearEntities(),this.entities=Zi(t)}queryEntities(t){let e=[];for(let[i,n]of this.entities)Ve(n,t)&&e.push({entity:i,components:n});return e}queryEntitiesMatch(t,e){let i=[];for(let[n,s]of this.entities.entries())Ve(s,t)&&e(s)&&i.push({entity:n,components:s});return i}readData(t){let e=this.data.get(t);return e===void 0&&Ct("Cannot read data '{}'",t),e}readEvents(t){let e=this.events.get(t);return e===void 0&&Ct("Cannot get events '{}'",t),e}registerData(t){this.data.has(t.dataId)&&g.warn("World already has data type '{}' and will be overwritten",t.dataId),this.data.set(t.dataId,t)}registerEvent(t){this.events.has(t)&&g.warn("World already has event type '{}' and will be overwritten",t),this.events.set(t,[])}removeComponent(t,e){let i=this.getComponents(t);return i!==void 0?(this.updateQueue.add(t),delete i[e]):!1}removeSystem(t){let e=this.systemEntries.findIndex(i=>i.fn===t);return e>=0?(this.systemEntries.splice(e,1),!0):!1}saveEntities(){return Hi(this.entities)}start(){for(let{fn:t,args:e}of this.startupSystemEntries)e!==void 0?t(this,...e):t(this)}update(){for(let{fn:t,args:e}of this.systemEntries)e!==void 0?t(this,...e):t(this);this.updateQueue.clear();for(let t of this.events.keys())this.events.set(t,[])}updateEntity(t){this.updateQueue.add(t)}writeData(t){this.data.has(t.dataId)?this.data.set(t.dataId,t):Ct("Data '{}' not registered",t.dataId)}writeEvent(t){let e=this.events.get(t.eventId);e!==void 0?e.push(t):Ct("Event '{}' not registered",t.eventId)}};var Re=class{context;json;world;inputCount;inputLoad;inputSave;launcher;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputSave=new Ft("save","save"),this.inputSave.addEventListener("click",()=>this.onSaveClick()),this.inputLoad=new Ft("load","load"),this.inputLoad.addEventListener("click",()=>this.onLoadClick()),this.world=new Ht,this.world.addSystem({fn:sn,startup:!0,args:[this]}),this.world.addSystem({fn:yn}),this.world.addSystem({fn:wn}),this.world.addSystem({fn:Cn}),this.world.addSystem({fn:En}),this.world.registerData({dataId:"appContext",context:e}),this.world.registerData({dataId:"time",delta:0}),this.world.registerEvent("hello")}create(){this.reset(),this.world.start()}render(){}reset(){this.world.clearEntities()}update(t){this.context.clear(),this.world.writeData({dataId:"time",delta:t}),this.world.update()}updateLayout(){this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputSave),this.launcher.addAppInput(this.inputLoad)}onLoadClick(){this.json!==void 0&&(console.time("loadEntities"),this.world.loadEntities(this.json),console.timeEnd("loadEntities"),g.info("World loaded ({} bytes)",this.json.length))}onSaveClick(){console.time("saveEntities"),this.json=this.world.saveEntities(),console.timeEnd("saveEntities"),g.info("World saved ({} bytes)",this.json.length)}};function sn(u,t){let e=t.launcher.inputSeed.getInt(),i=t.inputCount.getInt(),n=F.fromSeedLcg(e),{context:s}=u.readData("appContext"),[r,o]=s.getSize(!0);u.writeEvent({eventId:"hello",sender:sn});for(let a=0;a<i;a++){let c=u.createEntity(),h=n.nextFloat()<.8?"circle":"rectangle",p=new m(n.nextFloatBetween(0,r),n.nextFloatBetween(0,o)),l=new v(n.nextFloatBetween(-1,1),n.nextFloatBetween(-1,1)),d=n.nextFloatBetween(10,100),b=n.nextFloat()<.5?"red":"blue";u.addComponents(c,{componentId:h},{componentId:"position",value:p},{componentId:"velocity",value:l},{componentId:"size",value:d},{componentId:"color",value:b})}}function yn(u){let{context:t}=u.readData("appContext"),{delta:e}=u.readData("time"),[i,n]=t.getSize(!0),s=u.queryEntities(["position","velocity","size"]);for(let{components:r}of s){let o=r.position.value,a=r.velocity.value,c=.5*r.size.value,h=a.x,p=a.y,l=o.x+e*h,d=o.y+e*p;l>i-c?(l=i-c,h=-h):l<c&&(l=c,h=-h),d>n-c?(d=n-c,p=-p):d<c&&(d=c,p=-p),r.position.value=new m(l,d),r.velocity.value=new v(h,p)}}function wn(u){let{context:t}=u.readData("appContext"),e=u.queryEntities(["circle","position","size","color"]),i=new P,n=new P;for(let{components:s}of e){let r=s.position.value,o=s.size.value,a=s.color.value;a==="red"?i.addCircle(r,.5*o):a==="blue"&&n.addCircle(r,.5*o)}t.fillPath(i,"red"),t.fillPath(n,"blue")}function Cn(u){let{context:t}=u.readData("appContext"),e=u.queryEntities(["rectangle","position","size","color"]),i=new P,n=new P;for(let{components:s}of e){let r=s.position.value,o=s.size.value,a=s.color.value,c=r.x-.5*o,h=r.y-.5*o,p=r.x+.5*o,l=r.y+.5*o;a==="red"?i.addRectXY(c,h,p,l):a==="blue"&&n.addRectXY(c,h,p,l)}t.fillPath(i,"red"),t.fillPath(n,"blue")}function En(u){let t=u.readEvents("hello");for(let e of t)g.info("Hello from",e.sender.name)}var Ne=class{buffer;sa;sb;sg;sr;mask;operator;constructor(){this.mask=new Uint8Array,this.operator=this.sourceOverSolid,this.sb=0,this.sg=0,this.sr=0,this.sa=0,this.buffer=new Uint8Array}fill(){let t=this.buffer,e=0;for(;e<t.length;)t[e++]=this.sr,t[e++]=this.sg,t[e++]=this.sb,t[e++]=this.sa}initialize(t){this.buffer=t.getBuffer8(),this.mask=new Uint8Array(t.getWidth())}setColor(t){this.sr=$t(t.r,t.a),this.sg=$t(t.g,t.a),this.sb=$t(t.b,t.a),this.sa=t.a}setOperation(t){switch(t){case 0:{this.operator=this.sourceSolid;break}default:{this.operator=this.sourceOverSolid;break}}}sourceOverSolid(t,e,i){let n=this.buffer,s=e,r=4*(t+s);for(;s<i;){let o=this.mask[s],a=$t(this.sa,o);n[r]=zt(this.sr,o,n[r++],a),n[r]=zt(this.sg,o,n[r++],a),n[r]=zt(this.sb,o,n[r++],a),n[r]=zt(this.sa,o,n[r++],a),this.mask[s++]=0}}sourceSolid(t,e,i){let n=this.buffer,s=e,r=4*(t+s);for(;s<i;){let o=this.mask[s];n[r]=zt(this.sr,o,n[r++],o),n[r]=zt(this.sg,o,n[r++],o),n[r]=zt(this.sb,o,n[r++],o),n[r]=zt(this.sa,o,n[r++],o),this.mask[s++]=0}}};function zt(u,t,e,i){return $t(u,t)+$t(e,Sn(i))}function $t(u,t){let e=u*t+128;return e+(e>>>8)>>>8}function Sn(u){return 255-u}var ne=8,Qe=class{sign;x0;x1;y0;y1;constructor(t,e,i,n,s){this.x0=t,this.y0=e,this.x1=i,this.y1=n,this.sign=s}},Ue=class{activeEdges;compositor;edges;height;mask;width;constructor(t){this.height=0,this.width=0,this.compositor=t,this.mask=t.mask,this.edges=[],this.activeEdges=[]}addLine(t,e,i,n){A(t>=0,"Coordinate must not be NaN"),A(e>=0,"Coordinate must not be NaN"),A(i<=this.width,"Coordinate must not be NaN"),A(n<=this.height,"Coordinate must not be NaN");let s=e*256>>>0,r=n*256>>>0;if(s===r)return;let o=t*256>>>0,a=i*256>>>0;s<r?this.edges.push(new Qe(o,s,a,r,1)):this.edges.push(new Qe(a,r,o,s,-1))}initialize(t,e){this.width=t,this.height=e,this.mask=this.compositor.mask}render(t){let e=t===0?4294967295:1;this.quicksort(0,this.edges.length-1);let i=this.edges[0],n=1,s=i.y0>>>ne;for(;s<this.height;){let r=s<<ne;for(;n<=this.edges.length&&i.y0<=r;){let o=i.x1-i.x0,a=i.y1-i.y0,c=1;o<0&&(o=-o,c=-1),this.activeEdges.push({x0:i.x0>>>ne,y1:i.y1,m0:o<<ne,d0:a<<ne,d:(r-i.y0)*o,inc:c,sign:i.sign}),i=this.edges[n++]}for(let o=0;o<this.activeEdges.length;o++)this.activeEdges[o].y1<=r&&(this.activeEdges.splice(o,1),o--);for(let o=0;o<this.activeEdges.length;o++){let a=this.activeEdges[o];for(;a.d>=a.d0;)a.d-=a.d0,a.x0+=a.inc;a.d+=a.m0}if(this.activeEdges.length>0){for(let a=1;a<this.activeEdges.length;a++){let c=this.activeEdges[a],h=a;for(;h>0&&this.activeEdges[h-1].x0>c.x0;)this.activeEdges[h]=this.activeEdges[h-1],h--;this.activeEdges[h]=c}let o=0;for(let a=1;a<this.activeEdges.length;a++){let c=this.activeEdges[a-1],h=this.activeEdges[a-0];if(o+=c.sign,o&e)for(let p=c.x0;p<h.x0;p++)this.mask[p]=255}this.compositor.operator(this.width*s,this.activeEdges[0].x0,this.activeEdges[this.activeEdges.length-1].x0)}s++}this.edges=[],this.activeEdges=[]}setCompositor(t){this.compositor=t,this.mask=t.mask}quicksort(t,e){let i=this.edges,n=i[t+e>>>1],s=t,r=e;for(;s<=r;){for(;i[s].y0<n.y0;)s++;for(;i[r].y0>n.y0;)r--;if(s<=r){let o=i[s];i[s]=i[r],i[r]=o,s++,r--}}t<r&&this.quicksort(t,r),s<e&&this.quicksort(s,e)}};var Xe=class{bottom;left;right;top;constructor(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n}},Ke=class{clipRect;compositor;pathFlatten;pathStroke;rasterizer;constructor(){this.compositor=new Ne,this.rasterizer=new Ue(this.compositor),this.clipRect=new Xe(0,0,0,0),this.pathFlatten=Fe(W),this.pathStroke=ze(W)}addFill(t,e){let i=this.rentPath();i.copyFrom(t),i.transform(e),this.flatten(i),this.returnPath(i)}addStroke(t,e,i){let n=this.rentPath();if(i.transformOrder===0){let s=this.rentPath();s.copyFrom(t),s.transform(e),this.pathStroke.process(s,n,i),this.returnPath(s)}else this.pathStroke.process(t,n,i),n.transform(e);this.flatten(n),this.returnPath(n)}begin(t){let e=t.getWidth(),i=t.getWidth();this.clipRect=new Xe(0,i,e,0),this.compositor.initialize(t),this.rasterizer.initialize(e,i)}clear(t){this.compositor.setColor(t.color),this.compositor.fill()}end(){}renderFill(t){this.compositor.setColor(t.color),this.compositor.setOperation(t.compOp),this.rasterizer.render(t.rule)}renderStroke(t){this.compositor.setColor(t.color),this.compositor.setOperation(t.compOp),this.rasterizer.render(0)}rentPath(){return new P}returnPath(t){}clipPolyline(t,e){let i=this.rasterizer,n=t[0],s=D(n.y,e.bottom,e.top),r=s,o=s,a=t.length;for(let c=1;c<a;c++){let h=n;n=t[c];let p=h,l=n;if(p.x<e.left){if(l.x<e.left)continue;p=Ye(h,n,e.left),s=D(p.y,e.bottom,e.top),i.addLine(e.left,r,e.left,s)}else l.x<e.left&&(l=Ye(h,n,e.left),r=D(l.y,e.bottom,e.top));if(p.x>e.right){if(l.x>e.right)continue;p=Ye(h,n,e.right),s=D(p.y,e.bottom,e.top),i.addLine(e.right,o,e.right,s)}else l.x>e.right&&(l=Ye(h,n,e.right),o=D(l.y,e.bottom,e.top));if(p.y<e.bottom){if(l.y<e.bottom)continue;p=We(h,n,e.bottom)}else l.y<e.bottom&&(l=We(h,n,e.bottom));if(p.y>e.top){if(l.y>e.top)continue;p=We(h,n,e.top)}else l.y>e.top&&(l=We(h,n,e.top));i.addLine(p.x,p.y,l.x,l.y)}n.x>e.right?(s=D(n.y,e.bottom,e.top),i.addLine(e.right,o,e.right,s)):n.x<e.left&&(s=D(n.y,e.bottom,e.top),i.addLine(e.left,r,e.left,s))}flatten(t){let e=new P;this.pathFlatten.process(t,e,!0),this.clipPolyline(e.getPoints(),this.clipRect)}};function We(u,t,e){return new m(u.x+(t.x-u.x)*(e-u.y)/(t.y-u.y),e)}function Ye(u,t,e){return new m(e,u.y+(t.y-u.y)*(e-u.x)/(t.x-u.x))}var Tn={color:new U(0,0,0,255),compOp:1,rule:0},An={caps:ie,color:new U(0,0,0,255),compOp:1,dashArray:[],dashCaps:ie,dashOffset:0,join:1,miterLimit:4,transformOrder:1,width:1},Ze=class{fillOptions;pipeline;strokeOptions;transform;constructor(){this.fillOptions={...Tn},this.strokeOptions={...An},this.pipeline=new Ke,this.transform=R.identity}get caps(){return this.strokeOptions.caps}set caps(t){this.strokeOptions.caps=t}get dashArray(){return this.strokeOptions.dashArray}set dashArray(t){this.strokeOptions.dashArray=t}get dashCaps(){return this.strokeOptions.dashCaps}set dashCaps(t){this.strokeOptions.dashCaps=t}get dashOffset(){return this.strokeOptions.dashOffset}set dashOffset(t){this.strokeOptions.dashOffset=t}get fillColor(){return this.fillOptions.color}set fillColor(t){this.fillOptions.color=t}get fillCompOp(){return this.fillOptions.compOp}set fillCompOp(t){this.fillOptions.compOp=t}get fillRule(){return this.fillOptions.rule}set fillRule(t){this.fillOptions.rule=t}get join(){return this.strokeOptions.join}set join(t){this.strokeOptions.join=t}get miterLimit(){return this.strokeOptions.miterLimit}set miterLimit(t){this.strokeOptions.miterLimit=t}get strokeColor(){return this.strokeOptions.color}set strokeColor(t){this.strokeOptions.color=t}get strokeCompOp(){return this.strokeOptions.compOp}set strokeCompOp(t){this.strokeOptions.compOp=t}get strokeWidth(){return this.strokeOptions.width}set strokeWidth(t){this.strokeOptions.width=t}get transformOrder(){return this.strokeOptions.transformOrder}set transformOrder(t){this.strokeOptions.transformOrder=t}begin(t){this.pipeline.begin(t)}clear(){this.pipeline.clear(this.fillOptions)}end(){this.pipeline.end()}fillCircle(t,e,i){let n=this.rentPath();n.addCircleXY(t,e,i),this.fillPath(n),this.returnPath(n)}fillEllipse(t,e,i,n){let s=this.rentPath();s.addEllipseXY(t,e,i,n),this.fillPath(s),this.returnPath(s)}fillPath(t){this.pipeline.addFill(t,this.transform),this.pipeline.renderFill(this.fillOptions)}fillRect(t,e,i,n){let s=this.rentPath();s.addRectXY(t,e,i,n),this.fillPath(s),this.returnPath(s)}rentPath(){return this.pipeline.rentPath()}returnPath(t){this.pipeline.returnPath(t)}strokeCircle(t,e,i){let n=this.rentPath();n.addCircleXY(t,e,i),this.strokePath(n),this.returnPath(n)}strokeEllipse(t,e,i,n){let s=this.rentPath();s.addEllipseXY(t,e,i,n),this.strokePath(s),this.returnPath(s)}strokeLine(t,e,i,n){let s=this.rentPath();s.addLineXY(t,e,i,n),this.strokePath(s),this.returnPath(s)}strokePath(t){this.pipeline.addStroke(t,this.transform,this.strokeOptions),this.pipeline.renderStroke(this.strokeOptions)}strokeRect(t,e,i,n){let s=this.rentPath();s.addRectXY(t,e,i,n),this.strokePath(s),this.returnPath(s)}};var it=class{buffer;height;width;constructor(t,e,i){this.width=t,this.height=e,this.buffer=i??new ArrayBuffer(4*t*e)}fill(t){new Int32Array(this.buffer).fill(t)}getBuffer8(){let t=4*this.width*this.height;return new Uint8Array(this.buffer,0,t)}getHeight(){return this.height}getWidth(){return this.width}magnify(t){let e=new it(this.width*t,this.height*t),i=this.width*this.height,n=i*t*t,s=new Int32Array(this.buffer,0,i),r=new Int32Array(e.buffer,0,n),o=0;for(let a=0;a<this.height;a++)for(let c=0;c<t;c++){let h=a*this.width;for(let p=0;p<this.width;p++){let l=s[h++];for(let d=0;d<t;d++)r[o++]=l}}return e}resize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.buffer=new ArrayBuffer(4*t*e))}toImageData(){if(this.width!==0&&this.height!==0){let t=4*this.width*this.height,e=new Uint8ClampedArray(this.buffer,0,t);return new ImageData(e,this.width,this.height)}else return}};var He=class{context;image;launcher;inputColor;inputCount;inputSize;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputSize=new M("size","1","1024","200"),this.inputSize.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputSize.setStyle("width: 200px"),this.inputColor=new M("color","0","255","128"),this.inputColor.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputColor.setStyle("width: 200px"),this.image=new it(0,0)}create(){}render(){this.context.clear(),this.context.blitImage(this.image,0,0)}reset(){this.image=new it(0,0)}update(t){let e=this.launcher.inputSeed.getInt(),i=this.launcher.inputGenerator.getInt(),n=this.inputCount.getInt(),s=this.inputSize.getInt(),r=this.inputColor.getInt(),o=F.fromSeedLcg(e),a=Xt(o,i,n,s,s);a.close(),this.image.resize(s,s);let c=new Ze;c.begin(this.image),c.fillRule=1,c.fillColor=new U(224,224,224,255),c.clear(),c.fillColor=new U(r,0,0,255),c.fillPath(a)}updateLayout(){this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputSize),this.launcher.addAppInput(this.inputColor)}};var $e=class{context;edges;launcher;inputCount;inputProjection;inputRotation;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputRotation=new M("rotation","0","360","0"),this.inputRotation.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputRotation.setStyle("width: 200px"),this.inputProjection=new N("projection","orthographic"),this.inputProjection.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputProjection.setOptionValues("orthographic","perspective"),this.edges=[]}create(){}render(){this.context.clear(),this.context.drawEdges(this.edges,"#000000")}reset(){this.edges=[]}update(t){this.reset();let e=this.inputRotation.getInt(),[i,n]=this.context.getSize(!0),s=this.createCube(),r=.5*i,o=.5*n,a=.2*Math.min(i,n),c=e*Math.PI/180,h=O.identity;h.rotateXAnglePre(1.1*c),h.rotateYAnglePre(1.3*c),h.rotateZAnglePre(1.7*c);let p=O.identity;p.translatePre(0,0,-10);let l;this.inputProjection.getValue()==="orthographic"?l=O.fromOrthographic(-1,1,1,-1,-10,1e3):l=O.fromPerspective(-1,1,1,-1,-10,1e3),l.scalePre(a,a,a),l.translatePre(r,o,0);let d=l.mul(p).mul(h);this.edges=this.transformEdges(s,d)}updateLayout(){this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputRotation),this.launcher.addAppInput(this.inputProjection)}createCube(){let t=new S(1,1,1),e=new S(1,1,-1),i=new S(1,-1,1),n=new S(1,-1,-1),s=new S(-1,1,1),r=new S(-1,1,-1),o=new S(-1,-1,1),a=new S(-1,-1,-1);return[new Q(t,e),new Q(i,n),new Q(s,r),new Q(o,a),new Q(t,i),new Q(e,n),new Q(s,o),new Q(r,a),new Q(t,s),new Q(e,r),new Q(i,o),new Q(n,a)]}nextPointFromBox(t,e){let i=t.nextFloatBetween(e.x0,e.x1),n=t.nextFloatBetween(e.y0,e.y1),s=t.nextFloatBetween(e.z0,e.z1);return new S(i,n,s)}transformEdges(t,e){let i=[];for(let n of t){let s=e.mapPoint(n.p0),r=e.mapPoint(n.p1),o=m.fromObject(s),a=m.fromObject(r);i.push(new y(o,a))}return i}};var Ge=class{context;launcher;mesh;points;inputCount;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new M("count","0","50","1"),this.inputCount.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputCount.setStyle("width: 200px"),this.mesh=new L,this.points=[]}create(){}render(){let t=this.launcher.inputSeed.getInt(),e=F.fromSeedLcg(t);this.context.clear(),this.context.fillMeshRandom(this.mesh,e),this.context.drawMeshEdges(this.mesh,"#666666",.5),this.context.fillPoints(this.points,"#000000",5)}reset(){this.mesh=new L,this.points=[]}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),i=this.inputCount.getInt(),n=F.fromSeedLcg(e),[s,r]=this.context.getSize(!1),o=new I(0,0,s,r),a=Be(n,o),c=Be(n,o),h=Be(n,o);this.points.push(a,c,h);let p=new P;p.moveTo(a),p.lineTo(c),p.lineTo(h),p.close();let l=new L,d=new st(W);d.addPath(p),d.process(l,ut);for(let b=0;b<i;b++){let f=a.lerp(c,n.nextFloat()),w=c.lerp(h,n.nextFloat()),T=f.lerp(w,n.nextFloat());l.triangulateAddPoint(T),this.points.push(T)}l.triangulateOptimize(),l.validate(),this.mesh=l}updateLayout(){this.launcher.addAppInput(this.inputCount)}};var Je=class{bounds;context;input;isInside;launcher;inputCount;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.input=new P,this.bounds=I.empty,this.isInside=!1}create(){}render(){this.context.clear(),this.context.fillBox(this.bounds,"#ADD8E644"),this.context.fillPath(this.input,this.isInside?"#FFCCCC":"#CCCCCC","evenodd"),this.context.drawPath(this.input,"#666666"),this.context.fillPoints(this.input.getPoints(),"#000000",5)}reset(){this.input.clear()}update(t){this.reset(),document.getElementById("canvas2D")?.addEventListener("mousemove",h=>this.onMouseMove(h));let i=this.launcher.inputSeed.getInt(),n=this.launcher.inputGenerator.getInt(),s=this.inputCount.getInt(),r=F.fromSeedLcg(i),[o,a]=this.context.getSize(!1),c=Xt(r,n,s,o,a);c.close(),this.input=c,this.bounds=c.getBounds(),g.info("Path area = {}",c.getSignedArea())}updateLayout(){this.launcher.addAppInput(this.inputCount)}onMouseMove(t){let e=new m(t.offsetX,t.offsetY);this.isInside=this.input.hasPointInside(e,1),this.launcher.requestUpdate()}};function je(u){switch(u){case"intersection":return 1;case"exclusion":return 2;case"awithoutb":return 3;case"bwithouta":return 4;default:return 0}}function _e(u){switch(u){case"miter":return 1;case"miterclip":return 2;case"round":return 3;default:return 0}}function kt(u){switch(u){case"evenodd":return 1;case"positive":return 2;case"negative":return 3;case"absgeqtwo":return t=>Math.abs(t)>2;default:return 0}}var ti=class{chains;context;faces;launcher;polygonA;polygonB;inputBoolOp;inputParameter;inputWindA;inputWindB;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new M("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputBoolOp=new N("boolOp","union"),this.inputBoolOp.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputBoolOp.setOptionValues("union","intersection","exclusion","awithoutb","bwithouta"),this.inputWindA=new N("windA","nonzero"),this.inputWindA.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindA.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.inputWindB=new N("windB","nonzero"),this.inputWindB.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindB.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.polygonA=new V,this.polygonB=new V,this.chains=new P,this.faces=new P}create(){}render(){this.context.clear(),this.context.fillPolygon(this.polygonA,"#00FF0022"),this.context.fillPolygon(this.polygonB,"#0000FF22");let t=this.context.createLinePattern(6,"#FF0000")??"#FF000022";this.context.fillPath(this.faces,t),this.context.drawPath(this.faces,"#FF3333",1.5),this.context.drawPath(this.chains,"#3333FF",1.5)}reset(){this.polygonA=new V,this.polygonB=new V,this.chains=new P,this.faces=new P}update(t){let e=this.launcher.inputSeed.getInt(),i=this.launcher.inputGenerator.getInt(),n=2*(this.inputParameter.getInt()-100),s=F.fromSeedLcg(e),[r,o]=this.context.getSize(!1);[this.polygonA,this.polygonB]=Mt(s,i,n,r,o);let a=new st(W);for(let h of this.polygonA.getEdges())a.addEdge(h,0);for(let h of this.polygonB.getEdges())a.addEdge(h,1);this.faces.clear(),this.chains.clear();let c=new L;a.process(c,{booleanOperator:je(this.inputBoolOp.getValue()),windingOperatorA:kt(this.inputWindA.getValue()),windingOperatorB:kt(this.inputWindB.getValue())}),this.faces=c.getFacesPath(),this.chains=c.getChainsPath()}updateLayout(){this.launcher.addAppInput(this.inputParameter),this.launcher.addAppInput(this.inputBoolOp),this.launcher.addAppInput(this.inputWindA),this.launcher.addAppInput(this.inputWindB)}};var ei=class{context;launcher;path;points;inputParameter;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new M("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.path=new P,this.points=[]}create(){}render(){this.context.clear(),this.context.drawPath(this.path),this.context.fillPoints(this.points,"#FF0000",5)}reset(){this.path=new P,this.points=[]}update(t){let e=this.inputParameter.getInt(),i=new E(new m(100,150),new m(300,400),new m(600,250)),n=new E(new m(100,500),new m(300,100),new m(500,100+3*e));this.points=[],this.path=new P,i.intersectQuad(n,this.points),this.path.addCurveSplines(i),this.path.addCurveSplines(n)}updateLayout(){this.launcher.addAppInput(this.inputParameter)}};var ii=class{context;input;launcher;output;inputCount;inputJoin;inputOp;inputParam1;inputParam2;constructor(t,e){this.launcher=t,this.context=e,this.inputCount=new H("count","10"),this.inputCount.setStyle("width: 80px"),this.inputOp=new N("op","flatten"),this.inputOp.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputOp.setOptionValues("flatten","simplify","offset","dash","stroke","dashstroke"),this.inputParam1=new M("param1","0","100","50"),this.inputParam1.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam1.setStyle("width: 200px"),this.inputParam2=new M("param2","0","100","50"),this.inputParam2.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam2.setStyle("width: 200px"),this.inputJoin=new N("join","bevel"),this.inputJoin.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputJoin.setOptionValues("bevel","miter","miterclip","round"),this.input=new P,this.output=new P}create(){}render(){this.context.clear(),this.context.drawPath(this.input,"#666666FF",1),this.context.drawPath(this.output,"#FF0000FF",2),this.context.fillPoints(this.input.getPoints(),"#00000088",5),this.context.fillPoints(this.output.getPoints(),"#FF000088",5)}reset(){this.input.clear(),this.output.clear()}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),i=this.launcher.inputGenerator.getInt(),n=this.inputCount.getInt(),s=this.inputOp.getValue(),r=F.fromSeedLcg(e),[o,a]=this.context.getSize(!1),c=Xt(r,i,n,o,a);this.input=c;let h=$i;switch(s){case"flatten":{let p=(10*this.inputParam1.getFloat()+1)/10,l=(10*this.inputParam2.getFloat()+1)/10;this.output=c.flatten(!1,{flattenTolerance:l,simplifyTolerance:p});break}case"simplify":{let p=(10*this.inputParam1.getFloat()+1)/10;this.output=c.simplify({simplifyTolerance:p});break}case"offset":{let p=this.inputParam1.getFloat()-50,l=this.inputParam2.getFloat()/10,d=_e(this.inputJoin.getValue());this.output=c.offset({distance:p,join:d,miterLimit:l});break}case"dash":{let p=this.inputParam1.getFloat(),l=[2*p,p],d=10*this.inputParam2.getFloat();this.output=c.dash({array:l,offset:d});break}case"stroke":{let p=this.inputParam1.getFloat(),l=this.inputParam2.getFloat()/10,d=_e(this.inputJoin.getValue());this.output=c.stroke({caps:h,join:d,miterLimit:l,width:p});break}case"dashstroke":{let p=this.inputParam1.getFloat(),l=10*this.inputParam2.getFloat(),d=_e(this.inputJoin.getValue()),b=[2*p,p],f=50;this.output=c.stroke({caps:h,dashArray:b,dashOffset:l,join:d,width:f});break}}}updateLayout(){this.launcher.addAppInput(this.inputOp),this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputParam1),this.launcher.addAppInput(this.inputParam2),this.launcher.addAppInput(this.inputJoin)}};var ni=class{context;launcher;mesh;polygonA;polygonB;tagEntries;inputParameter;inputWind;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new M("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputWind=new N("wind","nonzero"),this.inputWind.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWind.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.polygonA=new V,this.polygonB=new V,this.mesh=new L,this.tagEntries=[]}create(){}render(){this.context.clear();let t=[],e=1/this.tagEntries.length;for(let i=0;i<1;i+=e){let n=U.fromHsv(i,.25,1,1);t.push(n.style)}for(let i of this.mesh.getFaces()){let n=i.data;if(n.length===0)continue;let s=new P;i.writeToPath(s);let r=this.tagEntries.findIndex(o=>Bt(o.tag,n));r<0||this.context.fillPath(s,t[r])}this.context.drawMeshEdges(this.mesh,"#888888",.5)}reset(){this.polygonA=new V,this.polygonB=new V,this.mesh=new L}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),i=this.launcher.inputGenerator.getInt(),n=2*(this.inputParameter.getInt()-100),s=F.fromSeedLcg(e),[r,o]=this.context.getSize(!1);[this.polygonA,this.polygonB]=Mt(s,i,n,r,o);let a=new yt(W);for(let h of this.polygonA.getEdges())a.addEdge(h,0);for(let h of this.polygonB.getEdges())a.addEdge(h,1);a.addEdge(y.fromXY(325,175,350,175),2),a.addEdge(y.fromXY(350,175,350,225),2),a.addEdge(y.fromXY(350,225,325,225),2),a.addEdge(y.fromXY(325,225,325,175),2),a.addEdge(y.fromXY(300,275,375,275),3),a.addEdge(y.fromXY(375,275,375,325),3),a.addEdge(y.fromXY(375,325,300,325),3),a.addEdge(y.fromXY(300,325,300,275),3);let c=new L;a.process(c,kt(this.inputWind.getValue())),this.updateTagEntries(c),this.mesh=c}updateLayout(){this.launcher.addAppInput(this.inputParameter),this.launcher.addAppInput(this.inputWind)}updateTagEntries(t){let e=[];for(let i of t.getFaces()){A(i.data!==void 0,"Face data must not be undefined");let n=i.data,s=e.find(r=>Bt(r.tag,n));s!==void 0?s.faces.push(i):e.push({tag:n,faces:[i]})}for(let i of e)i.tag.length>0&&t.monotonizeFaces(i.faces);this.tagEntries=e}};var si=class{context;launcher;inputParam1;inputParam2;constructor(t,e){this.launcher=t,this.context=e,this.inputParam1=new M("param1","1","100","50"),this.inputParam1.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam1.setStyle("width: 200px"),this.inputParam2=new M("param2","1","100","50"),this.inputParam2.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParam2.setStyle("width: 200px")}create(){}render(){this.context.clear()}reset(){}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),i=this.inputParam1.getInt(),n=this.inputParam2.getInt(),s=F.fromSeedLcg(e);g.infoDebug("param1 = {}, param2 = {}, random = {}",i,n,s.nextInt())}updateLayout(){this.launcher.addAppInput(this.inputParam1),this.launcher.addAppInput(this.inputParam2)}};var In=[0,1,1,7,1,19,21,127,1,259,261,1807,273,4915,5461,32767,1,65539,65541,458767,65553,1245235,1376341,8323327,65793,16974595,17106181,118427407,17895697,322122547],ri=class{boxes;context;image;launcher;inputCount;inputFormat;inputSize;constructor(t,e){this.launcher=t,this.context=e,this.inputSize=new M("size","16","1024","512"),this.inputSize.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputSize.setStyle("width: 200px"),this.inputCount=new M("count","0","16","8"),this.inputCount.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputCount.setStyle("width: 200px"),this.inputFormat=new N("format","none"),this.inputFormat.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputFormat.setOptionValues("none","u8","u16","u32","f32"),this.image=new it(0,0),this.boxes=[]}create(){}render(){let t=this.image.getWidth(),e=this.inputSize.getInt(),i=Math.trunc(e/t);i=D(i,1,128);let n=this.image.magnify(i);this.context.clear(),this.context.blitImage(n,0,0),this.context.fillBoxes(this.boxes,"#000000")}reset(){this.image=new it(0,0),this.boxes=[]}update(t){this.reset();let e=this.launcher.inputGenerator.getInt(),i=2**this.inputCount.getFloat(),n=this.launcher.inputSeed.getInt(),s=this.inputSize.getInt(),r=F.fromSeedLcg(n),o=[];switch(e){case 0:{this.sampleWhiteNoise(r,i,o);break}case 1:{this.sampleJitteredGrid(r,i,o);break}case 2:{this.sampleStochasticSobol(r,i,o);break}}switch(this.inputFormat.getValue()){case"none":{this.boxes=this.createBoxes(o,s,s/256);break}case"u8":{this.image=this.createImage(o,"u8");break}case"u16":{this.image=this.createImage(o,"u16");break}case"u32":{this.image=this.createImage(o,"u32");break}case"f32":{this.image=this.createImage(o,"f32");break}}}updateLayout(){this.launcher.addAppInput(this.inputSize),this.launcher.addAppInput(this.inputCount),this.launcher.addAppInput(this.inputFormat)}createBoxes(t,e,i){let n=[];for(let s=0;s<t.length;s+=2){let r=e*t[s+0],o=e*t[s+1],a=new I(r-i,o-i,r+i,o+i);n.push(a)}return n}createImage(t,e){switch(e){case"u8":{let i=this.getImageMinSize(t.length,4),n=new Uint8Array(4*i*i);for(let s=0;s<t.length;s++)n[s]=256*t[s];return new it(i,i,n.buffer)}case"u16":{let i=this.getImageMinSize(t.length,2),n=new Uint16Array(2*i*i);for(let s=0;s<t.length;s++)n[s]=65536*t[s];return new it(i,i,n.buffer)}case"u32":{let i=this.getImageMinSize(t.length,1),n=new Uint32Array(i*i);for(let s=0;s<t.length;s++)n[s]=4294967296*t[s];return new it(i,i,n.buffer)}case"f32":{let i=this.getImageMinSize(t.length,1),n=new Float32Array(i*i);for(let s=0;s<t.length;s++)n[s]=t[s];return new it(i,i,n.buffer)}default:B(e)}}createStratifiedSample(t,e,i,n,s){let r=e+t.nextFloat(),o=i+t.nextFloat();s.push(r/n),s.push(o/n)}getImageMinSize(t,e){let i=Math.sqrt(t/e);return Math.ceil(i)}sampleJitteredGrid(t,e,i){let n=Math.sqrt(e),s=1/Math.ceil(n);for(let r=0;r<1;r+=s)for(let o=0;o<1;o+=s){let a=s*t.nextFloat(),c=s*t.nextFloat();i.push(o+a),i.push(r+c)}}sampleStochasticSobol(t,e,i){let n=0,s=0,r=1;this.createStratifiedSample(t,n,s,r,i);for(let o=0,a=1;a<e;o++,a=r){r=2*a;for(let c=0;c<a;c++){let h=2*(c^0),p=2*(c^In[o]);n=r*i[h+0]^1,s=r*i[p+1]^1,this.createStratifiedSample(t,n,s,r,i)}}}sampleWhiteNoise(t,e,i){for(let n=0;n<e;n++){let s=t.nextFloat(),r=t.nextFloat();i.push(s),i.push(r)}}};var oi=class{context;inner;launcher;mesh;meshOriginal;outer;vertices;inputTime;constructor(t,e){this.launcher=t,this.context=e,this.inputTime=new M("time","0","500","50"),this.inputTime.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputTime.setStyle("width: 200px"),this.inner=new P,this.outer=new P,this.mesh=new L,this.meshOriginal=new L,this.vertices=[]}create(){}render(){this.context.clear(),this.context.drawEdges(this.getVertexEdges(),"#FF0000"),this.context.drawMeshEdges(this.meshOriginal,"#000000"),this.context.drawMeshEdges(this.mesh,"#00FF00")}reset(){this.inner.clear(),this.outer.clear(),this.mesh=new L,this.meshOriginal=new L,this.vertices=[]}update(t){this.reset();let e=this.launcher.inputSeed.getInt(),i=F.fromSeedLcg(e),[n,s]=this.context.getSize(!1),r=new I(0,0,n,s),o=this.launcher.inputGenerator.getInt(),a=this.inputTime.getInt(),c=en(i,r,o,1,0).toPath();this.mesh=c.toMesh(0),this.meshOriginal=this.mesh.clone(),this.mesh.triangulate(!1),this.initializeMesh(this.mesh),this.createStraightSkeleton(this.mesh,a)}updateLayout(){this.launcher.addAppInput(this.inputTime)}createStraightSkeleton(t,e){let i=t.getFaces().slice();for(;i.length>0;){i.sort((s,r)=>wt.compareFace(s,r));let n=i[0].data;if(A(n.t1>=0,"Parameter must be positve (t = {})",n.t1),this.printEvents(i,e),e<n.t1){for(let s of i)this.updateFacePositionAt(s,e),this.dumpVerticesAt(s,e);break}for(let s of i)this.updateFacePositionAt(s,n.t1);this.handleEvent(n),n.type!==2&&i.splice(0,1);for(let s of i)this.updateFaceEvent(s)}}deleteEdgeAndMerge(t){let e=t.lnext,i=e.lnext,n=t.sym,s=e.sym,r=i.sym;t.data=void 0,x.splice(n,e);let o=e;do o.p0=t.p0,o.onext.p0=t.p0,o=o.onext;while(o!==e);x.splice(t,e),x.detachPair(t),x.clear(e),x.clear(i),s.lnext.onext=r,r.lnext.onext=s,s.sym=r,r.sym=s}deleteEdgeAndSplit(t){let e=t.lnext,i=e.lnext;x.detachPair(e),e.p0=m.zero,e.sym.p0=m.zero,t.data=void 0,x.splice(t,ot.getWavefrontEdgeCcw(t)),t.face=void 0,e.face=void 0,i.face=void 0}dumpVerticesAt(t,e){let i=t.start,n=i.lnext,s=n.lnext,r=i.data,o=n.data,a=s.data;r!==void 0&&(r.t1=e,this.vertices.push(r)),o!==void 0&&(o.t1=e,this.vertices.push(o)),a!==void 0&&(a.t1=e,this.vertices.push(a))}getEdgeCollapseParameter(t,e){let i=t.getPositionAt(0),n=e.getPositionAt(0),s=t.vel,o=e.vel.sub(s),a=n.sub(i);return o.dot(a.neg)/o.dot(o)}getEdgeCrashParameter(t,e,i){let n=t.getPositionAt(0),s=e.getPositionAt(0),r=i.getPositionAt(0),o=t.vel,a=s.sub(n),h=r.sub(s).unit.normal;return a.dot(h)/(1+o.dot(h))}getKineticEventTypeName(t){switch(t){case 0:return"EdgeEvent";case 1:return"SplitEvent";case 2:return"FlipEvent";case 3:return"FullEvent"}}getRandomMesh(t,e,i,n,s){let[r,o]=Mt(t,e,i,n,s),a=new st(W);for(let h of r.getEdges())a.addEdge(h,0);for(let h of o.getEdges())a.addEdge(h,1);let c=new L;return a.process(c,{booleanOperator:2,windingOperatorA:0,windingOperatorB:0}),c}getTriangleCollapseParameter(t,e,i){let n=t.getPositionAt(0).toVector(),s=e.getPositionAt(0).toVector(),r=i.getPositionAt(0).toVector(),o=t.vel,a=e.vel,c=i.vel,h=o.cross(a)-o.cross(c)+a.cross(c),p=n.cross(a)-n.cross(c)+s.cross(c)-s.cross(o)+r.cross(o)-r.cross(a),l=n.cross(s)-n.cross(r)+s.cross(r),d=$(h,.5*p,l);return d.type===2?d:{type:1,x:ft(2*h,p)}}getVertexEdges(){let t=[];for(let e of this.vertices){let i=e.getPositionAt(e.t0),n=e.getPositionAt(e.t1);t.push(new y(i,n))}return t}handleEvent(t){let e=t.e,i=e.lnext,n=i.lnext,s=e.data,r=i.data,o=n.data,a=t.t1;switch(t.type){case 0:{this.stopVertexAt(s,a),this.stopVertexAt(r,a);let c=s.getPositionAt(a),h=new ot(c,r.n1,s.n2,a),p=i.sym,l=n.sym;this.deleteEdgeAndMerge(e),p.face!==void 0&&this.updateVerticesCw(p.sym,h),l.face!==void 0&&this.updateVerticesCcw(l,h);break}case 1:{this.stopVertexAt(s,a);let c=s.getPositionAt(a),h=new ot(c,s.n1,r.n1,a),p=new ot(c,o.n2,s.n2,a);this.deleteEdgeAndSplit(e),this.updateVerticesCw(e,h),this.updateVerticesCcw(n.sym,p);break}case 2:{x.swap(e),e.data=e.oprev.data,e.sym.data=e.sym.oprev.data;break}case 3:{this.stopVertexAt(s,a),this.stopVertexAt(r,a),this.stopVertexAt(o,a);break}}}handleTriangle0(t,e,i){let n=t.data,s=e.data,r=i.data,o=this.getTriangleCollapseParameter(n,s,r),a;o.type===2?o.x1<o.x2||o.x2<0?a=o.x1:a=o.x2:a=o.x;let c=n.getPositionAt(a),h=s.getPositionAt(a),p=r.getPositionAt(a),l=h.sub(c).lengthSq,d=p.sub(h).lengthSq,b=c.sub(p).lengthSq,f=l,w=t;return d>f&&(f=d,w=e),b>f&&(f=b,w=i),new wt(2,w,a)}handleTriangle1(t,e,i){let n=t.data,s=e.data,r=i.data;A(t.sym.face!==void 0),A(e.sym.face===void 0),A(i.sym.face!==void 0);let o=this.getEdgeCrashParameter(n,s,r),a=this.getEdgeCollapseParameter(s,r);if(a<=o&&a>0)return{type:0,e,t1:a};let c=n.getPositionAt(o),h=s.getPositionAt(o),p=r.getPositionAt(o),l=h.sub(c).lengthSq,d=p.sub(h).lengthSq,b=c.sub(p).lengthSq,f=l,w=t;return d>f&&(f=d,w=e),b>f&&(f=b,w=i),w===e?new wt(1,t,o):new wt(2,w,o)}handleTriangle2(t,e,i){let n=t.data,s=e.data,r=i.data,o=this.getEdgeCollapseParameter(n,s),a=this.getEdgeCollapseParameter(n,r);return o<a||a<0?new wt(0,t,o):new wt(0,i,a)}handleTriangle3(t,e){let i=t.data,n=e.data,s=this.getEdgeCollapseParameter(i,n);return new wt(3,t,s)}initializeMesh(t){for(let e of t.getEdges()){if(e.data!==void 0)continue;let i=ot.createFrom(e),n=e;do A(n.data===void 0),n.data=i,n=n.onext;while(n!==e)}for(let e of t.getFaces())this.updateFaceEvent(e)}printEdgesLnext(t,e){g.infoDebug("lnext");let i=0;for(let n of t.getLnextIterator())g.infoDebug("  [{}] p0: {}",i,n.p0),g.infoDebug("      p1: {}",n.p1),e&&n.validate(),i++}printEdgesOnext(t,e){g.infoDebug("onext");let i=0;for(let n of t.getOnextIterator())g.infoDebug("  [{}] p0: {}",i,n.p0),g.infoDebug("      p1: {}",n.p1),g.infoDebug("      angle: {}",n.p1.sub(n.p0).angle*180/Math.PI),e&&(A(n.data===t.data),n.validate()),i++}printEvents(t,e){g.infoDebug("******************************************************************"),g.infoDebug("Parameter = {}",e),g.infoDebug("******************************************************************");for(let i=0;i<t.length;i++){let s=t[i].data;g.infoDebug("[{}] type = {}",i,this.getKineticEventTypeName(s.type)),g.infoDebug("    t = {}",s.t1),g.infoDebug("    edge = {}",s.e.p0),g.infoDebug("           {}",s.e.p1)}}printFace(t){g.infoDebug("******************************************************************");let e=t.start,i=e.lnext,n=i.lnext;g.infoDebug("Face: e0 = {}",e.p0),g.infoDebug("           {}",e.p1),g.infoDebug("      e1 = {}",i.p0),g.infoDebug("           {}",i.p1),g.infoDebug("      e2 = {}",n.p0),g.infoDebug("           {}",n.p1)}printVerticesAt(t,e){g.infoDebug("******************************************************************");let i=t.start,n=i.lnext,s=n.lnext,r=i.data,o=n.data,a=s.data;g.infoDebug("vtx0: pos = {}",r.getPositionAt(e)),g.infoDebug("      vel = {}",r.vel),g.infoDebug("       n1 = {}",r.n1),g.infoDebug("       n2 = {}",r.n2),g.infoDebug("vtx1: pos = {}",o.getPositionAt(e)),g.infoDebug("      vel = {}",o.vel),g.infoDebug("       n1 = {}",o.n1),g.infoDebug("       n2 = {}",o.n2),g.infoDebug("vtx2: pos = {}",a.getPositionAt(e)),g.infoDebug("      vel = {}",a.vel),g.infoDebug("       n1 = {}",a.n1),g.infoDebug("       n2 = {}",a.n2)}stopVertexAt(t,e){t.t1=e,this.vertices.push(t)}updateEdgePositionAt(t,e){let i=t.data,n=t.sym.data;t.p0=i.getPositionAt(e),t.sym.p0=n.getPositionAt(e)}updateFaceEvent(t){let e=t.start,i=e.lnext,n=i.lnext,s;e.sym.face===void 0?i.sym.face===void 0?n.sym.face===void 0?s=this.handleTriangle3(e,i):s=this.handleTriangle2(i,n,e):n.sym.face===void 0?s=this.handleTriangle2(e,i,n):s=this.handleTriangle1(n,e,i):i.sym.face===void 0?n.sym.face===void 0?s=this.handleTriangle2(n,e,i):s=this.handleTriangle1(e,i,n):n.sym.face===void 0?s=this.handleTriangle1(i,n,e):s=this.handleTriangle0(e,i,n),t.data=s}updateFacePositionAt(t,e){let i=t.start,n=i.lnext,s=n.lnext;this.updateEdgePositionAt(i,e),this.updateEdgePositionAt(n,e),this.updateEdgePositionAt(s,e)}updateVerticesCcw(t,e){let i=t;do i.data=e,i=i.onext;while(i!==t)}updateVerticesCw(t,e){let i=t;do i.data=e,i=i.oprev;while(i!==t)}},ot=class{n1;n2;orig;t0;t1;vel;constructor(t,e,i,n){this.orig=t,this.vel=ot.getVelocity(e,i),this.n1=e,this.n2=i,this.t0=n,this.t1=Number.POSITIVE_INFINITY}static createFrom(t){let e=t.p0,i=ot.getWavefrontEdgeCw(t),n=ot.getWavefrontEdgeCcw(t),s=i.p1.sub(i.p0).unit.normal.neg,r=n.p0.sub(n.p1).unit.normal.neg;return new ot(e,s,r,0)}static getVelocity(t,e){let i=t.add(e);return i.mul(2).div(i.lengthSq)}static getWavefrontEdgeCcw(t){let e=t;do{if(e.face===void 0&&e.sym.face!==void 0)return e;e=e.onext}while(e!==t);return g.error("Fallback (ccw)"),t}static getWavefrontEdgeCw(t){let e=t;do{if(e.face!==void 0&&e.sym.face===void 0)return e;e=e.oprev}while(e!==t);return g.error("Fallback (cw)"),t}getPositionAt(t){return this.orig.addMul(this.vel,t-this.t0)}},wt=class{e;t1;type;constructor(t,e,i){this.type=t,this.e=e,this.t1=i}static compareFace(t,e){let i=t.data,n=e.data,s=i.t1,r=n.t1;return s<0==r<0?s-r:r}};var ai=class{context;errors;inputSegments;intersections;launcher;magnets;outputSegments;pins;inputParameter;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new M("parameter","1","200","50"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputSegments=[],this.outputSegments=[],this.intersections=[],this.magnets=[],this.pins=[],this.errors=[]}create(){}render(){let t=this.inputParameter.getInt();this.context.clear(),this.context.fillBoxes(this.magnets,"#E4E4E4"),this.context.drawEdges(this.inputSegments,"#888888"),this.context.fillPoints(this.pins,"#CCCCCC",.25*t),this.context.fillBoxes(this.errors,"#0088FF44"),this.context.drawEdges(this.outputSegments),this.context.fillEdgePoints(this.outputSegments,"#000000",5),this.context.fillPoints(this.intersections,"#FF0000",5)}reset(){this.inputSegments=[],this.outputSegments=[],this.intersections=[],this.magnets=[],this.pins=[],this.errors=[]}update(t){let e=this.inputParameter.getInt(),i=1/e,n=new It;n.precision=i;let[s,r]=this.context.getSize(!1);this.fillEdges(n,i,s,r);let o=performance.now();n.process();let a=performance.now();g.info("Snap round time: {} ms",(a-o).toFixed(1)),this.inputSegments=this.transformSegments(n.debugGetInputSegments(),e),this.outputSegments=this.transformSegments(n.debugGetOutputSegments(),e),this.intersections=this.transformPoints(n.debugGetIntersections(),e),this.magnets=this.transformBox(n.debugGetMagnets(),e),this.pins=this.transformPoints(n.debugGetPins(),e),this.errors=this.transformBox(this.transformPoints(n.debugGetErrors(),1),e),g.info("Got {} input edges",this.inputSegments.length),g.info("Found {} intersections, {} magnets and {} pins",this.intersections.length,this.magnets.length,this.pins.length),g.info("Created {} output edges",this.outputSegments.length),this.errors.length>0&&g.error("*** {} errors ***",this.errors.length)}updateLayout(){this.launcher.addAppInput(this.inputParameter)}addEdge(t,e,i,n=!1){let s=new C(e,i);t.addSegment(s,0,1,n,void 0)}addEdges(t,e){for(let i of e){let n=new C(i.p0,i.p1);t.addSegment(n,0,1,!1,void 0)}}fillEdges(t,e,i,n){let s=this.launcher.inputGenerator.getInt(),r=this.launcher.inputSeed.getInt(),o=F.fromSeedLcg(r);switch(s){case 0:{let p=o.nextIntBetween(10,30);for(let l=0;l<p;l++){let d=new m(i*o.nextFloat(),n*o.nextFloat()),b=new m(i*o.nextFloat(),n*o.nextFloat());o.nextFloat()<.5&&(d=m.roundToPrecision(d,e)),o.nextFloat()<.5&&(b=m.roundToPrecision(b,e)),this.addEdge(t,d,b)}break}case 1:{let a=[];a.push(y.fromXY(100,200,600,300)),a.push(y.fromXY(75,425,575,625)),a.push(y.fromXY(100,500,300,100)),a.push(y.fromXY(100,500,400,600)),a.push(y.fromXY(300,500,500,200)),this.addEdges(t,a);break}case 2:{let a=[];a.push(y.fromXY(200,200,500,200)),a.push(y.fromXY(500,200,500,500)),a.push(y.fromXY(500,500,200,500)),a.push(y.fromXY(200,500,200,200)),a.push(y.fromXY(300,220,400,220)),a.push(y.fromXY(400,220,400,320)),a.push(y.fromXY(400,320,300,320)),a.push(y.fromXY(300,320,300,220)),this.addEdges(t,a);break}case 3:{let a=new m(i*o.nextFloat(),n*o.nextFloat()),c=new m(i*o.nextFloat(),n*o.nextFloat()),h=o.nextFloatBetween(0,.5),p=o.nextFloatBetween(.5,1),l=m.roundToPrecision(a.lerp(c,h),e),d=m.roundToPrecision(a.lerp(c,p),e);this.addEdge(t,a,c),this.addEdge(t,l,d,!0);break}}}transformBox(t,e){let i=[];for(let n of t){let s=Math.round(e*(n.x-.5)),r=Math.round(e*(n.y-.5)),o=Math.round(e);i.push(new I(s,r,s+o,r+o))}return i}transformEdges(t,e){let i=[];for(let n of t){let s=Math.round(e*n.p0.x),r=Math.round(e*n.p0.y),o=Math.round(e*n.p1.x),a=Math.round(e*n.p1.y);i.push(y.fromXY(s,r,o,a))}return i}transformPoints(t,e){let i=[];for(let n of t){let s=Math.round(e*n.x),r=Math.round(e*n.y);i.push(new m(s,r))}return i}transformSegments(t,e){let i=[];for(let n of t){let s=Math.round(e*n.p0.x),r=Math.round(e*n.p0.y),o=Math.round(e*n.p1.x),a=Math.round(e*n.p1.y);i.push(y.fromXY(s,r,o,a))}return i}};var ci=class{context;error;launcher;mesh;polygonA;polygonB;inputBoolOp;inputOptions;inputParameter;inputWindA;inputWindB;constructor(t,e){this.launcher=t,this.context=e,this.inputParameter=new M("parameter","0","200","100"),this.inputParameter.addEventListener("input",()=>this.launcher.requestUpdate()),this.inputParameter.setStyle("width: 200px"),this.inputBoolOp=new N("boolOp","union"),this.inputBoolOp.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputBoolOp.setOptionValues("union","intersection","exclusion","awithoutb","bwithouta"),this.inputWindA=new N("windA","nonzero"),this.inputWindA.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindA.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.inputWindB=new N("windB","nonzero"),this.inputWindB.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputWindB.setOptionValues("nonzero","evenodd","positive","negative","absgeqtwo"),this.inputOptions=new N("options","triangulate"),this.inputOptions.addEventListener("input",()=>this.launcher.requestUpdate(!0)),this.inputOptions.setOptionValues("monotonize","triangulate","triangulateOpt"),this.polygonA=new V,this.polygonB=new V,this.error=new P,this.mesh=new L}create(){}render(){let t=this.launcher.inputSeed.getInt(),e=F.fromSeedLcg(t);this.context.clear(),this.context.fillMeshRandom(this.mesh,e);let i=this.context.createLinePattern(10,"#FF0000")??"#FF000022";this.context.fillPath(this.error,i),this.context.drawMeshEdges(this.mesh,"#AAAAAA",1.5)}reset(){this.polygonA=new V,this.polygonB=new V,this.error=new P,this.mesh=new L}update(t){let e=this.launcher.inputSeed.getInt(),i=this.launcher.inputGenerator.getInt(),n=2*(this.inputParameter.getInt()-100),s=F.fromSeedLcg(e),[r,o]=this.context.getSize(!1);[this.polygonA,this.polygonB]=Mt(s,i,n,r,o);let a=new st(W);for(let h of this.polygonA.getEdges())a.addEdge(h,0);for(let h of this.polygonB.getEdges())a.addEdge(h,1);let c=new L;switch(a.process(c,{booleanOperator:je(this.inputBoolOp.getValue()),windingOperatorA:kt(this.inputWindA.getValue()),windingOperatorB:kt(this.inputWindB.getValue())}),this.inputOptions.getValue()){case"monotonize":{c.monotonize();break}case"triangulate":{c.triangulate(!1);break}case"triangulateOpt":{c.triangulate(!0);break}}c.validate(),this.mesh=c,this.error=new P;for(let h of this.mesh.getFaces()){let p=h.getSignedArea();p<=0&&g.warn("Negative path area: {}",p),h.isMonotoneInX()||(h.writeToPath(this.error),g.error("Face not monotone"))}}updateLayout(){this.launcher.addAppInput(this.inputParameter),this.launcher.addAppInput(this.inputBoolOp),this.launcher.addAppInput(this.inputWindA),this.launcher.addAppInput(this.inputWindB),this.launcher.addAppInput(this.inputOptions)}};var ui=class{context;launcher;inputProjection;inputRotation;world;constructor(t,e){this.launcher=t,this.context=e,this.inputRotation=new M("rotation","0","200","100"),this.inputRotation.setStyle("width: 200px"),this.inputProjection=new N("projection","orthographic"),this.inputProjection.setOptionValues("orthographic","perspective"),this.world=new Ht}create(){this.reset();let t=5;this.world.createEntity({componentId:"mesh",material:Mn,vertices:{type:"Number",array:[-1e3,0,0,1e3,0,0]}}),this.world.createEntity({componentId:"mesh",material:On,vertices:{type:"Number",array:[0,-1e3,0,0,1e3,0]}}),this.world.createEntity({componentId:"mesh",material:Fn,vertices:{type:"Number",array:[0,0,-1e3,0,0,1e3]}}),this.world.createEntity({componentId:"mesh",material:zn,vertices:{type:"Number",array:[t,0,t,t,0,-t,-t,0,t,-t,0,-t,-t,0,t,t,0,-t]}})}render(){let t=this.context,e=[{view:t.currentTextureView,clearValue:{r:1,g:1,b:1,a:1},loadOp:"clear",storeOp:"store"}],i=t.device.createCommandEncoder();i.beginRenderPass({colorAttachments:e}).end();let s=i.finish();t.device.queue.submit([s])}reset(){this.world.clearEntities()}update(t){this.context.beginFrame(),this.world.update()}updateLayout(){this.launcher.addAppInput(this.inputRotation),this.launcher.addAppInput(this.inputProjection)}createWorldMatrix(t,e){let n=parseInt(this.inputRotation.getValue())*Math.PI/180,s=O.identity;s.rotateYAnglePre(n);let r=O.identity;r.rotateXAnglePre(.5),r.translatePre(0,0,-15);let o;return this.inputProjection.getValue()==="orthographic"?o=O.fromOrthographic(-10,10,10,-10,1,2e3):o=O.fromPerspectiveFrustum(65,t/e,1,2e3),o.translatePre(0,0,1),o.scalePre(1,1,.5),o.mul(r).mul(s)}},Mn={color:{r:1,g:0,b:0,a:0},topology:"line-list"},On={color:{r:0,g:1,b:0,a:0},topology:"line-list"},Fn={color:{r:0,g:0,b:1,a:0},topology:"line-list"},zn={color:{r:.5,g:.5,b:.5,a:.7},topology:"triangle-list"};var kn=await ht.createContext(),J=new ht(kn);J.addCanvas2D("bplustree",0,De);J.addCanvas2D("ecs",1,Re);J.addCanvas2D("image",0,He);J.addCanvas2D("matrix",0,$e);J.addCanvas2D("mesh",0,Ge);J.addCanvas2D("path-area",0,Je);J.addCanvas2D("path-clip",0,ti);J.addCanvas2D("path-intersection",0,ei);J.addCanvas2D("path-operations",0,ii);J.addCanvas2D("path-overlay",0,ni);J.addCanvas2D("playground",0,si);J.addCanvas2D("sampling",0,ri);J.addCanvas2D("skeleton",0,oi);J.addCanvas2D("snaprounding",0,ai);J.addCanvas2D("triangulate",0,ci);J.addCanvasWebGPU("weggpu",1,ui);J.init("playground");
